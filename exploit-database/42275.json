{
    "cpes": {
        "cpe:/o:redhat:enterprise_linux:7.0:ga:server": {
            "scores": {
                "stride": "000000"
            }
        }
    }, 
    "source": "exploit-database", 
    "exploit": "LyoNCiAqIExpbnV4X2xkc29faHdjYXBfNjQuYyBmb3IgQ1ZFLTIwMTctMTAwMDM2NiwgQ1ZFLTIwMTctMTAwMDM3OQ0KICogQ29weXJpZ2h0IChDKSAyMDE3IFF1YWx5cywgSW5jLg0KICoNCiAqIG15X2ltcG9ydGFudF9od2NhcHMoKSBhZGFwdGVkIGZyb20gZWxmL2RsLWh3Y2Fwcy5jLA0KICogcGFydCBvZiB0aGUgR05VIEMgTGlicmFyeToNCiAqIENvcHlyaWdodCAoQykgMjAxMi0yMDE3IEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgSW5jLg0KICoNCiAqIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5DQogKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQ0KICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3INCiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uDQogKg0KICogVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsDQogKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZg0KICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQ0KICogR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4NCiAqDQogKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQ0KICogYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uDQogKi8NCg0KLyoqDQpjYXQgPiBsYS5jIDw8ICJFT0YiDQpzdGF0aWMgdm9pZCBfX2F0dHJpYnV0ZV9fICgoY29uc3RydWN0b3IpKSBfaW5pdCAodm9pZCkgew0KICAgIF9fYXNtX18gX192b2xhdGlsZV9fICgNCiAgICAiYWRkcSAkNjQsICVyc3A7Ig0KICAgIC8vIHNldHVpZCgwKTsNCiAgICAibW92cSAkMTA1LCAlcmF4OyINCiAgICAibW92cSAkMCwgJXJkaTsiDQogICAgInN5c2NhbGw7Ig0KICAgIC8vIHNldGdpZCgwKTsNCiAgICAibW92cSAkMTA2LCAlcmF4OyINCiAgICAibW92cSAkMCwgJXJkaTsiDQogICAgInN5c2NhbGw7Ig0KICAgIC8vIGR1cDIoMCwgMSk7DQogICAgIm1vdnEgJDMzLCAlcmF4OyINCiAgICAibW92cSAkMCwgJXJkaTsiDQogICAgIm1vdnEgJDEsICVyc2k7Ig0KICAgICJzeXNjYWxsOyINCiAgICAvLyBkdXAyKDAsIDIpOw0KICAgICJtb3ZxICQzMywgJXJheDsiDQogICAgIm1vdnEgJDAsICVyZGk7Ig0KICAgICJtb3ZxICQyLCAlcnNpOyINCiAgICAic3lzY2FsbDsiDQogICAgLy8gZXhlY3ZlKCIvYmluL3NoIik7DQogICAgIm1vdnEgJDU5LCAlcmF4OyINCiAgICAibW92cSAkMHgwMDY4NzMyZjZlNjk2MjJmLCAlcmRpOyINCiAgICAicHVzaHEgJXJkaTsiDQogICAgIm1vdnEgJXJzcCwgJXJkaTsiDQogICAgIm1vdnEgJDAsICVyZHg7Ig0KICAgICJwdXNocSAlcmR4OyINCiAgICAicHVzaHEgJXJkaTsiDQogICAgIm1vdnEgJXJzcCwgJXJzaTsiDQogICAgInN5c2NhbGw7Ig0KICAgIC8vIGV4aXQoMCk7DQogICAgIm1vdnEgJDYwLCAlcmF4OyINCiAgICAibW92cSAkMCwgJXJkaTsiDQogICAgInN5c2NhbGw7Ig0KICAgICk7DQp9DQpFT0YNCmdjYyAtZnBpYyAtc2hhcmVkIC1ub3N0ZGxpYiAtT3MgLXMgLW8gbGEuc28gbGEuYw0KeHhkIC1pIGxhLnNvID4gbGEuc28uaA0KKiovDQoNCiNkZWZpbmUgX0dOVV9TT1VSQ0UNCiNpbmNsdWRlIDxhc3NlcnQuaD4NCiNpbmNsdWRlIDxlbGYuaD4NCiNpbmNsdWRlIDxmY250bC5oPg0KI2luY2x1ZGUgPGxpbWl0cy5oPg0KI2luY2x1ZGUgPGxpbmsuaD4NCiNpbmNsdWRlIDxzaWduYWwuaD4NCiNpbmNsdWRlIDxzdGRhcmcuaD4NCiNpbmNsdWRlIDxzdGRpby5oPg0KI2luY2x1ZGUgPHN0ZGxpYi5oPg0KI2luY2x1ZGUgPHN0cmluZy5oPg0KI2luY2x1ZGUgPHN5cy9wYXJhbS5oPg0KI2luY2x1ZGUgPHN5cy9yZXNvdXJjZS5oPg0KI2luY2x1ZGUgPHN5cy9zdGF0Lmg+DQojaW5jbHVkZSA8c3lzL3RpbWUuaD4NCiNpbmNsdWRlIDxzeXMvdHlwZXMuaD4NCiNpbmNsdWRlIDxzeXMvd2FpdC5oPg0KI2luY2x1ZGUgPHVuaXN0ZC5oPg0KDQojZGVmaW5lIFBBR0VTWiAoKHNpemVfdCk0MDk2KQ0KI2RlZmluZSBTVEFDS19BTElHTiAoKHNpemVfdCkxNikNCiNkZWZpbmUgTUFMTE9DX0FMSUdOICgoc2l6ZV90KTgpDQoNCiNkZWZpbmUgTUFYX0FSR19TVFJMRU4gKChzaXplX3QpMTI4PDwxMCkNCg0KI2RlZmluZSBTVUJfU1RBQ0tfUkFORCAoKHNpemVfdCk4MTkyKQ0KI2RlZmluZSBJTklUSUFMX1NUQUNLX0VYUEFOU0lPTiAoMTMxMDcyVUwpDQoNCiNkZWZpbmUgTERTTyAiL2xpYjY0L2xkLWxpbnV4LXg4Ni02NC5zby4yIg0KDQpzdGF0aWMgY29uc3Qgc3RydWN0IHRhcmdldCAqIHRhcmdldDsNCnN0YXRpYyBjb25zdCBzdHJ1Y3QgdGFyZ2V0IHsNCiAgICBjb25zdCBjaGFyICogbmFtZTsNCiAgICBzaXplX3QgdmRzb192dmFyOw0KICAgIGludCBqdW1wX2xkc29fcGllOw0KICAgIGludCBDVkVfMjAxNV8xNTkzOw0KICAgIGludCBvZmZzZXQybGliOw0KICAgIGNvbnN0IGNoYXIgKiBzeXN0ZW1fZGlyOw0KICAgIGNvbnN0IGNoYXIgKiByZXBsX2xpYjsNCiAgICB1bnNpZ25lZCBpbnQgZXh0cmFfcGFnZTsNCiAgICBpbnQgaWdub3JlX2xpYjsNCiAgICBpbnQgaWdub3JlX29yaWdpbjsNCiAgICBpbnQgZGlzYWJsZV9hdWRpdDsNCn0gdGFyZ2V0c1tdID0gew0KICAgIHsNCiAgICAgICAgLm5hbWUgPSAiRGViaWFuIDcuNyAod2hlZXp5KSIsDQogICAgICAgIC52ZHNvX3Z2YXIgPSA0MDk2LA0KICAgICAgICAuanVtcF9sZHNvX3BpZSA9IDEsDQogICAgICAgIC5DVkVfMjAxNV8xNTkzID0gMSwNCiAgICAgICAgLm9mZnNldDJsaWIgPSAxLA0KICAgICAgICAuc3lzdGVtX2RpciA9ICIvbGliIiwNCiAgICAgICAgLnJlcGxfbGliID0gImxpYi94ODZfNjQtbGludXgtZ251IiwNCiAgICB9LA0KICAgIHsNCiAgICAgICAgLm5hbWUgPSAiRGViaWFuIDguNSAoamVzc2llKSIsDQogICAgICAgIC52ZHNvX3Z2YXIgPSAxNjM4NCwNCiAgICAgICAgLm9mZnNldDJsaWIgPSAxLA0KICAgICAgICAuc3lzdGVtX2RpciA9ICIvbGliIiwNCiAgICAgICAgLnJlcGxfbGliID0gImxpYi94ODZfNjQtbGludXgtZ251IiwNCiAgICB9LA0KICAgIHsNCiAgICAgICAgLm5hbWUgPSAiRGViaWFuIDkuMCAoc3RyZXRjaCkiLA0KICAgICAgICAudmRzb192dmFyID0gMTYzODQsDQogICAgICAgIC5zeXN0ZW1fZGlyID0gIi9saWIiLA0KICAgICAgICAucmVwbF9saWIgPSAibGliL3g4Nl82NC1saW51eC1nbnUiLA0KICAgICAgICAuZXh0cmFfcGFnZSA9IDEsDQogICAgfSwNCiAgICB7DQogICAgICAgIC5uYW1lID0gIlVidW50dSAxNC4wNC4yIChUcnVzdHkgVGFocikiLA0KICAgICAgICAudmRzb192dmFyID0gODE5MiwNCiAgICAgICAgLmp1bXBfbGRzb19waWUgPSAxLA0KICAgICAgICAuQ1ZFXzIwMTVfMTU5MyA9IDEsDQogICAgICAgIC5vZmZzZXQybGliID0gMSwNCiAgICAgICAgLnN5c3RlbV9kaXIgPSAiL2xpYiIsDQogICAgICAgIC5yZXBsX2xpYiA9ICJsaWIveDg2XzY0LWxpbnV4LWdudSIsDQogICAgICAgIC5kaXNhYmxlX2F1ZGl0ID0gMSwNCiAgICB9LA0KICAgIHsNCiAgICAgICAgLm5hbWUgPSAiVWJ1bnR1IDE2LjA0LjIgKFhlbmlhbCBYZXJ1cykiLA0KICAgICAgICAudmRzb192dmFyID0gMTYzODQsDQogICAgICAgIC5zeXN0ZW1fZGlyID0gIi9saWIiLA0KICAgICAgICAucmVwbF9saWIgPSAibGliL3g4Nl82NC1saW51eC1nbnUiLA0KICAgICAgICAuZGlzYWJsZV9hdWRpdCA9IDEsDQogICAgfSwNCiAgICB7DQogICAgICAgIC5uYW1lID0gIlVidW50dSAxNy4wNCAoWmVzdHkgWmFwdXMpIiwNCiAgICAgICAgLnZkc29fdnZhciA9IDE2Mzg0LA0KICAgICAgICAuc3lzdGVtX2RpciA9ICIvbGliIiwNCiAgICAgICAgLnJlcGxfbGliID0gImxpYi94ODZfNjQtbGludXgtZ251IiwNCiAgICAgICAgLmV4dHJhX3BhZ2UgPSAxLA0KICAgICAgICAuZGlzYWJsZV9hdWRpdCA9IDEsDQogICAgfSwNCiAgICB7DQogICAgICAgIC5uYW1lID0gIkZlZG9yYSAyMiAoVHdlbnR5IFR3bykiLA0KICAgICAgICAudmRzb192dmFyID0gMTYzODQsDQogICAgICAgIC5vZmZzZXQybGliID0gMSwNCiAgICAgICAgLnN5c3RlbV9kaXIgPSAiL2xpYjY0IiwNCiAgICAgICAgLnJlcGxfbGliID0gImxpYjY0IiwNCiAgICB9LA0KICAgIHsNCiAgICAgICAgLm5hbWUgPSAiRmVkb3JhIDI1IChTZXJ2ZXIgRWRpdGlvbikiLA0KICAgICAgICAudmRzb192dmFyID0gMTYzODQsDQogICAgICAgIC5zeXN0ZW1fZGlyID0gIi9saWI2NCIsDQogICAgICAgIC5yZXBsX2xpYiA9ICJsaWI2NCIsDQogICAgICAgIC5leHRyYV9wYWdlID0gMSwNCiAgICB9LA0KICAgIHsNCiAgICAgICAgLm5hbWUgPSAiQ2VudE9TIDcuMy4xNjExIChDb3JlKSIsDQogICAgICAgIC52ZHNvX3Z2YXIgPSA4MTkyLA0KICAgICAgICAuanVtcF9sZHNvX3BpZSA9IDEsDQogICAgICAgIC5vZmZzZXQybGliID0gMSwNCiAgICAgICAgLnN5c3RlbV9kaXIgPSAiL2xpYjY0IiwNCiAgICAgICAgLnJlcGxfbGliID0gImxpYjY0IiwNCiAgICB9LA0KfTsNCg0KI2RlZmluZSBkaWUoKSBkbyB7IFwNCiAgICBwcmludGYoImRpZWQgaW4gJXM6ICV1XG4iLCBfX2Z1bmNfXywgX19MSU5FX18pOyBcDQogICAgZXhpdChFWElUX0ZBSUxVUkUpOyBcDQp9IHdoaWxlICgwKQ0KDQpzdGF0aWMgY29uc3QgY2hhciAqDQpteV9hc3ByaW50Zihjb25zdCBjaGFyICogY29uc3QgZm10LCAuLi4pDQp7DQogICAgaWYgKCFmbXQpIGRpZSgpOw0KICAgIGNoYXIgKiBzdHIgPSBOVUxMOw0KICAgIHZhX2xpc3QgYXA7DQogICAgdmFfc3RhcnQoYXAsIGZtdCk7DQogICAgY29uc3QgaW50IGxlbiA9IHZhc3ByaW50Zigmc3RyLCBmbXQsIGFwKTsNCiAgICB2YV9lbmQoYXApOw0KICAgIGlmICghc3RyKSBkaWUoKTsNCiAgICBpZiAobGVuIDw9IDApIGRpZSgpOw0KICAgIGlmICgodW5zaWduZWQgaW50KWxlbiAhPSBzdHJsZW4oc3RyKSkgZGllKCk7DQogICAgcmV0dXJuIHN0cjsNCn0NCg0Kc3RhdGljIGNvbnN0IEVsZlcoYXV4dl90KSAqIG15X2F1eHY7DQoNCnN0YXRpYyB1bnNpZ25lZCBsb25nIGludA0KbXlfZ2V0YXV4dmFsIChjb25zdCB1bnNpZ25lZCBsb25nIGludCB0eXBlKQ0Kew0KICAgIGNvbnN0IEVsZlcoYXV4dl90KSAqIHA7DQoNCiAgICBpZiAoIW15X2F1eHYpIGRpZSgpOw0KICAgIGZvciAocCA9IG15X2F1eHY7IHAtPmFfdHlwZSAhPSBBVF9OVUxMOyBwKyspDQogICAgICAgIGlmIChwLT5hX3R5cGUgPT0gdHlwZSkNCiAgICAgICAgICAgIHJldHVybiBwLT5hX3VuLmFfdmFsOw0KICAgIGRpZSgpOw0KfQ0KDQpzdHJ1Y3QgZWxmX2luZm8gew0KICAgIEVsZlcoSGFsZikgdHlwZTsNCiAgICB1aW50cHRyX3Qgcnhfc3RhcnQsIHJ4X2VuZDsNCiAgICB1aW50cHRyX3Qgcndfc3RhcnQsIHJ3X2VuZDsNCn07DQoNCnN0YXRpYyBzdHJ1Y3QgZWxmX2luZm8NCmdldF9lbGZfaW5mbyhjb25zdCBjaGFyICogY29uc3QgYmluYXJ5KQ0Kew0KICAgIHN0cnVjdCBlbGZfaW5mbyBlbGYgPSB7IEVUX05PTkUgfTsNCiAgICBpZiAoZWxmLnJ4X3N0YXJ0IHx8IGVsZi5yeF9lbmQpIGRpZSgpOw0KICAgIGlmIChlbGYucndfc3RhcnQgfHwgZWxmLnJ3X2VuZCkgZGllKCk7DQoNCiAgICBjb25zdCBpbnQgZmQgPSBvcGVuKGJpbmFyeSwgT19SRE9OTFkpOw0KICAgIGlmIChmZCA8PSAtMSkgZGllKCk7DQogICAgc3RydWN0IHN0YXQgc3Q7DQogICAgaWYgKGZzdGF0KGZkLCAmc3QpKSBkaWUoKTsNCiAgICBpZiAoIVNfSVNSRUcoc3Quc3RfbW9kZSkpIGRpZSgpOw0KICAgIGlmIChzdC5zdF9zaXplIDw9IDApIGRpZSgpOw0KICAgICNkZWZpbmUgU0FGRVNaICgoc2l6ZV90KTY0PDwyMCkNCiAgICBpZiAoc3Quc3Rfc2l6ZSA+PSAoc3NpemVfdClTQUZFU1opIGRpZSgpOw0KICAgIGNvbnN0IHNpemVfdCBzaXplID0gc3Quc3Rfc2l6ZTsNCiAgICB1aW50OF90ICogY29uc3QgYnVmID0gbWFsbG9jKHNpemUpOw0KICAgIGlmICghYnVmKSBkaWUoKTsNCiAgICBpZiAocmVhZChmZCwgYnVmLCBzaXplKSAhPSAoc3NpemVfdClzaXplKSBkaWUoKTsNCiAgICBpZiAoY2xvc2UoZmQpKSBkaWUoKTsNCg0KICAgIGlmIChzaXplIDw9IHNpemVvZihFbGZXKEVoZHIpKSkgZGllKCk7DQogICAgY29uc3QgRWxmVyhFaGRyKSAqIGNvbnN0IGVoZHIgPSAoY29uc3QgRWxmVyhFaGRyKSAqKWJ1ZjsNCiAgICBpZiAoZWhkci0+ZV9pZGVudFtFSV9NQUcwXSAhPSBFTEZNQUcwKSBkaWUoKTsNCiAgICBpZiAoZWhkci0+ZV9pZGVudFtFSV9NQUcxXSAhPSBFTEZNQUcxKSBkaWUoKTsNCiAgICBpZiAoZWhkci0+ZV9pZGVudFtFSV9NQUcyXSAhPSBFTEZNQUcyKSBkaWUoKTsNCiAgICBpZiAoZWhkci0+ZV9pZGVudFtFSV9NQUczXSAhPSBFTEZNQUczKSBkaWUoKTsNCiAgICBpZiAoZWhkci0+ZV9pZGVudFtFSV9DTEFTU10gIT0gRUxGQ0xBU1M2NCkgZGllKCk7DQogICAgaWYgKGVoZHItPmVfaWRlbnRbRUlfREFUQV0gIT0gRUxGREFUQTJMU0IpIGRpZSgpOw0KICAgIGlmIChlaGRyLT5lX3R5cGUgIT0gRVRfRFlOICYmIGVoZHItPmVfdHlwZSAhPSBFVF9FWEVDKSBkaWUoKTsNCiAgICBpZiAoZWhkci0+ZV9tYWNoaW5lICE9IEVNX1g4Nl82NCkgZGllKCk7DQogICAgaWYgKGVoZHItPmVfdmVyc2lvbiAhPSBFVl9DVVJSRU5UKSBkaWUoKTsNCiAgICBpZiAoZWhkci0+ZV9laHNpemUgIT0gc2l6ZW9mKEVsZlcoRWhkcikpKSBkaWUoKTsNCiAgICBpZiAoZWhkci0+ZV9waGVudHNpemUgIT0gc2l6ZW9mKEVsZlcoUGhkcikpKSBkaWUoKTsNCiAgICBpZiAoZWhkci0+ZV9waG9mZiA8PSAwIHx8IGVoZHItPmVfcGhvZmYgPj0gc2l6ZSkgZGllKCk7DQogICAgaWYgKGVoZHItPmVfcGhudW0gPiAoc2l6ZSAtIGVoZHItPmVfcGhvZmYpIC8gc2l6ZW9mKEVsZlcoUGhkcikpKSBkaWUoKTsNCiAgICBlbGYudHlwZSA9IGVoZHItPmVfdHlwZTsNCg0KICAgIGludCBpbnRlcnAgPSAwOw0KICAgIHVuc2lnbmVkIGludCBpOw0KICAgIGZvciAoaSA9IDA7IGkgPCBlaGRyLT5lX3BobnVtOyBpKyspIHsNCiAgICAgICAgY29uc3QgRWxmVyhQaGRyKSAqIGNvbnN0IHBoZHIgPSAoY29uc3QgRWxmVyhQaGRyKSAqKShidWYgKyBlaGRyLT5lX3Bob2ZmKSArIGk7DQogICAgICAgIGlmIChwaGRyLT5wX3R5cGUgPT0gUFRfSU5URVJQKSBpbnRlcnAgPSAxOw0KICAgICAgICBpZiAocGhkci0+cF90eXBlICE9IFBUX0xPQUQpIGNvbnRpbnVlOw0KDQogICAgICAgIGlmIChwaGRyLT5wX29mZnNldCA+PSBzaXplKSBkaWUoKTsNCiAgICAgICAgaWYgKHBoZHItPnBfZmlsZXN6ID4gc2l6ZSAtIHBoZHItPnBfb2Zmc2V0KSBkaWUoKTsNCiAgICAgICAgaWYgKHBoZHItPnBfZmlsZXN6ID4gcGhkci0+cF9tZW1zeikgZGllKCk7DQogICAgICAgIGlmIChwaGRyLT5wX3ZhZGRyICE9IHBoZHItPnBfcGFkZHIpIGRpZSgpOw0KICAgICAgICBpZiAocGhkci0+cF92YWRkciA+PSBTQUZFU1opIGRpZSgpOw0KICAgICAgICBpZiAocGhkci0+cF9tZW1zeiA+PSBTQUZFU1opIGRpZSgpOw0KICAgICAgICBpZiAocGhkci0+cF9tZW1zeiA8PSAwKSBkaWUoKTsNCiAgICAgICAgaWYgKHBoZHItPnBfYWxpZ24gIT0gMHgyMDAwMDApIGRpZSgpOw0KDQogICAgICAgIHN3aXRjaCAocGhkci0+cF9mbGFncykgew0KICAgICAgICAgICAgY2FzZSBQRl9SIHwgUEZfWDoNCiAgICAgICAgICAgICAgICBpZiAoZWxmLnJ4X2VuZCkgZGllKCk7DQogICAgICAgICAgICAgICAgaWYgKGVsZi5yd19lbmQpIGRpZSgpOw0KICAgICAgICAgICAgICAgIGlmIChwaGRyLT5wX3ZhZGRyICYmIGVoZHItPmVfdHlwZSAhPSBFVF9FWEVDKSBkaWUoKTsNCiAgICAgICAgICAgICAgICBlbGYucnhfc3RhcnQgPSBwaGRyLT5wX3ZhZGRyICYgfihQQUdFU1otMSk7DQogICAgICAgICAgICAgICAgZWxmLnJ4X2VuZCA9IChwaGRyLT5wX3ZhZGRyICsgcGhkci0+cF9tZW1zeiArIFBBR0VTWi0xKSAmIH4oUEFHRVNaLTEpOw0KICAgICAgICAgICAgICAgIGlmICghZWxmLnJ4X2VuZCkgZGllKCk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlIFBGX1IgfCBQRl9XOg0KICAgICAgICAgICAgICAgIGlmICghZWxmLnJ4X2VuZCkgZGllKCk7DQogICAgICAgICAgICAgICAgaWYgKGVsZi5yd19lbmQpIGRpZSgpOw0KICAgICAgICAgICAgICAgIGVsZi5yd19zdGFydCA9IHBoZHItPnBfdmFkZHIgJiB+KFBBR0VTWi0xKTsNCiAgICAgICAgICAgICAgICBlbGYucndfZW5kID0gKHBoZHItPnBfdmFkZHIgKyBwaGRyLT5wX21lbXN6ICsgUEFHRVNaLTEpICYgfihQQUdFU1otMSk7DQogICAgICAgICAgICAgICAgaWYgKGVsZi5yd19zdGFydCA8PSBlbGYucnhfZW5kKSBkaWUoKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgZGllKCk7DQogICAgICAgIH0NCiAgICB9DQogICAgaWYgKCFpbnRlcnAgJiYgIXN0cnN0cihiaW5hcnksICIvbGQtbGludXgiKSkgZGllKCk7DQogICAgaWYgKCFlbGYucnhfZW5kKSBkaWUoKTsNCiAgICBpZiAoIWVsZi5yd19lbmQpIGRpZSgpOw0KICAgIGZyZWUoYnVmKTsNCiAgICByZXR1cm4gZWxmOw0KfQ0KDQovKiBUaGVyZSBhcmUgbm8gaGFyZHdhcmUgY2FwYWJpbGl0aWVzIGRlZmluZWQuICAqLw0KI2RlZmluZSBteV9od2NhcF9zdHJpbmcoaWR4KSAiIg0KDQpzdHJ1Y3QgbXlfaW1wb3J0YW50X2h3Y2FwcyB7DQogICAgdW5zaWduZWQgbG9uZyBod2NhcF9tYXNrOw0KICAgIHNpemVfdCBtYXhfY2Fwc3RybGVuOw0KICAgIHNpemVfdCBwb2ludGVyczsNCiAgICBzaXplX3Qgc3RyaW5nczsNCn07DQoNCnN0cnVjdCBteV9saW5rX21hcCB7DQogICAgY29uc3QgRWxmVyhQaGRyKSAqIGxfcGhkcjsNCiAgICBFbGZXKEhhbGYpIGxfcGhudW07DQogICAgRWxmVyhBZGRyKSBsX2FkZHI7DQp9Ow0KDQpzdHJ1Y3Qgcl9zdHJsZW5wYWlyDQogIHsNCiAgICBjb25zdCBjaGFyICpzdHI7DQogICAgc2l6ZV90IGxlbjsNCiAgfTsNCg0KLyogUmV0dXJuIGFuIGFycmF5IG9mIHVzZWZ1bC9uZWNlc3NhcnkgaGFyZHdhcmUgY2FwYWJpbGl0eSBuYW1lcy4gICovDQpzdGF0aWMgc3RydWN0IG15X2ltcG9ydGFudF9od2NhcHMNCm15X2ltcG9ydGFudF9od2NhcHMgKGNvbnN0IGNoYXIgKiBjb25zdCBwbGF0Zm9ybSwgY29uc3Qgc2l6ZV90IHBsYXRmb3JtX2xlbiwNCiAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHVpbnQ2NF90IGh3Y2FwLCBjb25zdCB1aW50NjRfdCBod2NhcF9tYXNrLA0KICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RydWN0IG15X2xpbmtfbWFwICogc3lzaW5mb19tYXApDQp7DQogIHN0YXRpYyBjb25zdCBzdHJ1Y3QgbXlfaW1wb3J0YW50X2h3Y2FwcyBlcnI7DQogIC8qIERldGVybWluZSBob3cgbWFueSBpbXBvcnRhbnQgYml0cyBhcmUgc2V0LiAgKi8NCiAgdWludDY0X3QgbWFza2VkID0gaHdjYXAgJiBod2NhcF9tYXNrOw0KICBzaXplX3QgY250ID0gcGxhdGZvcm0gIT0gTlVMTDsNCiAgc2l6ZV90IG4sIG07DQogIHNpemVfdCB0b3RhbDsNCiAgc3RydWN0IHJfc3RybGVucGFpciAqcmVzdWx0Ow0KDQogIC8qIENvdW50IHRoZSBudW1iZXIgb2YgYml0cyBzZXQgaW4gdGhlIG1hc2tlZCB2YWx1ZS4gICovDQogIGZvciAobiA9IDA7ICh+KCgxVUxMIDw8IG4pIC0gMSkgJiBtYXNrZWQpICE9IDA7ICsrbikNCiAgICBpZiAoKG1hc2tlZCAmICgxVUxMIDw8IG4pKSAhPSAwKQ0KICAgICAgKytjbnQ7DQoNCiAgLyogVGhlIHN5c3RlbS1zdXBwbGllZCBEU08gY2FuIGNvbnRhaW4gYSBub3RlIG9mIHR5cGUgMiwgdmVuZG9yICJHTlUiLg0KICAgICBUaGlzIGdpdmVzIHVzIGEgbGlzdCBvZiBuYW1lcyB0byB0cmVhdCBhcyBmYWtlIGh3Y2FwIGJpdHMuICAqLw0KDQogIGNvbnN0IGNoYXIgKmRzb2NhcHMgPSBOVUxMOw0KICBzaXplX3QgZHNvY2Fwc2xlbiA9IDA7DQogIGlmIChzeXNpbmZvX21hcCAhPSBOVUxMKQ0KICAgIHsNCiAgICAgIGNvbnN0IEVsZlcoUGhkcikgKmNvbnN0IHBoZHIgPSBzeXNpbmZvX21hcC0+bF9waGRyOw0KICAgICAgY29uc3QgRWxmVyhXb3JkKSBwaG51bSA9IHN5c2luZm9fbWFwLT5sX3BobnVtOw0KICAgICAgdWludF9mYXN0MTZfdCBpOw0KICAgICAgZm9yIChpID0gMDsgaSA8IHBobnVtOyArK2kpDQogICAgICAgIGlmIChwaGRyW2ldLnBfdHlwZSA9PSBQVF9OT1RFKQ0KICAgICAgICAgIHsNCiAgICAgICAgICAgIGNvbnN0IEVsZlcoQWRkcikgc3RhcnQgPSAocGhkcltpXS5wX3ZhZGRyDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgc3lzaW5mb19tYXAtPmxfYWRkcik7DQogICAgICAgICAgICAvKiBUaGUgc3RhbmRhcmQgRUxGIG5vdGUgbGF5b3V0IGlzIGV4YWN0bHkgYXMgdGhlIGFub255bW91cyBzdHJ1Y3QuDQogICAgICAgICAgICAgICBUaGUgbmV4dCBlbGVtZW50IGlzIGEgdmFyaWFibGUgbGVuZ3RoIHZlbmRvciBuYW1lIG9mIGxlbmd0aA0KICAgICAgICAgICAgICAgVkVORE9STEVOICh3aXRoIGEgcmVhbCBsZW5ndGggcm91bmRlZCB0byBFbGZXKFdvcmQpKSwgZm9sbG93ZWQNCiAgICAgICAgICAgICAgIGJ5IHRoZSBkYXRhIG9mIGxlbmd0aCBEQVRBTEVOICh3aXRoIGEgcmVhbCBsZW5ndGggcm91bmRlZCB0bw0KICAgICAgICAgICAgICAgRWxmVyhXb3JkKSkuICAqLw0KICAgICAgICAgICAgY29uc3Qgc3RydWN0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgIEVsZlcoV29yZCkgdmVuZG9ybGVuOw0KICAgICAgICAgICAgICBFbGZXKFdvcmQpIGRhdGFsZW47DQogICAgICAgICAgICAgIEVsZlcoV29yZCkgdHlwZTsNCiAgICAgICAgICAgIH0gKm5vdGUgPSAoY29uc3Qgdm9pZCAqKSBzdGFydDsNCiAgICAgICAgICAgIHdoaWxlICgoRWxmVyhBZGRyKSkgKG5vdGUgKyAxKSAtIHN0YXJ0IDwgcGhkcltpXS5wX21lbXN6KQ0KICAgICAgICAgICAgICB7DQojZGVmaW5lIFJPVU5EKGxlbikgKCgobGVuKSArIHNpemVvZiAoRWxmVyhXb3JkKSkgLSAxKSAmIC1zaXplb2YgKEVsZlcoV29yZCkpKQ0KICAgICAgICAgICAgICAgIC8qIFRoZSBsYXlvdXQgb2YgdGhlIHR5cGUgMiwgdmVuZG9yICJHTlUiIG5vdGUgaXMgYXMgZm9sbG93czoNCiAgICAgICAgICAgICAgICAgICAubG9uZyA8TnVtYmVyIG9mIGNhcGFiaWxpdGllcyBlbmFibGVkIGJ5IHRoaXMgbm90ZT4NCiAgICAgICAgICAgICAgICAgICAubG9uZyA8Q2FwYWJpbGl0aWVzIG1hc2s+IChhcyBtYXNrID4+IF9ETF9GSVJTVF9FWFRSQSkuDQogICAgICAgICAgICAgICAgICAgLmJ5dGUgPFRoZSBiaXQgbnVtYmVyIGZvciB0aGUgbmV4dCBjYXBhYmlsaXR5Pg0KICAgICAgICAgICAgICAgICAgIC5hc2NpeiA8VGhlIG5hbWUgb2YgdGhlIGNhcGFiaWxpdHk+LiAgKi8NCiAgICAgICAgICAgICAgICBpZiAobm90ZS0+dHlwZSA9PSBOVF9HTlVfSFdDQVANCiAgICAgICAgICAgICAgICAgICAgJiYgbm90ZS0+dmVuZG9ybGVuID09IHNpemVvZiAiR05VIg0KICAgICAgICAgICAgICAgICAgICAmJiAhbWVtY21wICgobm90ZSArIDEpLCAiR05VIiwgc2l6ZW9mICJHTlUiKQ0KICAgICAgICAgICAgICAgICAgICAmJiBub3RlLT5kYXRhbGVuID4gMiAqIHNpemVvZiAoRWxmVyhXb3JkKSkgKyAyKQ0KICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBjb25zdCBFbGZXKFdvcmQpICpwID0gKChjb25zdCB2b2lkICopIChub3RlICsgMSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIFJPVU5EIChzaXplb2YgIkdOVSIpKTsNCiAgICAgICAgICAgICAgICAgICAgY250ICs9ICpwKys7DQogICAgICAgICAgICAgICAgICAgICsrcDsgICAgICAgIC8qIFNraXAgbWFzayB3b3JkLiAgKi8NCiAgICAgICAgICAgICAgICAgICAgZHNvY2FwcyA9IChjb25zdCBjaGFyICopIHA7IC8qIFBzZXVkby1zdHJpbmcgIjxiPm5hbWUiICAqLw0KICAgICAgICAgICAgICAgICAgICBkc29jYXBzbGVuID0gbm90ZS0+ZGF0YWxlbiAtIHNpemVvZiAqcCAqIDI7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIG5vdGUgPSAoKGNvbnN0IHZvaWQgKikgKG5vdGUgKyAxKQ0KICAgICAgICAgICAgICAgICAgICAgICAgKyBST1VORCAobm90ZS0+dmVuZG9ybGVuKSArIFJPVU5EIChub3RlLT5kYXRhbGVuKSk7DQojdW5kZWYgUk9VTkQNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGRzb2NhcHMgIT0gTlVMTCkNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgfQ0KICAgIH0NCg0KICAvKiBGb3IgVExTIGVuYWJsZWQgYnVpbGRzIGFsd2F5cyBhZGQgJ3RscycuICAqLw0KICArK2NudDsNCg0KICAvKiBDcmVhdGUgdGVtcG9yYXJ5IGRhdGEgc3RydWN0dXJlIHRvIGdlbmVyYXRlIHJlc3VsdCB0YWJsZS4gICovDQogIGlmIChjbnQgPCAyKSByZXR1cm4gZXJyOw0KICBpZiAoY250ID49IDMyKSByZXR1cm4gZXJyOw0KICBzdHJ1Y3Qgcl9zdHJsZW5wYWlyIHRlbXBbY250XTsNCiAgbSA9IDA7DQogIGlmIChkc29jYXBzICE9IE5VTEwpDQogICAgew0KICAgICAgLyogZHNvY2FwcyBwb2ludHMgdG8gdGhlIC5hc2NpeiBzdHJpbmcsIGFuZCAtMSBwb2ludHMgdG8gdGhlIG1hc2sNCiAgICAgICAgIC5sb25nIGp1c3QgYmVmb3JlIHRoZSBzdHJpbmcuICAqLw0KICAgICAgY29uc3QgRWxmVyhXb3JkKSBtYXNrID0gKChjb25zdCBFbGZXKFdvcmQpICopIGRzb2NhcHMpWy0xXTsNCiAgICAgIHNpemVfdCBsZW47DQogICAgICBjb25zdCBjaGFyICpwOw0KICAgICAgZm9yIChwID0gZHNvY2FwczsgcCA8IGRzb2NhcHMgKyBkc29jYXBzbGVuOyBwICs9IGxlbiArIDEpDQogICAgICAgIHsNCiAgICAgICAgICB1aW50X2Zhc3Q4X3QgYml0ID0gKnArKzsNCiAgICAgICAgICBsZW4gPSBzdHJsZW4gKHApOw0KDQogICAgICAgICAgLyogU2tpcCBlbnRyaWVzIHRoYXQgYXJlIG5vdCBlbmFibGVkIGluIHRoZSBtYXNrIHdvcmQuICAqLw0KICAgICAgICAgIGlmIChtYXNrICYgKChFbGZXKFdvcmQpKSAxIDw8IGJpdCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgIHRlbXBbbV0uc3RyID0gcDsNCiAgICAgICAgICAgICAgdGVtcFttXS5sZW4gPSBsZW47DQogICAgICAgICAgICAgICsrbTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICBlbHNlDQogICAgICAgICAgICAtLWNudDsNCiAgICAgICAgfQ0KICAgIH0NCiAgZm9yIChuID0gMDsgbWFza2VkICE9IDA7ICsrbikNCiAgICBpZiAoKG1hc2tlZCAmICgxVUxMIDw8IG4pKSAhPSAwKQ0KICAgICAgew0KICAgICAgICB0ZW1wW21dLnN0ciA9IG15X2h3Y2FwX3N0cmluZyAobik7DQogICAgICAgIHRlbXBbbV0ubGVuID0gc3RybGVuICh0ZW1wW21dLnN0cik7DQogICAgICAgIG1hc2tlZCBePSAxVUxMIDw8IG47DQogICAgICAgICsrbTsNCiAgICAgIH0NCiAgaWYgKHBsYXRmb3JtICE9IE5VTEwpDQogICAgew0KICAgICAgdGVtcFttXS5zdHIgPSBwbGF0Zm9ybTsNCiAgICAgIHRlbXBbbV0ubGVuID0gcGxhdGZvcm1fbGVuOw0KICAgICAgKyttOw0KICAgIH0NCg0KICB0ZW1wW21dLnN0ciA9ICJ0bHMiOw0KICB0ZW1wW21dLmxlbiA9IDM7DQogICsrbTsNCg0KICBhc3NlcnQgKG0gPT0gY250KTsNCg0KICAvKiBEZXRlcm1pbmUgdGhlIHRvdGFsIHNpemUgb2YgYWxsIHN0cmluZ3MgdG9nZXRoZXIuICAqLw0KICBpZiAoY250ID09IDEpDQogICAgdG90YWwgPSB0ZW1wWzBdLmxlbiArIDE7DQogIGVsc2UNCiAgICB7DQogICAgICB0b3RhbCA9IHRlbXBbMF0ubGVuICsgdGVtcFtjbnQgLSAxXS5sZW4gKyAyOw0KICAgICAgaWYgKGNudCA+IDIpDQogICAgICAgIHsNCiAgICAgICAgICB0b3RhbCA8PD0gMTsNCiAgICAgICAgICBmb3IgKG4gPSAxOyBuICsgMSA8IGNudDsgKytuKQ0KICAgICAgICAgICAgdG90YWwgKz0gdGVtcFtuXS5sZW4gKyAxOw0KICAgICAgICAgIGlmIChjbnQgPiAzDQogICAgICAgICAgICAgICYmIChjbnQgPj0gc2l6ZW9mIChzaXplX3QpICogOA0KICAgICAgICAgICAgICAgICAgfHwgdG90YWwgKyAoc2l6ZW9mICgqcmVzdWx0KSA8PCAzKQ0KICAgICAgICAgICAgICAgICAgICAgPj0gKDFVTCA8PCAoc2l6ZW9mIChzaXplX3QpICogOCAtIGNudCArIDMpKSkpDQogICAgICAgICAgICByZXR1cm4gZXJyOw0KDQogICAgICAgICAgdG90YWwgPDw9IGNudCAtIDM7DQogICAgICAgIH0NCiAgICB9DQoNCiAgLyogVGhlIHJlc3VsdCBzdHJ1Y3R1cmU6IHdlIHVzZSBhIHZlcnkgY29tcHJlc3NlZCB3YXkgdG8gc3RvcmUgdGhlDQogICAgIHZhcmlvdXMgY29tYmluYXRpb25zIG9mIGNhcGFiaWxpdHkgbmFtZXMuICAqLw0KICBjb25zdCBzaXplX3QgX3N6ID0gMSA8PCBjbnQ7DQoNCiAgLyogTm93IHdlIGFyZSByZWFkeSB0byBpbnN0YWxsIHRoZSBzdHJpbmcgcG9pbnRlcnMgYW5kIGxlbmd0aC4gICovDQogIHNpemVfdCBtYXhfY2Fwc3RybGVuID0gMDsNCiAgbiA9IGNudDsNCiAgZG8NCiAgICB7DQogICAgICBjb25zdCBzaXplX3QgbWFzayA9IDEgPDwgLS1uOw0KICAgICAgZm9yIChtID0gMSA8PCBjbnQ7IG0gPiAwOyApIHsNCiAgICAgICAgaWYgKCgtLW0gJiBtYXNrKSAhPSAwKQ0KICAgICAgICAgIG1heF9jYXBzdHJsZW4gKz0gdGVtcFtuXS5sZW4gKyAxOw0KICAgICAgICBicmVhazsNCiAgICAgIH0NCiAgICB9DQogIHdoaWxlIChuICE9IDApOw0KDQogIGlmIChod2NhcF9tYXNrID4gVUxPTkdfTUFYKSBkaWUoKTsNCiAgY29uc3Qgc3RydWN0IG15X2ltcG9ydGFudF9od2NhcHMgcmV0ID0gew0KICAgICAgLmh3Y2FwX21hc2sgPSBod2NhcF9tYXNrLA0KICAgICAgLm1heF9jYXBzdHJsZW4gPSBtYXhfY2Fwc3RybGVuLA0KICAgICAgLnBvaW50ZXJzID0gX3N6ICogc2l6ZW9mICgqcmVzdWx0KSwNCiAgICAgIC5zdHJpbmdzID0gdG90YWwsDQogIH07DQogIHJldHVybiByZXQ7DQp9DQoNCnN0YXRpYyBzaXplX3QNCm15X2JzZWFyY2goY29uc3Qgdm9pZCAqIGNvbnN0IGtleSwNCiAgICBjb25zdCB2b2lkICogY29uc3QgYmFzZSwgY29uc3Qgc2l6ZV90IG5tZW1iLCBjb25zdCBzaXplX3Qgc2l6ZSwNCiAgICBpbnQgKCogY29uc3QgY29tcGFyKShjb25zdCB2b2lkICosIGNvbnN0IHZvaWQgKikpDQp7DQogICAgaWYgKCFrZXkpIGRpZSgpOw0KICAgIGlmICghc2l6ZSkgZGllKCk7DQogICAgaWYgKCFjb21wYXIpIGRpZSgpOw0KICAgIGlmIChubWVtYiA+PSBTU0laRV9NQVggLyBzaXplKSBkaWUoKTsNCiAgICBpZiAoIWJhc2UgIT0gIW5tZW1iKSBkaWUoKTsNCiAgICBpZiAoIWJhc2UgfHwgIW5tZW1iKSByZXR1cm4gMDsNCg0KICAgIHNpemVfdCBsb3cgPSAwOw0KICAgIHNpemVfdCBoaWdoID0gbm1lbWIgLSAxOw0KICAgIHdoaWxlIChsb3cgPD0gaGlnaCkgew0KICAgICAgICBjb25zdCBzaXplX3QgbWlkID0gbG93ICsgKGhpZ2ggLSBsb3cpIC8gMjsNCiAgICAgICAgaWYgKG1pZCA+PSBubWVtYikgZGllKCk7DQogICAgICAgIGNvbnN0IGludCBjb25kID0gY29tcGFyKGtleSwgYmFzZSArIG1pZCAqIHNpemUpOw0KICAgICAgICBzd2l0Y2ggKGNvbmQpIHsNCiAgICAgICAgY2FzZSAwOg0KICAgICAgICAgICAgcmV0dXJuIG1pZDsNCiAgICAgICAgY2FzZSAtMToNCiAgICAgICAgICAgIGlmIChtaWQgPD0gMCkgew0KICAgICAgICAgICAgICAgIGlmIChtaWQgIT0gMCkgZGllKCk7DQogICAgICAgICAgICAgICAgaWYgKGxvdyAhPSAwKSBkaWUoKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gbG93Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaGlnaCA9IG1pZCAtIDE7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSArMToNCiAgICAgICAgICAgIGxvdyA9IG1pZCArIDE7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgIGRpZSgpOw0KICAgICAgICB9DQogICAgfQ0KICAgIGlmIChsb3cgPiBubWVtYikgZGllKCk7DQogICAgcmV0dXJuIGxvdzsNCn0NCg0Kc3RhdGljIGludA0KY21wX2ltcG9ydGFudF9od2NhcHMoY29uc3Qgdm9pZCAqIGNvbnN0IF9hLCBjb25zdCB2b2lkICogY29uc3QgX2IpDQp7DQogICAgY29uc3Qgc3RydWN0IG15X2ltcG9ydGFudF9od2NhcHMgKiBjb25zdCBhID0gX2E7DQogICAgY29uc3Qgc3RydWN0IG15X2ltcG9ydGFudF9od2NhcHMgKiBjb25zdCBiID0gX2I7DQoNCiAgICBpZiAoYS0+c3RyaW5ncyA8IGItPnN0cmluZ3MpIHJldHVybiAtMTsNCiAgICBpZiAoYS0+c3RyaW5ncyA+IGItPnN0cmluZ3MpIHJldHVybiArMTsNCg0KICAgIGlmIChhLT5wb2ludGVycyA8IGItPnBvaW50ZXJzKSByZXR1cm4gLTE7DQogICAgaWYgKGEtPnBvaW50ZXJzID4gYi0+cG9pbnRlcnMpIHJldHVybiArMTsNCg0KICAgIGlmIChhLT5tYXhfY2Fwc3RybGVuIDwgYi0+bWF4X2NhcHN0cmxlbikgcmV0dXJuIC0xOw0KICAgIGlmIChhLT5tYXhfY2Fwc3RybGVuID4gYi0+bWF4X2NhcHN0cmxlbikgcmV0dXJuICsxOw0KDQogICAgcmV0dXJuIDA7DQp9DQoNCnN0YXRpYyB2b2lkDQpjb3B5X2xpYihjb25zdCBjaGFyICogY29uc3Qgc3JjLCBjb25zdCBjaGFyICogY29uc3QgZHN0KQ0Kew0KICAgIGlmICghc3JjKSBkaWUoKTsNCiAgICBpZiAoKnNyYyAhPSAnLycpIGRpZSgpOw0KDQogICAgaWYgKCFkc3QpIGRpZSgpOw0KICAgIGlmICgqZHN0ICE9ICcvJykgZGllKCk7DQoNCiAgICBjb25zdCBpbnQgc3JjX2ZkID0gb3BlbihzcmMsIE9fUkRPTkxZKTsNCiAgICBpZiAoc3JjX2ZkIDw9IC0xKSBkaWUoKTsNCg0KICAgIGNvbnN0IGludCBkc3RfZmQgPSBvcGVuKGRzdCwgT19XUk9OTFkgfCBPX0NSRUFUIHwgT19UUlVOQyB8IE9fTk9GT0xMT1csIDApOw0KICAgIGlmIChkc3RfZmQgPD0gLTEpIGRpZSgpOw0KDQogICAgZm9yICg7Oykgew0KICAgICAgICBjaGFyIGJ1ZlsxMDI0XTsNCiAgICAgICAgY29uc3Qgc3NpemVfdCByZCA9IHJlYWQoc3JjX2ZkLCBidWYsIHNpemVvZihidWYpKTsNCiAgICAgICAgaWYgKHJkID09IDApIGJyZWFrOw0KICAgICAgICBpZiAocmQgPD0gMCkgZGllKCk7DQogICAgICAgIGNvbnN0IHNzaXplX3Qgd3IgPSB3cml0ZShkc3RfZmQsIGJ1ZiwgcmQpOw0KICAgICAgICBpZiAod3IgIT0gcmQpIGRpZSgpOw0KICAgIH0NCg0KICAgIGlmIChmY2htb2QoZHN0X2ZkLCAwNzU1KSkgZGllKCk7DQogICAgaWYgKGNsb3NlKGRzdF9mZCkpIGRpZSgpOw0KICAgIGlmIChjbG9zZShzcmNfZmQpKSBkaWUoKTsNCn0NCg0Kc3RhdGljIHZvaWQNCmNyZWF0ZV9uZWVkZWRfbGlicyhjb25zdCBjaGFyICogY29uc3QgYmluLCBjb25zdCBjaGFyICogY29uc3QgZGlyKQ0Kew0KICAgIGlmICghYmluKSBkaWUoKTsNCiAgICBpZiAoKmJpbiAhPSAnLycpIGRpZSgpOw0KICAgIGlmIChzdHJzcG4oYmluLCAiYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXpBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWjAxMjM0NTY3ODkrLC0uL18iKSAhPSBzdHJsZW4oYmluKSkgZGllKCk7DQoNCiAgICBpZiAoIWRpcikgZGllKCk7DQogICAgaWYgKCpkaXIgIT0gJy8nKSBkaWUoKTsNCiAgICBpZiAoZGlyW3N0cmxlbihkaXIpLTFdICE9ICcvJykgZGllKCk7DQoNCiAgICBjaGFyIGNtZFsyNTZdOw0KICAgIGlmICgodW5zaWduZWQgaW50KXNucHJpbnRmKGNtZCwgc2l6ZW9mKGNtZCksICIvdXNyL2Jpbi9lbnYgLSAlcyAtLWxpc3QgJXMiLCBMRFNPLCBiaW4pDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA+PSBzaXplb2YoY21kKSkgZGllKCk7DQogICAgRklMRSAqIGNvbnN0IGZwID0gcG9wZW4oY21kLCAiciIpOw0KICAgIGlmICghZnApIGRpZSgpOw0KDQogICAgY2hhciBidWZbMjU2XTsNCiAgICB1bnNpZ25lZCBpbnQgbnVtX2xpYnMgPSAwOw0KICAgIHdoaWxlIChmZ2V0cyhidWYsIHNpemVvZihidWYpLCBmcCkgPT0gYnVmKSB7DQogICAgICAgIGlmICghc3RyY2hyKGJ1ZiwgJ1xuJykpIGRpZSgpOw0KDQogICAgICAgIGNvbnN0IGNoYXIgKiBjb25zdCByZWxfbGliID0gYnVmICsgc3Ryc3BuKGJ1ZiwgIlx0ICIpOw0KICAgICAgICBpZiAoc3RybmNtcChyZWxfbGliLCAibGliIiwgMykpIGNvbnRpbnVlOw0KDQogICAgICAgIGNoYXIgKiBzcCA9IHN0cmNocihyZWxfbGliLCAnICcpOw0KICAgICAgICBpZiAoIXNwKSBkaWUoKTsNCiAgICAgICAgaWYgKHN0cm5jbXAoc3AsICIgPT4gLyIsIDUpKSBkaWUoKTsNCiAgICAgICAgKnNwID0gJ1wwJzsNCiAgICAgICAgaWYgKHN0cmNocihyZWxfbGliLCAnLycpKSBkaWUoKTsNCg0KICAgICAgICBjb25zdCBjaGFyICogY29uc3QgYWJzX2xpYiA9IHNwICsgNDsNCiAgICAgICAgaWYgKCphYnNfbGliICE9ICcvJykgZGllKCk7DQogICAgICAgIHNwID0gc3RyY2hyKGFic19saWIsICcgJyk7DQogICAgICAgIGlmICghc3ApIGRpZSgpOw0KICAgICAgICBpZiAoc3RybmNtcChzcCwgIiAoMHgiLCA0KSkgZGllKCk7DQogICAgICAgICpzcCA9ICdcMCc7DQoNCiAgICAgICAgc2l6ZV90IGk7DQogICAgICAgIHN0YXRpYyBjb25zdCBjaGFyICogY29uc3QgcHJlZml4ZXNbXSA9IHsgIiIsICIvIiwgIi8uIiwgIi8uLiIgfTsNCiAgICAgICAgZm9yIChpID0gMDsgaSA8IHNpemVvZihwcmVmaXhlcykvc2l6ZW9mKCpwcmVmaXhlcyk7IGkrKykgew0KDQogICAgICAgICAgICBjaGFyIHRtcF9saWJbMjU2XTsNCiAgICAgICAgICAgIGlmICgodW5zaWduZWQgaW50KXNucHJpbnRmKHRtcF9saWIsIHNpemVvZih0bXBfbGliKSwgIiVzJXMlcyIsIGRpciwgcHJlZml4ZXNbaV0sIHJlbF9saWIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA+PSBzaXplb2YodG1wX2xpYikpIGRpZSgpOw0KICAgICAgICAgICAgY29weV9saWIoYWJzX2xpYiwgdG1wX2xpYik7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCErK251bV9saWJzKSBkaWUoKTsNCiAgICB9DQogICAgaWYgKCFudW1fbGlicykgZGllKCk7DQogICAgcHJpbnRmKCJjb3BpZWQgJXUgbGliJXNcbiIsIG51bV9saWJzLCBudW1fbGlicyA+IDEgPyAicyIgOiAiIik7DQogICAgaWYgKHBjbG9zZShmcCkgIT0gRVhJVF9TVUNDRVNTKSBkaWUoKTsNCn0NCg0KaW50DQptYWluKGNvbnN0IGludCBteV9hcmdjLCBjb25zdCBjaGFyICogY29uc3QgbXlfYXJndltdLCBjb25zdCBjaGFyICogY29uc3QgbXlfZW52cFtdKQ0Kew0KICB7DQogICAgY29uc3QgY2hhciAqIGNvbnN0ICogcCA9IG15X2VudnA7DQogICAgd2hpbGUgKCpwKyspIDsNCiAgICBteV9hdXh2ID0gKGNvbnN0IHZvaWQgKilwOw0KICB9DQogICAgaWYgKG15X2dldGF1eHZhbChBVF9QQUdFU1opICE9IFBBR0VTWikgZGllKCk7DQoNCiAgICBpZiAobXlfYXJnYyAhPSAxKzIpIHsNCiAgICAgICAgcHJpbnRmKCJVc2FnZTogJXMgdGFyZ2V0IGJpbmFyeVxuIiwgbXlfYXJndlswXSk7DQogICAgICAgIHNpemVfdCBpOw0KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgc2l6ZW9mKHRhcmdldHMpL3NpemVvZigqdGFyZ2V0cyk7IGkrKykgew0KICAgICAgICAgICAgcHJpbnRmKCJUYXJnZXQgJXp1ICVzXG4iLCBpLCB0YXJnZXRzW2ldLm5hbWUpOw0KICAgICAgICB9DQogICAgICAgIGRpZSgpOw0KICAgIH0NCiAgew0KICAgIGNvbnN0IHNpemVfdCBpID0gc3RydG91bChteV9hcmd2WzFdLCBOVUxMLCAxMCk7DQogICAgaWYgKGkgPj0gc2l6ZW9mKHRhcmdldHMpL3NpemVvZigqdGFyZ2V0cykpIGRpZSgpOw0KICAgIHRhcmdldCA9IHRhcmdldHMgKyBpOw0KICAgIHByaW50ZigiVGFyZ2V0ICV6dSAlc1xuIiwgaSwgdGFyZ2V0LT5uYW1lKTsNCiAgfQ0KICAgIGNvbnN0IHNpemVfdCBzYWZlX3N0YWNrX3NpemUgPSB0YXJnZXQtPkNWRV8yMDE1XzE1OTMgPyA2NTUzNiA6IDMyNzY4Ow0KICAgIHByaW50Zigic2FmZV9zdGFja19zaXplICV6dVxuIiwgc2FmZV9zdGFja19zaXplKTsNCiAgICBpZiAoc2FmZV9zdGFja19zaXplIDw9IFNVQl9TVEFDS19SQU5EKSBkaWUoKTsNCg0KICAgIGNvbnN0IGNoYXIgKiBjb25zdCBiaW5hcnkgPSByZWFscGF0aChteV9hcmd2WzJdLCBOVUxMKTsNCiAgICBpZiAoIWJpbmFyeSkgZGllKCk7DQogICAgaWYgKCpiaW5hcnkgIT0gJy8nKSBkaWUoKTsNCiAgICBpZiAoYWNjZXNzKGJpbmFyeSwgUl9PSyB8IFhfT0spKSBkaWUoKTsNCiAgICBjb25zdCBzdHJ1Y3QgZWxmX2luZm8gZWxmX2JpbmFyeSA9IGdldF9lbGZfaW5mbyhiaW5hcnkpOw0KICAgIGNvbnN0IHN0cnVjdCBlbGZfaW5mbyBlbGZfaW50ZXJwID0gZ2V0X2VsZl9pbmZvKExEU08pOw0KICAgIGNvbnN0IHN0cnVjdCBlbGZfaW5mbyBlbGYgPSAoZWxmX2JpbmFyeS50eXBlID09IEVUX0RZTiAmJiB0YXJnZXQtPm9mZnNldDJsaWIgJiYgIXRhcmdldC0+anVtcF9sZHNvX3BpZSkgPyBlbGZfYmluYXJ5IDogZWxmX2ludGVycDsNCiAgICBjb25zdCBzaXplX3QganVtcF9sZHNvX3BpZSA9IChlbGZfYmluYXJ5LnR5cGUgPT0gRVRfRFlOICYmIHRhcmdldC0+b2Zmc2V0MmxpYiAmJiB0YXJnZXQtPmp1bXBfbGRzb19waWUpID8gKGVsZl9iaW5hcnkucnhfZW5kIC0gZWxmX2JpbmFyeS5yeF9zdGFydCkgOiAwOw0KICAgIGlmIChlbGYucndfc3RhcnQgLSBlbGYucnhfZW5kIDw9IHRhcmdldC0+dmRzb192dmFyKSBkaWUoKTsNCg0KICAgIGNvbnN0IGNoYXIgKiBjb25zdCBzbGFzaCA9IHN0cnJjaHIoYmluYXJ5LCAnLycpOw0KICAgIGlmICghc2xhc2gpIGRpZSgpOw0KICAgIGlmIChzbGFzaCA8PSBiaW5hcnkpIGRpZSgpOw0KICAgIGNvbnN0IGNoYXIgKiBjb25zdCBvcmlnaW4gPSBzdHJuZHVwKGJpbmFyeSwgc2xhc2ggLSBiaW5hcnkpOw0KICAgIGlmICghb3JpZ2luKSBkaWUoKTsNCiAgICBwcmludGYoIm9yaWdpbiAlcyAoJXp1KVxuIiwgb3JpZ2luLCBzdHJsZW4ob3JpZ2luKSk7DQoNCiAgICBjb25zdCBjaGFyICogY29uc3QgcGxhdGZvcm0gPSAoY29uc3Qgdm9pZCAqKW15X2dldGF1eHZhbChBVF9QTEFURk9STSk7DQogICAgaWYgKCFwbGF0Zm9ybSkgZGllKCk7DQogICAgaWYgKHN0cmNtcChwbGF0Zm9ybSwgIng4Nl82NCIpICE9IDApIGRpZSgpOw0KICAgIGNvbnN0IHNpemVfdCBwbGF0Zm9ybV9sZW4gPSBzdHJsZW4ocGxhdGZvcm0pOw0KDQogICAgY29uc3Qgc3RydWN0IHsNCiAgICAgICAgY29uc3QgY2hhciAqIHN0cjsNCiAgICAgICAgc2l6ZV90IGxlbjsNCiAgICAgICAgc2l6ZV90IHJlcGxfbGVuOw0KICAgIH0gRFNUc1tdID0gew0KICAgICAgICAjZGVmaW5lIERTVF9MSUIgIkxJQiINCiAgICAgICAgeyBEU1RfTElCLCBzdHJsZW4oRFNUX0xJQiksIHN0cmxlbih0YXJnZXQtPnJlcGxfbGliKSB9LA0KICAgICAgICAjZGVmaW5lIERTVF9QTEFURk9STSAiUExBVEZPUk0iDQogICAgICAgIHsgRFNUX1BMQVRGT1JNLCBzdHJsZW4oRFNUX1BMQVRGT1JNKSwgcGxhdGZvcm1fbGVuIH0NCiAgICB9Ow0KICAgIHNpemVfdCByZXBsX21heCA9IHRhcmdldC0+aWdub3JlX29yaWdpbiA/IDAgOiBzdHJsZW4ob3JpZ2luKTsNCiAgew0KICAgIHNpemVfdCBpOw0KICAgIGZvciAoaSA9IHRhcmdldC0+aWdub3JlX2xpYiA/IDEgOiAwOyBpIDwgc2l6ZW9mKERTVHMpL3NpemVvZigqRFNUcyk7IGkrKykgew0KICAgICAgICBpZiAocmVwbF9tYXggPCBEU1RzW2ldLnJlcGxfbGVuKQ0KICAgICAgICAgICAgcmVwbF9tYXggPSBEU1RzW2ldLnJlcGxfbGVuOw0KICAgIH0NCiAgfQ0KICAgIHByaW50ZigicmVwbF9tYXggJXp1XG4iLCByZXBsX21heCk7DQogICAgaWYgKHJlcGxfbWF4IDwgNCkgZGllKCk7DQoNCiAgICBjb25zdCBFbGZXKEVoZHIpICogY29uc3Qgc3lzaW5mb19kc28gPSAoY29uc3Qgdm9pZCAqKW15X2dldGF1eHZhbChBVF9TWVNJTkZPX0VIRFIpOw0KICAgIGlmICghc3lzaW5mb19kc28pIGRpZSgpOw0KICAgIHN0cnVjdCBteV9saW5rX21hcCBzeXNpbmZvX21hcCA9IHsNCiAgICAgICAgLmxfcGhkciA9IChjb25zdCB2b2lkICopc3lzaW5mb19kc28gKyBzeXNpbmZvX2Rzby0+ZV9waG9mZiwNCiAgICAgICAgLmxfcGhudW0gPSBzeXNpbmZvX2Rzby0+ZV9waG51bSwNCiAgICAgICAgLmxfYWRkciA9IFVMT05HX01BWA0KICAgIH07DQogIHsNCiAgICB1aW50X2Zhc3QxNl90IGk7DQogICAgZm9yIChpID0gMDsgaSA8IHN5c2luZm9fbWFwLmxfcGhudW07ICsraSkgew0KICAgICAgICBjb25zdCBFbGZXKFBoZHIpICogY29uc3QgcGggPSAmc3lzaW5mb19tYXAubF9waGRyW2ldOw0KICAgICAgICBpZiAocGgtPnBfdHlwZSA9PSBQVF9MT0FEKSB7DQogICAgICAgICAgICBpZiAoc3lzaW5mb19tYXAubF9hZGRyID09IFVMT05HX01BWCkNCiAgICAgICAgICAgICAgICBzeXNpbmZvX21hcC5sX2FkZHIgPSBwaC0+cF92YWRkcjsNCiAgICAgICAgfQ0KICAgIH0NCiAgfQ0KICAgIGlmIChzeXNpbmZvX21hcC5sX2FkZHIgPT0gVUxPTkdfTUFYKSBkaWUoKTsNCiAgICBzeXNpbmZvX21hcC5sX2FkZHIgPSAoRWxmVyhBZGRyKSlzeXNpbmZvX2RzbyAtIHN5c2luZm9fbWFwLmxfYWRkcjsNCg0KICAgIGNvbnN0IHVuc2lnbmVkIGxvbmcgaHdjYXAgPSBteV9nZXRhdXh2YWwoQVRfSFdDQVApOw0KICAgIGlmICghaHdjYXApIGRpZSgpOw0KICAgIHN0cnVjdCBteV9pbXBvcnRhbnRfaHdjYXBzICogaW1wb3J0YW50X2h3Y2FwcyA9IE5VTEw7DQogICAgc2l6ZV90IG51bV9pbXBvcnRhbnRfaHdjYXBzID0gMDsNCiAgew0KICAgIHNpemVfdCBtYXhfaW1wb3J0YW50X2h3Y2FwcyA9IDA7DQogICAgdWludDMyX3QgaHdjYXBfbWFzayA9IDE7DQogICAgZG8gew0KICAgICAgICBpZiAoaHdjYXBfbWFzayAmIH5od2NhcCkgY29udGludWU7DQogICAgICAgIGNvbnN0IHVpbnQ2NF90IHBvcGNvdW50ID0gX19idWlsdGluX3BvcGNvdW50KGh3Y2FwX21hc2spOw0KICAgICAgICBpZiAocG9wY291bnQgPCAxKSBkaWUoKTsNCiAgICAgICAgaWYgKHBvcGNvdW50ID4gMzIpIGRpZSgpOw0KDQogICAgICAgIGNvbnN0IHN0cnVjdCBteV9pbXBvcnRhbnRfaHdjYXBzIGloYyA9IG15X2ltcG9ydGFudF9od2NhcHMocGxhdGZvcm0sIHBsYXRmb3JtX2xlbiwgaHdjYXAsIGh3Y2FwX21hc2ssICZzeXNpbmZvX21hcCk7DQogICAgICAgIGlmICghaWhjLnBvaW50ZXJzKSBkaWUoKTsNCg0KICAgICAgICBjb25zdCBzaXplX3QgaWR4ID0gbXlfYnNlYXJjaCgmaWhjLCBpbXBvcnRhbnRfaHdjYXBzLCBudW1faW1wb3J0YW50X2h3Y2Fwcywgc2l6ZW9mKHN0cnVjdCBteV9pbXBvcnRhbnRfaHdjYXBzKSwgY21wX2ltcG9ydGFudF9od2NhcHMpOw0KICAgICAgICBpZiAoaWR4ID4gbnVtX2ltcG9ydGFudF9od2NhcHMpIGRpZSgpOw0KDQogICAgICAgIGlmIChpZHggPT0gbnVtX2ltcG9ydGFudF9od2NhcHMgfHwgY21wX2ltcG9ydGFudF9od2NhcHMoJmloYywgaW1wb3J0YW50X2h3Y2FwcyArIGlkeCkpIHsNCiAgICAgICAgICAgIGlmIChudW1faW1wb3J0YW50X2h3Y2FwcyA+PSBtYXhfaW1wb3J0YW50X2h3Y2Fwcykgew0KICAgICAgICAgICAgICAgIGlmIChudW1faW1wb3J0YW50X2h3Y2FwcyAhPSBtYXhfaW1wb3J0YW50X2h3Y2FwcykgZGllKCk7DQogICAgICAgICAgICAgICAgaWYgKG1heF9pbXBvcnRhbnRfaHdjYXBzID49IDY1NTM2KSBkaWUoKTsNCiAgICAgICAgICAgICAgICBtYXhfaW1wb3J0YW50X2h3Y2FwcyArPSAyNTY7DQoNCiAgICAgICAgICAgICAgICBpZiAobnVtX2ltcG9ydGFudF9od2NhcHMgPj0gbWF4X2ltcG9ydGFudF9od2NhcHMpIGRpZSgpOw0KICAgICAgICAgICAgICAgIGltcG9ydGFudF9od2NhcHMgPSByZWFsbG9jKGltcG9ydGFudF9od2NhcHMsIG1heF9pbXBvcnRhbnRfaHdjYXBzICogc2l6ZW9mKHN0cnVjdCBteV9pbXBvcnRhbnRfaHdjYXBzKSk7DQogICAgICAgICAgICAgICAgaWYgKCFpbXBvcnRhbnRfaHdjYXBzKSBkaWUoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIG1lbW1vdmUoaW1wb3J0YW50X2h3Y2FwcyArIGlkeCArIDEsIGltcG9ydGFudF9od2NhcHMgKyBpZHgsIChudW1faW1wb3J0YW50X2h3Y2FwcyAtIGlkeCkgKiBzaXplb2Yoc3RydWN0IG15X2ltcG9ydGFudF9od2NhcHMpKTsNCiAgICAgICAgICAgIGltcG9ydGFudF9od2NhcHNbaWR4XSA9IGloYzsNCiAgICAgICAgICAgIG51bV9pbXBvcnRhbnRfaHdjYXBzKys7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCEoaHdjYXBfbWFzayAlIDB4MTAwMDAwMDApKQ0KICAgICAgICAgICAgcHJpbnRmKCJudW1faW1wb3J0YW50X2h3Y2FwcyAlenUgaHdjYXBfbWFzayAleFxuIiwgbnVtX2ltcG9ydGFudF9od2NhcHMsIGh3Y2FwX21hc2spOw0KICAgIH0gd2hpbGUgKCsraHdjYXBfbWFzayk7DQogIH0NCiAgICBwcmludGYoIm51bV9pbXBvcnRhbnRfaHdjYXBzICV6dVxuIiwgbnVtX2ltcG9ydGFudF9od2NhcHMpOw0KDQogICAgc3RhdGljIHN0cnVjdCB7DQogICAgICAgIHNpemVfdCBsZW4sIGd3ciwgZHN0LCBjbnQ7DQogICAgICAgIHN0cnVjdCBteV9pbXBvcnRhbnRfaHdjYXBzIGloYzsNCiAgICB9IGJlc3QgPSB7IC5paGMgPSB7IC5wb2ludGVycyA9IFNJWkVfTUFYIH0gfTsNCg0KICAgIGlmIChzdHJyY2hyKHRhcmdldC0+c3lzdGVtX2RpciwgJy8nKSAhPSB0YXJnZXQtPnN5c3RlbV9kaXIpIGRpZSgpOw0KICAgIGNvbnN0IGNoYXIgKiBjb25zdCBzZXBfbGliID0gbXlfYXNwcmludGYoIjolcyIsIHRhcmdldC0+c3lzdGVtX2Rpcik7DQogICAgY29uc3Qgc2l6ZV90IHNlcF9saWJfbGVuID0gc3RybGVuKHNlcF9saWIpOw0KICAgIGlmIChzZXBfbGliX2xlbiA+PSBNQUxMT0NfQUxJR04pIGRpZSgpOw0KDQogICAgI2RlZmluZSBMTFAgIkxEX0xJQlJBUllfUEFUSD0iDQogICAgc3RhdGljIGNoYXIgbGxwW01BWF9BUkdfU1RSTEVOXTsNCg0KICAgIHNpemVfdCBsZW47DQogICAgZm9yIChsZW4gPSBzaXplb2YobGxwKSAtIHNpemVvZihMTFApOyBsZW4gPj0gTUFMTE9DX0FMSUdOOyBsZW4gLT0gTUFMTE9DX0FMSUdOKSB7DQoNCiAgICAgICAgc2l6ZV90IGd3cjsNCiAgICAgICAgZm9yIChnd3IgPSBNQUxMT0NfQUxJR047IGd3ciA8PSBsZW4gLSBzZXBfbGliX2xlbjsgZ3dyICs9IE1BTExPQ19BTElHTikgew0KDQogICAgICAgICAgICBzaXplX3QgZHN0Ow0KICAgICAgICAgICAgZm9yIChkc3QgPSAwOyBkc3QgPCBzaXplb2YoRFNUcykvc2l6ZW9mKCpEU1RzKTsgZHN0KyspIHsNCg0KICAgICAgICAgICAgICAgIGNvbnN0IHNpemVfdCBjbnQgPSAobGVuIC0gc2VwX2xpYl9sZW4gLSBnd3IpIC8gKDEgKyBEU1RzW2RzdF0ubGVuICsgMSk7DQogICAgICAgICAgICAgICAgY29uc3Qgc2l6ZV90IGdwaiA9IChsZW4gKyBjbnQgKiAocmVwbF9tYXggLSAodGFyZ2V0LT5pZ25vcmVfbGliID8gNyA6IDQpKSArIDEgKyBTVEFDS19BTElHTi0xKSAmIH4oU1RBQ0tfQUxJR04tMSk7DQogICAgICAgICAgICAgICAgY29uc3Qgc2l6ZV90IGJ3ciA9IChjbnQgKiAoRFNUc1tkc3RdLnJlcGxfbGVuICsgMSkpICsgKGxlbiAtIGd3ciAtIGNudCAqICgxICsgRFNUc1tkc3RdLmxlbiArIDEpKSArIDE7DQoNCiAgICAgICAgICAgICAgICBzaXplX3QgaWR4Ow0KICAgICAgICAgICAgICAgIGZvciAoaWR4ID0gMDsgaWR4IDwgbnVtX2ltcG9ydGFudF9od2NhcHM7IGlkeCsrKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cnVjdCBteV9pbXBvcnRhbnRfaHdjYXBzIGloYyA9IGltcG9ydGFudF9od2NhcHNbaWR4XTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGloYy5tYXhfY2Fwc3RybGVuICUgTUFMTE9DX0FMSUdOID49IHNpemVvZigiLy4uIikpIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgICAgICBpZiAoaWhjLnBvaW50ZXJzIDw9IDIgKiBTVUJfU1RBQ0tfUkFORCkgY29udGludWU7DQoNCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2l6ZV90IG51cCA9ICgoaWhjLnBvaW50ZXJzICsgaWhjLnN0cmluZ3MgKyBQQUdFU1otMSkgJiB+KFBBR0VTWi0xKSkgKyAodGFyZ2V0LT5leHRyYV9wYWdlICogUEFHRVNaKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKG51cCA+PSAoZWxmLnJ3X3N0YXJ0IC0gZWxmLnJ4X2VuZCkgLSB0YXJnZXQtPnZkc29fdnZhcikgY29udGludWU7DQoNCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2l6ZV90IGloY19zdHJpbmdzX3N0YXJ0ID0gaWhjLnBvaW50ZXJzOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCBzaXplX3QgaWhjX3N0cmluZ3NfZW5kID0gaWhjX3N0cmluZ3Nfc3RhcnQgKyBpaGMuc3RyaW5nczsNCg0KICAgICAgICAgICAgICAgICAgICBjb25zdCBzaXplX3QgZ3BqX2Jhc2UgPSBudXAgKyB0YXJnZXQtPnZkc29fdnZhciArIChlbGYucndfZW5kIC0gZWxmLnJ3X3N0YXJ0KSArIGp1bXBfbGRzb19waWUgKyBQQUdFU1ogKyBzYWZlX3N0YWNrX3NpemU7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNpemVfdCBncGpfYmFzZV9sbyA9IGdwal9iYXNlIC0gU1VCX1NUQUNLX1JBTkQ7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNpemVfdCBncGpfYmFzZV9oaSA9IGdwal9iYXNlICsgU1VCX1NUQUNLX1JBTkQ7DQoNCiAgICAgICAgICAgICAgICAgICAgaWYgKGdwal9iYXNlX2xvIDw9IGdwaikgY29udGludWU7DQogICAgICAgICAgICAgICAgICAgIGlmIChncGpfYmFzZV9oaSAtIGdwaiA+PSBpaGNfc3RyaW5nc19zdGFydCkgY29udGludWU7DQogICAgICAgICAgICAgICAgICAgIGlmIChncGpfYmFzZV9sbyAtIGdwaiArIGd3ciA8PSBpaGNfc3RyaW5nc19zdGFydCkgY29udGludWU7DQogICAgICAgICAgICAgICAgICAgIGlmIChncGpfYmFzZV9oaSAtIGdwaiArIGd3ciArIGJ3ciA+PSBpaGNfc3RyaW5nc19lbmQpIGNvbnRpbnVlOw0KDQogICAgICAgICAgICAgICAgICAgIGlmIChiZXN0LmloYy5wb2ludGVycyA8PSBpaGMucG9pbnRlcnMpIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgICAgICBiZXN0LmloYyA9IGloYzsNCiAgICAgICAgICAgICAgICAgICAgYmVzdC5sZW4gPSBsZW47DQogICAgICAgICAgICAgICAgICAgIGJlc3QuZ3dyID0gZ3dyOw0KICAgICAgICAgICAgICAgICAgICBiZXN0LmRzdCA9IGRzdDsNCiAgICAgICAgICAgICAgICAgICAgYmVzdC5jbnQgPSBjbnQ7DQogICAgICAgICAgICAgICAgICAgIHByaW50ZigibWF4ICV6dSBpaGNwICV6dSBpaGNzICV6dSBsZW4gJXp1IGdwaiAlenUgZ3dyICV6dSBid3IgJXp1IGNudCAlenUgZHN0ICV6dSByZXBsICV6dVxuIiwNCiAgICAgICAgICAgICAgICAgICAgICAgIGloYy5tYXhfY2Fwc3RybGVuLCBpaGMucG9pbnRlcnMsIGloYy5zdHJpbmdzLCBsZW4sIGdwaiwgZ3dyLCBid3IsIGNudCwgRFNUc1tkc3RdLmxlbiwgRFNUc1tkc3RdLnJlcGxfbGVuKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgaWYgKGJlc3QuaWhjLnBvaW50ZXJzID49IFNJWkVfTUFYKSBkaWUoKTsNCg0KICAgIGlmIChJTklUSUFMX1NUQUNLX0VYUEFOU0lPTiA8PSBzYWZlX3N0YWNrX3NpemUpIGRpZSgpOw0KICAgIGNvbnN0IHNpemVfdCBwYWRzID0gKElOSVRJQUxfU1RBQ0tfRVhQQU5TSU9OIC0gc2FmZV9zdGFja19zaXplKSAvIHNpemVvZihjaGFyICopOw0KICAgIHN0YXRpYyBjaGFyIHBhZFtNQVhfQVJHX1NUUkxFTl07DQogICAgbWVtc2V0KHBhZCwgJyAnLCBzaXplb2YocGFkKS0xKTsNCg0KICB7DQogICAgY2hhciAqIGNwID0gbWVtcGNweShsbHAsIExMUCwgc2l6ZW9mKExMUCktMSk7DQogICAgbWVtc2V0KGNwLCAnLycsIGJlc3QubGVuKTsNCiAgICBpZiAoYmVzdC5sZW4gPD0gc2VwX2xpYl9sZW4pIGRpZSgpOw0KICAgIG1lbWNweShjcCArIGJlc3QubGVuIC0gc2VwX2xpYl9sZW4sIHNlcF9saWIsIHNlcF9saWJfbGVuKTsNCiAgICBpZiAoKihjcCArIGJlc3QubGVuKSkgZGllKCk7DQoNCiAgICAjZGVmaW5lIExJQl9UT19UTVAgIi8uLi90bXAvIg0KICAgIGlmIChzaXplb2YoTElCX1RPX1RNUCktMSAhPSBNQUxMT0NfQUxJR04pIGRpZSgpOw0KDQogICAgaWYgKCFiZXN0Lmd3cikgZGllKCk7DQogICAgaWYgKGJlc3QuZ3dyID49IGJlc3QubGVuKSBkaWUoKTsNCiAgICBpZiAoYmVzdC5nd3IgJSBNQUxMT0NfQUxJR04pIGRpZSgpOw0KICAgIHNpemVfdCBpOw0KICAgIGZvciAoaSA9IDA7IGkgPCBiZXN0Lmd3ciAvIE1BTExPQ19BTElHTjsgaSsrKSB7DQogICAgICAgIGNwID0gbWVtcGNweShjcCwgTElCX1RPX1RNUCwgTUFMTE9DX0FMSUdOKTsNCiAgICB9DQogICAgaWYgKCFiZXN0LmNudCkgZGllKCk7DQogICAgaWYgKGJlc3QuZHN0ID49IHNpemVvZihEU1RzKS9zaXplb2YoKkRTVHMpKSBkaWUoKTsNCiAgICBmb3IgKGkgPSAwOyBpIDwgYmVzdC5jbnQ7IGkrKykgew0KICAgICAgICAqY3ArKyA9ICckJzsNCiAgICAgICAgY3AgPSBtZW1wY3B5KGNwLCBEU1RzW2Jlc3QuZHN0XS5zdHIsIERTVHNbYmVzdC5kc3RdLmxlbik7DQogICAgICAgICpjcCsrID0gJy8nOw0KICAgIH0NCiAgICBpZiAoY3AgPj0gbGxwICsgc2l6ZW9mKGxscCkpIGRpZSgpOw0KICAgIGlmIChsbHBbc2l6ZW9mKGxscCktMV0pIGRpZSgpOw0KICAgIGlmIChzdHJsZW4obGxwKSAhPSBzaXplb2YoTExQKS0xICsgYmVzdC5sZW4pIGRpZSgpOw0KICB9DQoNCiAgICAjZGVmaW5lIExIQ00gIkxEX0hXQ0FQX01BU0s9Ig0KICAgIHN0YXRpYyBjaGFyIGxoY21bNjRdOw0KICAgIGlmICgodW5zaWduZWQgaW50KXNucHJpbnRmKGxoY20sIHNpemVvZihsaGNtKSwgIiVzJWx1IiwgTEhDTSwgYmVzdC5paGMuaHdjYXBfbWFzaykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA+PSBzaXplb2YobGhjbSkpIGRpZSgpOw0KDQogICAgY29uc3Qgc2l6ZV90IGFyZ3MgPSAxICsgKHRhcmdldC0+anVtcF9sZHNvX3BpZSA/IDAgOiBwYWRzKSArIDE7DQogICAgY2hhciAqKiBjb25zdCBhcmd2ID0gY2FsbG9jKGFyZ3MsIHNpemVvZihjaGFyICopKTsNCiAgICBpZiAoIWFyZ3YpIGRpZSgpOw0KICB7DQogICAgY2hhciAqKiBhcCA9IGFyZ3Y7DQogICAgKmFwKysgPSAoY2hhciAqKWJpbmFyeTsNCiAgICBpZiAoIXRhcmdldC0+anVtcF9sZHNvX3BpZSkgew0KICAgICAgICBzaXplX3QgaTsNCiAgICAgICAgZm9yIChpID0gMDsgaSA8IHBhZHM7IGkrKykgew0KICAgICAgICAgICAgKmFwKysgPSBwYWQ7DQogICAgICAgIH0NCiAgICB9DQogICAgKmFwKysgPSBOVUxMOw0KICAgIGlmIChhcCAhPSBhcmd2ICsgYXJncykgZGllKCk7DQogIH0NCg0KICAgIGNvbnN0IHNpemVfdCBlbnZzID0gMyArICh0YXJnZXQtPmp1bXBfbGRzb19waWUgPyBwYWRzIDogMCkgKyAxOw0KICAgIGNoYXIgKiogY29uc3QgZW52cCA9IGNhbGxvYyhlbnZzLCBzaXplb2YoY2hhciAqKSk7DQogICAgaWYgKCFlbnZwKSBkaWUoKTsNCiAgew0KICAgIGNoYXIgKiogZXAgPSBlbnZwOw0KICAgICplcCsrID0gbGxwOw0KICAgICplcCsrID0gbGhjbTsNCiAgICAjZGVmaW5lIFJFTF9MQSAiYSINCiAgICAjZGVmaW5lIExEQSAiTERfQVVESVQ9Ig0KICAgICNkZWZpbmUgTERQICJMRF9QUkVMT0FEPSINCiAgICAqZXArKyA9IHRhcmdldC0+ZGlzYWJsZV9hdWRpdCA/IExEUCBSRUxfTEEgOiBMREEgUkVMX0xBOw0KICAgIGlmICh0YXJnZXQtPmp1bXBfbGRzb19waWUpIHsNCiAgICAgICAgc2l6ZV90IGk7DQogICAgICAgIGZvciAoaSA9IDA7IGkgPCBwYWRzOyBpKyspIHsNCiAgICAgICAgICAgICplcCsrID0gcGFkOw0KICAgICAgICB9DQogICAgfQ0KICAgICplcCsrID0gTlVMTDsNCiAgICBpZiAoZXAgIT0gZW52cCArIGVudnMpIGRpZSgpOw0KICB9DQoNCiAgew0KICAgIGNvbnN0IHNpemVfdCBNSU5fR0FQID0gdGFyZ2V0LT5DVkVfMjAxNV8xNTkzID8NCiAgICAgICAgKDEyOCoxMDI0KjEwMjRVTCArICgoKC0xVSApICYgMHgzZmZmZmYpIDw8IDEyKSkgOg0KICAgICAgICAoMTI4KjEwMjQqMTAyNFVMICsgKCgoLTFVTCkgJiAweDNmZmZmZikgPDwgMTIpKSA7DQogICAgcHJpbnRmKCJNSU5fR0FQICV6dVxuIiwgTUlOX0dBUCk7DQoNCiAgICBpZiAocGFkcyAqIHNpemVvZihwYWQpICsgKDE8PDIwKSA+PSBNSU5fR0FQIC8gNCkgZGllKCk7DQogICAgY29uc3Qgc3RydWN0IHJsaW1pdCBybGltaXRfc3RhY2sgPSB7IE1JTl9HQVAsIE1JTl9HQVAgfTsNCiAgICBpZiAoc2V0cmxpbWl0KFJMSU1JVF9TVEFDSywgJnJsaW1pdF9zdGFjaykpIGRpZSgpOw0KICB9DQoNCiAgICBpbnQgcGlwZWZkWzJdOw0KICAgIGlmIChwaXBlKHBpcGVmZCkpIGRpZSgpOw0KICAgIGlmIChjbG9zZShwaXBlZmRbMF0pKSBkaWUoKTsNCiAgICBwaXBlZmRbMF0gPSAtMTsNCiAgICBpZiAoc2lnbmFsKFNJR1BJUEUsIFNJR19ERkwpID09IFNJR19FUlIpIGRpZSgpOw0KDQogIHsNCiAgICBjb25zdCBjaGFyICogY29uc3QgYWJzX2xhX2RpciA9IG15X2FzcHJpbnRmKCIvJXMvJXMvIiwgdGFyZ2V0LT5zeXN0ZW1fZGlyLCBMSUJfVE9fVE1QKTsNCiAgICBjb25zdCBjaGFyICogY29uc3QgYWJzX2xhc1tdID0gew0KICAgICAgICBteV9hc3ByaW50ZigiJXMlcyVzIiwgYWJzX2xhX2RpciwgIiIsIFJFTF9MQSksDQogICAgICAgIG15X2FzcHJpbnRmKCIlcyVzJXMiLCBhYnNfbGFfZGlyLCAiLyIsIFJFTF9MQSksDQogICAgICAgIG15X2FzcHJpbnRmKCIlcyVzJXMiLCBhYnNfbGFfZGlyLCAiLy4iLCBSRUxfTEEpLA0KICAgICAgICBteV9hc3ByaW50ZigiJXMlcyVzIiwgYWJzX2xhX2RpciwgIi8uLiIsIFJFTF9MQSksDQogICAgfTsNCiAgICBzaXplX3QgaTsNCiAgICBmb3IgKGkgPSAwOyBpIDwgc2l6ZW9mKGFic19sYXMpL3NpemVvZigqYWJzX2xhcyk7IGkrKykgew0KICAgICAgICBjb25zdCBpbnQgZmQgPSBvcGVuKGFic19sYXNbaV0sIE9fV1JPTkxZIHwgT19DUkVBVCB8IE9fVFJVTkMgfCBPX05PRk9MTE9XLCAwKTsNCiAgICAgICAgaWYgKGZkIDw9IC0xKSBkaWUoKTsNCiAgICAgIHsNCiAgICAgICAgc3RydWN0IHN0YXQgc3Q7DQogICAgICAgIGlmIChmc3RhdChmZCwgJnN0KSkgZGllKCk7DQogICAgICAgIGlmICghU19JU1JFRyhzdC5zdF9tb2RlKSkgZGllKCk7DQogICAgICAgIGlmIChzdC5zdF91aWQgIT0gZ2V0dWlkKCkpIGRpZSgpOw0KICAgICAgICBpZiAoc3Quc3RfdWlkICE9IGdldGV1aWQoKSkgZGllKCk7DQogICAgICB9DQogICAgICB7DQogICAgICAgIHN0YXRpYyBjb25zdA0KICAgICAgICAjaW5jbHVkZSAibGEuc28uaCINCiAgICAgICAgaWYgKHNpemVvZihsYV9zbykgIT0gbGFfc29fbGVuKSBkaWUoKTsNCiAgICAgICAgaWYgKHdyaXRlKGZkLCBsYV9zbywgc2l6ZW9mKGxhX3NvKSkgIT0gKHNzaXplX3Qpc2l6ZW9mKGxhX3NvKSkgZGllKCk7DQogICAgICB9DQogICAgICAgIGlmIChmY2htb2QoZmQsIDA0NzU1KSkgZGllKCk7DQogICAgICAgIGlmIChjbG9zZShmZCkpIGRpZSgpOw0KICAgIH0NCiAgICBpZiAodGFyZ2V0LT5kaXNhYmxlX2F1ZGl0KSBjcmVhdGVfbmVlZGVkX2xpYnMoYmluYXJ5LCBhYnNfbGFfZGlyKTsNCiAgfQ0KDQogICAgc2l6ZV90IHRyeTsNCiAgICBmb3IgKHRyeSA9IDE7IHRyeTsgdHJ5KyspIHsNCiAgICAgICAgaWYgKGZmbHVzaChzdGRvdXQpKSBkaWUoKTsNCiAgICAgICAgY29uc3QgcGlkX3QgcGlkID0gZm9yaygpOw0KICAgICAgICBpZiAocGlkIDw9IC0xKSBkaWUoKTsNCiAgICAgICAgaWYgKHBpZCA9PSAwKSB7DQogICAgICAgICAgICBpZiAoZHVwMihwaXBlZmRbMV0sIDEpICE9IDEpIGRpZSgpOw0KICAgICAgICAgICAgaWYgKGR1cDIocGlwZWZkWzFdLCAyKSAhPSAyKSBkaWUoKTsNCiAgICAgICAgICAgIGV4ZWN2ZSgqYXJndiwgYXJndiwgZW52cCk7DQogICAgICAgICAgICBkaWUoKTsNCiAgICAgICAgfQ0KICAgICAgICBpbnQgc3RhdHVzID0gMDsNCiAgICAgICAgc3RydWN0IHRpbWV2YWwgc3RhcnQsIHN0b3AsIGRpZmY7DQogICAgICAgIGlmIChnZXR0aW1lb2ZkYXkoJnN0YXJ0LCBOVUxMKSkgZGllKCk7DQogICAgICAgIGlmICh3YWl0cGlkKHBpZCwgJnN0YXR1cywgV1VOVFJBQ0VEKSAhPSBwaWQpIGRpZSgpOw0KICAgICAgICBpZiAoZ2V0dGltZW9mZGF5KCZzdG9wLCBOVUxMKSkgZGllKCk7DQogICAgICAgIHRpbWVyc3ViKCZzdG9wLCAmc3RhcnQsICZkaWZmKTsNCiAgICAgICAgcHJpbnRmKCJ0cnkgJXp1ICVsZC4lMDZsZCAiLCB0cnksIGRpZmYudHZfc2VjLCBkaWZmLnR2X3VzZWMpOw0KDQogICAgICAgIGlmIChXSUZTSUdOQUxFRChzdGF0dXMpKSB7DQogICAgICAgICAgICBwcmludGYoInNpZ25hbCAlZFxuIiwgV1RFUk1TSUcoc3RhdHVzKSk7DQogICAgICAgICAgICBzd2l0Y2ggKFdURVJNU0lHKHN0YXR1cykpIHsNCiAgICAgICAgICAgICAgICBjYXNlIFNJR1BJUEU6DQogICAgICAgICAgICAgICAgY2FzZSBTSUdTRUdWOg0KICAgICAgICAgICAgICAgIGNhc2UgU0lHQlVTOg0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgICAgICBkaWUoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIGlmIChXSUZFWElURUQoc3RhdHVzKSkgew0KICAgICAgICAgICAgcHJpbnRmKCJleGl0ZWQgJWRcbiIsIFdFWElUU1RBVFVTKHN0YXR1cykpOw0KICAgICAgICAgICAgZGllKCk7DQogICAgICAgIH0gZWxzZSBpZiAoV0lGU1RPUFBFRChzdGF0dXMpKSB7DQogICAgICAgICAgICBwcmludGYoInN0b3BwZWQgJWRcbiIsIFdTVE9QU0lHKHN0YXR1cykpOw0KICAgICAgICAgICAgZGllKCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBwcmludGYoInVua25vd24gJWRcbiIsIHN0YXR1cyk7DQogICAgICAgICAgICBkaWUoKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBkaWUoKTsNCn0=", 
    "filename": "platforms/lin_x86-64/local/42275.c", 
    "id": "42275", 
    "cves": [
        "CVE-2017-1000366", 
        "CVE-2017-1000379"
    ]
}